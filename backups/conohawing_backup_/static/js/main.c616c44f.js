/*! For license information please see main.c616c44f.js.LICENSE.txt */
(()=>{var e={43:(e,t,n)=>{"use strict";e.exports=n(202)},73:(e,t,n)=>{"use strict";n.d(t,{h:()=>d,setGlobalNavigate:()=>o});var s=n(405);let r=null,a=!1,l=null;const o=e=>{r=e},i=e=>![/\.hot-update\.json$/,/\.hot-update\.js$/,/\.hot-update\.css$/,/\.js$/,/\.css$/,/\.png$/,/\.jpg$/,/\.jpeg$/,/\.gif$/,/\.svg$/,/\.ico$/,/\.woff$/,/\.woff2$/,/\.ttf$/,/\.eot$/,/\.map$/].some(t=>t.test(e))&&!["/login","/instructor-login","/refresh","/register","/forgot-password","/api/messages/unread-count","/verify-temp-password","/restore-master-user"].some(t=>e.includes(t)),c=e=>e.includes("/login")||e.endsWith("/login")||e.includes("/instructor-login"),d=()=>{const e=window.fetch;window.fetch=async function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const d=!i(t);d||console.log("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u30ea\u30af\u30a8\u30b9\u30c8\u958b\u59cb",{url:t,method:o.method});if((t.startsWith("http://")||t.startsWith("https://"))&&!d&&console.log("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u5b8c\u5168\u306aURL\u3092\u691c\u51fa\u3001\u8a8d\u8a3c\u30d8\u30c3\u30c0\u30fc\u3092\u8ffd\u52a0\u3057\u307e\u3059"),c(t))return console.log("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u30ed\u30b0\u30a4\u30f3\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u305f\u3081\u3001\u8a8d\u8a3c\u51e6\u7406\u3092\u30b9\u30ad\u30c3\u30d7"),e(t,o);if(a&&!t.includes("/client-ip")&&!t.includes("/health"))throw console.log("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u8a8d\u8a3c\u30a8\u30e9\u30fc\u51e6\u7406\u4e2d\u306e\u305f\u3081\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),new Error("Authentication error handling in progress");try{var u;const{accessToken:l,refreshToken:x}=(0,s.Uk)(),g=localStorage.getItem("loginCode")&&localStorage.getItem("tempPassword"),h=localStorage.getItem("tempPasswordExpiry");let p=!1;if(g)if(h){const e=new Date(h);p=e>new Date}else p=!0;!i(t)||!l||null!==(u=o.headers)&&void 0!==u&&u.Authorization?!i(t)||l||d||(p?console.log("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u30c8\u30fc\u30af\u30f3\u306a\u3057\u3060\u304c\u3001\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u304c\u6709\u52b9\u3067\u3059",{url:t}):console.warn("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u8a8d\u8a3c\u304c\u5fc5\u8981\u306a\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3067\u3059\u304c\u3001\u30c8\u30fc\u30af\u30f3\u304c\u3042\u308a\u307e\u305b\u3093",{url:t})):(o.headers={...o.headers,Authorization:`Bearer ${l}`},d||console.log("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: Authorization\u30d8\u30c3\u30c0\u30fc\u3092\u8ffd\u52a0",{hasToken:!!l,tokenLength:l?l.length:0}));const f=await e(t,o);if(401===f.status||403===f.status){const d=localStorage.getItem("loginCode")&&localStorage.getItem("tempPassword"),u=localStorage.getItem("tempPasswordExpiry");let g=!1;if(d)if(u){const e=new Date(u);g=e>new Date}else g=!0;if(console.warn("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u8a8d\u8a3c\u30a8\u30e9\u30fc\u3092\u691c\u51fa",{url:t,status:f.status,hasToken:!!l,tokenLength:l?l.length:0,hasTempPasswordAuth:d,isTempPasswordValid:g}),c(t))return console.log("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u30ed\u30b0\u30a4\u30f3\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u305f\u3081\u3001\u8a8d\u8a3c\u30a8\u30e9\u30fc\u51e6\u7406\u3092\u30b9\u30ad\u30c3\u30d7"),f;if(!i(t))return console.log("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u8a8d\u8a3c\u4e0d\u8981\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u305f\u3081\u3001\u8a8d\u8a3c\u30a8\u30e9\u30fc\u51e6\u7406\u3092\u30b9\u30ad\u30c3\u30d7"),f;if(g&&!l&&(console.error("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u304c\u6709\u52b9\u3067\u3059\u304c\u3001\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u304c\u8a8d\u8a3c\u30a8\u30e9\u30fc\u3092\u8fd4\u3057\u307e\u3057\u305f"),console.error("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u304cJWT\u30c8\u30fc\u30af\u30f3\u30d9\u30fc\u30b9\u306e\u8a8d\u8a3c\u3092\u8981\u6c42\u3057\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059")),a=!0,console.log("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u8a8d\u8a3c\u30a8\u30e9\u30fc\u51e6\u7406\u3092\u958b\u59cb\u3057\u307e\u3059"),x&&(0,s._r)(x))throw console.error("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u306e\u6709\u52b9\u671f\u9650\u304c\u5207\u308c\u3066\u3044\u307e\u3059"),r&&(0,s.handleTokenInvalid)(r,"\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u671f\u9650\u5207\u308c\u3067\u3059\u3002\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),new Error("Refresh token expired");if(x&&!(0,s._r)(x))try{console.log("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u7528\u3057\u3066\u81ea\u52d5\u518d\u8a8d\u8a3c\u3092\u8a66\u884c");const{refreshTokenAPI:s,storeTokens:r}=await Promise.resolve().then(n.bind(n,405)),a=await s(x);if(a.success&&a.data){r(a.data.access_token,a.data.refresh_token),console.log("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u6210\u529f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u518d\u5b9f\u884c");const n={...o,headers:{...o.headers,Authorization:`Bearer ${a.data.access_token}`}};return await e(t,n)}}catch(m){console.error("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u306b\u5931\u6557:",m)}throw console.warn("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: Authentication failed, redirecting to login"),r&&(0,s.handleTokenInvalid)(r,"\u8a8d\u8a3c\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),new Error("Authentication failed")}return f}catch(x){if("Authentication failed"===x.message||"Refresh token expired"===x.message)throw x;throw x}finally{l&&clearTimeout(l),l=setTimeout(()=>{a=!1,l=null,console.log("Fetch\u30a4\u30f3\u30bf\u30fc\u30bb\u30d7\u30bf\u30fc: \u8a8d\u8a3c\u30a8\u30e9\u30fc\u51e6\u7406\u30d5\u30e9\u30b0\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u307e\u3057\u305f")},2e3)}}}},146:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.camelCase=void 0;var n=/^--[a-zA-Z0-9_-]+$/,s=/-([a-z])/g,r=/^[^-]+$/,a=/^-(webkit|moz|ms|o|khtml)-/,l=/^-(ms)-/,o=function(e,t){return t.toUpperCase()},i=function(e,t){return"".concat(t,"-")};t.camelCase=function(e,t){return void 0===t&&(t={}),function(e){return!e||r.test(e)||n.test(e)}(e)?e:(e=e.toLowerCase(),(e=t.reactCompat?e.replace(l,i):e.replace(a,i)).replace(s,o))}},202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),s=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),i=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),x=Symbol.iterator;var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h=Object.assign,p={};function f(e,t,n){this.props=e,this.context=t,this.refs=p,this.updater=n||g}function b(){}function y(e,t,n){this.props=e,this.context=t,this.refs=p,this.updater=n||g}f.prototype.isReactComponent={},f.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},f.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=f.prototype;var v=y.prototype=new b;v.constructor=y,h(v,f.prototype),v.isPureReactComponent=!0;var j=Array.isArray,N=Object.prototype.hasOwnProperty,w={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,s){var r,a={},l=null,o=null;if(null!=t)for(r in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(l=""+t.key),t)N.call(t,r)&&!k.hasOwnProperty(r)&&(a[r]=t[r]);var i=arguments.length-2;if(1===i)a.children=s;else if(1<i){for(var c=Array(i),d=0;d<i;d++)c[d]=arguments[d+2];a.children=c}if(e&&e.defaultProps)for(r in i=e.defaultProps)void 0===a[r]&&(a[r]=i[r]);return{$$typeof:n,type:e,key:l,ref:o,props:a,_owner:w.current}}function _(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function T(e,t,r,a,l){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var i=!1;if(null===e)i=!0;else switch(o){case"string":case"number":i=!0;break;case"object":switch(e.$$typeof){case n:case s:i=!0}}if(i)return l=l(i=e),e=""===a?"."+I(i,0):a,j(l)?(r="",null!=e&&(r=e.replace(C,"$&/")+"/"),T(l,t,r,"",function(e){return e})):null!=l&&(_(l)&&(l=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(l,r+(!l.key||i&&i.key===l.key?"":(""+l.key).replace(C,"$&/")+"/")+e)),t.push(l)),1;if(i=0,a=""===a?".":a+":",j(e))for(var c=0;c<e.length;c++){var d=a+I(o=e[c],c);i+=T(o,t,r,d,l)}else if(d=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=x&&e[x]||e["@@iterator"])?e:null}(e),"function"===typeof d)for(e=d.call(e),c=0;!(o=e.next()).done;)i+=T(o=o.value,t,r,d=a+I(o,c++),l);else if("object"===o)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return i}function P(e,t,n){if(null==e)return e;var s=[],r=0;return T(e,s,"","",function(e){return t.call(n,e,r++)}),s}function L(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var E={current:null},D={transition:null},A={ReactCurrentDispatcher:E,ReactCurrentBatchConfig:D,ReactCurrentOwner:w};function $(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:P,forEach:function(e,t,n){P(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return P(e,function(){t++}),t},toArray:function(e){return P(e,function(e){return e})||[]},only:function(e){if(!_(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=f,t.Fragment=r,t.Profiler=l,t.PureComponent=y,t.StrictMode=a,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=A,t.act=$,t.cloneElement=function(e,t,s){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=h({},e.props),a=e.key,l=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(l=t.ref,o=w.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var i=e.type.defaultProps;for(c in t)N.call(t,c)&&!k.hasOwnProperty(c)&&(r[c]=void 0===t[c]&&void 0!==i?i[c]:t[c])}var c=arguments.length-2;if(1===c)r.children=s;else if(1<c){i=Array(c);for(var d=0;d<c;d++)i[d]=arguments[d+2];r.children=i}return{$$typeof:n,type:e.type,key:a,ref:l,props:r,_owner:o}},t.createContext=function(e){return(e={$$typeof:i,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=_,t.lazy=function(e){return{$$typeof:m,_payload:{_status:-1,_result:e},_init:L}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=$,t.useCallback=function(e,t){return E.current.useCallback(e,t)},t.useContext=function(e){return E.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return E.current.useDeferredValue(e)},t.useEffect=function(e,t){return E.current.useEffect(e,t)},t.useId=function(){return E.current.useId()},t.useImperativeHandle=function(e,t,n){return E.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return E.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return E.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return E.current.useMemo(e,t)},t.useReducer=function(e,t,n){return E.current.useReducer(e,t,n)},t.useRef=function(e){return E.current.useRef(e)},t.useState=function(e){return E.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return E.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return E.current.useTransition()},t.version="18.3.1"},222:function(e,t,n){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=null;if(!e||"string"!==typeof e)return n;var s=(0,r.default)(e),a="function"===typeof t;return s.forEach(function(e){if("declaration"===e.type){var s=e.property,r=e.value;a?t(s,r,e):r&&((n=n||{})[s]=r)}}),n};var r=s(n(403))},234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var s=n-1>>>1,r=e[s];if(!(0<a(r,t)))break e;e[s]=t,e[n]=r,n=s}}function s(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var s=0,r=e.length,l=r>>>1;s<l;){var o=2*(s+1)-1,i=e[o],c=o+1,d=e[c];if(0>a(i,n))c<r&&0>a(d,i)?(e[s]=d,e[c]=n,s=c):(e[s]=i,e[o]=n,s=o);else{if(!(c<r&&0>a(d,n)))break e;e[s]=d,e[c]=n,s=c}}}return t}function a(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var l=performance;t.unstable_now=function(){return l.now()}}else{var o=Date,i=o.now();t.unstable_now=function(){return o.now()-i}}var c=[],d=[],u=1,m=null,x=3,g=!1,h=!1,p=!1,f="function"===typeof setTimeout?setTimeout:null,b="function"===typeof clearTimeout?clearTimeout:null,y="undefined"!==typeof setImmediate?setImmediate:null;function v(e){for(var t=s(d);null!==t;){if(null===t.callback)r(d);else{if(!(t.startTime<=e))break;r(d),t.sortIndex=t.expirationTime,n(c,t)}t=s(d)}}function j(e){if(p=!1,v(e),!h)if(null!==s(c))h=!0,D(N);else{var t=s(d);null!==t&&A(j,t.startTime-e)}}function N(e,n){h=!1,p&&(p=!1,b(_),_=-1),g=!0;var a=x;try{for(v(n),m=s(c);null!==m&&(!(m.expirationTime>n)||e&&!T());){var l=m.callback;if("function"===typeof l){m.callback=null,x=m.priorityLevel;var o=l(m.expirationTime<=n);n=t.unstable_now(),"function"===typeof o?m.callback=o:m===s(c)&&r(c),v(n)}else r(c);m=s(c)}if(null!==m)var i=!0;else{var u=s(d);null!==u&&A(j,u.startTime-n),i=!1}return i}finally{m=null,x=a,g=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var w,k=!1,S=null,_=-1,C=5,I=-1;function T(){return!(t.unstable_now()-I<C)}function P(){if(null!==S){var e=t.unstable_now();I=e;var n=!0;try{n=S(!0,e)}finally{n?w():(k=!1,S=null)}}else k=!1}if("function"===typeof y)w=function(){y(P)};else if("undefined"!==typeof MessageChannel){var L=new MessageChannel,E=L.port2;L.port1.onmessage=P,w=function(){E.postMessage(null)}}else w=function(){f(P,0)};function D(e){S=e,k||(k=!0,w())}function A(e,n){_=f(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){h||g||(h=!0,D(N))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return x},t.unstable_getFirstCallbackNode=function(){return s(c)},t.unstable_next=function(e){switch(x){case 1:case 2:case 3:var t=3;break;default:t=x}var n=x;x=t;try{return e()}finally{x=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=x;x=e;try{return t()}finally{x=n}},t.unstable_scheduleCallback=function(e,r,a){var l=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?l+a:l:a=l,e){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return e={id:u++,callback:r,priorityLevel:e,startTime:a,expirationTime:o=a+o,sortIndex:-1},a>l?(e.sortIndex=a,n(d,e),null===s(c)&&e===s(d)&&(p?(b(_),_=-1):p=!0,A(j,a-l))):(e.sortIndex=o,n(c,e),h||g||(h=!0,D(N))),e},t.unstable_shouldYield=T,t.unstable_wrapCallback=function(e){var t=x;return function(){var n=x;x=t;try{return e.apply(this,arguments)}finally{x=n}}}},240:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString,s=Object.defineProperty,r=Object.getOwnPropertyDescriptor,a=function(e){return"function"===typeof Array.isArray?Array.isArray(e):"[object Array]"===n.call(e)},l=function(e){if(!e||"[object Object]"!==n.call(e))return!1;var s,r=t.call(e,"constructor"),a=e.constructor&&e.constructor.prototype&&t.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!r&&!a)return!1;for(s in e);return"undefined"===typeof s||t.call(e,s)},o=function(e,t){s&&"__proto__"===t.name?s(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},i=function(e,n){if("__proto__"===n){if(!t.call(e,n))return;if(r)return r(e,n).value}return e[n]};e.exports=function e(){var t,n,s,r,c,d,u=arguments[0],m=1,x=arguments.length,g=!1;for("boolean"===typeof u&&(g=u,u=arguments[1]||{},m=2),(null==u||"object"!==typeof u&&"function"!==typeof u)&&(u={});m<x;++m)if(null!=(t=arguments[m]))for(n in t)s=i(u,n),u!==(r=i(t,n))&&(g&&r&&(l(r)||(c=a(r)))?(c?(c=!1,d=s&&a(s)?s:[]):d=s&&l(s)?s:{},o(u,{name:n,newValue:e(g,d,r)})):"undefined"!==typeof r&&o(u,{name:n,newValue:r}));return u}},291:(e,t,n)=>{"use strict";n.d(t,{NR:()=>i,Nx:()=>r,isExpired:()=>l,pu:()=>s,yJ:()=>a});const s=()=>{try{const e=new Date,t=e.toLocaleString("ja-JP",{timeZone:"Asia/Tokyo",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),n=new Date(t.replace(/\//g,"-"));return isNaN(n.getTime())?(console.warn("getCurrentJapanTime: \u65e5\u672c\u6642\u9593\u306e\u53d6\u5f97\u306b\u5931\u6557\u3001\u73fe\u5728\u6642\u523b\u3092\u8fd4\u3057\u307e\u3059"),e):n}catch(e){return console.error("getCurrentJapanTime \u30a8\u30e9\u30fc:",e),new Date}},r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Date(e).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",...t})},a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return"";const n=e.toString();if(n.includes("-")&&(n.includes(" ")||n.includes("T"))){return n.replace(/-/g,"/").replace("T"," ").replace(/\.\d{3}Z?$/,"").replace(/\s+/g," ")}return new Date(e).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",...t})},l=e=>{if(console.log("isExpired \u547c\u3073\u51fa\u3057:",{expiryTime:e,type:typeof e,length:e?e.length:"N/A"}),!e)return console.log("isExpired: \u7a7a\u5024\u306e\u305f\u3081\u671f\u9650\u5207\u308c\u3068\u3057\u3066\u6271\u3046"),!0;try{if("0000-00-00 00:00:00"===e||"0000-00-00"===e||"null"===e||"undefined"===e||null===e||void 0===e||""===e||"NULL"===e||"None"===e)return console.log("isExpired: \u7121\u52b9\u306a\u65e5\u4ed8\u5024\u306e\u305f\u3081\u671f\u9650\u5207\u308c\u3068\u3057\u3066\u6271\u3046:",e),!0;const t=String(e).trim();if(""===t)return console.log("isExpired: \u7a7a\u6587\u5b57\u5217\u306e\u305f\u3081\u671f\u9650\u5207\u308c\u3068\u3057\u3066\u6271\u3046"),!0;const n=new Date(t);if(isNaN(n.getTime()))return console.warn("isExpired: \u7121\u52b9\u306a\u65e5\u4ed8\u5024:",t),!0;const r=s();return console.log("isExpired \u30c1\u30a7\u30c3\u30af:",{original:e,expiryString:t,japanDateValid:!isNaN(n.getTime()),nowValid:!isNaN(r.getTime()),japanDateTimestamp:n.getTime(),nowTimestamp:r.getTime(),isExpired:n<=r}),n<=r}catch(t){return console.error("isExpired \u30a8\u30e9\u30fc:",t,"expiryTime:",e),!0}},o=()=>{return e=new Date,new Date(e).toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"-");var e},i=e=>{if(!e||""===e.trim())return null;return((e,t)=>{if(!e||!t)return null;try{const n=new Date(`${e}T${t}:00`);if(isNaN(n.getTime()))return null;const s=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),a=String(n.getDate()).padStart(2,"0"),l=String(n.getHours()).padStart(2,"0");return`${s}-${r}-${a} ${l}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`}catch(n){return console.error("\u65e5\u6642\u5909\u63db\u30a8\u30e9\u30fc:",n),null}})(o(),e)}},294:function(e,t,n){"use strict";var s=(this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}})(n(222)),r=n(146);function a(e,t){var n={};return e&&"string"===typeof e?((0,s.default)(e,function(e,s){e&&s&&(n[(0,r.camelCase)(e,t)]=s)}),n):n}a.default=a,e.exports=a},391:(e,t,n)=>{"use strict";var s=n(950);t.createRoot=s.createRoot,t.hydrateRoot=s.hydrateRoot},403:e=>{var t=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,n=/\n/g,s=/^\s*/,r=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,a=/^:\s*/,l=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,o=/^[;\s]*/,i=/^\s+|\s+$/g,c="";function d(e){return e?e.replace(i,c):c}e.exports=function(e,i){if("string"!==typeof e)throw new TypeError("First argument must be a string");if(!e)return[];i=i||{};var u=1,m=1;function x(e){var t=e.match(n);t&&(u+=t.length);var s=e.lastIndexOf("\n");m=~s?e.length-s:m+e.length}function g(){var e={line:u,column:m};return function(t){return t.position=new h(e),y(),t}}function h(e){this.start=e,this.end={line:u,column:m},this.source=i.source}h.prototype.content=e;var p=[];function f(t){var n=new Error(i.source+":"+u+":"+m+": "+t);if(n.reason=t,n.filename=i.source,n.line=u,n.column=m,n.source=e,!i.silent)throw n;p.push(n)}function b(t){var n=t.exec(e);if(n){var s=n[0];return x(s),e=e.slice(s.length),n}}function y(){b(s)}function v(e){var t;for(e=e||[];t=j();)!1!==t&&e.push(t);return e}function j(){var t=g();if("/"==e.charAt(0)&&"*"==e.charAt(1)){for(var n=2;c!=e.charAt(n)&&("*"!=e.charAt(n)||"/"!=e.charAt(n+1));)++n;if(n+=2,c===e.charAt(n-1))return f("End of comment missing");var s=e.slice(2,n-2);return m+=2,x(s),e=e.slice(n),m+=2,t({type:"comment",comment:s})}}function N(){var e=g(),n=b(r);if(n){if(j(),!b(a))return f("property missing ':'");var s=b(l),i=e({type:"declaration",property:d(n[0].replace(t,c)),value:s?d(s[0].replace(t,c)):c});return b(o),i}}return y(),function(){var e,t=[];for(v(t);e=N();)!1!==e&&(t.push(e),v(t));return t}()}},405:(e,t,n)=>{"use strict";n.d(t,{EY:()=>d,G6:()=>m,PD:()=>i,Uk:()=>x,V$:()=>h,Vg:()=>f,Yq:()=>y,_r:()=>u,handleTokenInvalid:()=>b,refreshTokenAPI:()=>p,storeTokens:()=>g});var s=n(533);const r="loginCode",a="tempPassword",l="currentUser",o="tempPasswordExpiry",i=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{if(localStorage.setItem(r,e),localStorage.setItem(a,t),n&&localStorage.setItem(l,JSON.stringify(n)),s)localStorage.setItem(o,s);else{const e=new Date;e.setHours(e.getHours()+24),localStorage.setItem(o,e.toISOString())}console.log("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u60c5\u5831\u3092\u4fdd\u5b58\u3057\u307e\u3057\u305f:",{loginCode:"***",tempPassword:"***",expiry:s||"24\u6642\u9593\u5f8c"})}catch(i){console.error("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u60c5\u5831\u306e\u4fdd\u5b58\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",i)}},c=e=>{try{if(!e||"string"!==typeof e)return null;const t=e.split(".");if(3!==t.length)return null;const n=t[1].replace(/-/g,"+").replace(/_/g,"/"),s=n+"=".repeat((4-n.length%4)%4),r=atob(s);return JSON.parse(r)}catch(t){return console.error("JWT decode error:",t),null}},d=e=>{if(!e)return 0;if(!e.includes(".")||3!==e.split(".").length)return console.error("Invalid token format:",{token:e?e.substring(0,50)+"...":"null",fullToken:e,length:e?e.length:0,containsDots:!!e&&e.includes("."),dotCount:e?(e.match(/\./g)||[]).length:0}),0;try{const t=c(e);if(!t||!t.exp)return console.error("Invalid token payload or missing exp field"),0;const n=1e3*t.exp,s=Date.now(),r=Math.floor((n-s)/1e3);return Math.max(0,r)}catch(t){return console.error("Token expiry check error:",{error:t.message,token:e?e.substring(0,50)+"...":"null",fullToken:e,tokenLength:e?e.length:0}),0}},u=e=>{if(!e)return!0;try{if(!e.includes(".")||3!==e.split(".").length)return console.error("Invalid refresh token format:",{token:e?e.substring(0,50)+"...":"null",length:e?e.length:0}),!0;const t=c(e);if(!t)return console.error("Failed to decode refresh token payload"),!0;if(!t.exp)return console.error("Refresh token missing exp field"),!0;const n=Math.floor(Date.now()/1e3),s=n>=t.exp,r=Math.max(0,t.exp-n);return console.log("\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u6709\u52b9\u671f\u9650\u30c1\u30a7\u30c3\u30af:",{currentTime:n,expiryTime:t.exp,isExpired:s,remainingTime:r,remainingMinutes:Math.floor(r/60),currentDate:new Date(1e3*n).toISOString(),expiryDate:new Date(1e3*t.exp).toISOString()}),s}catch(t){return console.error("Refresh token expiry check error:",t),!0}},m=e=>d(e)>0,x=()=>({accessToken:localStorage.getItem("accessToken"),refreshToken:localStorage.getItem("refreshToken")}),g=(e,t)=>{e&&localStorage.setItem("accessToken",e),t&&(localStorage.setItem("refreshToken",t),console.log("\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u3092\u4fdd\u5b58\u3057\u307e\u3057\u305f"))},h=()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("refreshTokenCreated"),localStorage.removeItem("autoLoginCode"),localStorage.removeItem("tempPassword"),localStorage.removeItem("loginCode"),localStorage.removeItem("temp_password"),localStorage.removeItem("code"),localStorage.removeItem("password"),console.log("\u30c8\u30fc\u30af\u30f3\u3068\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u30c7\u30fc\u30bf\u3092\u30af\u30ea\u30a2\u3057\u307e\u3057\u305f")},p=async e=>{try{console.log("\u30c8\u30fc\u30af\u30f3\u66f4\u65b0API\u547c\u3073\u51fa\u3057\u958b\u59cb:",{refreshToken:e?"\u5b58\u5728":"\u306a\u3057"});const t=await fetch(`${s.JR}/api/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e})});console.log("\u30c8\u30fc\u30af\u30f3\u66f4\u65b0API\u5fdc\u7b54:",{status:t.status,ok:t.ok});const n=await t.json();if(console.log("\u30c8\u30fc\u30af\u30f3\u66f4\u65b0API\u5fdc\u7b54\u30c7\u30fc\u30bf:",n),!t.ok)throw console.error("\u30c8\u30fc\u30af\u30f3\u66f4\u65b0API\u5931\u6557:",{status:t.status,data:n}),new Error(n.message||"\u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f");if(!n.success)throw console.error("\u30c8\u30fc\u30af\u30f3\u66f4\u65b0API\u6210\u529f\u30d5\u30e9\u30b0\u304cfalse:",n),new Error(n.message||"\u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f");return console.log("\u30c8\u30fc\u30af\u30f3\u66f4\u65b0API\u6210\u529f:",n),n}catch(t){throw console.error("Token refresh API error:",t),t}},f=e=>!["/","/student/login","/login"].some(t=>e.startsWith(t)),b=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"\u30c8\u30fc\u30af\u30f3\u304c\u7121\u52b9\u306b\u306a\u308a\u307e\u3057\u305f";if(console.warn("Token invalid, redirecting to login:",t),window.isRedirecting)return void console.log("\u65e2\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u51e6\u7406\u4e2d\u306e\u305f\u3081\u3001\u91cd\u8907\u51e6\u7406\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");window.isRedirecting=!0;const n=localStorage.getItem("currentUser");let s=null;if(n)try{s=JSON.parse(n).role}catch(l){console.error("\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u306e\u89e3\u6790\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",l)}h(),localStorage.removeItem("currentUser"),localStorage.clear(),sessionStorage.clear();const r=window.location.pathname;let a="/homepage";1===s?a="/student-login/":s>=4&&(a="/admin-instructor-login"),!("/homepage"===r||r.startsWith("/student/login")||r.startsWith("/login"))&&"undefined"!==typeof window&&window.alert?(alert(`${t}\n\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u623b\u308a\u307e\u3059\u3002`),e(a,{replace:!0})):e(a,{replace:!0}),setTimeout(()=>{window.isRedirecting=!1},1e3)},y=e=>d(e)<=1800},533:(e,t,n)=>{"use strict";n.d(t,{JR:()=>s});const s=(console.log("API Base URL (from env):","https://backend.studysphere.ayatori-inc.co.jp"),"https://backend.studysphere.ayatori-inc.co.jp"),r=()=>"studysphere.ayatori-inc.co.jp"===window.location.hostname||!0;r()||(console.log("=== API Configuration ==="),console.log("API Base URL:",s),console.log("Environment:",r()?"Production":"Development"),console.log("Hostname:",window.location.hostname),console.log("REACT_APP_API_URL:","https://backend.studysphere.ayatori-inc.co.jp"),console.log("========================"))},534:(e,t,n)=>{"use strict";var s=n(43),r=Symbol.for("react.element"),a=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,o=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var s,a={},c=null,d=null;for(s in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)l.call(t,s)&&!i.hasOwnProperty(s)&&(a[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===a[s]&&(a[s]=t[s]);return{$$typeof:r,type:e,key:c,ref:d,props:a,_owner:o.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},579:(e,t,n)=>{"use strict";e.exports=n(534)},730:(e,t,n)=>{"use strict";var s=n(43),r=n(853);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var l=new Set,o={};function i(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(o[e]=t,e=0;e<t.length;e++)l.add(t[e])}var d=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,m=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,x={},g={};function h(e,t,n,s,r,a,l){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=l}var p={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){p[e]=new h(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];p[t]=new h(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){p[e]=new h(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){p[e]=new h(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){p[e]=new h(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){p[e]=new h(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){p[e]=new h(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){p[e]=new h(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){p[e]=new h(e,5,!1,e.toLowerCase(),null,!1,!1)});var f=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function y(e,t,n,s){var r=p.hasOwnProperty(t)?p[t]:null;(null!==r?0!==r.type:s||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,s){if(null===t||"undefined"===typeof t||function(e,t,n,s){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!s&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,s))return!0;if(s)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,r,s)&&(n=null),s||null===r?function(e){return!!u.call(g,e)||!u.call(x,e)&&(m.test(e)?g[e]=!0:(x[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,s=r.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(r=r.type)||4===r&&!0===n?"":""+n,s?e.setAttributeNS(s,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(f,b);p[t]=new h(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(f,b);p[t]=new h(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(f,b);p[t]=new h(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){p[e]=new h(e,1,!1,e.toLowerCase(),null,!1,!1)}),p.xlinkHref=new h("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){p[e]=new h(e,1,!1,e.toLowerCase(),null,!0,!0)});var v=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,j=Symbol.for("react.element"),N=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),C=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),T=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),L=Symbol.for("react.memo"),E=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var A=Symbol.iterator;function $(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=A&&e[A]||e["@@iterator"])?e:null}var z,O=Object.assign;function R(e){if(void 0===z)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);z=t&&t[1]||""}return"\n"+z+e}var M=!1;function F(e,t){if(!e||M)return"";M=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var s=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){s=c}e.call(t.prototype)}else{try{throw Error()}catch(c){s=c}e()}}catch(c){if(c&&s&&"string"===typeof c.stack){for(var r=c.stack.split("\n"),a=s.stack.split("\n"),l=r.length-1,o=a.length-1;1<=l&&0<=o&&r[l]!==a[o];)o--;for(;1<=l&&0<=o;l--,o--)if(r[l]!==a[o]){if(1!==l||1!==o)do{if(l--,0>--o||r[l]!==a[o]){var i="\n"+r[l].replace(" at new "," at ");return e.displayName&&i.includes("<anonymous>")&&(i=i.replace("<anonymous>",e.displayName)),i}}while(1<=l&&0<=o);break}}}finally{M=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?R(e):""}function U(e){switch(e.tag){case 5:return R(e.type);case 16:return R("Lazy");case 13:return R("Suspense");case 19:return R("SuspenseList");case 0:case 2:case 15:return e=F(e.type,!1);case 11:return e=F(e.type.render,!1);case 1:return e=F(e.type,!0);default:return""}}function B(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case w:return"Fragment";case N:return"Portal";case S:return"Profiler";case k:return"StrictMode";case T:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case _:return(e._context.displayName||"Context")+".Provider";case I:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case L:return null!==(t=e.displayName||null)?t:B(e.type)||"Memo";case E:t=e._payload,e=e._init;try{return B(e(t))}catch(n){}}return null}function J(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return B(t);case 8:return t===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function q(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function V(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function H(e){e._valueTracker||(e._valueTracker=function(e){var t=V(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),s=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){s=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(e){s=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function W(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),s="";return e&&(s=V(e)?e.checked?"true":"false":e.value),(e=s)!==n&&(t.setValue(e),!0)}function Q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function K(e,t){var n=t.checked;return O({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Y(e,t){var n=null==t.defaultValue?"":t.defaultValue,s=null!=t.checked?t.checked:t.defaultChecked;n=q(null!=t.value?t.value:n),e._wrapperState={initialChecked:s,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function G(e,t){null!=(t=t.checked)&&y(e,"checked",t,!1)}function Z(e,t){G(e,t);var n=q(t.value),s=t.type;if(null!=n)"number"===s?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===s||"reset"===s)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function X(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var s=t.type;if(!("submit"!==s&&"reset"!==s||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,s){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&s&&(e[n].defaultSelected=!0)}else{for(n=""+q(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(s&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function se(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return O({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function re(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:q(n)}}function ae(e,t){var n=q(t.value),s=q(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=s&&(e.defaultValue=""+s)}function le(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function oe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ie(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?oe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,de,ue=(de=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,s){MSApp.execUnsafeLocalFunction(function(){return de(e,t)})}:de);function me(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var xe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ge=["Webkit","ms","Moz","O"];function he(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||xe.hasOwnProperty(e)&&xe[e]?(""+t).trim():t+"px"}function pe(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var s=0===n.indexOf("--"),r=he(n,t[n],s);"float"===n&&(n="cssFloat"),s?e.setProperty(n,r):e[n]=r}}Object.keys(xe).forEach(function(e){ge.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),xe[t]=xe[e]})});var fe=O({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function be(e,t){if(t){if(fe[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function ye(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ve=null;function je(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Ne=null,we=null,ke=null;function Se(e){if(e=yr(e)){if("function"!==typeof Ne)throw Error(a(280));var t=e.stateNode;t&&(t=jr(t),Ne(e.stateNode,e.type,t))}}function _e(e){we?ke?ke.push(e):ke=[e]:we=e}function Ce(){if(we){var e=we,t=ke;if(ke=we=null,Se(e),t)for(e=0;e<t.length;e++)Se(t[e])}}function Ie(e,t){return e(t)}function Te(){}var Pe=!1;function Le(e,t,n){if(Pe)return e(t,n);Pe=!0;try{return Ie(e,t,n)}finally{Pe=!1,(null!==we||null!==ke)&&(Te(),Ce())}}function Ee(e,t){var n=e.stateNode;if(null===n)return null;var s=jr(n);if(null===s)return null;n=s[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(s=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!s;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(a(231,t,typeof n));return n}var De=!1;if(d)try{var Ae={};Object.defineProperty(Ae,"passive",{get:function(){De=!0}}),window.addEventListener("test",Ae,Ae),window.removeEventListener("test",Ae,Ae)}catch(de){De=!1}function $e(e,t,n,s,r,a,l,o,i){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(d){this.onError(d)}}var ze=!1,Oe=null,Re=!1,Me=null,Fe={onError:function(e){ze=!0,Oe=e}};function Ue(e,t,n,s,r,a,l,o,i){ze=!1,Oe=null,$e.apply(Fe,arguments)}function Be(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function qe(e){if(Be(e)!==e)throw Error(a(188))}function Ve(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Be(e)))throw Error(a(188));return t!==e?null:e}for(var n=e,s=t;;){var r=n.return;if(null===r)break;var l=r.alternate;if(null===l){if(null!==(s=r.return)){n=s;continue}break}if(r.child===l.child){for(l=r.child;l;){if(l===n)return qe(r),e;if(l===s)return qe(r),t;l=l.sibling}throw Error(a(188))}if(n.return!==s.return)n=r,s=l;else{for(var o=!1,i=r.child;i;){if(i===n){o=!0,n=r,s=l;break}if(i===s){o=!0,s=r,n=l;break}i=i.sibling}if(!o){for(i=l.child;i;){if(i===n){o=!0,n=l,s=r;break}if(i===s){o=!0,s=l,n=r;break}i=i.sibling}if(!o)throw Error(a(189))}}if(n.alternate!==s)throw Error(a(190))}if(3!==n.tag)throw Error(a(188));return n.stateNode.current===n?e:t}(e))?He(e):null}function He(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=He(e);if(null!==t)return t;e=e.sibling}return null}var We=r.unstable_scheduleCallback,Qe=r.unstable_cancelCallback,Ke=r.unstable_shouldYield,Ye=r.unstable_requestPaint,Ge=r.unstable_now,Ze=r.unstable_getCurrentPriorityLevel,Xe=r.unstable_ImmediatePriority,et=r.unstable_UserBlockingPriority,tt=r.unstable_NormalPriority,nt=r.unstable_LowPriority,st=r.unstable_IdlePriority,rt=null,at=null;var lt=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(ot(e)/it|0)|0},ot=Math.log,it=Math.LN2;var ct=64,dt=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function mt(e,t){var n=e.pendingLanes;if(0===n)return 0;var s=0,r=e.suspendedLanes,a=e.pingedLanes,l=268435455&n;if(0!==l){var o=l&~r;0!==o?s=ut(o):0!==(a&=l)&&(s=ut(a))}else 0!==(l=n&~r)?s=ut(l):0!==a&&(s=ut(a));if(0===s)return 0;if(0!==t&&t!==s&&0===(t&r)&&((r=s&-s)>=(a=t&-t)||16===r&&0!==(4194240&a)))return t;if(0!==(4&s)&&(s|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=s;0<t;)r=1<<(n=31-lt(t)),s|=e[n],t&=~r;return s}function xt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function gt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function ht(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function pt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ft(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-lt(t)]=n}function bt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var s=31-lt(n),r=1<<s;r&t|e[s]&t&&(e[s]|=t),n&=~r}}var yt=0;function vt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var jt,Nt,wt,kt,St,_t=!1,Ct=[],It=null,Tt=null,Pt=null,Lt=new Map,Et=new Map,Dt=[],At="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function $t(e,t){switch(e){case"focusin":case"focusout":It=null;break;case"dragenter":case"dragleave":Tt=null;break;case"mouseover":case"mouseout":Pt=null;break;case"pointerover":case"pointerout":Lt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Et.delete(t.pointerId)}}function zt(e,t,n,s,r,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:n,eventSystemFlags:s,nativeEvent:a,targetContainers:[r]},null!==t&&(null!==(t=yr(t))&&Nt(t)),e):(e.eventSystemFlags|=s,t=e.targetContainers,null!==r&&-1===t.indexOf(r)&&t.push(r),e)}function Ot(e){var t=br(e.target);if(null!==t){var n=Be(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Je(n)))return e.blockedOn=t,void St(e.priority,function(){wt(n)})}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Rt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Kt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=yr(n))&&Nt(t),e.blockedOn=n,!1;var s=new(n=e.nativeEvent).constructor(n.type,n);ve=s,n.target.dispatchEvent(s),ve=null,t.shift()}return!0}function Mt(e,t,n){Rt(e)&&n.delete(t)}function Ft(){_t=!1,null!==It&&Rt(It)&&(It=null),null!==Tt&&Rt(Tt)&&(Tt=null),null!==Pt&&Rt(Pt)&&(Pt=null),Lt.forEach(Mt),Et.forEach(Mt)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,_t||(_t=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Ft)))}function Bt(e){function t(t){return Ut(t,e)}if(0<Ct.length){Ut(Ct[0],e);for(var n=1;n<Ct.length;n++){var s=Ct[n];s.blockedOn===e&&(s.blockedOn=null)}}for(null!==It&&Ut(It,e),null!==Tt&&Ut(Tt,e),null!==Pt&&Ut(Pt,e),Lt.forEach(t),Et.forEach(t),n=0;n<Dt.length;n++)(s=Dt[n]).blockedOn===e&&(s.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Ot(n),null===n.blockedOn&&Dt.shift()}var Jt=v.ReactCurrentBatchConfig,qt=!0;function Vt(e,t,n,s){var r=yt,a=Jt.transition;Jt.transition=null;try{yt=1,Wt(e,t,n,s)}finally{yt=r,Jt.transition=a}}function Ht(e,t,n,s){var r=yt,a=Jt.transition;Jt.transition=null;try{yt=4,Wt(e,t,n,s)}finally{yt=r,Jt.transition=a}}function Wt(e,t,n,s){if(qt){var r=Kt(e,t,n,s);if(null===r)qs(e,t,s,Qt,n),$t(e,s);else if(function(e,t,n,s,r){switch(t){case"focusin":return It=zt(It,e,t,n,s,r),!0;case"dragenter":return Tt=zt(Tt,e,t,n,s,r),!0;case"mouseover":return Pt=zt(Pt,e,t,n,s,r),!0;case"pointerover":var a=r.pointerId;return Lt.set(a,zt(Lt.get(a)||null,e,t,n,s,r)),!0;case"gotpointercapture":return a=r.pointerId,Et.set(a,zt(Et.get(a)||null,e,t,n,s,r)),!0}return!1}(r,e,t,n,s))s.stopPropagation();else if($t(e,s),4&t&&-1<At.indexOf(e)){for(;null!==r;){var a=yr(r);if(null!==a&&jt(a),null===(a=Kt(e,t,n,s))&&qs(e,t,s,Qt,n),a===r)break;r=a}null!==r&&s.stopPropagation()}else qs(e,t,s,null,n)}}var Qt=null;function Kt(e,t,n,s){if(Qt=null,null!==(e=br(e=je(s))))if(null===(t=Be(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Je(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Qt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ze()){case Xe:return 1;case et:return 4;case tt:case nt:return 16;case st:return 536870912;default:return 16}default:return 16}}var Gt=null,Zt=null,Xt=null;function en(){if(Xt)return Xt;var e,t,n=Zt,s=n.length,r="value"in Gt?Gt.value:Gt.textContent,a=r.length;for(e=0;e<s&&n[e]===r[e];e++);var l=s-e;for(t=1;t<=l&&n[s-t]===r[a-t];t++);return Xt=r.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function sn(){return!1}function rn(e){function t(t,n,s,r,a){for(var l in this._reactName=t,this._targetInst=s,this.type=n,this.nativeEvent=r,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(l)&&(t=e[l],this[l]=t?t(r):r[l]);return this.isDefaultPrevented=(null!=r.defaultPrevented?r.defaultPrevented:!1===r.returnValue)?nn:sn,this.isPropagationStopped=sn,this}return O(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var an,ln,on,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=rn(cn),un=O({},cn,{view:0,detail:0}),mn=rn(un),xn=O({},un,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==on&&(on&&"mousemove"===e.type?(an=e.screenX-on.screenX,ln=e.screenY-on.screenY):ln=an=0,on=e),an)},movementY:function(e){return"movementY"in e?e.movementY:ln}}),gn=rn(xn),hn=rn(O({},xn,{dataTransfer:0})),pn=rn(O({},un,{relatedTarget:0})),fn=rn(O({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),bn=O({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yn=rn(bn),vn=rn(O({},cn,{data:0})),jn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=wn[e])&&!!t[e]}function Sn(){return kn}var _n=O({},un,{key:function(e){if(e.key){var t=jn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Nn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=rn(_n),In=rn(O({},xn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Tn=rn(O({},un,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sn})),Pn=rn(O({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ln=O({},xn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),En=rn(Ln),Dn=[9,13,27,32],An=d&&"CompositionEvent"in window,$n=null;d&&"documentMode"in document&&($n=document.documentMode);var zn=d&&"TextEvent"in window&&!$n,On=d&&(!An||$n&&8<$n&&11>=$n),Rn=String.fromCharCode(32),Mn=!1;function Fn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Bn=!1;var Jn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Jn[e.type]:"textarea"===t}function Vn(e,t,n,s){_e(s),0<(t=Hs(t,"onChange")).length&&(n=new dn("onChange","change",null,n,s),e.push({event:n,listeners:t}))}var Hn=null,Wn=null;function Qn(e){Rs(e,0)}function Kn(e){if(W(vr(e)))return e}function Yn(e,t){if("change"===e)return t}var Gn=!1;if(d){var Zn;if(d){var Xn="oninput"in document;if(!Xn){var es=document.createElement("div");es.setAttribute("oninput","return;"),Xn="function"===typeof es.oninput}Zn=Xn}else Zn=!1;Gn=Zn&&(!document.documentMode||9<document.documentMode)}function ts(){Hn&&(Hn.detachEvent("onpropertychange",ns),Wn=Hn=null)}function ns(e){if("value"===e.propertyName&&Kn(Wn)){var t=[];Vn(t,Wn,e,je(e)),Le(Qn,t)}}function ss(e,t,n){"focusin"===e?(ts(),Wn=n,(Hn=t).attachEvent("onpropertychange",ns)):"focusout"===e&&ts()}function rs(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Kn(Wn)}function as(e,t){if("click"===e)return Kn(t)}function ls(e,t){if("input"===e||"change"===e)return Kn(t)}var os="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function is(e,t){if(os(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!u.call(t,r)||!os(e[r],t[r]))return!1}return!0}function cs(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ds(e,t){var n,s=cs(e);for(e=0;s;){if(3===s.nodeType){if(n=e+s.textContent.length,e<=t&&n>=t)return{node:s,offset:t-e};e=n}e:{for(;s;){if(s.nextSibling){s=s.nextSibling;break e}s=s.parentNode}s=void 0}s=cs(s)}}function us(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?us(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ms(){for(var e=window,t=Q();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(s){n=!1}if(!n)break;t=Q((e=t.contentWindow).document)}return t}function xs(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function gs(e){var t=ms(),n=e.focusedElem,s=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&us(n.ownerDocument.documentElement,n)){if(null!==s&&xs(n))if(t=s.start,void 0===(e=s.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var r=n.textContent.length,a=Math.min(s.start,r);s=void 0===s.end?a:Math.min(s.end,r),!e.extend&&a>s&&(r=s,s=a,a=r),r=ds(n,a);var l=ds(n,s);r&&l&&(1!==e.rangeCount||e.anchorNode!==r.node||e.anchorOffset!==r.offset||e.focusNode!==l.node||e.focusOffset!==l.offset)&&((t=t.createRange()).setStart(r.node,r.offset),e.removeAllRanges(),a>s?(e.addRange(t),e.extend(l.node,l.offset)):(t.setEnd(l.node,l.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var hs=d&&"documentMode"in document&&11>=document.documentMode,ps=null,fs=null,bs=null,ys=!1;function vs(e,t,n){var s=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;ys||null==ps||ps!==Q(s)||("selectionStart"in(s=ps)&&xs(s)?s={start:s.selectionStart,end:s.selectionEnd}:s={anchorNode:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset},bs&&is(bs,s)||(bs=s,0<(s=Hs(fs,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:s}),t.target=ps)))}function js(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ns={animationend:js("Animation","AnimationEnd"),animationiteration:js("Animation","AnimationIteration"),animationstart:js("Animation","AnimationStart"),transitionend:js("Transition","TransitionEnd")},ws={},ks={};function Ss(e){if(ws[e])return ws[e];if(!Ns[e])return e;var t,n=Ns[e];for(t in n)if(n.hasOwnProperty(t)&&t in ks)return ws[e]=n[t];return e}d&&(ks=document.createElement("div").style,"AnimationEvent"in window||(delete Ns.animationend.animation,delete Ns.animationiteration.animation,delete Ns.animationstart.animation),"TransitionEvent"in window||delete Ns.transitionend.transition);var _s=Ss("animationend"),Cs=Ss("animationiteration"),Is=Ss("animationstart"),Ts=Ss("transitionend"),Ps=new Map,Ls="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Es(e,t){Ps.set(e,t),i(t,[e])}for(var Ds=0;Ds<Ls.length;Ds++){var As=Ls[Ds];Es(As.toLowerCase(),"on"+(As[0].toUpperCase()+As.slice(1)))}Es(_s,"onAnimationEnd"),Es(Cs,"onAnimationIteration"),Es(Is,"onAnimationStart"),Es("dblclick","onDoubleClick"),Es("focusin","onFocus"),Es("focusout","onBlur"),Es(Ts,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),i("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),i("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),i("onBeforeInput",["compositionend","keypress","textInput","paste"]),i("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),i("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $s="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zs=new Set("cancel close invalid load scroll toggle".split(" ").concat($s));function Os(e,t,n){var s=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,s,r,l,o,i,c){if(Ue.apply(this,arguments),ze){if(!ze)throw Error(a(198));var d=Oe;ze=!1,Oe=null,Re||(Re=!0,Me=d)}}(s,t,void 0,e),e.currentTarget=null}function Rs(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var s=e[n],r=s.event;s=s.listeners;e:{var a=void 0;if(t)for(var l=s.length-1;0<=l;l--){var o=s[l],i=o.instance,c=o.currentTarget;if(o=o.listener,i!==a&&r.isPropagationStopped())break e;Os(r,o,c),a=i}else for(l=0;l<s.length;l++){if(i=(o=s[l]).instance,c=o.currentTarget,o=o.listener,i!==a&&r.isPropagationStopped())break e;Os(r,o,c),a=i}}}if(Re)throw e=Me,Re=!1,Me=null,e}function Ms(e,t){var n=t[hr];void 0===n&&(n=t[hr]=new Set);var s=e+"__bubble";n.has(s)||(Js(t,e,2,!1),n.add(s))}function Fs(e,t,n){var s=0;t&&(s|=4),Js(n,e,s,t)}var Us="_reactListening"+Math.random().toString(36).slice(2);function Bs(e){if(!e[Us]){e[Us]=!0,l.forEach(function(t){"selectionchange"!==t&&(zs.has(t)||Fs(t,!1,e),Fs(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Us]||(t[Us]=!0,Fs("selectionchange",!1,t))}}function Js(e,t,n,s){switch(Yt(t)){case 1:var r=Vt;break;case 4:r=Ht;break;default:r=Wt}n=r.bind(null,t,n,e),r=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(r=!0),s?void 0!==r?e.addEventListener(t,n,{capture:!0,passive:r}):e.addEventListener(t,n,!0):void 0!==r?e.addEventListener(t,n,{passive:r}):e.addEventListener(t,n,!1)}function qs(e,t,n,s,r){var a=s;if(0===(1&t)&&0===(2&t)&&null!==s)e:for(;;){if(null===s)return;var l=s.tag;if(3===l||4===l){var o=s.stateNode.containerInfo;if(o===r||8===o.nodeType&&o.parentNode===r)break;if(4===l)for(l=s.return;null!==l;){var i=l.tag;if((3===i||4===i)&&((i=l.stateNode.containerInfo)===r||8===i.nodeType&&i.parentNode===r))return;l=l.return}for(;null!==o;){if(null===(l=br(o)))return;if(5===(i=l.tag)||6===i){s=a=l;continue e}o=o.parentNode}}s=s.return}Le(function(){var s=a,r=je(n),l=[];e:{var o=Ps.get(e);if(void 0!==o){var i=dn,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":i=Cn;break;case"focusin":c="focus",i=pn;break;case"focusout":c="blur",i=pn;break;case"beforeblur":case"afterblur":i=pn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":i=gn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":i=hn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":i=Tn;break;case _s:case Cs:case Is:i=fn;break;case Ts:i=Pn;break;case"scroll":i=mn;break;case"wheel":i=En;break;case"copy":case"cut":case"paste":i=yn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":i=In}var d=0!==(4&t),u=!d&&"scroll"===e,m=d?null!==o?o+"Capture":null:o;d=[];for(var x,g=s;null!==g;){var h=(x=g).stateNode;if(5===x.tag&&null!==h&&(x=h,null!==m&&(null!=(h=Ee(g,m))&&d.push(Vs(g,h,x)))),u)break;g=g.return}0<d.length&&(o=new i(o,c,null,n,r),l.push({event:o,listeners:d}))}}if(0===(7&t)){if(i="mouseout"===e||"pointerout"===e,(!(o="mouseover"===e||"pointerover"===e)||n===ve||!(c=n.relatedTarget||n.fromElement)||!br(c)&&!c[gr])&&(i||o)&&(o=r.window===r?r:(o=r.ownerDocument)?o.defaultView||o.parentWindow:window,i?(i=s,null!==(c=(c=n.relatedTarget||n.toElement)?br(c):null)&&(c!==(u=Be(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(i=null,c=s),i!==c)){if(d=gn,h="onMouseLeave",m="onMouseEnter",g="mouse","pointerout"!==e&&"pointerover"!==e||(d=In,h="onPointerLeave",m="onPointerEnter",g="pointer"),u=null==i?o:vr(i),x=null==c?o:vr(c),(o=new d(h,g+"leave",i,n,r)).target=u,o.relatedTarget=x,h=null,br(r)===s&&((d=new d(m,g+"enter",c,n,r)).target=x,d.relatedTarget=u,h=d),u=h,i&&c)e:{for(m=c,g=0,x=d=i;x;x=Ws(x))g++;for(x=0,h=m;h;h=Ws(h))x++;for(;0<g-x;)d=Ws(d),g--;for(;0<x-g;)m=Ws(m),x--;for(;g--;){if(d===m||null!==m&&d===m.alternate)break e;d=Ws(d),m=Ws(m)}d=null}else d=null;null!==i&&Qs(l,o,i,d,!1),null!==c&&null!==u&&Qs(l,u,c,d,!0)}if("select"===(i=(o=s?vr(s):window).nodeName&&o.nodeName.toLowerCase())||"input"===i&&"file"===o.type)var p=Yn;else if(qn(o))if(Gn)p=ls;else{p=rs;var f=ss}else(i=o.nodeName)&&"input"===i.toLowerCase()&&("checkbox"===o.type||"radio"===o.type)&&(p=as);switch(p&&(p=p(e,s))?Vn(l,p,n,r):(f&&f(e,o,s),"focusout"===e&&(f=o._wrapperState)&&f.controlled&&"number"===o.type&&ee(o,"number",o.value)),f=s?vr(s):window,e){case"focusin":(qn(f)||"true"===f.contentEditable)&&(ps=f,fs=s,bs=null);break;case"focusout":bs=fs=ps=null;break;case"mousedown":ys=!0;break;case"contextmenu":case"mouseup":case"dragend":ys=!1,vs(l,n,r);break;case"selectionchange":if(hs)break;case"keydown":case"keyup":vs(l,n,r)}var b;if(An)e:{switch(e){case"compositionstart":var y="onCompositionStart";break e;case"compositionend":y="onCompositionEnd";break e;case"compositionupdate":y="onCompositionUpdate";break e}y=void 0}else Bn?Fn(e,n)&&(y="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(y="onCompositionStart");y&&(On&&"ko"!==n.locale&&(Bn||"onCompositionStart"!==y?"onCompositionEnd"===y&&Bn&&(b=en()):(Zt="value"in(Gt=r)?Gt.value:Gt.textContent,Bn=!0)),0<(f=Hs(s,y)).length&&(y=new vn(y,e,null,n,r),l.push({event:y,listeners:f}),b?y.data=b:null!==(b=Un(n))&&(y.data=b))),(b=zn?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Mn=!0,Rn);case"textInput":return(e=t.data)===Rn&&Mn?null:e;default:return null}}(e,n):function(e,t){if(Bn)return"compositionend"===e||!An&&Fn(e,t)?(e=en(),Xt=Zt=Gt=null,Bn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return On&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(s=Hs(s,"onBeforeInput")).length&&(r=new vn("onBeforeInput","beforeinput",null,n,r),l.push({event:r,listeners:s}),r.data=b))}Rs(l,t)})}function Vs(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hs(e,t){for(var n=t+"Capture",s=[];null!==e;){var r=e,a=r.stateNode;5===r.tag&&null!==a&&(r=a,null!=(a=Ee(e,n))&&s.unshift(Vs(e,a,r)),null!=(a=Ee(e,t))&&s.push(Vs(e,a,r))),e=e.return}return s}function Ws(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Qs(e,t,n,s,r){for(var a=t._reactName,l=[];null!==n&&n!==s;){var o=n,i=o.alternate,c=o.stateNode;if(null!==i&&i===s)break;5===o.tag&&null!==c&&(o=c,r?null!=(i=Ee(n,a))&&l.unshift(Vs(n,i,o)):r||null!=(i=Ee(n,a))&&l.push(Vs(n,i,o))),n=n.return}0!==l.length&&e.push({event:t,listeners:l})}var Ks=/\r\n?/g,Ys=/\u0000|\uFFFD/g;function Gs(e){return("string"===typeof e?e:""+e).replace(Ks,"\n").replace(Ys,"")}function Zs(e,t,n){if(t=Gs(t),Gs(e)!==t&&n)throw Error(a(425))}function Xs(){}var er=null,tr=null;function nr(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var sr="function"===typeof setTimeout?setTimeout:void 0,rr="function"===typeof clearTimeout?clearTimeout:void 0,ar="function"===typeof Promise?Promise:void 0,lr="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ar?function(e){return ar.resolve(null).then(e).catch(or)}:sr;function or(e){setTimeout(function(){throw e})}function ir(e,t){var n=t,s=0;do{var r=n.nextSibling;if(e.removeChild(n),r&&8===r.nodeType)if("/$"===(n=r.data)){if(0===s)return e.removeChild(r),void Bt(t);s--}else"$"!==n&&"$?"!==n&&"$!"!==n||s++;n=r}while(n);Bt(t)}function cr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function dr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ur=Math.random().toString(36).slice(2),mr="__reactFiber$"+ur,xr="__reactProps$"+ur,gr="__reactContainer$"+ur,hr="__reactEvents$"+ur,pr="__reactListeners$"+ur,fr="__reactHandles$"+ur;function br(e){var t=e[mr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[gr]||n[mr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=dr(e);null!==e;){if(n=e[mr])return n;e=dr(e)}return t}n=(e=n).parentNode}return null}function yr(e){return!(e=e[mr]||e[gr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function vr(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function jr(e){return e[xr]||null}var Nr=[],wr=-1;function kr(e){return{current:e}}function Sr(e){0>wr||(e.current=Nr[wr],Nr[wr]=null,wr--)}function _r(e,t){wr++,Nr[wr]=e.current,e.current=t}var Cr={},Ir=kr(Cr),Tr=kr(!1),Pr=Cr;function Lr(e,t){var n=e.type.contextTypes;if(!n)return Cr;var s=e.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===t)return s.__reactInternalMemoizedMaskedChildContext;var r,a={};for(r in n)a[r]=t[r];return s&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Er(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Dr(){Sr(Tr),Sr(Ir)}function Ar(e,t,n){if(Ir.current!==Cr)throw Error(a(168));_r(Ir,t),_r(Tr,n)}function $r(e,t,n){var s=e.stateNode;if(t=t.childContextTypes,"function"!==typeof s.getChildContext)return n;for(var r in s=s.getChildContext())if(!(r in t))throw Error(a(108,J(e)||"Unknown",r));return O({},n,s)}function zr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Cr,Pr=Ir.current,_r(Ir,e),_r(Tr,Tr.current),!0}function Or(e,t,n){var s=e.stateNode;if(!s)throw Error(a(169));n?(e=$r(e,t,Pr),s.__reactInternalMemoizedMergedChildContext=e,Sr(Tr),Sr(Ir),_r(Ir,e)):Sr(Tr),_r(Tr,n)}var Rr=null,Mr=!1,Fr=!1;function Ur(e){null===Rr?Rr=[e]:Rr.push(e)}function Br(){if(!Fr&&null!==Rr){Fr=!0;var e=0,t=yt;try{var n=Rr;for(yt=1;e<n.length;e++){var s=n[e];do{s=s(!0)}while(null!==s)}Rr=null,Mr=!1}catch(r){throw null!==Rr&&(Rr=Rr.slice(e+1)),We(Xe,Br),r}finally{yt=t,Fr=!1}}return null}var Jr=[],qr=0,Vr=null,Hr=0,Wr=[],Qr=0,Kr=null,Yr=1,Gr="";function Zr(e,t){Jr[qr++]=Hr,Jr[qr++]=Vr,Vr=e,Hr=t}function Xr(e,t,n){Wr[Qr++]=Yr,Wr[Qr++]=Gr,Wr[Qr++]=Kr,Kr=e;var s=Yr;e=Gr;var r=32-lt(s)-1;s&=~(1<<r),n+=1;var a=32-lt(t)+r;if(30<a){var l=r-r%5;a=(s&(1<<l)-1).toString(32),s>>=l,r-=l,Yr=1<<32-lt(t)+r|n<<r|s,Gr=a+e}else Yr=1<<a|n<<r|s,Gr=e}function ea(e){null!==e.return&&(Zr(e,1),Xr(e,1,0))}function ta(e){for(;e===Vr;)Vr=Jr[--qr],Jr[qr]=null,Hr=Jr[--qr],Jr[qr]=null;for(;e===Kr;)Kr=Wr[--Qr],Wr[Qr]=null,Gr=Wr[--Qr],Wr[Qr]=null,Yr=Wr[--Qr],Wr[Qr]=null}var na=null,sa=null,ra=!1,aa=null;function la(e,t){var n=Lc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function oa(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,na=e,sa=cr(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,na=e,sa=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Kr?{id:Yr,overflow:Gr}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Lc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,na=e,sa=null,!0);default:return!1}}function ia(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ca(e){if(ra){var t=sa;if(t){var n=t;if(!oa(e,t)){if(ia(e))throw Error(a(418));t=cr(n.nextSibling);var s=na;t&&oa(e,t)?la(s,n):(e.flags=-4097&e.flags|2,ra=!1,na=e)}}else{if(ia(e))throw Error(a(418));e.flags=-4097&e.flags|2,ra=!1,na=e}}}function da(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;na=e}function ua(e){if(e!==na)return!1;if(!ra)return da(e),ra=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!nr(e.type,e.memoizedProps)),t&&(t=sa)){if(ia(e))throw ma(),Error(a(418));for(;t;)la(e,t),t=cr(t.nextSibling)}if(da(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){sa=cr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}sa=null}}else sa=na?cr(e.stateNode.nextSibling):null;return!0}function ma(){for(var e=sa;e;)e=cr(e.nextSibling)}function xa(){sa=na=null,ra=!1}function ga(e){null===aa?aa=[e]:aa.push(e)}var ha=v.ReactCurrentBatchConfig;function pa(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(a(309));var s=n.stateNode}if(!s)throw Error(a(147,e));var r=s,l=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===l?t.ref:(t=function(e){var t=r.refs;null===e?delete t[l]:t[l]=e},t._stringRef=l,t)}if("string"!==typeof e)throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function fa(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ba(e){return(0,e._init)(e._payload)}function ya(e){function t(t,n){if(e){var s=t.deletions;null===s?(t.deletions=[n],t.flags|=16):s.push(n)}}function n(n,s){if(!e)return null;for(;null!==s;)t(n,s),s=s.sibling;return null}function s(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return(e=Dc(e,t)).index=0,e.sibling=null,e}function l(t,n,s){return t.index=s,e?null!==(s=t.alternate)?(s=s.index)<n?(t.flags|=2,n):s:(t.flags|=2,n):(t.flags|=1048576,n)}function o(t){return e&&null===t.alternate&&(t.flags|=2),t}function i(e,t,n,s){return null===t||6!==t.tag?((t=Oc(n,e.mode,s)).return=e,t):((t=r(t,n)).return=e,t)}function c(e,t,n,s){var a=n.type;return a===w?u(e,t,n.props.children,s,n.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===E&&ba(a)===t.type)?((s=r(t,n.props)).ref=pa(e,t,n),s.return=e,s):((s=Ac(n.type,n.key,n.props,null,e.mode,s)).ref=pa(e,t,n),s.return=e,s)}function d(e,t,n,s){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Rc(n,e.mode,s)).return=e,t):((t=r(t,n.children||[])).return=e,t)}function u(e,t,n,s,a){return null===t||7!==t.tag?((t=$c(n,e.mode,s,a)).return=e,t):((t=r(t,n)).return=e,t)}function m(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Oc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case j:return(n=Ac(t.type,t.key,t.props,null,e.mode,n)).ref=pa(e,null,t),n.return=e,n;case N:return(t=Rc(t,e.mode,n)).return=e,t;case E:return m(e,(0,t._init)(t._payload),n)}if(te(t)||$(t))return(t=$c(t,e.mode,n,null)).return=e,t;fa(e,t)}return null}function x(e,t,n,s){var r=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==r?null:i(e,t,""+n,s);if("object"===typeof n&&null!==n){switch(n.$$typeof){case j:return n.key===r?c(e,t,n,s):null;case N:return n.key===r?d(e,t,n,s):null;case E:return x(e,t,(r=n._init)(n._payload),s)}if(te(n)||$(n))return null!==r?null:u(e,t,n,s,null);fa(e,n)}return null}function g(e,t,n,s,r){if("string"===typeof s&&""!==s||"number"===typeof s)return i(t,e=e.get(n)||null,""+s,r);if("object"===typeof s&&null!==s){switch(s.$$typeof){case j:return c(t,e=e.get(null===s.key?n:s.key)||null,s,r);case N:return d(t,e=e.get(null===s.key?n:s.key)||null,s,r);case E:return g(e,t,n,(0,s._init)(s._payload),r)}if(te(s)||$(s))return u(t,e=e.get(n)||null,s,r,null);fa(t,s)}return null}function h(r,a,o,i){for(var c=null,d=null,u=a,h=a=0,p=null;null!==u&&h<o.length;h++){u.index>h?(p=u,u=null):p=u.sibling;var f=x(r,u,o[h],i);if(null===f){null===u&&(u=p);break}e&&u&&null===f.alternate&&t(r,u),a=l(f,a,h),null===d?c=f:d.sibling=f,d=f,u=p}if(h===o.length)return n(r,u),ra&&Zr(r,h),c;if(null===u){for(;h<o.length;h++)null!==(u=m(r,o[h],i))&&(a=l(u,a,h),null===d?c=u:d.sibling=u,d=u);return ra&&Zr(r,h),c}for(u=s(r,u);h<o.length;h++)null!==(p=g(u,r,h,o[h],i))&&(e&&null!==p.alternate&&u.delete(null===p.key?h:p.key),a=l(p,a,h),null===d?c=p:d.sibling=p,d=p);return e&&u.forEach(function(e){return t(r,e)}),ra&&Zr(r,h),c}function p(r,o,i,c){var d=$(i);if("function"!==typeof d)throw Error(a(150));if(null==(i=d.call(i)))throw Error(a(151));for(var u=d=null,h=o,p=o=0,f=null,b=i.next();null!==h&&!b.done;p++,b=i.next()){h.index>p?(f=h,h=null):f=h.sibling;var y=x(r,h,b.value,c);if(null===y){null===h&&(h=f);break}e&&h&&null===y.alternate&&t(r,h),o=l(y,o,p),null===u?d=y:u.sibling=y,u=y,h=f}if(b.done)return n(r,h),ra&&Zr(r,p),d;if(null===h){for(;!b.done;p++,b=i.next())null!==(b=m(r,b.value,c))&&(o=l(b,o,p),null===u?d=b:u.sibling=b,u=b);return ra&&Zr(r,p),d}for(h=s(r,h);!b.done;p++,b=i.next())null!==(b=g(h,r,p,b.value,c))&&(e&&null!==b.alternate&&h.delete(null===b.key?p:b.key),o=l(b,o,p),null===u?d=b:u.sibling=b,u=b);return e&&h.forEach(function(e){return t(r,e)}),ra&&Zr(r,p),d}return function e(s,a,l,i){if("object"===typeof l&&null!==l&&l.type===w&&null===l.key&&(l=l.props.children),"object"===typeof l&&null!==l){switch(l.$$typeof){case j:e:{for(var c=l.key,d=a;null!==d;){if(d.key===c){if((c=l.type)===w){if(7===d.tag){n(s,d.sibling),(a=r(d,l.props.children)).return=s,s=a;break e}}else if(d.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===E&&ba(c)===d.type){n(s,d.sibling),(a=r(d,l.props)).ref=pa(s,d,l),a.return=s,s=a;break e}n(s,d);break}t(s,d),d=d.sibling}l.type===w?((a=$c(l.props.children,s.mode,i,l.key)).return=s,s=a):((i=Ac(l.type,l.key,l.props,null,s.mode,i)).ref=pa(s,a,l),i.return=s,s=i)}return o(s);case N:e:{for(d=l.key;null!==a;){if(a.key===d){if(4===a.tag&&a.stateNode.containerInfo===l.containerInfo&&a.stateNode.implementation===l.implementation){n(s,a.sibling),(a=r(a,l.children||[])).return=s,s=a;break e}n(s,a);break}t(s,a),a=a.sibling}(a=Rc(l,s.mode,i)).return=s,s=a}return o(s);case E:return e(s,a,(d=l._init)(l._payload),i)}if(te(l))return h(s,a,l,i);if($(l))return p(s,a,l,i);fa(s,l)}return"string"===typeof l&&""!==l||"number"===typeof l?(l=""+l,null!==a&&6===a.tag?(n(s,a.sibling),(a=r(a,l)).return=s,s=a):(n(s,a),(a=Oc(l,s.mode,i)).return=s,s=a),o(s)):n(s,a)}}var va=ya(!0),ja=ya(!1),Na=kr(null),wa=null,ka=null,Sa=null;function _a(){Sa=ka=wa=null}function Ca(e){var t=Na.current;Sr(Na),e._currentValue=t}function Ia(e,t,n){for(;null!==e;){var s=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==s&&(s.childLanes|=t)):null!==s&&(s.childLanes&t)!==t&&(s.childLanes|=t),e===n)break;e=e.return}}function Ta(e,t){wa=e,Sa=ka=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(yo=!0),e.firstContext=null)}function Pa(e){var t=e._currentValue;if(Sa!==e)if(e={context:e,memoizedValue:t,next:null},null===ka){if(null===wa)throw Error(a(308));ka=e,wa.dependencies={lanes:0,firstContext:e}}else ka=ka.next=e;return t}var La=null;function Ea(e){null===La?La=[e]:La.push(e)}function Da(e,t,n,s){var r=t.interleaved;return null===r?(n.next=n,Ea(t)):(n.next=r.next,r.next=n),t.interleaved=n,Aa(e,s)}function Aa(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var $a=!1;function za(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Oa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ra(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ma(e,t,n){var s=e.updateQueue;if(null===s)return null;if(s=s.shared,0!==(2&Ii)){var r=s.pending;return null===r?t.next=t:(t.next=r.next,r.next=t),s.pending=t,Aa(e,n)}return null===(r=s.interleaved)?(t.next=t,Ea(s)):(t.next=r.next,r.next=t),s.interleaved=t,Aa(e,n)}function Fa(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var s=t.lanes;n|=s&=e.pendingLanes,t.lanes=n,bt(e,n)}}function Ua(e,t){var n=e.updateQueue,s=e.alternate;if(null!==s&&n===(s=s.updateQueue)){var r=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?r=a=l:a=a.next=l,n=n.next}while(null!==n);null===a?r=a=t:a=a.next=t}else r=a=t;return n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:s.shared,effects:s.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ba(e,t,n,s){var r=e.updateQueue;$a=!1;var a=r.firstBaseUpdate,l=r.lastBaseUpdate,o=r.shared.pending;if(null!==o){r.shared.pending=null;var i=o,c=i.next;i.next=null,null===l?a=c:l.next=c,l=i;var d=e.alternate;null!==d&&((o=(d=d.updateQueue).lastBaseUpdate)!==l&&(null===o?d.firstBaseUpdate=c:o.next=c,d.lastBaseUpdate=i))}if(null!==a){var u=r.baseState;for(l=0,d=c=i=null,o=a;;){var m=o.lane,x=o.eventTime;if((s&m)===m){null!==d&&(d=d.next={eventTime:x,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var g=e,h=o;switch(m=t,x=n,h.tag){case 1:if("function"===typeof(g=h.payload)){u=g.call(x,u,m);break e}u=g;break e;case 3:g.flags=-65537&g.flags|128;case 0:if(null===(m="function"===typeof(g=h.payload)?g.call(x,u,m):g)||void 0===m)break e;u=O({},u,m);break e;case 2:$a=!0}}null!==o.callback&&0!==o.lane&&(e.flags|=64,null===(m=r.effects)?r.effects=[o]:m.push(o))}else x={eventTime:x,lane:m,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===d?(c=d=x,i=u):d=d.next=x,l|=m;if(null===(o=o.next)){if(null===(o=r.shared.pending))break;o=(m=o).next,m.next=null,r.lastBaseUpdate=m,r.shared.pending=null}}if(null===d&&(i=u),r.baseState=i,r.firstBaseUpdate=c,r.lastBaseUpdate=d,null!==(t=r.shared.interleaved)){r=t;do{l|=r.lane,r=r.next}while(r!==t)}else null===a&&(r.shared.lanes=0);zi|=l,e.lanes=l,e.memoizedState=u}}function Ja(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var s=e[t],r=s.callback;if(null!==r){if(s.callback=null,s=n,"function"!==typeof r)throw Error(a(191,r));r.call(s)}}}var qa={},Va=kr(qa),Ha=kr(qa),Wa=kr(qa);function Qa(e){if(e===qa)throw Error(a(174));return e}function Ka(e,t){switch(_r(Wa,t),_r(Ha,e),_r(Va,qa),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ie(null,"");break;default:t=ie(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Sr(Va),_r(Va,t)}function Ya(){Sr(Va),Sr(Ha),Sr(Wa)}function Ga(e){Qa(Wa.current);var t=Qa(Va.current),n=ie(t,e.type);t!==n&&(_r(Ha,e),_r(Va,n))}function Za(e){Ha.current===e&&(Sr(Va),Sr(Ha))}var Xa=kr(0);function el(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var tl=[];function nl(){for(var e=0;e<tl.length;e++)tl[e]._workInProgressVersionPrimary=null;tl.length=0}var sl=v.ReactCurrentDispatcher,rl=v.ReactCurrentBatchConfig,al=0,ll=null,ol=null,il=null,cl=!1,dl=!1,ul=0,ml=0;function xl(){throw Error(a(321))}function gl(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!os(e[n],t[n]))return!1;return!0}function hl(e,t,n,s,r,l){if(al=l,ll=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,sl.current=null===e||null===e.memoizedState?Zl:Xl,e=n(s,r),dl){l=0;do{if(dl=!1,ul=0,25<=l)throw Error(a(301));l+=1,il=ol=null,t.updateQueue=null,sl.current=eo,e=n(s,r)}while(dl)}if(sl.current=Gl,t=null!==ol&&null!==ol.next,al=0,il=ol=ll=null,cl=!1,t)throw Error(a(300));return e}function pl(){var e=0!==ul;return ul=0,e}function fl(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===il?ll.memoizedState=il=e:il=il.next=e,il}function bl(){if(null===ol){var e=ll.alternate;e=null!==e?e.memoizedState:null}else e=ol.next;var t=null===il?ll.memoizedState:il.next;if(null!==t)il=t,ol=e;else{if(null===e)throw Error(a(310));e={memoizedState:(ol=e).memoizedState,baseState:ol.baseState,baseQueue:ol.baseQueue,queue:ol.queue,next:null},null===il?ll.memoizedState=il=e:il=il.next=e}return il}function yl(e,t){return"function"===typeof t?t(e):t}function vl(e){var t=bl(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var s=ol,r=s.baseQueue,l=n.pending;if(null!==l){if(null!==r){var o=r.next;r.next=l.next,l.next=o}s.baseQueue=r=l,n.pending=null}if(null!==r){l=r.next,s=s.baseState;var i=o=null,c=null,d=l;do{var u=d.lane;if((al&u)===u)null!==c&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),s=d.hasEagerState?d.eagerState:e(s,d.action);else{var m={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};null===c?(i=c=m,o=s):c=c.next=m,ll.lanes|=u,zi|=u}d=d.next}while(null!==d&&d!==l);null===c?o=s:c.next=i,os(s,t.memoizedState)||(yo=!0),t.memoizedState=s,t.baseState=o,t.baseQueue=c,n.lastRenderedState=s}if(null!==(e=n.interleaved)){r=e;do{l=r.lane,ll.lanes|=l,zi|=l,r=r.next}while(r!==e)}else null===r&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function jl(e){var t=bl(),n=t.queue;if(null===n)throw Error(a(311));n.lastRenderedReducer=e;var s=n.dispatch,r=n.pending,l=t.memoizedState;if(null!==r){n.pending=null;var o=r=r.next;do{l=e(l,o.action),o=o.next}while(o!==r);os(l,t.memoizedState)||(yo=!0),t.memoizedState=l,null===t.baseQueue&&(t.baseState=l),n.lastRenderedState=l}return[l,s]}function Nl(){}function wl(e,t){var n=ll,s=bl(),r=t(),l=!os(s.memoizedState,r);if(l&&(s.memoizedState=r,yo=!0),s=s.queue,$l(_l.bind(null,n,s,e),[e]),s.getSnapshot!==t||l||null!==il&&1&il.memoizedState.tag){if(n.flags|=2048,Pl(9,Sl.bind(null,n,s,r,t),void 0,null),null===Ti)throw Error(a(349));0!==(30&al)||kl(n,t,r)}return r}function kl(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=ll.updateQueue)?(t={lastEffect:null,stores:null},ll.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Sl(e,t,n,s){t.value=n,t.getSnapshot=s,Cl(t)&&Il(e)}function _l(e,t,n){return n(function(){Cl(t)&&Il(e)})}function Cl(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!os(e,n)}catch(s){return!0}}function Il(e){var t=Aa(e,1);null!==t&&nc(t,e,1,-1)}function Tl(e){var t=fl();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:yl,lastRenderedState:e},t.queue=e,e=e.dispatch=Wl.bind(null,ll,e),[t.memoizedState,e]}function Pl(e,t,n,s){return e={tag:e,create:t,destroy:n,deps:s,next:null},null===(t=ll.updateQueue)?(t={lastEffect:null,stores:null},ll.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(s=n.next,n.next=e,e.next=s,t.lastEffect=e),e}function Ll(){return bl().memoizedState}function El(e,t,n,s){var r=fl();ll.flags|=e,r.memoizedState=Pl(1|t,n,void 0,void 0===s?null:s)}function Dl(e,t,n,s){var r=bl();s=void 0===s?null:s;var a=void 0;if(null!==ol){var l=ol.memoizedState;if(a=l.destroy,null!==s&&gl(s,l.deps))return void(r.memoizedState=Pl(t,n,a,s))}ll.flags|=e,r.memoizedState=Pl(1|t,n,a,s)}function Al(e,t){return El(8390656,8,e,t)}function $l(e,t){return Dl(2048,8,e,t)}function zl(e,t){return Dl(4,2,e,t)}function Ol(e,t){return Dl(4,4,e,t)}function Rl(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ml(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Dl(4,4,Rl.bind(null,t,e),n)}function Fl(){}function Ul(e,t){var n=bl();t=void 0===t?null:t;var s=n.memoizedState;return null!==s&&null!==t&&gl(t,s[1])?s[0]:(n.memoizedState=[e,t],e)}function Bl(e,t){var n=bl();t=void 0===t?null:t;var s=n.memoizedState;return null!==s&&null!==t&&gl(t,s[1])?s[0]:(e=e(),n.memoizedState=[e,t],e)}function Jl(e,t,n){return 0===(21&al)?(e.baseState&&(e.baseState=!1,yo=!0),e.memoizedState=n):(os(n,t)||(n=ht(),ll.lanes|=n,zi|=n,e.baseState=!0),t)}function ql(e,t){var n=yt;yt=0!==n&&4>n?n:4,e(!0);var s=rl.transition;rl.transition={};try{e(!1),t()}finally{yt=n,rl.transition=s}}function Vl(){return bl().memoizedState}function Hl(e,t,n){var s=tc(e);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},Ql(e))Kl(t,n);else if(null!==(n=Da(e,t,n,s))){nc(n,e,s,ec()),Yl(n,t,s)}}function Wl(e,t,n){var s=tc(e),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ql(e))Kl(t,r);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var l=t.lastRenderedState,o=a(l,n);if(r.hasEagerState=!0,r.eagerState=o,os(o,l)){var i=t.interleaved;return null===i?(r.next=r,Ea(t)):(r.next=i.next,i.next=r),void(t.interleaved=r)}}catch(c){}null!==(n=Da(e,t,r,s))&&(nc(n,e,s,r=ec()),Yl(n,t,s))}}function Ql(e){var t=e.alternate;return e===ll||null!==t&&t===ll}function Kl(e,t){dl=cl=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Yl(e,t,n){if(0!==(4194240&n)){var s=t.lanes;n|=s&=e.pendingLanes,t.lanes=n,bt(e,n)}}var Gl={readContext:Pa,useCallback:xl,useContext:xl,useEffect:xl,useImperativeHandle:xl,useInsertionEffect:xl,useLayoutEffect:xl,useMemo:xl,useReducer:xl,useRef:xl,useState:xl,useDebugValue:xl,useDeferredValue:xl,useTransition:xl,useMutableSource:xl,useSyncExternalStore:xl,useId:xl,unstable_isNewReconciler:!1},Zl={readContext:Pa,useCallback:function(e,t){return fl().memoizedState=[e,void 0===t?null:t],e},useContext:Pa,useEffect:Al,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,El(4194308,4,Rl.bind(null,t,e),n)},useLayoutEffect:function(e,t){return El(4194308,4,e,t)},useInsertionEffect:function(e,t){return El(4,2,e,t)},useMemo:function(e,t){var n=fl();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var s=fl();return t=void 0!==n?n(t):t,s.memoizedState=s.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},s.queue=e,e=e.dispatch=Hl.bind(null,ll,e),[s.memoizedState,e]},useRef:function(e){return e={current:e},fl().memoizedState=e},useState:Tl,useDebugValue:Fl,useDeferredValue:function(e){return fl().memoizedState=e},useTransition:function(){var e=Tl(!1),t=e[0];return e=ql.bind(null,e[1]),fl().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var s=ll,r=fl();if(ra){if(void 0===n)throw Error(a(407));n=n()}else{if(n=t(),null===Ti)throw Error(a(349));0!==(30&al)||kl(s,t,n)}r.memoizedState=n;var l={value:n,getSnapshot:t};return r.queue=l,Al(_l.bind(null,s,l,e),[e]),s.flags|=2048,Pl(9,Sl.bind(null,s,l,n,t),void 0,null),n},useId:function(){var e=fl(),t=Ti.identifierPrefix;if(ra){var n=Gr;t=":"+t+"R"+(n=(Yr&~(1<<32-lt(Yr)-1)).toString(32)+n),0<(n=ul++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ml++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},Xl={readContext:Pa,useCallback:Ul,useContext:Pa,useEffect:$l,useImperativeHandle:Ml,useInsertionEffect:zl,useLayoutEffect:Ol,useMemo:Bl,useReducer:vl,useRef:Ll,useState:function(){return vl(yl)},useDebugValue:Fl,useDeferredValue:function(e){return Jl(bl(),ol.memoizedState,e)},useTransition:function(){return[vl(yl)[0],bl().memoizedState]},useMutableSource:Nl,useSyncExternalStore:wl,useId:Vl,unstable_isNewReconciler:!1},eo={readContext:Pa,useCallback:Ul,useContext:Pa,useEffect:$l,useImperativeHandle:Ml,useInsertionEffect:zl,useLayoutEffect:Ol,useMemo:Bl,useReducer:jl,useRef:Ll,useState:function(){return jl(yl)},useDebugValue:Fl,useDeferredValue:function(e){var t=bl();return null===ol?t.memoizedState=e:Jl(t,ol.memoizedState,e)},useTransition:function(){return[jl(yl)[0],bl().memoizedState]},useMutableSource:Nl,useSyncExternalStore:wl,useId:Vl,unstable_isNewReconciler:!1};function to(e,t){if(e&&e.defaultProps){for(var n in t=O({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function no(e,t,n,s){n=null===(n=n(s,t=e.memoizedState))||void 0===n?t:O({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var so={isMounted:function(e){return!!(e=e._reactInternals)&&Be(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var s=ec(),r=tc(e),a=Ra(s,r);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ma(e,a,r))&&(nc(t,e,r,s),Fa(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var s=ec(),r=tc(e),a=Ra(s,r);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),null!==(t=Ma(e,a,r))&&(nc(t,e,r,s),Fa(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),s=tc(e),r=Ra(n,s);r.tag=2,void 0!==t&&null!==t&&(r.callback=t),null!==(t=Ma(e,r,s))&&(nc(t,e,s,n),Fa(t,e,s))}};function ro(e,t,n,s,r,a,l){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(s,a,l):!t.prototype||!t.prototype.isPureReactComponent||(!is(n,s)||!is(r,a))}function ao(e,t,n){var s=!1,r=Cr,a=t.contextType;return"object"===typeof a&&null!==a?a=Pa(a):(r=Er(t)?Pr:Ir.current,a=(s=null!==(s=t.contextTypes)&&void 0!==s)?Lr(e,r):Cr),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=so,e.stateNode=t,t._reactInternals=e,s&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=a),t}function lo(e,t,n,s){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,s),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,s),t.state!==e&&so.enqueueReplaceState(t,t.state,null)}function oo(e,t,n,s){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs={},za(e);var a=t.contextType;"object"===typeof a&&null!==a?r.context=Pa(a):(a=Er(t)?Pr:Ir.current,r.context=Lr(e,a)),r.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(no(e,t,a,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&so.enqueueReplaceState(r,r.state,null),Ba(e,n,r,s),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.flags|=4194308)}function io(e,t){try{var n="",s=t;do{n+=U(s),s=s.return}while(s);var r=n}catch(a){r="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:r,digest:null}}function co(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function uo(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var mo="function"===typeof WeakMap?WeakMap:Map;function xo(e,t,n){(n=Ra(-1,n)).tag=3,n.payload={element:null};var s=t.value;return n.callback=function(){qi||(qi=!0,Vi=s),uo(0,t)},n}function go(e,t,n){(n=Ra(-1,n)).tag=3;var s=e.type.getDerivedStateFromError;if("function"===typeof s){var r=t.value;n.payload=function(){return s(r)},n.callback=function(){uo(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){uo(0,t),"function"!==typeof s&&(null===Hi?Hi=new Set([this]):Hi.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ho(e,t,n){var s=e.pingCache;if(null===s){s=e.pingCache=new mo;var r=new Set;s.set(t,r)}else void 0===(r=s.get(t))&&(r=new Set,s.set(t,r));r.has(n)||(r.add(n),e=Sc.bind(null,e,t,n),t.then(e,e))}function po(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function fo(e,t,n,s,r){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Ra(-1,1)).tag=2,Ma(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=r,e)}var bo=v.ReactCurrentOwner,yo=!1;function vo(e,t,n,s){t.child=null===e?ja(t,null,n,s):va(t,e.child,n,s)}function jo(e,t,n,s,r){n=n.render;var a=t.ref;return Ta(t,r),s=hl(e,t,n,s,a,r),n=pl(),null===e||yo?(ra&&n&&ea(t),t.flags|=1,vo(e,t,s,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,qo(e,t,r))}function No(e,t,n,s,r){if(null===e){var a=n.type;return"function"!==typeof a||Ec(a)||void 0!==a.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ac(n.type,null,s,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,wo(e,t,a,s,r))}if(a=e.child,0===(e.lanes&r)){var l=a.memoizedProps;if((n=null!==(n=n.compare)?n:is)(l,s)&&e.ref===t.ref)return qo(e,t,r)}return t.flags|=1,(e=Dc(a,s)).ref=t.ref,e.return=t,t.child=e}function wo(e,t,n,s,r){if(null!==e){var a=e.memoizedProps;if(is(a,s)&&e.ref===t.ref){if(yo=!1,t.pendingProps=s=a,0===(e.lanes&r))return t.lanes=e.lanes,qo(e,t,r);0!==(131072&e.flags)&&(yo=!0)}}return _o(e,t,n,s,r)}function ko(e,t,n){var s=t.pendingProps,r=s.children,a=null!==e?e.memoizedState:null;if("hidden"===s.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},_r(Di,Ei),Ei|=n;else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,_r(Di,Ei),Ei|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=null!==a?a.baseLanes:n,_r(Di,Ei),Ei|=s}else null!==a?(s=a.baseLanes|n,t.memoizedState=null):s=n,_r(Di,Ei),Ei|=s;return vo(e,t,r,n),t.child}function So(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function _o(e,t,n,s,r){var a=Er(n)?Pr:Ir.current;return a=Lr(t,a),Ta(t,r),n=hl(e,t,n,s,a,r),s=pl(),null===e||yo?(ra&&s&&ea(t),t.flags|=1,vo(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r,qo(e,t,r))}function Co(e,t,n,s,r){if(Er(n)){var a=!0;zr(t)}else a=!1;if(Ta(t,r),null===t.stateNode)Jo(e,t),ao(t,n,s),oo(t,n,s,r),s=!0;else if(null===e){var l=t.stateNode,o=t.memoizedProps;l.props=o;var i=l.context,c=n.contextType;"object"===typeof c&&null!==c?c=Pa(c):c=Lr(t,c=Er(n)?Pr:Ir.current);var d=n.getDerivedStateFromProps,u="function"===typeof d||"function"===typeof l.getSnapshotBeforeUpdate;u||"function"!==typeof l.UNSAFE_componentWillReceiveProps&&"function"!==typeof l.componentWillReceiveProps||(o!==s||i!==c)&&lo(t,l,s,c),$a=!1;var m=t.memoizedState;l.state=m,Ba(t,s,l,r),i=t.memoizedState,o!==s||m!==i||Tr.current||$a?("function"===typeof d&&(no(t,n,d,s),i=t.memoizedState),(o=$a||ro(t,n,o,s,m,i,c))?(u||"function"!==typeof l.UNSAFE_componentWillMount&&"function"!==typeof l.componentWillMount||("function"===typeof l.componentWillMount&&l.componentWillMount(),"function"===typeof l.UNSAFE_componentWillMount&&l.UNSAFE_componentWillMount()),"function"===typeof l.componentDidMount&&(t.flags|=4194308)):("function"===typeof l.componentDidMount&&(t.flags|=4194308),t.memoizedProps=s,t.memoizedState=i),l.props=s,l.state=i,l.context=c,s=o):("function"===typeof l.componentDidMount&&(t.flags|=4194308),s=!1)}else{l=t.stateNode,Oa(e,t),o=t.memoizedProps,c=t.type===t.elementType?o:to(t.type,o),l.props=c,u=t.pendingProps,m=l.context,"object"===typeof(i=n.contextType)&&null!==i?i=Pa(i):i=Lr(t,i=Er(n)?Pr:Ir.current);var x=n.getDerivedStateFromProps;(d="function"===typeof x||"function"===typeof l.getSnapshotBeforeUpdate)||"function"!==typeof l.UNSAFE_componentWillReceiveProps&&"function"!==typeof l.componentWillReceiveProps||(o!==u||m!==i)&&lo(t,l,s,i),$a=!1,m=t.memoizedState,l.state=m,Ba(t,s,l,r);var g=t.memoizedState;o!==u||m!==g||Tr.current||$a?("function"===typeof x&&(no(t,n,x,s),g=t.memoizedState),(c=$a||ro(t,n,c,s,m,g,i)||!1)?(d||"function"!==typeof l.UNSAFE_componentWillUpdate&&"function"!==typeof l.componentWillUpdate||("function"===typeof l.componentWillUpdate&&l.componentWillUpdate(s,g,i),"function"===typeof l.UNSAFE_componentWillUpdate&&l.UNSAFE_componentWillUpdate(s,g,i)),"function"===typeof l.componentDidUpdate&&(t.flags|=4),"function"===typeof l.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof l.componentDidUpdate||o===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),"function"!==typeof l.getSnapshotBeforeUpdate||o===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),t.memoizedProps=s,t.memoizedState=g),l.props=s,l.state=g,l.context=i,s=c):("function"!==typeof l.componentDidUpdate||o===e.memoizedProps&&m===e.memoizedState||(t.flags|=4),"function"!==typeof l.getSnapshotBeforeUpdate||o===e.memoizedProps&&m===e.memoizedState||(t.flags|=1024),s=!1)}return Io(e,t,n,s,a,r)}function Io(e,t,n,s,r,a){So(e,t);var l=0!==(128&t.flags);if(!s&&!l)return r&&Or(t,n,!1),qo(e,t,a);s=t.stateNode,bo.current=t;var o=l&&"function"!==typeof n.getDerivedStateFromError?null:s.render();return t.flags|=1,null!==e&&l?(t.child=va(t,e.child,null,a),t.child=va(t,null,o,a)):vo(e,t,o,a),t.memoizedState=s.state,r&&Or(t,n,!0),t.child}function To(e){var t=e.stateNode;t.pendingContext?Ar(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ar(0,t.context,!1),Ka(e,t.containerInfo)}function Po(e,t,n,s,r){return xa(),ga(r),t.flags|=256,vo(e,t,n,s),t.child}var Lo,Eo,Do,Ao,$o={dehydrated:null,treeContext:null,retryLane:0};function zo(e){return{baseLanes:e,cachePool:null,transitions:null}}function Oo(e,t,n){var s,r=t.pendingProps,l=Xa.current,o=!1,i=0!==(128&t.flags);if((s=i)||(s=(null===e||null!==e.memoizedState)&&0!==(2&l)),s?(o=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(l|=1),_r(Xa,1&l),null===e)return ca(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(i=r.children,e=r.fallback,o?(r=t.mode,o=t.child,i={mode:"hidden",children:i},0===(1&r)&&null!==o?(o.childLanes=0,o.pendingProps=i):o=zc(i,r,0,null),e=$c(e,r,n,null),o.return=t,e.return=t,o.sibling=e,t.child=o,t.child.memoizedState=zo(n),t.memoizedState=$o,e):Ro(t,i));if(null!==(l=e.memoizedState)&&null!==(s=l.dehydrated))return function(e,t,n,s,r,l,o){if(n)return 256&t.flags?(t.flags&=-257,Mo(e,t,o,s=co(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(l=s.fallback,r=t.mode,s=zc({mode:"visible",children:s.children},r,0,null),(l=$c(l,r,o,null)).flags|=2,s.return=t,l.return=t,s.sibling=l,t.child=s,0!==(1&t.mode)&&va(t,e.child,null,o),t.child.memoizedState=zo(o),t.memoizedState=$o,l);if(0===(1&t.mode))return Mo(e,t,o,null);if("$!"===r.data){if(s=r.nextSibling&&r.nextSibling.dataset)var i=s.dgst;return s=i,Mo(e,t,o,s=co(l=Error(a(419)),s,void 0))}if(i=0!==(o&e.childLanes),yo||i){if(null!==(s=Ti)){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}0!==(r=0!==(r&(s.suspendedLanes|o))?0:r)&&r!==l.retryLane&&(l.retryLane=r,Aa(e,r),nc(s,e,r,-1))}return hc(),Mo(e,t,o,s=co(Error(a(421))))}return"$?"===r.data?(t.flags|=128,t.child=e.child,t=Cc.bind(null,e),r._reactRetry=t,null):(e=l.treeContext,sa=cr(r.nextSibling),na=t,ra=!0,aa=null,null!==e&&(Wr[Qr++]=Yr,Wr[Qr++]=Gr,Wr[Qr++]=Kr,Yr=e.id,Gr=e.overflow,Kr=t),t=Ro(t,s.children),t.flags|=4096,t)}(e,t,i,r,s,l,n);if(o){o=r.fallback,i=t.mode,s=(l=e.child).sibling;var c={mode:"hidden",children:r.children};return 0===(1&i)&&t.child!==l?((r=t.child).childLanes=0,r.pendingProps=c,t.deletions=null):(r=Dc(l,c)).subtreeFlags=14680064&l.subtreeFlags,null!==s?o=Dc(s,o):(o=$c(o,i,n,null)).flags|=2,o.return=t,r.return=t,r.sibling=o,t.child=r,r=o,o=t.child,i=null===(i=e.child.memoizedState)?zo(n):{baseLanes:i.baseLanes|n,cachePool:null,transitions:i.transitions},o.memoizedState=i,o.childLanes=e.childLanes&~n,t.memoizedState=$o,r}return e=(o=e.child).sibling,r=Dc(o,{mode:"visible",children:r.children}),0===(1&t.mode)&&(r.lanes=n),r.return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Ro(e,t){return(t=zc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Mo(e,t,n,s){return null!==s&&ga(s),va(t,e.child,null,n),(e=Ro(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Fo(e,t,n){e.lanes|=t;var s=e.alternate;null!==s&&(s.lanes|=t),Ia(e.return,t,n)}function Uo(e,t,n,s,r){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=s,a.tail=n,a.tailMode=r)}function Bo(e,t,n){var s=t.pendingProps,r=s.revealOrder,a=s.tail;if(vo(e,t,s.children,n),0!==(2&(s=Xa.current)))s=1&s|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Fo(e,n,t);else if(19===e.tag)Fo(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}s&=1}if(_r(Xa,s),0===(1&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)null!==(e=n.alternate)&&null===el(e)&&(r=n),n=n.sibling;null===(n=r)?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),Uo(t,!1,r,n,a);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(null!==(e=r.alternate)&&null===el(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}Uo(t,!0,n,null,a);break;case"together":Uo(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Jo(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qo(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),zi|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(n=Dc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Vo(e,t){if(!ra)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var s=null;null!==n;)null!==n.alternate&&(s=n),n=n.sibling;null===s?t||null===e.tail?e.tail=null:e.tail.sibling=null:s.sibling=null}}function Ho(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,s=0;if(t)for(var r=e.child;null!==r;)n|=r.lanes|r.childLanes,s|=14680064&r.subtreeFlags,s|=14680064&r.flags,r.return=e,r=r.sibling;else for(r=e.child;null!==r;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=e,r=r.sibling;return e.subtreeFlags|=s,e.childLanes=n,t}function Wo(e,t,n){var s=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ho(t),null;case 1:case 17:return Er(t.type)&&Dr(),Ho(t),null;case 3:return s=t.stateNode,Ya(),Sr(Tr),Sr(Ir),nl(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),null!==e&&null!==e.child||(ua(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(lc(aa),aa=null))),Eo(e,t),Ho(t),null;case 5:Za(t);var r=Qa(Wa.current);if(n=t.type,null!==e&&null!=t.stateNode)Do(e,t,n,s,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!s){if(null===t.stateNode)throw Error(a(166));return Ho(t),null}if(e=Qa(Va.current),ua(t)){s=t.stateNode,n=t.type;var l=t.memoizedProps;switch(s[mr]=t,s[xr]=l,e=0!==(1&t.mode),n){case"dialog":Ms("cancel",s),Ms("close",s);break;case"iframe":case"object":case"embed":Ms("load",s);break;case"video":case"audio":for(r=0;r<$s.length;r++)Ms($s[r],s);break;case"source":Ms("error",s);break;case"img":case"image":case"link":Ms("error",s),Ms("load",s);break;case"details":Ms("toggle",s);break;case"input":Y(s,l),Ms("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!l.multiple},Ms("invalid",s);break;case"textarea":re(s,l),Ms("invalid",s)}for(var i in be(n,l),r=null,l)if(l.hasOwnProperty(i)){var c=l[i];"children"===i?"string"===typeof c?s.textContent!==c&&(!0!==l.suppressHydrationWarning&&Zs(s.textContent,c,e),r=["children",c]):"number"===typeof c&&s.textContent!==""+c&&(!0!==l.suppressHydrationWarning&&Zs(s.textContent,c,e),r=["children",""+c]):o.hasOwnProperty(i)&&null!=c&&"onScroll"===i&&Ms("scroll",s)}switch(n){case"input":H(s),X(s,l,!0);break;case"textarea":H(s),le(s);break;case"select":case"option":break;default:"function"===typeof l.onClick&&(s.onclick=Xs)}s=r,t.updateQueue=s,null!==s&&(t.flags|=4)}else{i=9===r.nodeType?r:r.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=oe(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=i.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof s.is?e=i.createElement(n,{is:s.is}):(e=i.createElement(n),"select"===n&&(i=e,s.multiple?i.multiple=!0:s.size&&(i.size=s.size))):e=i.createElementNS(e,n),e[mr]=t,e[xr]=s,Lo(e,t,!1,!1),t.stateNode=e;e:{switch(i=ye(n,s),n){case"dialog":Ms("cancel",e),Ms("close",e),r=s;break;case"iframe":case"object":case"embed":Ms("load",e),r=s;break;case"video":case"audio":for(r=0;r<$s.length;r++)Ms($s[r],e);r=s;break;case"source":Ms("error",e),r=s;break;case"img":case"image":case"link":Ms("error",e),Ms("load",e),r=s;break;case"details":Ms("toggle",e),r=s;break;case"input":Y(e,s),r=K(e,s),Ms("invalid",e);break;case"option":default:r=s;break;case"select":e._wrapperState={wasMultiple:!!s.multiple},r=O({},s,{value:void 0}),Ms("invalid",e);break;case"textarea":re(e,s),r=se(e,s),Ms("invalid",e)}for(l in be(n,r),c=r)if(c.hasOwnProperty(l)){var d=c[l];"style"===l?pe(e,d):"dangerouslySetInnerHTML"===l?null!=(d=d?d.__html:void 0)&&ue(e,d):"children"===l?"string"===typeof d?("textarea"!==n||""!==d)&&me(e,d):"number"===typeof d&&me(e,""+d):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(o.hasOwnProperty(l)?null!=d&&"onScroll"===l&&Ms("scroll",e):null!=d&&y(e,l,d,i))}switch(n){case"input":H(e),X(e,s,!1);break;case"textarea":H(e),le(e);break;case"option":null!=s.value&&e.setAttribute("value",""+q(s.value));break;case"select":e.multiple=!!s.multiple,null!=(l=s.value)?ne(e,!!s.multiple,l,!1):null!=s.defaultValue&&ne(e,!!s.multiple,s.defaultValue,!0);break;default:"function"===typeof r.onClick&&(e.onclick=Xs)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ho(t),null;case 6:if(e&&null!=t.stateNode)Ao(e,t,e.memoizedProps,s);else{if("string"!==typeof s&&null===t.stateNode)throw Error(a(166));if(n=Qa(Wa.current),Qa(Va.current),ua(t)){if(s=t.stateNode,n=t.memoizedProps,s[mr]=t,(l=s.nodeValue!==n)&&null!==(e=na))switch(e.tag){case 3:Zs(s.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Zs(s.nodeValue,n,0!==(1&e.mode))}l&&(t.flags|=4)}else(s=(9===n.nodeType?n:n.ownerDocument).createTextNode(s))[mr]=t,t.stateNode=s}return Ho(t),null;case 13:if(Sr(Xa),s=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ra&&null!==sa&&0!==(1&t.mode)&&0===(128&t.flags))ma(),xa(),t.flags|=98560,l=!1;else if(l=ua(t),null!==s&&null!==s.dehydrated){if(null===e){if(!l)throw Error(a(318));if(!(l=null!==(l=t.memoizedState)?l.dehydrated:null))throw Error(a(317));l[mr]=t}else xa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ho(t),l=!1}else null!==aa&&(lc(aa),aa=null),l=!0;if(!l)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((s=null!==s)!==(null!==e&&null!==e.memoizedState)&&s&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&Xa.current)?0===Ai&&(Ai=3):hc())),null!==t.updateQueue&&(t.flags|=4),Ho(t),null);case 4:return Ya(),Eo(e,t),null===e&&Bs(t.stateNode.containerInfo),Ho(t),null;case 10:return Ca(t.type._context),Ho(t),null;case 19:if(Sr(Xa),null===(l=t.memoizedState))return Ho(t),null;if(s=0!==(128&t.flags),null===(i=l.rendering))if(s)Vo(l,!1);else{if(0!==Ai||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(i=el(e))){for(t.flags|=128,Vo(l,!1),null!==(s=i.updateQueue)&&(t.updateQueue=s,t.flags|=4),t.subtreeFlags=0,s=n,n=t.child;null!==n;)e=s,(l=n).flags&=14680066,null===(i=l.alternate)?(l.childLanes=0,l.lanes=e,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=i.childLanes,l.lanes=i.lanes,l.child=i.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=i.memoizedProps,l.memoizedState=i.memoizedState,l.updateQueue=i.updateQueue,l.type=i.type,e=i.dependencies,l.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return _r(Xa,1&Xa.current|2),t.child}e=e.sibling}null!==l.tail&&Ge()>Bi&&(t.flags|=128,s=!0,Vo(l,!1),t.lanes=4194304)}else{if(!s)if(null!==(e=el(i))){if(t.flags|=128,s=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Vo(l,!0),null===l.tail&&"hidden"===l.tailMode&&!i.alternate&&!ra)return Ho(t),null}else 2*Ge()-l.renderingStartTime>Bi&&1073741824!==n&&(t.flags|=128,s=!0,Vo(l,!1),t.lanes=4194304);l.isBackwards?(i.sibling=t.child,t.child=i):(null!==(n=l.last)?n.sibling=i:t.child=i,l.last=i)}return null!==l.tail?(t=l.tail,l.rendering=t,l.tail=t.sibling,l.renderingStartTime=Ge(),t.sibling=null,n=Xa.current,_r(Xa,s?1&n|2:1&n),t):(Ho(t),null);case 22:case 23:return uc(),s=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==s&&(t.flags|=8192),s&&0!==(1&t.mode)?0!==(1073741824&Ei)&&(Ho(t),6&t.subtreeFlags&&(t.flags|=8192)):Ho(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Qo(e,t){switch(ta(t),t.tag){case 1:return Er(t.type)&&Dr(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ya(),Sr(Tr),Sr(Ir),nl(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Za(t),null;case 13:if(Sr(Xa),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));xa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Sr(Xa),null;case 4:return Ya(),null;case 10:return Ca(t.type._context),null;case 22:case 23:return uc(),null;default:return null}}Lo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Eo=function(){},Do=function(e,t,n,s){var r=e.memoizedProps;if(r!==s){e=t.stateNode,Qa(Va.current);var a,l=null;switch(n){case"input":r=K(e,r),s=K(e,s),l=[];break;case"select":r=O({},r,{value:void 0}),s=O({},s,{value:void 0}),l=[];break;case"textarea":r=se(e,r),s=se(e,s),l=[];break;default:"function"!==typeof r.onClick&&"function"===typeof s.onClick&&(e.onclick=Xs)}for(d in be(n,s),n=null,r)if(!s.hasOwnProperty(d)&&r.hasOwnProperty(d)&&null!=r[d])if("style"===d){var i=r[d];for(a in i)i.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else"dangerouslySetInnerHTML"!==d&&"children"!==d&&"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&"autoFocus"!==d&&(o.hasOwnProperty(d)?l||(l=[]):(l=l||[]).push(d,null));for(d in s){var c=s[d];if(i=null!=r?r[d]:void 0,s.hasOwnProperty(d)&&c!==i&&(null!=c||null!=i))if("style"===d)if(i){for(a in i)!i.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in c)c.hasOwnProperty(a)&&i[a]!==c[a]&&(n||(n={}),n[a]=c[a])}else n||(l||(l=[]),l.push(d,n)),n=c;else"dangerouslySetInnerHTML"===d?(c=c?c.__html:void 0,i=i?i.__html:void 0,null!=c&&i!==c&&(l=l||[]).push(d,c)):"children"===d?"string"!==typeof c&&"number"!==typeof c||(l=l||[]).push(d,""+c):"suppressContentEditableWarning"!==d&&"suppressHydrationWarning"!==d&&(o.hasOwnProperty(d)?(null!=c&&"onScroll"===d&&Ms("scroll",e),l||i===c||(l=[])):(l=l||[]).push(d,c))}n&&(l=l||[]).push("style",n);var d=l;(t.updateQueue=d)&&(t.flags|=4)}},Ao=function(e,t,n,s){n!==s&&(t.flags|=4)};var Ko=!1,Yo=!1,Go="function"===typeof WeakSet?WeakSet:Set,Zo=null;function Xo(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(s){kc(e,t,s)}else n.current=null}function ei(e,t,n){try{n()}catch(s){kc(e,t,s)}}var ti=!1;function ni(e,t,n){var s=t.updateQueue;if(null!==(s=null!==s?s.lastEffect:null)){var r=s=s.next;do{if((r.tag&e)===e){var a=r.destroy;r.destroy=void 0,void 0!==a&&ei(t,n,a)}r=r.next}while(r!==s)}}function si(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var s=n.create;n.destroy=s()}n=n.next}while(n!==t)}}function ri(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ai(e){var t=e.alternate;null!==t&&(e.alternate=null,ai(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[mr],delete t[xr],delete t[hr],delete t[pr],delete t[fr])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function li(e){return 5===e.tag||3===e.tag||4===e.tag}function oi(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||li(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ii(e,t,n){var s=e.tag;if(5===s||6===s)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Xs));else if(4!==s&&null!==(e=e.child))for(ii(e,t,n),e=e.sibling;null!==e;)ii(e,t,n),e=e.sibling}function ci(e,t,n){var s=e.tag;if(5===s||6===s)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==s&&null!==(e=e.child))for(ci(e,t,n),e=e.sibling;null!==e;)ci(e,t,n),e=e.sibling}var di=null,ui=!1;function mi(e,t,n){for(n=n.child;null!==n;)xi(e,t,n),n=n.sibling}function xi(e,t,n){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(rt,n)}catch(o){}switch(n.tag){case 5:Yo||Xo(n,t);case 6:var s=di,r=ui;di=null,mi(e,t,n),ui=r,null!==(di=s)&&(ui?(e=di,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):di.removeChild(n.stateNode));break;case 18:null!==di&&(ui?(e=di,n=n.stateNode,8===e.nodeType?ir(e.parentNode,n):1===e.nodeType&&ir(e,n),Bt(e)):ir(di,n.stateNode));break;case 4:s=di,r=ui,di=n.stateNode.containerInfo,ui=!0,mi(e,t,n),di=s,ui=r;break;case 0:case 11:case 14:case 15:if(!Yo&&(null!==(s=n.updateQueue)&&null!==(s=s.lastEffect))){r=s=s.next;do{var a=r,l=a.destroy;a=a.tag,void 0!==l&&(0!==(2&a)||0!==(4&a))&&ei(n,t,l),r=r.next}while(r!==s)}mi(e,t,n);break;case 1:if(!Yo&&(Xo(n,t),"function"===typeof(s=n.stateNode).componentWillUnmount))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(o){kc(n,t,o)}mi(e,t,n);break;case 21:mi(e,t,n);break;case 22:1&n.mode?(Yo=(s=Yo)||null!==n.memoizedState,mi(e,t,n),Yo=s):mi(e,t,n);break;default:mi(e,t,n)}}function gi(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Go),t.forEach(function(t){var s=Ic.bind(null,e,t);n.has(t)||(n.add(t),t.then(s,s))})}}function hi(e,t){var n=t.deletions;if(null!==n)for(var s=0;s<n.length;s++){var r=n[s];try{var l=e,o=t,i=o;e:for(;null!==i;){switch(i.tag){case 5:di=i.stateNode,ui=!1;break e;case 3:case 4:di=i.stateNode.containerInfo,ui=!0;break e}i=i.return}if(null===di)throw Error(a(160));xi(l,o,r),di=null,ui=!1;var c=r.alternate;null!==c&&(c.return=null),r.return=null}catch(d){kc(r,t,d)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)pi(t,e),t=t.sibling}function pi(e,t){var n=e.alternate,s=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(hi(t,e),fi(e),4&s){try{ni(3,e,e.return),si(3,e)}catch(p){kc(e,e.return,p)}try{ni(5,e,e.return)}catch(p){kc(e,e.return,p)}}break;case 1:hi(t,e),fi(e),512&s&&null!==n&&Xo(n,n.return);break;case 5:if(hi(t,e),fi(e),512&s&&null!==n&&Xo(n,n.return),32&e.flags){var r=e.stateNode;try{me(r,"")}catch(p){kc(e,e.return,p)}}if(4&s&&null!=(r=e.stateNode)){var l=e.memoizedProps,o=null!==n?n.memoizedProps:l,i=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===i&&"radio"===l.type&&null!=l.name&&G(r,l),ye(i,o);var d=ye(i,l);for(o=0;o<c.length;o+=2){var u=c[o],m=c[o+1];"style"===u?pe(r,m):"dangerouslySetInnerHTML"===u?ue(r,m):"children"===u?me(r,m):y(r,u,m,d)}switch(i){case"input":Z(r,l);break;case"textarea":ae(r,l);break;case"select":var x=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!l.multiple;var g=l.value;null!=g?ne(r,!!l.multiple,g,!1):x!==!!l.multiple&&(null!=l.defaultValue?ne(r,!!l.multiple,l.defaultValue,!0):ne(r,!!l.multiple,l.multiple?[]:"",!1))}r[xr]=l}catch(p){kc(e,e.return,p)}}break;case 6:if(hi(t,e),fi(e),4&s){if(null===e.stateNode)throw Error(a(162));r=e.stateNode,l=e.memoizedProps;try{r.nodeValue=l}catch(p){kc(e,e.return,p)}}break;case 3:if(hi(t,e),fi(e),4&s&&null!==n&&n.memoizedState.isDehydrated)try{Bt(t.containerInfo)}catch(p){kc(e,e.return,p)}break;case 4:default:hi(t,e),fi(e);break;case 13:hi(t,e),fi(e),8192&(r=e.child).flags&&(l=null!==r.memoizedState,r.stateNode.isHidden=l,!l||null!==r.alternate&&null!==r.alternate.memoizedState||(Ui=Ge())),4&s&&gi(e);break;case 22:if(u=null!==n&&null!==n.memoizedState,1&e.mode?(Yo=(d=Yo)||u,hi(t,e),Yo=d):hi(t,e),fi(e),8192&s){if(d=null!==e.memoizedState,(e.stateNode.isHidden=d)&&!u&&0!==(1&e.mode))for(Zo=e,u=e.child;null!==u;){for(m=Zo=u;null!==Zo;){switch(g=(x=Zo).child,x.tag){case 0:case 11:case 14:case 15:ni(4,x,x.return);break;case 1:Xo(x,x.return);var h=x.stateNode;if("function"===typeof h.componentWillUnmount){s=x,n=x.return;try{t=s,h.props=t.memoizedProps,h.state=t.memoizedState,h.componentWillUnmount()}catch(p){kc(s,n,p)}}break;case 5:Xo(x,x.return);break;case 22:if(null!==x.memoizedState){ji(m);continue}}null!==g?(g.return=x,Zo=g):ji(m)}u=u.sibling}e:for(u=null,m=e;;){if(5===m.tag){if(null===u){u=m;try{r=m.stateNode,d?"function"===typeof(l=r.style).setProperty?l.setProperty("display","none","important"):l.display="none":(i=m.stateNode,o=void 0!==(c=m.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,i.style.display=he("display",o))}catch(p){kc(e,e.return,p)}}}else if(6===m.tag){if(null===u)try{m.stateNode.nodeValue=d?"":m.memoizedProps}catch(p){kc(e,e.return,p)}}else if((22!==m.tag&&23!==m.tag||null===m.memoizedState||m===e)&&null!==m.child){m.child.return=m,m=m.child;continue}if(m===e)break e;for(;null===m.sibling;){if(null===m.return||m.return===e)break e;u===m&&(u=null),m=m.return}u===m&&(u=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:hi(t,e),fi(e),4&s&&gi(e);case 21:}}function fi(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(li(n)){var s=n;break e}n=n.return}throw Error(a(160))}switch(s.tag){case 5:var r=s.stateNode;32&s.flags&&(me(r,""),s.flags&=-33),ci(e,oi(e),r);break;case 3:case 4:var l=s.stateNode.containerInfo;ii(e,oi(e),l);break;default:throw Error(a(161))}}catch(o){kc(e,e.return,o)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bi(e,t,n){Zo=e,yi(e,t,n)}function yi(e,t,n){for(var s=0!==(1&e.mode);null!==Zo;){var r=Zo,a=r.child;if(22===r.tag&&s){var l=null!==r.memoizedState||Ko;if(!l){var o=r.alternate,i=null!==o&&null!==o.memoizedState||Yo;o=Ko;var c=Yo;if(Ko=l,(Yo=i)&&!c)for(Zo=r;null!==Zo;)i=(l=Zo).child,22===l.tag&&null!==l.memoizedState?Ni(r):null!==i?(i.return=l,Zo=i):Ni(r);for(;null!==a;)Zo=a,yi(a,t,n),a=a.sibling;Zo=r,Ko=o,Yo=c}vi(e)}else 0!==(8772&r.subtreeFlags)&&null!==a?(a.return=r,Zo=a):vi(e)}}function vi(e){for(;null!==Zo;){var t=Zo;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Yo||si(5,t);break;case 1:var s=t.stateNode;if(4&t.flags&&!Yo)if(null===n)s.componentDidMount();else{var r=t.elementType===t.type?n.memoizedProps:to(t.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var l=t.updateQueue;null!==l&&Ja(t,l,s);break;case 3:var o=t.updateQueue;if(null!==o){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Ja(t,o,n)}break;case 5:var i=t.stateNode;if(null===n&&4&t.flags){n=i;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var d=t.alternate;if(null!==d){var u=d.memoizedState;if(null!==u){var m=u.dehydrated;null!==m&&Bt(m)}}}break;default:throw Error(a(163))}Yo||512&t.flags&&ri(t)}catch(x){kc(t,t.return,x)}}if(t===e){Zo=null;break}if(null!==(n=t.sibling)){n.return=t.return,Zo=n;break}Zo=t.return}}function ji(e){for(;null!==Zo;){var t=Zo;if(t===e){Zo=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Zo=n;break}Zo=t.return}}function Ni(e){for(;null!==Zo;){var t=Zo;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{si(4,t)}catch(i){kc(t,n,i)}break;case 1:var s=t.stateNode;if("function"===typeof s.componentDidMount){var r=t.return;try{s.componentDidMount()}catch(i){kc(t,r,i)}}var a=t.return;try{ri(t)}catch(i){kc(t,a,i)}break;case 5:var l=t.return;try{ri(t)}catch(i){kc(t,l,i)}}}catch(i){kc(t,t.return,i)}if(t===e){Zo=null;break}var o=t.sibling;if(null!==o){o.return=t.return,Zo=o;break}Zo=t.return}}var wi,ki=Math.ceil,Si=v.ReactCurrentDispatcher,_i=v.ReactCurrentOwner,Ci=v.ReactCurrentBatchConfig,Ii=0,Ti=null,Pi=null,Li=0,Ei=0,Di=kr(0),Ai=0,$i=null,zi=0,Oi=0,Ri=0,Mi=null,Fi=null,Ui=0,Bi=1/0,Ji=null,qi=!1,Vi=null,Hi=null,Wi=!1,Qi=null,Ki=0,Yi=0,Gi=null,Zi=-1,Xi=0;function ec(){return 0!==(6&Ii)?Ge():-1!==Zi?Zi:Zi=Ge()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Ii)&&0!==Li?Li&-Li:null!==ha.transition?(0===Xi&&(Xi=ht()),Xi):0!==(e=yt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function nc(e,t,n,s){if(50<Yi)throw Yi=0,Gi=null,Error(a(185));ft(e,n,s),0!==(2&Ii)&&e===Ti||(e===Ti&&(0===(2&Ii)&&(Oi|=n),4===Ai&&oc(e,Li)),sc(e,s),1===n&&0===Ii&&0===(1&t.mode)&&(Bi=Ge()+500,Mr&&Br()))}function sc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,s=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var l=31-lt(a),o=1<<l,i=r[l];-1===i?0!==(o&n)&&0===(o&s)||(r[l]=xt(o,t)):i<=t&&(e.expiredLanes|=o),a&=~o}}(e,t);var s=mt(e,e===Ti?Li:0);if(0===s)null!==n&&Qe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=s&-s,e.callbackPriority!==t){if(null!=n&&Qe(n),1===t)0===e.tag?function(e){Mr=!0,Ur(e)}(ic.bind(null,e)):Ur(ic.bind(null,e)),lr(function(){0===(6&Ii)&&Br()}),n=null;else{switch(vt(s)){case 1:n=Xe;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=st}n=Tc(n,rc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function rc(e,t){if(Zi=-1,Xi=0,0!==(6&Ii))throw Error(a(327));var n=e.callbackNode;if(Nc()&&e.callbackNode!==n)return null;var s=mt(e,e===Ti?Li:0);if(0===s)return null;if(0!==(30&s)||0!==(s&e.expiredLanes)||t)t=pc(e,s);else{t=s;var r=Ii;Ii|=2;var l=gc();for(Ti===e&&Li===t||(Ji=null,Bi=Ge()+500,mc(e,t));;)try{bc();break}catch(i){xc(e,i)}_a(),Si.current=l,Ii=r,null!==Pi?t=0:(Ti=null,Li=0,t=Ai)}if(0!==t){if(2===t&&(0!==(r=gt(e))&&(s=r,t=ac(e,r))),1===t)throw n=$i,mc(e,0),oc(e,s),sc(e,Ge()),n;if(6===t)oc(e,s);else{if(r=e.current.alternate,0===(30&s)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var s=0;s<n.length;s++){var r=n[s],a=r.getSnapshot;r=r.value;try{if(!os(a(),r))return!1}catch(o){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(r)&&(2===(t=pc(e,s))&&(0!==(l=gt(e))&&(s=l,t=ac(e,l))),1===t))throw n=$i,mc(e,0),oc(e,s),sc(e,Ge()),n;switch(e.finishedWork=r,e.finishedLanes=s,t){case 0:case 1:throw Error(a(345));case 2:case 5:jc(e,Fi,Ji);break;case 3:if(oc(e,s),(130023424&s)===s&&10<(t=Ui+500-Ge())){if(0!==mt(e,0))break;if(((r=e.suspendedLanes)&s)!==s){ec(),e.pingedLanes|=e.suspendedLanes&r;break}e.timeoutHandle=sr(jc.bind(null,e,Fi,Ji),t);break}jc(e,Fi,Ji);break;case 4:if(oc(e,s),(4194240&s)===s)break;for(t=e.eventTimes,r=-1;0<s;){var o=31-lt(s);l=1<<o,(o=t[o])>r&&(r=o),s&=~l}if(s=r,10<(s=(120>(s=Ge()-s)?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*ki(s/1960))-s)){e.timeoutHandle=sr(jc.bind(null,e,Fi,Ji),s);break}jc(e,Fi,Ji);break;default:throw Error(a(329))}}}return sc(e,Ge()),e.callbackNode===n?rc.bind(null,e):null}function ac(e,t){var n=Mi;return e.current.memoizedState.isDehydrated&&(mc(e,t).flags|=256),2!==(e=pc(e,t))&&(t=Fi,Fi=n,null!==t&&lc(t)),e}function lc(e){null===Fi?Fi=e:Fi.push.apply(Fi,e)}function oc(e,t){for(t&=~Ri,t&=~Oi,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-lt(t),s=1<<n;e[n]=-1,t&=~s}}function ic(e){if(0!==(6&Ii))throw Error(a(327));Nc();var t=mt(e,0);if(0===(1&t))return sc(e,Ge()),null;var n=pc(e,t);if(0!==e.tag&&2===n){var s=gt(e);0!==s&&(t=s,n=ac(e,s))}if(1===n)throw n=$i,mc(e,0),oc(e,t),sc(e,Ge()),n;if(6===n)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,jc(e,Fi,Ji),sc(e,Ge()),null}function cc(e,t){var n=Ii;Ii|=1;try{return e(t)}finally{0===(Ii=n)&&(Bi=Ge()+500,Mr&&Br())}}function dc(e){null!==Qi&&0===Qi.tag&&0===(6&Ii)&&Nc();var t=Ii;Ii|=1;var n=Ci.transition,s=yt;try{if(Ci.transition=null,yt=1,e)return e()}finally{yt=s,Ci.transition=n,0===(6&(Ii=t))&&Br()}}function uc(){Ei=Di.current,Sr(Di)}function mc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,rr(n)),null!==Pi)for(n=Pi.return;null!==n;){var s=n;switch(ta(s),s.tag){case 1:null!==(s=s.type.childContextTypes)&&void 0!==s&&Dr();break;case 3:Ya(),Sr(Tr),Sr(Ir),nl();break;case 5:Za(s);break;case 4:Ya();break;case 13:case 19:Sr(Xa);break;case 10:Ca(s.type._context);break;case 22:case 23:uc()}n=n.return}if(Ti=e,Pi=e=Dc(e.current,null),Li=Ei=t,Ai=0,$i=null,Ri=Oi=zi=0,Fi=Mi=null,null!==La){for(t=0;t<La.length;t++)if(null!==(s=(n=La[t]).interleaved)){n.interleaved=null;var r=s.next,a=n.pending;if(null!==a){var l=a.next;a.next=r,s.next=l}n.pending=s}La=null}return e}function xc(e,t){for(;;){var n=Pi;try{if(_a(),sl.current=Gl,cl){for(var s=ll.memoizedState;null!==s;){var r=s.queue;null!==r&&(r.pending=null),s=s.next}cl=!1}if(al=0,il=ol=ll=null,dl=!1,ul=0,_i.current=null,null===n||null===n.return){Ai=1,$i=t,Pi=null;break}e:{var l=e,o=n.return,i=n,c=t;if(t=Li,i.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var d=c,u=i,m=u.tag;if(0===(1&u.mode)&&(0===m||11===m||15===m)){var x=u.alternate;x?(u.updateQueue=x.updateQueue,u.memoizedState=x.memoizedState,u.lanes=x.lanes):(u.updateQueue=null,u.memoizedState=null)}var g=po(o);if(null!==g){g.flags&=-257,fo(g,o,i,0,t),1&g.mode&&ho(l,d,t),c=d;var h=(t=g).updateQueue;if(null===h){var p=new Set;p.add(c),t.updateQueue=p}else h.add(c);break e}if(0===(1&t)){ho(l,d,t),hc();break e}c=Error(a(426))}else if(ra&&1&i.mode){var f=po(o);if(null!==f){0===(65536&f.flags)&&(f.flags|=256),fo(f,o,i,0,t),ga(io(c,i));break e}}l=c=io(c,i),4!==Ai&&(Ai=2),null===Mi?Mi=[l]:Mi.push(l),l=o;do{switch(l.tag){case 3:l.flags|=65536,t&=-t,l.lanes|=t,Ua(l,xo(0,c,t));break e;case 1:i=c;var b=l.type,y=l.stateNode;if(0===(128&l.flags)&&("function"===typeof b.getDerivedStateFromError||null!==y&&"function"===typeof y.componentDidCatch&&(null===Hi||!Hi.has(y)))){l.flags|=65536,t&=-t,l.lanes|=t,Ua(l,go(l,i,t));break e}}l=l.return}while(null!==l)}vc(n)}catch(v){t=v,Pi===n&&null!==n&&(Pi=n=n.return);continue}break}}function gc(){var e=Si.current;return Si.current=Gl,null===e?Gl:e}function hc(){0!==Ai&&3!==Ai&&2!==Ai||(Ai=4),null===Ti||0===(268435455&zi)&&0===(268435455&Oi)||oc(Ti,Li)}function pc(e,t){var n=Ii;Ii|=2;var s=gc();for(Ti===e&&Li===t||(Ji=null,mc(e,t));;)try{fc();break}catch(r){xc(e,r)}if(_a(),Ii=n,Si.current=s,null!==Pi)throw Error(a(261));return Ti=null,Li=0,Ai}function fc(){for(;null!==Pi;)yc(Pi)}function bc(){for(;null!==Pi&&!Ke();)yc(Pi)}function yc(e){var t=wi(e.alternate,e,Ei);e.memoizedProps=e.pendingProps,null===t?vc(e):Pi=t,_i.current=null}function vc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Wo(n,t,Ei)))return void(Pi=n)}else{if(null!==(n=Qo(n,t)))return n.flags&=32767,void(Pi=n);if(null===e)return Ai=6,void(Pi=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Pi=t);Pi=t=e}while(null!==t);0===Ai&&(Ai=5)}function jc(e,t,n){var s=yt,r=Ci.transition;try{Ci.transition=null,yt=1,function(e,t,n,s){do{Nc()}while(null!==Qi);if(0!==(6&Ii))throw Error(a(327));n=e.finishedWork;var r=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var l=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var s=e.eventTimes;for(e=e.expirationTimes;0<n;){var r=31-lt(n),a=1<<r;t[r]=0,s[r]=-1,e[r]=-1,n&=~a}}(e,l),e===Ti&&(Pi=Ti=null,Li=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Wi||(Wi=!0,Tc(tt,function(){return Nc(),null})),l=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||l){l=Ci.transition,Ci.transition=null;var o=yt;yt=1;var i=Ii;Ii|=4,_i.current=null,function(e,t){if(er=qt,xs(e=ms())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var s=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(s&&0!==s.rangeCount){n=s.anchorNode;var r=s.anchorOffset,l=s.focusNode;s=s.focusOffset;try{n.nodeType,l.nodeType}catch(j){n=null;break e}var o=0,i=-1,c=-1,d=0,u=0,m=e,x=null;t:for(;;){for(var g;m!==n||0!==r&&3!==m.nodeType||(i=o+r),m!==l||0!==s&&3!==m.nodeType||(c=o+s),3===m.nodeType&&(o+=m.nodeValue.length),null!==(g=m.firstChild);)x=m,m=g;for(;;){if(m===e)break t;if(x===n&&++d===r&&(i=o),x===l&&++u===s&&(c=o),null!==(g=m.nextSibling))break;x=(m=x).parentNode}m=g}n=-1===i||-1===c?null:{start:i,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(tr={focusedElem:e,selectionRange:n},qt=!1,Zo=t;null!==Zo;)if(e=(t=Zo).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Zo=e;else for(;null!==Zo;){t=Zo;try{var h=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==h){var p=h.memoizedProps,f=h.memoizedState,b=t.stateNode,y=b.getSnapshotBeforeUpdate(t.elementType===t.type?p:to(t.type,p),f);b.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var v=t.stateNode.containerInfo;1===v.nodeType?v.textContent="":9===v.nodeType&&v.documentElement&&v.removeChild(v.documentElement);break;default:throw Error(a(163))}}catch(j){kc(t,t.return,j)}if(null!==(e=t.sibling)){e.return=t.return,Zo=e;break}Zo=t.return}h=ti,ti=!1}(e,n),pi(n,e),gs(tr),qt=!!er,tr=er=null,e.current=n,bi(n,e,r),Ye(),Ii=i,yt=o,Ci.transition=l}else e.current=n;if(Wi&&(Wi=!1,Qi=e,Ki=r),l=e.pendingLanes,0===l&&(Hi=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(rt,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),sc(e,Ge()),null!==t)for(s=e.onRecoverableError,n=0;n<t.length;n++)r=t[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(qi)throw qi=!1,e=Vi,Vi=null,e;0!==(1&Ki)&&0!==e.tag&&Nc(),l=e.pendingLanes,0!==(1&l)?e===Gi?Yi++:(Yi=0,Gi=e):Yi=0,Br()}(e,t,n,s)}finally{Ci.transition=r,yt=s}return null}function Nc(){if(null!==Qi){var e=vt(Ki),t=Ci.transition,n=yt;try{if(Ci.transition=null,yt=16>e?16:e,null===Qi)var s=!1;else{if(e=Qi,Qi=null,Ki=0,0!==(6&Ii))throw Error(a(331));var r=Ii;for(Ii|=4,Zo=e.current;null!==Zo;){var l=Zo,o=l.child;if(0!==(16&Zo.flags)){var i=l.deletions;if(null!==i){for(var c=0;c<i.length;c++){var d=i[c];for(Zo=d;null!==Zo;){var u=Zo;switch(u.tag){case 0:case 11:case 15:ni(8,u,l)}var m=u.child;if(null!==m)m.return=u,Zo=m;else for(;null!==Zo;){var x=(u=Zo).sibling,g=u.return;if(ai(u),u===d){Zo=null;break}if(null!==x){x.return=g,Zo=x;break}Zo=g}}}var h=l.alternate;if(null!==h){var p=h.child;if(null!==p){h.child=null;do{var f=p.sibling;p.sibling=null,p=f}while(null!==p)}}Zo=l}}if(0!==(2064&l.subtreeFlags)&&null!==o)o.return=l,Zo=o;else e:for(;null!==Zo;){if(0!==(2048&(l=Zo).flags))switch(l.tag){case 0:case 11:case 15:ni(9,l,l.return)}var b=l.sibling;if(null!==b){b.return=l.return,Zo=b;break e}Zo=l.return}}var y=e.current;for(Zo=y;null!==Zo;){var v=(o=Zo).child;if(0!==(2064&o.subtreeFlags)&&null!==v)v.return=o,Zo=v;else e:for(o=y;null!==Zo;){if(0!==(2048&(i=Zo).flags))try{switch(i.tag){case 0:case 11:case 15:si(9,i)}}catch(N){kc(i,i.return,N)}if(i===o){Zo=null;break e}var j=i.sibling;if(null!==j){j.return=i.return,Zo=j;break e}Zo=i.return}}if(Ii=r,Br(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(rt,e)}catch(N){}s=!0}return s}finally{yt=n,Ci.transition=t}}return!1}function wc(e,t,n){e=Ma(e,t=xo(0,t=io(n,t),1),1),t=ec(),null!==e&&(ft(e,1,t),sc(e,t))}function kc(e,t,n){if(3===e.tag)wc(e,e,n);else for(;null!==t;){if(3===t.tag){wc(t,e,n);break}if(1===t.tag){var s=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof s.componentDidCatch&&(null===Hi||!Hi.has(s))){t=Ma(t,e=go(t,e=io(n,e),1),1),e=ec(),null!==t&&(ft(t,1,e),sc(t,e));break}}t=t.return}}function Sc(e,t,n){var s=e.pingCache;null!==s&&s.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Ti===e&&(Li&n)===n&&(4===Ai||3===Ai&&(130023424&Li)===Li&&500>Ge()-Ui?mc(e,0):Ri|=n),sc(e,t)}function _c(e,t){0===t&&(0===(1&e.mode)?t=1:(t=dt,0===(130023424&(dt<<=1))&&(dt=4194304)));var n=ec();null!==(e=Aa(e,t))&&(ft(e,t,n),sc(e,n))}function Cc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),_c(e,n)}function Ic(e,t){var n=0;switch(e.tag){case 13:var s=e.stateNode,r=e.memoizedState;null!==r&&(n=r.retryLane);break;case 19:s=e.stateNode;break;default:throw Error(a(314))}null!==s&&s.delete(t),_c(e,n)}function Tc(e,t){return We(e,t)}function Pc(e,t,n,s){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Lc(e,t,n,s){return new Pc(e,t,n,s)}function Ec(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dc(e,t){var n=e.alternate;return null===n?((n=Lc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ac(e,t,n,s,r,l){var o=2;if(s=e,"function"===typeof e)Ec(e)&&(o=1);else if("string"===typeof e)o=5;else e:switch(e){case w:return $c(n.children,r,l,t);case k:o=8,r|=8;break;case S:return(e=Lc(12,n,t,2|r)).elementType=S,e.lanes=l,e;case T:return(e=Lc(13,n,t,r)).elementType=T,e.lanes=l,e;case P:return(e=Lc(19,n,t,r)).elementType=P,e.lanes=l,e;case D:return zc(n,r,l,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case _:o=10;break e;case C:o=9;break e;case I:o=11;break e;case L:o=14;break e;case E:o=16,s=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=Lc(o,n,t,r)).elementType=e,t.type=s,t.lanes=l,t}function $c(e,t,n,s){return(e=Lc(7,e,s,t)).lanes=n,e}function zc(e,t,n,s){return(e=Lc(22,e,s,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Oc(e,t,n){return(e=Lc(6,e,null,t)).lanes=n,e}function Rc(e,t,n){return(t=Lc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Mc(e,t,n,s,r){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=pt(0),this.expirationTimes=pt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=pt(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Fc(e,t,n,s,r,a,l,o,i){return e=new Mc(e,t,n,o,i),1===t?(t=1,!0===a&&(t|=8)):t=0,a=Lc(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},za(a),e}function Uc(e){if(!e)return Cr;e:{if(Be(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Er(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var n=e.type;if(Er(n))return $r(e,n,t)}return t}function Bc(e,t,n,s,r,a,l,o,i){return(e=Fc(n,s,!0,e,0,a,0,o,i)).context=Uc(null),n=e.current,(a=Ra(s=ec(),r=tc(n))).callback=void 0!==t&&null!==t?t:null,Ma(n,a,r),e.current.lanes=r,ft(e,r,s),sc(e,s),e}function Jc(e,t,n,s){var r=t.current,a=ec(),l=tc(r);return n=Uc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Ra(a,l)).payload={element:e},null!==(s=void 0===s?null:s)&&(t.callback=s),null!==(e=Ma(r,t,l))&&(nc(e,r,l,a),Fa(e,r,l)),l}function qc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Vc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Hc(e,t){Vc(e,t),(e=e.alternate)&&Vc(e,t)}wi=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Tr.current)yo=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return yo=!1,function(e,t,n){switch(t.tag){case 3:To(t),xa();break;case 5:Ga(t);break;case 1:Er(t.type)&&zr(t);break;case 4:Ka(t,t.stateNode.containerInfo);break;case 10:var s=t.type._context,r=t.memoizedProps.value;_r(Na,s._currentValue),s._currentValue=r;break;case 13:if(null!==(s=t.memoizedState))return null!==s.dehydrated?(_r(Xa,1&Xa.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Oo(e,t,n):(_r(Xa,1&Xa.current),null!==(e=qo(e,t,n))?e.sibling:null);_r(Xa,1&Xa.current);break;case 19:if(s=0!==(n&t.childLanes),0!==(128&e.flags)){if(s)return Bo(e,t,n);t.flags|=128}if(null!==(r=t.memoizedState)&&(r.rendering=null,r.tail=null,r.lastEffect=null),_r(Xa,Xa.current),s)break;return null;case 22:case 23:return t.lanes=0,ko(e,t,n)}return qo(e,t,n)}(e,t,n);yo=0!==(131072&e.flags)}else yo=!1,ra&&0!==(1048576&t.flags)&&Xr(t,Hr,t.index);switch(t.lanes=0,t.tag){case 2:var s=t.type;Jo(e,t),e=t.pendingProps;var r=Lr(t,Ir.current);Ta(t,n),r=hl(null,t,s,e,r,n);var l=pl();return t.flags|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Er(s)?(l=!0,zr(t)):l=!1,t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,za(t),r.updater=so,t.stateNode=r,r._reactInternals=t,oo(t,s,e,n),t=Io(null,t,s,!0,l,n)):(t.tag=0,ra&&l&&ea(t),vo(null,t,r,n),t=t.child),t;case 16:s=t.elementType;e:{switch(Jo(e,t),e=t.pendingProps,s=(r=s._init)(s._payload),t.type=s,r=t.tag=function(e){if("function"===typeof e)return Ec(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===I)return 11;if(e===L)return 14}return 2}(s),e=to(s,e),r){case 0:t=_o(null,t,s,e,n);break e;case 1:t=Co(null,t,s,e,n);break e;case 11:t=jo(null,t,s,e,n);break e;case 14:t=No(null,t,s,to(s.type,e),n);break e}throw Error(a(306,s,""))}return t;case 0:return s=t.type,r=t.pendingProps,_o(e,t,s,r=t.elementType===s?r:to(s,r),n);case 1:return s=t.type,r=t.pendingProps,Co(e,t,s,r=t.elementType===s?r:to(s,r),n);case 3:e:{if(To(t),null===e)throw Error(a(387));s=t.pendingProps,r=(l=t.memoizedState).element,Oa(e,t),Ba(t,s,null,n);var o=t.memoizedState;if(s=o.element,l.isDehydrated){if(l={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=l,t.memoizedState=l,256&t.flags){t=Po(e,t,s,n,r=io(Error(a(423)),t));break e}if(s!==r){t=Po(e,t,s,n,r=io(Error(a(424)),t));break e}for(sa=cr(t.stateNode.containerInfo.firstChild),na=t,ra=!0,aa=null,n=ja(t,null,s,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(xa(),s===r){t=qo(e,t,n);break e}vo(e,t,s,n)}t=t.child}return t;case 5:return Ga(t),null===e&&ca(t),s=t.type,r=t.pendingProps,l=null!==e?e.memoizedProps:null,o=r.children,nr(s,r)?o=null:null!==l&&nr(s,l)&&(t.flags|=32),So(e,t),vo(e,t,o,n),t.child;case 6:return null===e&&ca(t),null;case 13:return Oo(e,t,n);case 4:return Ka(t,t.stateNode.containerInfo),s=t.pendingProps,null===e?t.child=va(t,null,s,n):vo(e,t,s,n),t.child;case 11:return s=t.type,r=t.pendingProps,jo(e,t,s,r=t.elementType===s?r:to(s,r),n);case 7:return vo(e,t,t.pendingProps,n),t.child;case 8:case 12:return vo(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(s=t.type._context,r=t.pendingProps,l=t.memoizedProps,o=r.value,_r(Na,s._currentValue),s._currentValue=o,null!==l)if(os(l.value,o)){if(l.children===r.children&&!Tr.current){t=qo(e,t,n);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var i=l.dependencies;if(null!==i){o=l.child;for(var c=i.firstContext;null!==c;){if(c.context===s){if(1===l.tag){(c=Ra(-1,n&-n)).tag=2;var d=l.updateQueue;if(null!==d){var u=(d=d.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}l.lanes|=n,null!==(c=l.alternate)&&(c.lanes|=n),Ia(l.return,n,t),i.lanes|=n;break}c=c.next}}else if(10===l.tag)o=l.type===t.type?null:l.child;else if(18===l.tag){if(null===(o=l.return))throw Error(a(341));o.lanes|=n,null!==(i=o.alternate)&&(i.lanes|=n),Ia(o,n,t),o=l.sibling}else o=l.child;if(null!==o)o.return=l;else for(o=l;null!==o;){if(o===t){o=null;break}if(null!==(l=o.sibling)){l.return=o.return,o=l;break}o=o.return}l=o}vo(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,s=t.pendingProps.children,Ta(t,n),s=s(r=Pa(r)),t.flags|=1,vo(e,t,s,n),t.child;case 14:return r=to(s=t.type,t.pendingProps),No(e,t,s,r=to(s.type,r),n);case 15:return wo(e,t,t.type,t.pendingProps,n);case 17:return s=t.type,r=t.pendingProps,r=t.elementType===s?r:to(s,r),Jo(e,t),t.tag=1,Er(s)?(e=!0,zr(t)):e=!1,Ta(t,n),ao(t,s,r),oo(t,s,r,n),Io(null,t,s,!0,e,n);case 19:return Bo(e,t,n);case 22:return ko(e,t,n)}throw Error(a(156,t.tag))};var Wc="function"===typeof reportError?reportError:function(e){console.error(e)};function Qc(e){this._internalRoot=e}function Kc(e){this._internalRoot=e}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Gc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function Xc(e,t,n,s,r){var a=n._reactRootContainer;if(a){var l=a;if("function"===typeof r){var o=r;r=function(){var e=qc(l);o.call(e)}}Jc(t,l,e,r)}else l=function(e,t,n,s,r){if(r){if("function"===typeof s){var a=s;s=function(){var e=qc(l);a.call(e)}}var l=Bc(t,s,e,0,null,!1,0,"",Zc);return e._reactRootContainer=l,e[gr]=l.current,Bs(8===e.nodeType?e.parentNode:e),dc(),l}for(;r=e.lastChild;)e.removeChild(r);if("function"===typeof s){var o=s;s=function(){var e=qc(i);o.call(e)}}var i=Fc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=i,e[gr]=i.current,Bs(8===e.nodeType?e.parentNode:e),dc(function(){Jc(t,i,n,s)}),i}(n,t,e,r,s);return qc(l)}Kc.prototype.render=Qc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Jc(e,t,null,null)},Kc.prototype.unmount=Qc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;dc(function(){Jc(null,e,null,null)}),t[gr]=null}},Kc.prototype.unstable_scheduleHydration=function(e){if(e){var t=kt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Ot(e)}},jt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ut(t.pendingLanes);0!==n&&(bt(t,1|n),sc(t,Ge()),0===(6&Ii)&&(Bi=Ge()+500,Br()))}break;case 13:dc(function(){var t=Aa(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}}),Hc(e,1)}},Nt=function(e){if(13===e.tag){var t=Aa(e,134217728);if(null!==t)nc(t,e,134217728,ec());Hc(e,134217728)}},wt=function(e){if(13===e.tag){var t=tc(e),n=Aa(e,t);if(null!==n)nc(n,e,t,ec());Hc(e,t)}},kt=function(){return yt},St=function(e,t){var n=yt;try{return yt=e,t()}finally{yt=n}},Ne=function(e,t,n){switch(t){case"input":if(Z(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var s=n[t];if(s!==e&&s.form===e.form){var r=jr(s);if(!r)throw Error(a(90));W(s),Z(s,r)}}}break;case"textarea":ae(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ie=cc,Te=dc;var ed={usingClientEntryPoint:!1,Events:[yr,vr,jr,_e,Ce,cc]},td={findFiberByHostInstance:br,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},nd={bundleType:td.bundleType,version:td.version,rendererPackageName:td.rendererPackageName,rendererConfig:td.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:v.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ve(e))?null:e.stateNode},findFiberByHostInstance:td.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var sd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!sd.isDisabled&&sd.supportsFiber)try{rt=sd.inject(nd),at=sd}catch(de){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ed,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(t))throw Error(a(200));return function(e,t,n){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:N,key:null==s?null:""+s,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Yc(e))throw Error(a(299));var n=!1,s="",r=Wc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(s=t.identifierPrefix),void 0!==t.onRecoverableError&&(r=t.onRecoverableError)),t=Fc(e,1,!1,null,0,n,0,s,r),e[gr]=t.current,Bs(8===e.nodeType?e.parentNode:e),new Qc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=Ve(t))?null:e.stateNode},t.flushSync=function(e){return dc(e)},t.hydrate=function(e,t,n){if(!Gc(t))throw Error(a(200));return Xc(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Yc(e))throw Error(a(405));var s=null!=n&&n.hydratedSources||null,r=!1,l="",o=Wc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(r=!0),void 0!==n.identifierPrefix&&(l=n.identifierPrefix),void 0!==n.onRecoverableError&&(o=n.onRecoverableError)),t=Bc(t,null,e,1,null!=n?n:null,r,0,l,o),e[gr]=t.current,Bs(e),s)for(e=0;e<s.length;e++)r=(r=(n=s[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,r]:t.mutableSourceEagerHydrationData.push(n,r);return new Kc(t)},t.render=function(e,t,n){if(!Gc(t))throw Error(a(200));return Xc(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Gc(e))throw Error(a(40));return!!e._reactRootContainer&&(dc(function(){Xc(null,null,e,!1,function(){e._reactRootContainer=null,e[gr]=null})}),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,s){if(!Gc(n))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return Xc(e,t,n,!1,s)},t.version="18.3.1-next-f1338f8080-20240426"},853:(e,t,n)=>{"use strict";e.exports=n(234)},950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(730)}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,n),a.exports}(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(s,r){if(1&r&&(s=this(s)),8&r)return s;if("object"===typeof s&&s){if(4&r&&s.__esModule)return s;if(16&r&&"function"===typeof s.then)return s}var a=Object.create(null);n.r(a);var l={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&s;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach(e=>l[e]=()=>s[e]);return l.default=()=>s,n.d(a,l),a}})(),n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};n.r(e),n.d(e,{boolean:()=>os,booleanish:()=>is,commaOrSpaceSeparated:()=>xs,commaSeparated:()=>ms,number:()=>ds,overloadedBoolean:()=>cs,spaceSeparated:()=>us});var t={};n.r(t),n.d(t,{attentionMarkers:()=>Ja,contentInitial:()=>Oa,disable:()=>qa,document:()=>za,flow:()=>Ma,flowInitial:()=>Ra,insideSpan:()=>Ba,string:()=>Fa,text:()=>Ua});var s,r=n(43),a=n.t(r,2),l=n(391),o=n(950),i=n.t(o,2);function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},c.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(s||(s={}));const d="popstate";function u(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function m(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function x(e,t){return{usr:e.state,key:e.key,idx:t}}function g(e,t,n,s){return void 0===n&&(n=null),c({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?p(t):t,{state:n,key:t&&t.key||s||Math.random().toString(36).substr(2,8)})}function h(e){let{pathname:t="/",search:n="",hash:s=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),s&&"#"!==s&&(t+="#"===s.charAt(0)?s:"#"+s),t}function p(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let s=e.indexOf("?");s>=0&&(t.search=e.substr(s),e=e.substr(0,s)),e&&(t.pathname=e)}return t}function f(e,t,n,r){void 0===r&&(r={});let{window:a=document.defaultView,v5Compat:l=!1}=r,o=a.history,i=s.Pop,m=null,p=f();function f(){return(o.state||{idx:null}).idx}function b(){i=s.Pop;let e=f(),t=null==e?null:e-p;p=e,m&&m({action:i,location:v.location,delta:t})}function y(e){let t="null"!==a.location.origin?a.location.origin:a.location.href,n="string"===typeof e?e:h(e);return n=n.replace(/ $/,"%20"),u(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==p&&(p=0,o.replaceState(c({},o.state,{idx:p}),""));let v={get action(){return i},get location(){return e(a,o)},listen(e){if(m)throw new Error("A history only accepts one active listener");return a.addEventListener(d,b),m=e,()=>{a.removeEventListener(d,b),m=null}},createHref:e=>t(a,e),createURL:y,encodeLocation(e){let t=y(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){i=s.Push;let r=g(v.location,e,t);n&&n(r,e),p=f()+1;let c=x(r,p),d=v.createHref(r);try{o.pushState(c,"",d)}catch(u){if(u instanceof DOMException&&"DataCloneError"===u.name)throw u;a.location.assign(d)}l&&m&&m({action:i,location:v.location,delta:1})},replace:function(e,t){i=s.Replace;let r=g(v.location,e,t);n&&n(r,e),p=f();let a=x(r,p),c=v.createHref(r);o.replaceState(a,"",c),l&&m&&m({action:i,location:v.location,delta:0})},go:e=>o.go(e)};return v}var b;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(b||(b={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function y(e,t,n){return void 0===n&&(n="/"),v(e,t,n,!1)}function v(e,t,n,s){let r=A(("string"===typeof t?p(t):t).pathname||"/",n);if(null==r)return null;let a=j(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every((e,n)=>e===t[n]);return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(a);let l=null;for(let o=0;null==l&&o<a.length;++o){let e=D(r);l=L(a[o],e,s)}return l}function j(e,t,n,s){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===s&&(s="");let r=(e,r,a)=>{let l={relativePath:void 0===a?e.path||"":a,caseSensitive:!0===e.caseSensitive,childrenIndex:r,route:e};l.relativePath.startsWith("/")&&(u(l.relativePath.startsWith(s),'Absolute route path "'+l.relativePath+'" nested under path "'+s+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),l.relativePath=l.relativePath.slice(s.length));let o=M([s,l.relativePath]),i=n.concat(l);e.children&&e.children.length>0&&(u(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),j(e.children,t,i,o)),(null!=e.path||e.index)&&t.push({path:o,score:P(o,e.index),routesMeta:i})};return e.forEach((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let s of N(e.path))r(e,t,s);else r(e,t)}),t}function N(e){let t=e.split("/");if(0===t.length)return[];let[n,...s]=t,r=n.endsWith("?"),a=n.replace(/\?$/,"");if(0===s.length)return r?[a,""]:[a];let l=N(s.join("/")),o=[];return o.push(...l.map(e=>""===e?a:[a,e].join("/"))),r&&o.push(...l),o.map(t=>e.startsWith("/")&&""===t?"/":t)}const w=/^:[\w-]+$/,k=3,S=2,_=1,C=10,I=-2,T=e=>"*"===e;function P(e,t){let n=e.split("/"),s=n.length;return n.some(T)&&(s+=I),t&&(s+=S),n.filter(e=>!T(e)).reduce((e,t)=>e+(w.test(t)?k:""===t?_:C),s)}function L(e,t,n){void 0===n&&(n=!1);let{routesMeta:s}=e,r={},a="/",l=[];for(let o=0;o<s.length;++o){let e=s[o],i=o===s.length-1,c="/"===a?t:t.slice(a.length)||"/",d=E({path:e.relativePath,caseSensitive:e.caseSensitive,end:i},c),u=e.route;if(!d&&i&&n&&!s[s.length-1].route.index&&(d=E({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!d)return null;Object.assign(r,d.params),l.push({params:r,pathname:M([a,d.pathname]),pathnameBase:F(M([a,d.pathnameBase])),route:u}),"/"!==d.pathnameBase&&(a=M([a,d.pathnameBase]))}return l}function E(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,s]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);m("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let s=[],r="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,n)=>(s.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(s.push({paramName:"*"}),r+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":""!==e&&"/"!==e&&(r+="(?:(?=\\/|$))");let a=new RegExp(r,t?void 0:"i");return[a,s]}(e.path,e.caseSensitive,e.end),r=t.match(n);if(!r)return null;let a=r[0],l=a.replace(/(.)\/+$/,"$1"),o=r.slice(1),i=s.reduce((e,t,n)=>{let{paramName:s,isOptional:r}=t;if("*"===s){let e=o[n]||"";l=a.slice(0,a.length-e.length).replace(/(.)\/+$/,"$1")}const i=o[n];return e[s]=r&&!i?void 0:(i||"").replace(/%2F/g,"/"),e},{});return{params:i,pathname:a,pathnameBase:l,pattern:e}}function D(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return m(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function A(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,s=e.charAt(n);return s&&"/"!==s?null:e.slice(n)||"/"}function $(e,t,n,s){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(s)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function z(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function O(e,t){let n=z(e);return t?n.map((e,t)=>t===n.length-1?e.pathname:e.pathnameBase):n.map(e=>e.pathnameBase)}function R(e,t,n,s){let r;void 0===s&&(s=!1),"string"===typeof e?r=p(e):(r=c({},e),u(!r.pathname||!r.pathname.includes("?"),$("?","pathname","search",r)),u(!r.pathname||!r.pathname.includes("#"),$("#","pathname","hash",r)),u(!r.search||!r.search.includes("#"),$("#","search","hash",r)));let a,l=""===e||""===r.pathname,o=l?"/":r.pathname;if(null==o)a=n;else{let e=t.length-1;if(!s&&o.startsWith("..")){let t=o.split("/");for(;".."===t[0];)t.shift(),e-=1;r.pathname=t.join("/")}a=e>=0?t[e]:"/"}let i=function(e,t){void 0===t&&(t="/");let{pathname:n,search:s="",hash:r=""}="string"===typeof e?p(e):e,a=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)}),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:a,search:U(s),hash:B(r)}}(r,a),d=o&&"/"!==o&&o.endsWith("/"),m=(l||"."===o)&&n.endsWith("/");return i.pathname.endsWith("/")||!d&&!m||(i.pathname+="/"),i}const M=e=>e.join("/").replace(/\/\/+/g,"/"),F=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),U=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",B=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function J(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const q=["post","put","patch","delete"],V=(new Set(q),["get",...q]);new Set(V),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function H(){return H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},H.apply(this,arguments)}const W=r.createContext(null);const Q=r.createContext(null);const K=r.createContext(null);const Y=r.createContext(null);const G=r.createContext({outlet:null,matches:[],isDataRoute:!1});const Z=r.createContext(null);function X(){return null!=r.useContext(Y)}function ee(){return X()||u(!1),r.useContext(Y).location}function te(e){r.useContext(K).static||r.useLayoutEffect(e)}function ne(){let{isDataRoute:e}=r.useContext(G);return e?function(){let{router:e}=xe(ue.UseNavigateStable),t=he(me.UseNavigateStable),n=r.useRef(!1);return te(()=>{n.current=!0}),r.useCallback(function(s,r){void 0===r&&(r={}),n.current&&("number"===typeof s?e.navigate(s):e.navigate(s,H({fromRouteId:t},r)))},[e,t])}():function(){X()||u(!1);let e=r.useContext(W),{basename:t,future:n,navigator:s}=r.useContext(K),{matches:a}=r.useContext(G),{pathname:l}=ee(),o=JSON.stringify(O(a,n.v7_relativeSplatPath)),i=r.useRef(!1);te(()=>{i.current=!0});let c=r.useCallback(function(n,r){if(void 0===r&&(r={}),!i.current)return;if("number"===typeof n)return void s.go(n);let a=R(n,JSON.parse(o),l,"path"===r.relative);null==e&&"/"!==t&&(a.pathname="/"===a.pathname?t:M([t,a.pathname])),(r.replace?s.replace:s.push)(a,r.state,r)},[t,s,o,l,e]);return c}()}function se(){let{matches:e}=r.useContext(G),t=e[e.length-1];return t?t.params:{}}function re(e,t){let{relative:n}=void 0===t?{}:t,{future:s}=r.useContext(K),{matches:a}=r.useContext(G),{pathname:l}=ee(),o=JSON.stringify(O(a,s.v7_relativeSplatPath));return r.useMemo(()=>R(e,JSON.parse(o),l,"path"===n),[e,o,l,n])}function ae(e,t,n,a){X()||u(!1);let{navigator:l}=r.useContext(K),{matches:o}=r.useContext(G),i=o[o.length-1],c=i?i.params:{},d=(i&&i.pathname,i?i.pathnameBase:"/");i&&i.route;let m,x=ee();if(t){var g;let e="string"===typeof t?p(t):t;"/"===d||(null==(g=e.pathname)?void 0:g.startsWith(d))||u(!1),m=e}else m=x;let h=m.pathname||"/",f=h;if("/"!==d){let e=d.replace(/^\//,"").split("/");f="/"+h.replace(/^\//,"").split("/").slice(e.length).join("/")}let b=y(e,{pathname:f});let v=de(b&&b.map(e=>Object.assign({},e,{params:Object.assign({},c,e.params),pathname:M([d,l.encodeLocation?l.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?d:M([d,l.encodeLocation?l.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),o,n,a);return t&&v?r.createElement(Y.Provider,{value:{location:H({pathname:"/",search:"",hash:"",state:null,key:"default"},m),navigationType:s.Pop}},v):v}function le(){let e=function(){var e;let t=r.useContext(Z),n=ge(me.UseRouteError),s=he(me.UseRouteError);if(void 0!==t)return t;return null==(e=n.errors)?void 0:e[s]}(),t=J(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,s="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:s};return r.createElement(r.Fragment,null,r.createElement("h2",null,"Unexpected Application Error!"),r.createElement("h3",{style:{fontStyle:"italic"}},t),n?r.createElement("pre",{style:a},n):null,null)}const oe=r.createElement(le,null);class ie extends r.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?r.createElement(G.Provider,{value:this.props.routeContext},r.createElement(Z.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ce(e){let{routeContext:t,match:n,children:s}=e,a=r.useContext(W);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),r.createElement(G.Provider,{value:t},s)}function de(e,t,n,s){var a;if(void 0===t&&(t=[]),void 0===n&&(n=null),void 0===s&&(s=null),null==e){var l;if(!n)return null;if(n.errors)e=n.matches;else{if(!(null!=(l=s)&&l.v7_partialHydration&&0===t.length&&!n.initialized&&n.matches.length>0))return null;e=n.matches}}let o=e,i=null==(a=n)?void 0:a.errors;if(null!=i){let e=o.findIndex(e=>e.route.id&&void 0!==(null==i?void 0:i[e.route.id]));e>=0||u(!1),o=o.slice(0,Math.min(o.length,e+1))}let c=!1,d=-1;if(n&&s&&s.v7_partialHydration)for(let r=0;r<o.length;r++){let e=o[r];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(d=r),e.route.id){let{loaderData:t,errors:s}=n,r=e.route.loader&&void 0===t[e.route.id]&&(!s||void 0===s[e.route.id]);if(e.route.lazy||r){c=!0,o=d>=0?o.slice(0,d+1):[o[0]];break}}}return o.reduceRight((e,s,a)=>{let l,u=!1,m=null,x=null;var g;n&&(l=i&&s.route.id?i[s.route.id]:void 0,m=s.route.errorElement||oe,c&&(d<0&&0===a?(g="route-fallback",!1||pe[g]||(pe[g]=!0),u=!0,x=null):d===a&&(u=!0,x=s.route.hydrateFallbackElement||null)));let h=t.concat(o.slice(0,a+1)),p=()=>{let t;return t=l?m:u?x:s.route.Component?r.createElement(s.route.Component,null):s.route.element?s.route.element:e,r.createElement(ce,{match:s,routeContext:{outlet:e,matches:h,isDataRoute:null!=n},children:t})};return n&&(s.route.ErrorBoundary||s.route.errorElement||0===a)?r.createElement(ie,{location:n.location,revalidation:n.revalidation,component:m,error:l,children:p(),routeContext:{outlet:null,matches:h,isDataRoute:!0}}):p()},null)}var ue=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(ue||{}),me=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(me||{});function xe(e){let t=r.useContext(W);return t||u(!1),t}function ge(e){let t=r.useContext(Q);return t||u(!1),t}function he(e){let t=function(){let e=r.useContext(G);return e||u(!1),e}(),n=t.matches[t.matches.length-1];return n.route.id||u(!1),n.route.id}const pe={};function fe(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}a.startTransition;function be(e){u(!1)}function ye(e){let{basename:t="/",children:n=null,location:a,navigationType:l=s.Pop,navigator:o,static:i=!1,future:c}=e;X()&&u(!1);let d=t.replace(/^\/*/,"/"),m=r.useMemo(()=>({basename:d,navigator:o,static:i,future:H({v7_relativeSplatPath:!1},c)}),[d,c,o,i]);"string"===typeof a&&(a=p(a));let{pathname:x="/",search:g="",hash:h="",state:f=null,key:b="default"}=a,y=r.useMemo(()=>{let e=A(x,d);return null==e?null:{location:{pathname:e,search:g,hash:h,state:f,key:b},navigationType:l}},[d,x,g,h,f,b,l]);return null==y?null:r.createElement(K.Provider,{value:m},r.createElement(Y.Provider,{children:n,value:y}))}function ve(e){let{children:t,location:n}=e;return ae(je(t),n)}new Promise(()=>{});r.Component;function je(e,t){void 0===t&&(t=[]);let n=[];return r.Children.forEach(e,(e,s)=>{if(!r.isValidElement(e))return;let a=[...t,s];if(e.type===r.Fragment)return void n.push.apply(n,je(e.props.children,a));e.type!==be&&u(!1),e.props.index&&e.props.children&&u(!1);let l={id:e.props.id||a.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(l.children=je(e.props.children,a)),n.push(l)}),n}function Ne(){return Ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ne.apply(this,arguments)}function we(e,t){if(null==e)return{};var n,s,r={},a=Object.keys(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||(r[n]=e[n]);return r}function ke(e){return void 0===e&&(e=""),new URLSearchParams("string"===typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,n)=>{let s=e[n];return t.concat(Array.isArray(s)?s.map(e=>[n,e]):[[n,s]])},[]))}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const Se=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"];try{window.__reactRouterVersion="6"}catch(Yc){}new Map;const _e=a.startTransition;i.flushSync,a.useId;function Ce(e){let{basename:t,children:n,future:s,window:a}=e,l=r.useRef();var o;null==l.current&&(l.current=(void 0===(o={window:a,v5Compat:!0})&&(o={}),f(function(e,t){let{pathname:n,search:s,hash:r}=e.location;return g("",{pathname:n,search:s,hash:r},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:h(t)},null,o)));let i=l.current,[c,d]=r.useState({action:i.action,location:i.location}),{v7_startTransition:u}=s||{},m=r.useCallback(e=>{u&&_e?_e(()=>d(e)):d(e)},[d,u]);return r.useLayoutEffect(()=>i.listen(m),[i,m]),r.useEffect(()=>fe(s),[s]),r.createElement(ye,{basename:t,children:n,location:c.location,navigationType:c.action,navigator:i,future:s})}const Ie="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,Te=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Pe=r.forwardRef(function(e,t){let n,{onClick:s,relative:a,reloadDocument:l,replace:o,state:i,target:c,to:d,preventScrollReset:m,viewTransition:x}=e,g=we(e,Se),{basename:p}=r.useContext(K),f=!1;if("string"===typeof d&&Te.test(d)&&(n=d,Ie))try{let e=new URL(window.location.href),t=d.startsWith("//")?new URL(e.protocol+d):new URL(d),n=A(t.pathname,p);t.origin===e.origin&&null!=n?d=n+t.search+t.hash:f=!0}catch(Yc){}let b=function(e,t){let{relative:n}=void 0===t?{}:t;X()||u(!1);let{basename:s,navigator:a}=r.useContext(K),{hash:l,pathname:o,search:i}=re(e,{relative:n}),c=o;return"/"!==s&&(c="/"===o?s:M([s,o])),a.createHref({pathname:c,search:i,hash:l})}(d,{relative:a}),y=function(e,t){let{target:n,replace:s,state:a,preventScrollReset:l,relative:o,viewTransition:i}=void 0===t?{}:t,c=ne(),d=ee(),u=re(e,{relative:o});return r.useCallback(t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let n=void 0!==s?s:h(d)===h(u);c(e,{replace:n,state:a,preventScrollReset:l,relative:o,viewTransition:i})}},[d,c,u,s,a,n,e,l,o,i])}(d,{replace:o,state:i,target:c,preventScrollReset:m,relative:a,viewTransition:x});return r.createElement("a",Ne({},g,{href:n||b,onClick:f||l?s:function(e){s&&s(e),e.defaultPrevented||y(e)},ref:t,target:c}))});var Le,Ee;function De(e){let t=r.useRef(ke(e)),n=r.useRef(!1),s=ee(),a=r.useMemo(()=>function(e,t){let n=ke(e);return t&&t.forEach((e,s)=>{n.has(s)||t.getAll(s).forEach(e=>{n.append(s,e)})}),n}(s.search,n.current?null:t.current),[s.search]),l=ne(),o=r.useCallback((e,t)=>{const s=ke("function"===typeof e?e(a):e);n.current=!0,l("?"+s,t)},[l,a]);return[a,o]}(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Le||(Le={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Ee||(Ee={}));var Ae=n(405),$e=n(73),ze=n(533);const Oe=async()=>{try{const e=await(async()=>{try{const t=await fetch(`${ze.JR}/api/operation-logs/client-ip`,{method:"GET",headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});var e;return t.ok&&(null===(e=(await t.json()).data)||void 0===e?void 0:e.ip)||"N/A"}catch(t){return console.warn("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9IP\u53d6\u5f97\u30b5\u30fc\u30d3\u30b9\u3067\u30a8\u30e9\u30fc:",t),"N/A"}})();if(e&&"N/A"!==e)return e;return await new Promise(e=>{try{const t=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;if(!t)return void e("N/A");const n=new t({iceServers:[]});n.createDataChannel(""),n.createOffer().then(e=>n.setLocalDescription(e)),n.onicecandidate=t=>{if(!t||!t.candidate)return n.close(),void e("N/A");const s=/([0-9]{1,3}(\.[0-9]{1,3}){3})/.exec(t.candidate.candidate);if(s){const t=s[1];n.close(),e(t)}},setTimeout(()=>{n.close(),e("N/A")},3e3)}catch(t){console.warn("\u30ed\u30fc\u30ab\u30ebIP\u53d6\u5f97\u30a8\u30e9\u30fc:",t),e("N/A")}})}catch(e){return console.error("IP\u30a2\u30c9\u30ec\u30b9\u53d6\u5f97\u306b\u5931\u6557:",e),"N/A"}};let Re=null,Me=0;const Fe=async()=>{const e=Date.now();if(Re&&e-Me<3e5)return Re;const t=await Oe();return Re=t,Me=e,t},Ue=()=>{try{const e=["userData","currentUser","user","adminUser","loggedInUser","authUser"];for(const t of e){const e=localStorage.getItem(t);if(e)try{const n=JSON.parse(e);if(n&&(n.name||n.username||n.id))return console.log(`\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092 ${t} \u304b\u3089\u53d6\u5f97:`,n),n}catch(Yc){console.warn(`${t} \u306e\u30d1\u30fc\u30b9\u306b\u5931\u6557:`,Yc)}}for(const t of e){const e=sessionStorage.getItem(t);if(e)try{const n=JSON.parse(e);if(n&&(n.name||n.username||n.id))return console.log(`\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u30bb\u30c3\u30b7\u30e7\u30f3 ${t} \u304b\u3089\u53d6\u5f97:`,n),n}catch(Yc){console.warn(`\u30bb\u30c3\u30b7\u30e7\u30f3 ${t} \u306e\u30d1\u30fc\u30b9\u306b\u5931\u6557:`,Yc)}}return console.log("\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f"),null}catch(e){return console.error("\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557:",e),null}},Be=()=>{const e=Ue();return e?e.name||e.username||e.displayName||"\u4e0d\u660e\u306a\u30e6\u30fc\u30b6\u30fc":"\u30b7\u30b9\u30c6\u30e0"},Je=()=>{const e=Ue();return e?e.id||e.userId||"unknown":"system"};let qe=!1;const Ve=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(qe)throw console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u51e6\u7406\u4e2d\u306e\u305f\u3081\u3001API\u547c\u3073\u51fa\u3057\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),new Error("Authentication error handling in progress");const r=`${ze.JR}${e}`,a=t.body instanceof FormData,l=localStorage.getItem("accessToken"),o={headers:{...a?{}:{"Content-Type":"application/json"},"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0",...l&&{Authorization:`Bearer ${l}`},...t.headers}},i={...o,...t,headers:{...o.headers,...t.headers}};try{console.log(`API\u547c\u3073\u51fa\u3057: ${i.method||"GET"} ${r}${s>0?` (\u518d\u8a66\u884c ${s})`:""}`);const t=new AbortController,a=setTimeout(()=>t.abort(),15e3),l=await fetch(r,{...i,signal:t.signal});if(clearTimeout(a),401===l.status||403===l.status){if(["/login","/instructor-login","/refresh","/register","/forgot-password","/api/messages/unread-count"].some(t=>e.includes(t)))return console.log("\u8a8d\u8a3c\u4e0d\u8981\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u305f\u3081\u3001\u8a8d\u8a3c\u30a8\u30e9\u30fc\u51e6\u7406\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),l;qe=!0,console.warn("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u3092\u691c\u51fa\u3057\u307e\u3057\u305f\u3002\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u51e6\u7406\u3092\u958b\u59cb\u3057\u307e\u3059\u3002");const{setGlobalNavigate:t}=await Promise.resolve().then(n.bind(n,73)),{handleTokenInvalid:s}=await Promise.resolve().then(n.bind(n,405));throw setTimeout(()=>{s(window.navigate||(()=>window.location.href="/homepage"),"\u8a8d\u8a3c\u306b\u5931\u6557\u3057\u307e\u3057\u305f"),qe=!1},100),new Error("Authentication failed")}if(!l.ok){let e;try{const t=await l.text();e=JSON.parse(t)}catch(c){e={message:await l.text()}}console.error(`API\u30a8\u30e9\u30fc (${l.status}):`,e);const t=new Error(e.message||`API\u547c\u3073\u51fa\u3057\u306b\u5931\u6557\u3057\u307e\u3057\u305f (${l.status})`);throw t.status=l.status,t.response={data:e},t}const o=await l.json();return console.log("API\u30ec\u30b9\u30dd\u30f3\u30b9:",o),o}catch(d){if(console.error("API\u547c\u3073\u51fa\u3057\u30a8\u30e9\u30fc:",d),"Authentication failed"===d.message)throw d;if(("AbortError"===d.name||d.message.includes("Failed to fetch")||d.message.includes("ERR_EMPTY_RESPONSE"))&&s<3){console.warn(`\u63a5\u7d9a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002${s+1}\u56de\u76ee\u306e\u518d\u8a66\u884c\u3092\u5b9f\u884c\u3057\u307e\u3059...`);const n=1e3*Math.pow(2,s);return await new Promise(e=>setTimeout(e,n)),Ve(e,t,s+1)}if("AbortError"===d.name||d.message.includes("Failed to fetch")||d.message.includes("ERR_EMPTY_RESPONSE"))throw console.error("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093\u3002\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),new Error("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093\u3002\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002");throw d}},He=e=>{if(qe)throw console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u51e6\u7406\u4e2d\u306e\u305f\u3081\u3001GET\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),new Error("Authentication error handling in progress");const t=e.includes("?")?"&":"?",n=`${e}${t}_t=${Date.now()}`;return Ve(n)},We=(e,t)=>{if(qe)throw console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u51e6\u7406\u4e2d\u306e\u305f\u3081\u3001POST\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),new Error("Authentication error handling in progress");return Ve(e,{method:"POST",body:JSON.stringify(t)})},Qe=(e,t)=>{if(qe)throw console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u51e6\u7406\u4e2d\u306e\u305f\u3081\u3001PUT\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),new Error("Authentication error handling in progress");return Ve(e,{method:"PUT",body:JSON.stringify(t)})},Ke=e=>{if(qe)throw console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u51e6\u7406\u4e2d\u306e\u305f\u3081\u3001DELETE\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),new Error("Authentication error handling in progress");return Ve(e,{method:"DELETE"})},Ye=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(qe)throw console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u51e6\u7406\u4e2d\u306e\u305f\u3081\u3001API\u547c\u3073\u51fa\u3057\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),new Error("Authentication error handling in progress");const s=`${ze.JR}${e}`,r=localStorage.getItem("accessToken"),a={headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0",...r&&{Authorization:`Bearer ${r}`},...t.headers}},l={...a,...t,headers:{...a.headers,...t.headers}};try{console.log(`\u30d0\u30a4\u30ca\u30ea\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9API\u547c\u3073\u51fa\u3057: ${l.method||"GET"} ${s}`);const t=await fetch(s,l);if(401===t.status||403===t.status){if(["/login","/instructor-login","/refresh","/register","/forgot-password","/api/messages/unread-count"].some(t=>e.includes(t)))return console.log("\u8a8d\u8a3c\u4e0d\u8981\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u305f\u3081\u3001\u8a8d\u8a3c\u30a8\u30e9\u30fc\u51e6\u7406\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),t;qe=!0,console.warn("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u3092\u691c\u51fa\u3057\u307e\u3057\u305f\u3002\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u51e6\u7406\u3092\u958b\u59cb\u3057\u307e\u3059\u3002");const{setGlobalNavigate:s}=await Promise.resolve().then(n.bind(n,73)),{handleTokenInvalid:r}=await Promise.resolve().then(n.bind(n,405));throw setTimeout(()=>{r(window.navigate||(()=>window.location.href="/homepage"),"\u8a8d\u8a3c\u306b\u5931\u6557\u3057\u307e\u3057\u305f"),qe=!1},100),new Error("Authentication failed")}if(!t.ok){const e=await t.text();throw console.error(`API\u30a8\u30e9\u30fc (${t.status}):`,e),new Error(`API\u547c\u3073\u51fa\u3057\u306b\u5931\u6557\u3057\u307e\u3057\u305f (${t.status}): ${e}`)}const r=await t.blob();return console.log(`\u30d0\u30a4\u30ca\u30ea\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5b8c\u4e86: ${r.size} bytes`),r}catch(o){if(console.error("\u30d0\u30a4\u30ca\u30ea\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30a8\u30e9\u30fc:",o),"Authentication failed"===o.message)throw o;throw o}},Ge=(e,t)=>Qe(`/api/users/${e}`,t),Ze=e=>He(`/api/users/${e}/specializations`),Xe=(e,t)=>We(`/api/users/${e}/specializations`,{specialization:t}),et=(e,t,n)=>Qe(`/api/users/${e}/specializations/${t}`,{specialization:n}),tt=(e,t)=>Ke(`/api/users/${e}/specializations/${t}`),nt=e=>{if(!e||"undefined"===e)throw console.error("\u62e0\u70b9ID\u304c\u7121\u52b9\u3067\u3059:",e),new Error("\u62e0\u70b9ID\u304c\u7121\u52b9\u3067\u3059");return He(`/api/user-courses/satellite/${e}/user-courses`)},st=e=>{if(!e||"undefined"===e)throw console.error("\u62e0\u70b9ID\u304c\u7121\u52b9\u3067\u3059:",e),new Error("\u62e0\u70b9ID\u304c\u7121\u52b9\u3067\u3059");return He(`/api/user-courses/satellite/${e}/available-courses`)},rt=e=>He(`/api/user-courses/satellite/${e}/available-curriculum-paths`),at=(e,t)=>We(`/api/user-courses/satellite/${e}/bulk-assign-courses`,t),lt=(e,t)=>We(`/api/user-courses/satellite/${e}/bulk-remove-courses`,t),ot=(e,t)=>We(`/api/user-courses/satellite/${e}/bulk-assign-curriculum-paths`,t),it=async(e,t)=>{const s=await Ve("/api/users/verify-temp-password",{method:"POST",body:JSON.stringify({loginCode:e,tempPassword:t})});if(s.success&&s.data&&s.data.expiresAt){const{isExpired:e}=await Promise.resolve().then(n.bind(n,291));if(e(s.data.expiresAt))return{success:!1,message:"\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u304c\u5207\u308c\u3066\u3044\u307e\u3059"}}return s},ct=async e=>He(`/api/test/instructor/pending-approvals?satelliteId=${e}`),dt="adminOperationLogs",ut=new Map,mt=async(e,t)=>{var n;const s="string"===typeof e?{action:e,details:t}:e||{},r="object"===typeof s.details&&null!==s.details?JSON.stringify(s.details):null!==(n=s.details)&&void 0!==n?n:null;if(((e,t)=>{const n=`${e}:${t}`,s=Date.now(),r=ut.get(n);if(r&&s-r<3e3)return console.log("\u91cd\u8907\u64cd\u4f5c\u3092\u691c\u51fa\u3057\u307e\u3057\u305f:",{action:e,details:t,timeDiff:s-r}),!0;ut.set(n,s);const a=s-3e5;for(const[l,o]of ut.entries())o<a&&ut.delete(l);return!1})(s.action,r))return console.log("\u91cd\u8907\u64cd\u4f5c\u306e\u305f\u3081\u3001\u30ed\u30b0\u8a18\u9332\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059:",{action:s.action,details:r}),null;let a=s.ipAddress;try{if(!a||"N/A"===a){const e=await(async()=>{try{const e=await He("/api/operation-logs/client-ip");if(e.success&&e.data&&e.data.ip)return e.data.ip}catch(e){console.warn("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u304b\u3089\u306eIP\u53d6\u5f97\u306b\u5931\u6557:",e)}return null})();a=e&&"N/A"!==e?e:await Fe()}const e={adminId:s.adminId||Je(),adminName:s.adminName||Be(),action:s.action,details:r,ipAddress:a};console.log("\u64cd\u4f5c\u30ed\u30b0\u3092\u9001\u4fe1:",e);const t=await We("/api/operation-logs",e);if(console.log("\u64cd\u4f5c\u30ed\u30b0\u9001\u4fe1\u30ec\u30b9\u30dd\u30f3\u30b9:",t),t.success){const e=await xt(),n=Array.isArray(e)?e:[],l={id:t.data.id,adminId:s.adminId||Je(),adminName:s.adminName||Be(),action:s.action,details:r,timestamp:(new Date).toISOString(),ipAddress:a};n.unshift(l);const o=gt(n);return localStorage.setItem(dt,JSON.stringify(o)),l}throw new Error(t.message||"\u30ed\u30b0\u306e\u8a18\u9332\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(l){console.error("\u64cd\u4f5c\u30ed\u30b0\u306e\u8a18\u9332\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",l);try{const e=await xt(),t=Array.isArray(e)?e:[],n=a||await Fe(),l={id:Date.now()+Math.random(),adminId:s&&s.adminId||Je(),adminName:s&&s.adminName||Be(),action:s&&s.action||"unknown_action",details:r,timestamp:(new Date).toISOString(),ipAddress:n};t.unshift(l);const o=gt(t);return localStorage.setItem(dt,JSON.stringify(o)),l}catch(o){return console.error("\u30ed\u30fc\u30ab\u30eb\u30ed\u30b0\u4fdd\u5b58\u306b\u3082\u5931\u6557\u3057\u307e\u3057\u305f:",o),null}}},xt=async()=>{try{const t=await He("/api/operation-logs");if(console.log("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u304b\u3089\u306e\u64cd\u4f5c\u30ed\u30b0\u30ec\u30b9\u30dd\u30f3\u30b9:",t),t.success&&t.data&&t.data.logs){const e=t.data.logs.map(e=>({id:e.id,adminId:e.admin_id,adminName:e.admin_name,action:e.action,details:e.details,timestamp:e.created_at,ipAddress:e.ip_address}));return console.log("\u5909\u63db\u5f8c\u306e\u30ed\u30b0\u30c7\u30fc\u30bf:",e),localStorage.setItem(dt,JSON.stringify(e)),e}{console.log("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u304b\u3089\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u671f\u5f85\u5f62\u5f0f\u3068\u7570\u306a\u308a\u307e\u3059:",t);const n=localStorage.getItem(dt);if(n)try{const e=JSON.parse(n);return Array.isArray(e)?e:[]}catch(e){return console.error("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u30ed\u30b0\u30c7\u30fc\u30bf\u306e\u89e3\u6790\u306b\u5931\u6557:",e),[]}return[]}}catch(t){console.error("\u64cd\u4f5c\u30ed\u30b0\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",t);try{const e=localStorage.getItem(dt);if(e){const t=JSON.parse(e);return Array.isArray(t)?t:[]}}catch(n){console.error("\u30ed\u30fc\u30ab\u30eb\u30ed\u30b0\u53d6\u5f97\u306b\u3082\u5931\u6557\u3057\u307e\u3057\u305f:",n)}return[]}},gt=e=>{if(!Array.isArray(e))return[];const t=new Date;return e.filter(e=>{const n=new Date(e.timestamp);return t-n<2592e6}).slice(0,100)},ht=async()=>{try{const e=await He("/api/operation-logs/stats");if(e.success&&e.data)return{totalLogs:e.data.totalLogs||0,todayLogs:e.data.todayLogs||0,thisWeekLogs:e.data.thisWeekLogs||0,thisMonthLogs:e.data.thisMonthLogs||0,actionCounts:e.data.actionStats?e.data.actionStats.reduce((e,t)=>(e[t.action]=t.count,e),{}):{}};{const e=await xt(),t=Array.isArray(e)?e:[],n=new Date,s={totalLogs:t.length,todayLogs:0,thisWeekLogs:0,thisMonthLogs:0,actionCounts:{}};return t.forEach(e=>{const t=new Date(e.timestamp),r=(n-t)/864e5;r<1&&s.todayLogs++,r<7&&s.thisWeekLogs++,r<30&&s.thisMonthLogs++,s.actionCounts[e.action]?s.actionCounts[e.action]++:s.actionCounts[e.action]=1}),s}}catch(e){console.error("\u30ed\u30b0\u7d71\u8a08\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",e);const t=await xt(),n=Array.isArray(t)?t:[],s=new Date,r={totalLogs:n.length,todayLogs:0,thisWeekLogs:0,thisMonthLogs:0,actionCounts:{}};return n.forEach(e=>{const t=new Date(e.timestamp),n=(s-t)/864e5;n<1&&r.todayLogs++,n<7&&r.thisWeekLogs++,n<30&&r.thisMonthLogs++,r.actionCounts[e.action]?r.actionCounts[e.action]++:r.actionCounts[e.action]=1}),r}};var pt=n(579);const ft=(0,r.createContext)(),bt=()=>{const e=(0,r.useContext)(ft);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},yt=e=>{let{children:t}=e;const[n,s]=(0,r.useState)(!1),[a,l]=(0,r.useState)(!0),[o,i]=(0,r.useState)(null),c=ne(),d=ee(),u=(0,r.useRef)(null),m=(0,r.useRef)(null),x=(0,r.useRef)(0),g=(0,r.useRef)(!1);(0,r.useEffect)(()=>{(0,$e.setGlobalNavigate)(c),(0,$e.h)();(async()=>{const e=d.pathname;if("/"===e||e.startsWith("/student/login")||e.startsWith("/login"))return console.log("AuthContext: \u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u305f\u3081\u3001\u521d\u671f\u8a8d\u8a3c\u30c1\u30a7\u30c3\u30af\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),s(!1),i(null),void l(!1);try{console.log("=== \u521d\u671f\u8a8d\u8a3c\u30c1\u30a7\u30c3\u30af\u958b\u59cb ===");const e=localStorage.getItem("currentUser");if(console.log("localStorage currentUser:",e?"\u5b58\u5728":"\u306a\u3057"),!e)return console.log("\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093"),s(!1),i(null),void l(!1);const n=JSON.parse(e);console.log("\u30e6\u30fc\u30b6\u30fc\u60c5\u5831:",{role:n.role,name:n.name}),console.log("\u521d\u671f\u8a8d\u8a3c\u30c1\u30a7\u30c3\u30af - \u6307\u5c0e\u54e1\u540d\u30c7\u30d0\u30c3\u30b0:",{instructorName:n.instructorName,type:typeof n.instructorName,isTruthy:!!n.instructorName}),i(n);const{accessToken:r,refreshToken:a}=(0,Ae.Uk)();console.log("\u4fdd\u5b58\u3055\u308c\u305f\u30c8\u30fc\u30af\u30f3:",{accessToken:r?"\u5b58\u5728":"\u306a\u3057",refreshToken:a?"\u5b58\u5728":"\u306a\u3057"});const o=localStorage.getItem("loginCode"),d=localStorage.getItem("tempPassword"),u=localStorage.getItem("tempPasswordExpiry");if(console.log("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u60c5\u5831:",{loginCode:o?"\u5b58\u5728":"\u306a\u3057",tempPassword:d?"\u5b58\u5728":"\u306a\u3057",expiry:u||"\u306a\u3057"}),!r||!a){if(o&&d){if(!u)return console.log("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u60c5\u5831\u304c\u6709\u52b9\u3067\u3059\uff08\u6709\u52b9\u671f\u9650\u306a\u3057\uff09- \u8a8d\u8a3c\u6e08\u307f\u3068\u3057\u3066\u8a2d\u5b9a"),s(!0),i(n),void l(!1);{const e=new Date(u);if(e>new Date)return console.log("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u60c5\u5831\u304c\u6709\u52b9\u3067\u3059 - \u8a8d\u8a3c\u6e08\u307f\u3068\u3057\u3066\u8a2d\u5b9a"),s(!0),i(n),void l(!1);console.log("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u304c\u5207\u308c\u3066\u3044\u307e\u3059"),localStorage.removeItem("loginCode"),localStorage.removeItem("tempPassword"),localStorage.removeItem("tempPasswordExpiry"),localStorage.removeItem("currentUser")}}return console.log("\u6709\u52b9\u306a\u8a8d\u8a3c\u60c5\u5831\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093 - \u8a8d\u8a3c\u3055\u308c\u3066\u3044\u307e\u305b\u3093"),s(!1),i(null),void l(!1)}if(console.log("\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u306e\u6709\u52b9\u671f\u9650\u3092\u30c1\u30a7\u30c3\u30af\u4e2d..."),(0,Ae._r)(a))return console.log("\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u306e\u6709\u52b9\u671f\u9650\u304c\u5207\u308c\u3066\u3044\u307e\u3059"),void(0,Ae.handleTokenInvalid)(c,"\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u306e\u6709\u52b9\u671f\u9650\u304c\u5207\u308c\u307e\u3057\u305f");if(console.log("\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u306f\u6709\u52b9\u3067\u3059"),r&&console.log("\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u8a73\u7d30:",{length:r.length,startsWith:r.substring(0,20)+"...",containsDots:r.includes("."),dotCount:(r.match(/\./g)||[]).length,fullToken:r}),a&&console.log("\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u8a73\u7d30:",{length:a.length,startsWith:a.substring(0,20)+"...",containsDots:a.includes("."),dotCount:(a.match(/\./g)||[]).length,fullToken:a}),!r.includes(".")||3!==r.split(".").length)return console.error("\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u306e\u5f62\u5f0f\u304c\u4e0d\u6b63\u3067\u3059:",r),void(0,Ae.handleTokenInvalid)(c,"\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u306e\u5f62\u5f0f\u304c\u4e0d\u6b63\u3067\u3059");if(!a.includes(".")||3!==a.split(".").length)return console.error("\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u306e\u5f62\u5f0f\u304c\u4e0d\u6b63\u3067\u3059:",a),void(0,Ae.handleTokenInvalid)(c,"\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u306e\u5f62\u5f0f\u304c\u4e0d\u6b63\u3067\u3059");console.log("\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u306e\u6709\u52b9\u6027\u3092\u30c1\u30a7\u30c3\u30af\u4e2d...");const m=(0,Ae.G6)(r),x=(0,Ae.EY)(r);if(console.log("\u30c8\u30fc\u30af\u30f3\u6709\u52b9\u6027\u30c1\u30a7\u30c3\u30af:",{isValid:m,remainingTime:x,shouldRefresh:(0,Ae.Yq)(r),remainingMinutes:Math.floor(x/60)}),!m){console.log("\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u304c\u7121\u52b9\u3067\u3059\u3002\u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u3092\u8a66\u884c\u3057\u307e\u3059\u3002");try{await h(a),console.log("\u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u6210\u529f - \u8a8d\u8a3c\u6e08\u307f\u3068\u3057\u3066\u8a2d\u5b9a"),s(!0),l(!1)}catch(t){console.error("\u521d\u671f\u8a8d\u8a3c\u6642\u306e\u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u306b\u5931\u6557:",t),(0,Ae.handleTokenInvalid)(c,"\u30c8\u30fc\u30af\u30f3\u306e\u6709\u52b9\u671f\u9650\u304c\u5207\u308c\u307e\u3057\u305f")}return}console.log("\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u304c\u6709\u52b9\u3067\u3059"),s(!0),l(!1),(0,Ae.Yq)(r)&&(console.log("\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u304c30\u5206\u4ee5\u5185\u306b\u671f\u9650\u5207\u308c\u306b\u306a\u308a\u307e\u3059\u3002\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u66f4\u65b0\u3092\u8a66\u884c\u3057\u307e\u3059\u3002"),h(a).catch(e=>{console.error("\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u306b\u5931\u6557:",e)}))}catch(t){console.error("Initial auth check error:",t),(0,Ae.handleTokenInvalid)(c,"\u8a8d\u8a3c\u30c1\u30a7\u30c3\u30af\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}})()},[]);const h=async e=>{if(g.current)return console.log("\u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u304c\u65e2\u306b\u9032\u884c\u4e2d\u3067\u3059\u3002\u5f85\u6a5f\u3057\u307e\u3059\u3002"),!1;if(x.current>=3)return console.error("\u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u306e\u8a66\u884c\u56de\u6570\u304c\u4e0a\u9650(3\u56de)\u306b\u9054\u3057\u307e\u3057\u305f"),(0,Ae.handleTokenInvalid)(c,"\u8a8d\u8a3c\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u671f\u9650\u5207\u308c\u3067\u3059\u3002\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),!1;try{g.current=!0,x.current++,console.log(`\u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u8a66\u884c ${x.current}/3`);const t=await fetch(`${ze.JR}/api/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:e})});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const n=await t.json();if(n.success){console.log("\u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u6210\u529f");const{access_token:e,refresh_token:t}=n.data;return(0,Ae.storeTokens)(e,t),x.current=0,g.current=!1,!0}throw new Error(n.message||"\u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(t){return console.error("\u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u30a8\u30e9\u30fc:",t),x.current>=3?(console.error("\u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u306e\u6700\u5927\u8a66\u884c\u56de\u6570\u306b\u9054\u3057\u307e\u3057\u305f"),(0,Ae.handleTokenInvalid)(c,"\u8a8d\u8a3c\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u671f\u9650\u5207\u308c\u3067\u3059\u3002\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002")):console.log("\u66f4\u65b0\u5931\u6557\u3002\u6b8b\u308a\u8a66\u884c\u56de\u6570: "+(3-x.current)),g.current=!1,!1}},p=async()=>{try{const{accessToken:e,refreshToken:t}=(0,Ae.Uk)();if(!e||!t)return void console.log("\u30c8\u30fc\u30af\u30f3\u304c\u5b58\u5728\u3057\u307e\u305b\u3093");if((0,Ae._r)(t))return console.log("\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u306e\u6709\u52b9\u671f\u9650\u304c\u5207\u308c\u3066\u3044\u307e\u3059"),void(0,Ae.handleTokenInvalid)(c,"\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u671f\u9650\u5207\u308c\u3067\u3059\u3002\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002");const n=(0,Ae.G6)(e),s=(0,Ae.Yq)(e);if(!n&&s){console.log("\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u304c\u7121\u52b9\u3067\u3059\u3002\u66f4\u65b0\u3092\u8a66\u884c\u3057\u307e\u3059\u3002");await h(t)||(console.log("\u30c8\u30fc\u30af\u30f3\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u307e\u3059\u3002"),await f())}}catch(e){console.error("\u5b9a\u671f\u7684\u306a\u30c8\u30fc\u30af\u30f3\u30c1\u30a7\u30c3\u30af\u3067\u30a8\u30e9\u30fc:",e),await f()}};(0,r.useEffect)(()=>{if(a)return;const e=d.pathname;!(0,Ae.Vg)(e)||n||(0,Ae.handleTokenInvalid)(c,"\u8a8d\u8a3c\u304c\u5fc5\u8981\u3067\u3059")},[d.pathname,n,a]),(0,r.useEffect)(()=>{if(n)return p(),u.current=setInterval(p,3e5),()=>{u.current&&(clearInterval(u.current),u.current=null)}},[n]);const f=async()=>{console.log("=== \u30ed\u30b0\u30a2\u30a6\u30c8\u51e6\u7406\u958b\u59cb ==="),g.current=!1,x.current=0,u.current&&(clearInterval(u.current),u.current=null),m.current&&(clearTimeout(m.current),m.current=null);const e=localStorage.getItem("currentUser");let t="\u4e0d\u660e",n="\u4e0d\u660e",r=null,a=null;if(e)try{const s=JSON.parse(e);t=s.name||"\u4e0d\u660e",a=s.role,r=s.id,n=1===a?"\u5229\u7528\u8005":a>=4?"\u7ba1\u7406\u8005\u30fb\u6307\u5c0e\u54e1":"\u4e0d\u660e"}catch(l){console.error("\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u306e\u89e3\u6790\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",l)}if(1===a&&r)try{console.log("\u5229\u7528\u8005\u306e\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4f7f\u7528\u6e08\u307f\u306b\u30de\u30fc\u30af\u3057\u307e\u3059"),await(async e=>Ve(`/api/users/${e}/mark-temp-password-used`,{method:"POST"}))(r),console.log("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4f7f\u7528\u6e08\u307f\u306b\u30de\u30fc\u30af\u3057\u307e\u3057\u305f")}catch(l){console.error("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u4f7f\u7528\u6e08\u307f\u30de\u30fc\u30af\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",l)}try{await mt({action:"\u30ed\u30b0\u30a2\u30a6\u30c8",details:`${n}\u300c${t}\u300d\u304c\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u307e\u3057\u305f`})}catch(l){console.error("\u30ed\u30b0\u30a2\u30a6\u30c8\u30ed\u30b0\u306e\u8a18\u9332\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",l)}localStorage.removeItem("currentUser"),(0,Ae.V$)(),localStorage.clear(),sessionStorage.clear(),console.log("LocalStorage\u3068SessionStorage\u3092\u5b8c\u5168\u306b\u30af\u30ea\u30a2\u3057\u307e\u3057\u305f"),s(!1),i(null),1===a?(console.log("\u5229\u7528\u8005\u306e\u305f\u3081\u3001\u5229\u7528\u8005\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u307e\u3059"),c("/student-login/")):a>=4?(console.log("\u7ba1\u7406\u8005\u30fb\u6307\u5c0e\u54e1\u306e\u305f\u3081\u3001\u7ba1\u7406\u8005\u30fb\u6307\u5c0e\u54e1\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u307e\u3059"),c("/admin-instructor-login")):(console.log("\u4e0d\u660e\u306a\u30ed\u30fc\u30eb\u306e\u305f\u3081\u3001\u30db\u30fc\u30e0\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u307e\u3059"),c("/homepage")),console.log("\u30ed\u30b0\u30a2\u30a6\u30c8\u51e6\u7406\u5b8c\u4e86")},b={isAuthenticated:n,isLoading:a,currentUser:o,login:(e,t,n)=>{if(console.log("=== \u30ed\u30b0\u30a4\u30f3\u51e6\u7406\u958b\u59cb ==="),console.log("\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf:",e),console.log("\u6307\u5c0e\u54e1\u540d\u30c7\u30d0\u30c3\u30b0:",{instructorName:e.instructorName,type:typeof e.instructorName,isTruthy:!!e.instructorName}),console.log("\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3:",t?"\u5b58\u5728":"\u306a\u3057"),console.log("\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3:",n?"\u5b58\u5728":"\u306a\u3057"),x.current=0,l(!0),t&&console.log("\u30ed\u30b0\u30a4\u30f3\u6642 - \u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u8a73\u7d30:",{length:t.length,startsWith:t.substring(0,20)+"...",containsDots:t.includes("."),dotCount:(t.match(/\./g)||[]).length,fullToken:t}),n&&console.log("\u30ed\u30b0\u30a4\u30f3\u6642 - \u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u8a73\u7d30:",{length:n.length,startsWith:n.substring(0,20)+"...",containsDots:n.includes("."),dotCount:(n.match(/\./g)||[]).length,fullToken:n}),localStorage.removeItem("currentUser"),e.role>=6&&e.satellite_id){const t={id:e.satellite_id,name:e.satellite_name,company_id:e.company_id,company_name:e.company_name};sessionStorage.setItem("selectedSatellite",JSON.stringify(t)),console.log("\u7ba1\u7406\u8005\u30ed\u30b0\u30a4\u30f3\u6642: selectedSatellite\u3092\u4fdd\u5b58:",t)}localStorage.setItem("currentUser",JSON.stringify(e)),console.log("\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3092localStorage\u306b\u4fdd\u5b58\u5b8c\u4e86"),t&&n?((0,Ae.storeTokens)(t,n),console.log("\u30c8\u30fc\u30af\u30f3\u3092localStorage\u306b\u4fdd\u5b58\u5b8c\u4e86")):(localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),console.log("\u30c8\u30fc\u30af\u30f3\u306a\u3057 - \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u3068\u3057\u3066\u51e6\u7406")),i(e),s(!0),l(!1),console.log("\u8a8d\u8a3c\u72b6\u614b\u3092\u8a2d\u5b9a\u5b8c\u4e86"),console.log("\u8a2d\u5b9a\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf:",e),console.log("\u8a2d\u5b9a\u3055\u308c\u305f\u30ed\u30fc\u30eb:",e.role),console.log("\u30ed\u30fc\u30eb\u306e\u578b:",typeof e.role)},logout:f,updateAuthForSatellite:(e,t,n)=>{console.log("=== \u62e0\u70b9\u5909\u66f4\u6642\u8a8d\u8a3c\u66f4\u65b0\u51e6\u7406\u958b\u59cb ==="),console.log("\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf:",e),console.log("\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3:",t?"\u5b58\u5728":"\u306a\u3057"),console.log("\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3:",n?"\u5b58\u5728":"\u306a\u3057"),x.current=0,localStorage.setItem("currentUser",JSON.stringify(e)),console.log("\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3092localStorage\u306b\u66f4\u65b0\u5b8c\u4e86"),t&&n&&((0,Ae.storeTokens)(t,n),console.log("\u30c8\u30fc\u30af\u30f3\u3092localStorage\u306b\u66f4\u65b0\u5b8c\u4e86")),i(e),console.log("\u8a8d\u8a3c\u72b6\u614b\u3092\u66f4\u65b0\u5b8c\u4e86")}};return(0,pt.jsx)(ft.Provider,{value:b,children:t})},vt=()=>{const[e,t]=(0,r.useState)(0),[n,s]=(0,r.useState)(!1),a=ee(),l=()=>{if(!a.pathname.startsWith("/admin/"))return void s(!1);const{accessToken:e}=(0,Ae.Uk)();if(e){const n=(0,Ae.EY)(e);t(n),s(n>0)}else s(!1)};(0,r.useEffect)(()=>{l();const e=setInterval(l,1e3);return()=>clearInterval(e)},[a.pathname]);return n?(0,pt.jsxs)("div",{className:`fixed bottom-4 right-4 z-50 p-3 rounded-lg border-2 shadow-lg ${e<=30?"bg-red-100 border-red-300":e<=60?"bg-orange-100 border-orange-300":e<=180?"bg-yellow-100 border-yellow-300":"bg-green-100 border-green-300"} transition-all duration-300`,title:"\u8a66\u9a13\u7528\uff1a\u30c8\u30fc\u30af\u30f3\u6b8b\u308a\u6642\u9593\u8868\u793a",children:[(0,pt.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,pt.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),(0,pt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u6b8b\u308a"}),(0,pt.jsx)("span",{className:"text-lg font-bold "+(e<=30?"text-red-600":e<=60?"text-orange-600":e<=180?"text-yellow-600":"text-green-600"),children:(e=>{if(e<=0)return"00:00";const t=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`})(e)})]}),e<=60&&(0,pt.jsx)("div",{className:"mt-1 text-xs text-red-600 font-medium",children:e<=30?"\u26a0\ufe0f \u307e\u3082\u306a\u304f\u671f\u9650\u5207\u308c":"\u26a0\ufe0f \u66f4\u65b0\u304c\u5fc5\u8981"}),(0,pt.jsx)("div",{className:"mt-1 text-xs text-gray-500",children:"\ud83d\udd2c \u7ba1\u7406\u8005\u8a66\u9a13\u7528"})]}):null},jt=()=>{const[e,t]=(0,r.useState)(""),[n,s]=(0,r.useState)("");return(0,r.useEffect)(()=>{const e=Math.floor(7*Math.random())+1;t(`/images/background/${e}.png`)},[]),(0,r.useEffect)(()=>{const e=Math.floor(6*Math.random())+1;s(`/images/mio/${e}.png`)},[]),(0,pt.jsxs)("div",{className:"min-h-screen bg-black",children:[(0,pt.jsx)("header",{className:"fixed top-0 left-0 w-full bg-black bg-opacity-90 backdrop-blur-lg z-50 transition-all duration-300",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,pt.jsxs)("div",{className:"flex justify-between items-center py-4",children:[(0,pt.jsx)("div",{className:"flex items-center",children:(0,pt.jsx)("a",{href:"https://www.ayatori-inc.co.jp/",target:"_blank",rel:"noopener noreferrer",className:"text-white text-3xl font-bold hover:text-blue-400 transition-colors",children:"AYATORI.Inc"})}),(0,pt.jsxs)("nav",{className:"hidden md:flex items-center space-x-8",children:[(0,pt.jsxs)("a",{href:"https://ayatori-inc.co.jp/LP-AISchool/",className:"text-white hover:text-blue-400 transition-colors font-medium relative group",children:["\u4e3b\u8981\u6a5f\u80fd",(0,pt.jsx)("span",{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-blue-400 transition-all duration-300 group-hover:w-full"})]}),(0,pt.jsxs)("a",{href:"https://www.ayatori-inc.co.jp/StudySphere-Support/",className:"text-white hover:text-blue-400 transition-colors font-medium relative group",children:["\u30b5\u30dd\u30fc\u30c8",(0,pt.jsx)("span",{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-blue-400 transition-all duration-300 group-hover:w-full"})]}),(0,pt.jsxs)("a",{href:"https://ayatori-inc.co.jp/LP-remote-support/",className:"text-white hover:text-blue-400 transition-colors font-medium relative group",children:["\u5728\u5b85\u652f\u63f4",(0,pt.jsx)("span",{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-blue-400 transition-all duration-300 group-hover:w-full"})]}),(0,pt.jsxs)("a",{href:"https://www.ayatori-inc.co.jp/?page_id=7",target:"_blank",rel:"noopener noreferrer",className:"text-white hover:text-blue-400 transition-colors font-medium relative group",children:["\u554f\u3044\u5408\u308f\u305b",(0,pt.jsx)("span",{className:"absolute bottom-0 left-0 w-0 h-0.5 bg-blue-400 transition-all duration-300 group-hover:w-full"})]})]}),(0,pt.jsx)("div",{className:"md:hidden",children:(0,pt.jsx)("button",{className:"text-white",children:(0,pt.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})})]})})}),(0,pt.jsxs)("main",{children:[(0,pt.jsxs)("section",{className:"relative h-screen flex items-center justify-center text-center overflow-hidden bg-black pt-20",children:[(0,pt.jsx)("div",{className:"absolute top-0 left-0 w-full h-full bg-cover bg-center bg-no-repeat z-10",style:{backgroundImage:e?`url(${e})`:"none"},children:(0,pt.jsx)("div",{className:"absolute top-0 left-0 w-full h-full bg-gradient-to-b from-black/20 via-black/40 to-black/80 z-20"})}),(0,pt.jsxs)("div",{className:"relative z-30 text-white max-w-4xl px-4 mx-auto",children:[(0,pt.jsx)("h1",{className:"text-6xl md:text-7xl font-bold mb-6 text-shadow-lg animate-fade-in-up",children:"StudySphere"}),(0,pt.jsx)("p",{className:"text-2xl md:text-3xl mb-8 opacity-90 animate-fade-in-up animation-delay-200",children:"\u300c\u5b66\u3076\u300d\u306f\u3001\u3042\u306a\u305f\u306e\u529b\u306b\u306a\u308b\u3002"}),(0,pt.jsx)("p",{className:"text-lg md:text-xl mb-12 opacity-80 leading-relaxed animate-fade-in-up animation-delay-400",children:"\u3053\u3053\u304b\u3089\u3001\u3042\u306a\u305f\u306e\u30da\u30fc\u30b9\u3067\u672a\u6765\u3092\u5275\u308d\u3046\u3002"}),(0,pt.jsxs)("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-6 animate-fade-in-up animation-delay-600",children:[(0,pt.jsx)(Pe,{to:"/admin-instructor-login",className:"bg-white/20 text-white px-8 py-4 rounded-full hover:bg-white/30 transition-all duration-300 font-semibold text-lg border-2 border-white/30 hover:border-white/50 transform hover:-translate-y-1 hover:shadow-xl backdrop-blur-sm",children:"\u7ba1\u7406\u8005\u30fb\u6307\u5c0e\u54e1"}),(0,pt.jsx)(Pe,{to:"/student-login",className:"bg-white/20 text-white px-8 py-4 rounded-full hover:bg-white/30 transition-all duration-300 font-semibold text-lg border-2 border-white/30 hover:border-white/50 transform hover:-translate-y-1 hover:shadow-xl backdrop-blur-sm",children:"\u5229\u7528\u8005"}),(0,pt.jsxs)("a",{href:"https://drive.google.com/file/d/1hBn-q4GTexuB8zzv9MFYooGqm7Ie3yPz/view?usp=drive_link",target:"_blank",rel:"noopener noreferrer",className:"bg-white/20 text-white px-8 py-4 rounded-full hover:bg-white/30 transition-all duration-300 font-semibold text-lg border-2 border-white/30 hover:border-white/50 transform hover:-translate-y-1 hover:shadow-xl backdrop-blur-sm flex items-center gap-3",children:[(0,pt.jsx)("span",{className:"text-2xl",children:"\u229e"}),(0,pt.jsx)("span",{className:"animate-bounce",children:"\u2b07"}),"\u30a2\u30d7\u30ea\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9"]})]})]})]}),(0,pt.jsx)("section",{className:"py-20 bg-black",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,pt.jsx)("div",{className:"text-center max-w-4xl mx-auto",children:(0,pt.jsxs)("div",{className:"flex flex-col items-center gap-8",children:[(0,pt.jsxs)("div",{className:"max-w-2xl",children:[(0,pt.jsx)("h2",{className:"text-4xl md:text-5xl font-bold text-white mb-6",children:"\u5b66\u7fd2\u306e\u8cea\u3092\u9ad8\u3081\u308b\u3001StudySphere\u306e\u3059\u3079\u3066\u3002"}),(0,pt.jsxs)("p",{className:"text-xl text-gray-300 leading-relaxed",children:["\u3042\u306a\u305f\u306e\u300c\u5b66\u3073\u305f\u3044\u300d\u3092\u53f6\u3048\u308b\u6a5f\u80fd\u3001\u5b89\u5fc3\u306e\u30b5\u30dd\u30fc\u30c8\u3001",(0,pt.jsx)("br",{}),"\u81ea\u7531\u306a\u5b66\u7fd2\u74b0\u5883\u3092\u3054\u7d39\u4ecb\u3057\u307e\u3059\u3002"]})]}),(0,pt.jsx)("div",{className:"order-2 md:order-1",children:n&&(0,pt.jsx)("img",{src:n,alt:"\u30ad\u30e3\u30e9\u30af\u30bf\u30fc",className:"max-w-48 md:max-w-64 h-auto rounded-xl shadow-2xl hover:scale-105 transition-transform duration-300"})}),(0,pt.jsxs)("div",{className:"flex flex-wrap justify-center gap-4 order-3",children:[(0,pt.jsx)("a",{href:"https://ayatori-inc.co.jp/LP-AISchool/",className:"bg-transparent border-2 border-white text-white px-6 py-3 rounded hover:bg-white hover:text-black transition-all duration-300 font-semibold",children:"\u4e3b\u8981\u6a5f\u80fd"}),(0,pt.jsx)("a",{href:"https://www.ayatori-inc.co.jp/StudySphere-Support/",className:"bg-transparent border-2 border-white text-white px-6 py-3 rounded hover:bg-white hover:text-black transition-all duration-300 font-semibold",children:"\u30b5\u30dd\u30fc\u30c8"}),(0,pt.jsx)("a",{href:"https://ayatori-inc.co.jp/LP-remote-support/",className:"bg-transparent border-2 border-white text-white px-6 py-3 rounded hover:bg-white hover:text-black transition-all duration-300 font-semibold",children:"\u5728\u5b85\u652f\u63f4"})]})]})})})})]}),(0,pt.jsx)("footer",{className:"bg-gray-900 text-white py-12",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,pt.jsx)("div",{className:"text-center",children:(0,pt.jsx)("div",{className:"border-t border-gray-800 pt-6",children:(0,pt.jsx)("p",{className:"text-gray-500 text-sm",children:"Copyright\xa9 AYATORI.inc All Rights Reserved."})})})})})]})},Nt=e=>"string"!==typeof e?String(e):e.replace(/<[^>]*>/g,""),wt=e=>{if("string"!==typeof e)return String(e);let t=e;return t=(e=>{if("string"!==typeof e)return String(e);let t=e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");return t=t.replace(/\s*on\w+\s*=\s*["'][^"']*["']/gi,""),t=t.replace(/javascript:/gi,""),t})(t),t=Nt(t),t=(e=>{if("string"!==typeof e)return String(e);const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return e.replace(/[&<>"'/]/g,e=>t[e])})(t),t=t.replace(/\s+/g," "),t=t.trim(),t},kt=e=>"string"!==typeof e?String(e):Nt(e).trim(),St=(e,t)=>{let n;return function(){for(var s=arguments.length,r=new Array(s),a=0;a<s;a++)r[a]=arguments[a];clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...r)},t)}},_t={FULL:"full",LIGHT:"light",HTML_ONLY:"html_only",NONE:"none"},Ct=e=>{let{type:t="text",value:n="",onChange:s,onBlur:a,sanitizeMode:l=_t.FULL,debounceMs:o=300,className:i="",placeholder:c="",required:d=!1,disabled:u=!1,maxLength:m,minLength:x,pattern:g,autoComplete:h,autoFocus:p=!1,readOnly:f=!1,id:b,name:y,...v}=e;const[j,N]=(0,r.useState)(n),[w,k]=(0,r.useState)(!1),S=(0,r.useCallback)(()=>{switch(l){case _t.FULL:return wt;case _t.LIGHT:return kt;case _t.HTML_ONLY:return Nt;case _t.NONE:return e=>e;default:return wt}},[l]),_=(0,r.useCallback)(St(e=>{const t=S()(e);t!==e&&(N(t),s&&s({target:{value:t,name:y,id:b}})),k(!1)},o),[S,s,y,b,o]),C=(0,r.useCallback)(e=>{const t=e.target.value;N(t),k(!0),s&&s(e),_(t)},[s,_]),I=(0,r.useCallback)(e=>{const t=S()(e.target.value);t!==e.target.value&&(N(t),s&&s({target:{value:t,name:y,id:b}})),a&&a(e),k(!1)},[S,s,a,y,b]);(0,r.useEffect)(()=>{N(n)},[n]);const T=w&&(0,pt.jsx)("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2",children:(0,pt.jsx)("div",{className:"w-3 h-3 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})});return(0,pt.jsxs)("div",{className:"relative",children:[(0,pt.jsx)("input",{type:t,value:j,onChange:C,onBlur:I,className:`${i} ${w?"border-blue-300":""}`,placeholder:c,required:d,disabled:u,maxLength:m,minLength:x,pattern:g,autoComplete:h,autoFocus:p,readOnly:f,id:b,name:y,...v}),T]})},It=()=>{const[e,t]=(0,r.useState)({id:"",password:""}),[n,s]=(0,r.useState)(""),[a,l]=(0,r.useState)(!1),[o,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),[x,g]=(0,r.useState)(null),[h,p]=(0,r.useState)([]),[f,b]=(0,r.useState)([]),[y,v]=(0,r.useState)(""),[j,N]=(0,r.useState)(""),[w,k]=(0,r.useState)(!1),[S,_]=(0,r.useState)(""),C=ne(),{login:I,isAuthenticated:T,currentUser:P}=bt();(0,r.useEffect)(()=>{if(T&&P){const e=P.role;if("true"===sessionStorage.getItem("instructorDashboardSelection"))return void console.log("\u6307\u5c0e\u54e1\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u9078\u629e\u4e2d - LoginPage\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3092\u7121\u52b9");e>=9?C("/admin/dashboard"):e>=4&&e<=8?C("/instructor/dashboard"):e>=1&&e<=3&&C("/student/dashboard")}},[T,P,C]);const L=async e=>{try{console.log("=== getUserCompaniesAPI Debug ==="),console.log("Username:",e),console.log("API URL:",`${ze.JR}/api/user-companies/${e}`);const t=await fetch(`${ze.JR}/api/user-companies/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});console.log("Response status:",t.status),console.log("Response ok:",t.ok);const n=await t.json();if(console.log("Response data:",n),!t.ok)throw new Error(n.message||"\u4f01\u696d\u30fb\u62e0\u70b9\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f");return n}catch(n){throw console.error("LoginPage: Get user companies API error:",n),n}},E=async(e,t,s,r)=>{try{const n=await fetch(`${ze.JR}/api/instructor-login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t,companyId:s,satelliteId:r})}),a=await n.json();if(!n.ok)throw new Error(a.message||"\u6307\u5c0e\u54e1\u30ed\u30b0\u30a4\u30f3\u306b\u5931\u6557\u3057\u307e\u3057\u305f");return a}catch(n){throw console.error("LoginPage: Instructor login API error:",n),n}},D=e=>{const{name:n,value:r}=e.target;("id"!==n||/^[a-zA-Z0-9_/.-]*$/.test(r))&&(t(e=>({...e,[n]:r})),s(""))},A=async t=>{if(console.log("=== handleDashboardSelection Debug ==="),console.log("dashboardType:",t),console.log("userData:",x),console.log("userData.role:",null===x||void 0===x?void 0:x.role),console.log("userData.role type:",typeof(null===x||void 0===x?void 0:x.role)),"instructor"===t&&(sessionStorage.setItem("instructorDashboardSelection","true"),console.log("\u6307\u5c0e\u54e1\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u9078\u629e\u30d5\u30e9\u30b0\u3092\u8a2d\u5b9a"),await new Promise(e=>setTimeout(e,100))),"admin"===t){if(x.role<9)return console.log("User role not authorized for admin dashboard:",x.role),void s("\u7ba1\u7406\u8005\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u304c\u3042\u308a\u307e\u305b\u3093\u3002");const e={id:x.user_id,name:x.user_name,email:x.email||"",login_code:x.login_code,role:x.role,password_reset_required:x.password_reset_required||!1,access_token:x.access_token,refresh_token:x.refresh_token};console.log("Logging in admin user:",e),I(e,x.access_token,x.refresh_token),mt({action:"\u30ed\u30b0\u30a4\u30f3",details:`\u30b7\u30b9\u30c6\u30e0\u7ba1\u7406\u8005\u300c${x.user_name}\u300d\u304c\u7ba1\u7406\u8005\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3057\u305f`,adminId:x.user_id,adminName:x.user_name}),console.log("Navigating to admin dashboard"),C("/admin/dashboard")}else if("instructor"===t){let t;if(console.log("=== Instructor Dashboard Selection Debug ==="),console.log("User data for instructor selection:",x),console.log("User role:",x.role),x.role>=9?(console.log("Fetching all companies and satellites for admin (role 9+)"),t=await(async()=>{try{console.log("=== getAllCompaniesAndSatellitesAPI Debug ==="),console.log("Fetching all companies and satellites for admin");const e=await fetch(`${ze.JR}/api/companies`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error("\u4f01\u696d\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f");const t=await e.json();console.log("Companies response:",t),console.log("Companies response type:",typeof t),console.log("Is array:",Array.isArray(t));const n=Array.isArray(t)?t:t.data||[];console.log("Extracted companies:",n);const s=await fetch(`${ze.JR}/api/satellites`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error("\u62e0\u70b9\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f");const r=await s.json();console.log("Satellites response:",r),console.log("Satellites response type:",typeof r),console.log("Is array:",Array.isArray(r));const a=Array.isArray(r)?r:r.data||[];console.log("Extracted satellites:",a);const l=n.map(e=>({id:e.id,name:e.name,satellites:a.filter(t=>t.company_id===e.id).map(e=>({id:e.id,name:e.name,company_id:e.company_id}))}));return console.log("Companies with satellites:",l),{success:!0,data:{companies:l}}}catch(n){throw console.error("LoginPage: Get all companies and satellites API error:",n),n}})()):(console.log("Fetching user companies data for instructor dashboard selection"),t=await L(e.id)),console.log("Companies data response for instructor selection:",t),t.success&&t.data.companies.length>0){if(console.log("Companies found for instructor selection:",t.data.companies.length),x.role>=9)return p(t.data.companies),i(!1),void d(!0);const r=t.data.companies[0],a=r.satellites||[];if(1===a.length){console.log("Single satellite found in dashboard selection, auto-selecting and proceeding to dashboard");const t=a[0];try{const n=await E(e.id,e.password,r.id.toString(),t.id.toString());if(n.success&&n.data){const e=n.data,t={id:e.user_id,name:e.user_name,email:e.email||"",login_code:e.login_code,role:e.role,company_id:e.company_id,company_name:e.company_name,satellite_id:e.satellite_id,satellite_name:e.satellite_name,satellite_ids:[e.satellite_id],passwordResetRequired:e.password_reset_required||!1,access_token:e.access_token,refresh_token:e.refresh_token},s={id:e.satellite_id,name:e.satellite_name,company_id:e.company_id,company_name:e.company_name};return sessionStorage.setItem("selectedSatellite",JSON.stringify(s)),console.log("\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u9078\u629e\u6642\u81ea\u52d5\u9078\u629e: selectedSatellite\u3092\u4fdd\u5b58:",s),I(t,e.access_token,e.refresh_token),await mt({action:"\u30ed\u30b0\u30a4\u30f3",details:`\u6307\u5c0e\u54e1\u300c${e.user_name}\u300d\u304c${e.company_name}\u306e${e.satellite_name}\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3057\u305f\uff08\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u9078\u629e\u6642\u81ea\u52d5\u9078\u629e\uff09`,adminId:e.user_id,adminName:e.user_name}),sessionStorage.removeItem("instructorDashboardSelection"),void C("/instructor/dashboard")}}catch(n){console.error("Auto-login failed in dashboard selection, falling back to manual selection:",n)}}a.length>1?(p(t.data.companies),i(!1),d(!0)):(s("\u62e0\u70b9\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30b7\u30b9\u30c6\u30e0\u7ba1\u7406\u8005\u306b\u304a\u554f\u3044\u5408\u308f\u305b\u304f\u3060\u3055\u3044\u3002"),l(!1))}else{console.log("No companies found for instructor selection, proceeding to instructor dashboard");const e={id:x.user_id,name:x.user_name,email:x.email||"",login_code:x.login_code,role:x.role,passwordResetRequired:x.password_reset_required||!1,access_token:x.access_token,refresh_token:x.refresh_token};I(e,x.access_token,x.refresh_token),mt({action:"\u30ed\u30b0\u30a4\u30f3",details:`\u6307\u5c0e\u54e1\u300c${x.user_name}\u300d\u304c\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3057\u305f`,adminId:x.user_id,adminName:x.user_name}),sessionStorage.removeItem("instructorDashboardSelection"),C("/instructor/dashboard")}}},$=async()=>{if(y&&j){l(!0),s("");try{const t=await E(e.id,e.password,y,j);if(!t.success||!t.data)throw new Error(t.message||"\u6307\u5c0e\u54e1\u30ed\u30b0\u30a4\u30f3\u306b\u5931\u6557\u3057\u307e\u3057\u305f");{const e=t.data,n={id:e.user_id,name:e.user_name,email:e.email||"",login_code:e.login_code,role:e.role,company_id:e.company_id,company_name:e.company_name,satellite_id:e.satellite_id,satellite_name:e.satellite_name,passwordResetRequired:e.password_reset_required||!1,access_token:e.access_token,refresh_token:e.refresh_token},s={id:e.satellite_id,name:e.satellite_name,company_id:e.company_id,company_name:e.company_name};sessionStorage.setItem("selectedSatellite",JSON.stringify(s)),console.log("\u4f01\u696d\u9078\u629e\u6642\u30ed\u30b0\u30a4\u30f3: selectedSatellite\u3092\u4fdd\u5b58:",s),n.satellite_id=e.satellite_id,n.satellite_ids=[e.satellite_id],n.satellite_name=e.satellite_name,n.company_id=e.company_id,n.company_name=e.company_name,I(n,e.access_token,e.refresh_token),await mt({action:"\u30ed\u30b0\u30a4\u30f3",details:`\u6307\u5c0e\u54e1\u300c${e.user_name}\u300d\u304c${e.company_name}\u306e${e.satellite_name}\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3057\u305f`,adminId:e.user_id,adminName:e.user_name}),sessionStorage.removeItem("instructorDashboardSelection"),C("/instructor/dashboard")}}catch(n){s(n.message||"\u6307\u5c0e\u54e1\u30ed\u30b0\u30a4\u30f3\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}finally{l(!1)}}else s("\u4f01\u696d\u3068\u62e0\u70b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044")},z=async()=>{if(j){l(!0),s("");try{sessionStorage.removeItem("selectedSatellite"),console.log("\u30ed\u30b0\u30a4\u30f3\u6642: \u53e4\u3044selectedSatellite\u60c5\u5831\u3092\u30af\u30ea\u30a2\u3057\u307e\u3057\u305f");const t=y||x&&x.company_id;console.log("=== Satellite Selection Debug ==="),console.log("selectedSatellite:",j),console.log("companyId:",t),console.log("userData:",x),console.log("=== Instructor Login API Call ==="),console.log("Calling instructorLoginAPI with:",{username:e.id,password:e.password?"***":"undefined",companyId:t,satelliteId:j});const n=await E(e.id,e.password,t,j);if(console.log("=== Instructor Login API Response ==="),console.log("Response:",n),!n.success||!n.data)throw console.error("=== Instructor Login Failed ==="),console.error("Response not successful:",n),new Error(n.message||"\u6307\u5c0e\u54e1\u30ed\u30b0\u30a4\u30f3\u306b\u5931\u6557\u3057\u307e\u3057\u305f");{const e=n.data,t={id:e.user_id,name:e.user_name,email:e.email||"",login_code:e.login_code,role:e.role,company_id:e.company_id,company_name:e.company_name,satellite_id:e.satellite_id,satellite_name:e.satellite_name,passwordResetRequired:e.password_reset_required||!1,access_token:e.access_token,refresh_token:e.refresh_token};console.log("=== Satellite Selection Login Success Debug ==="),console.log("Selected company_id:",e.company_id),console.log("Selected satellite_id:",e.satellite_id),console.log("User data to be saved:",t);const s={id:e.satellite_id,name:e.satellite_name,company_id:e.company_id,company_name:e.company_name};sessionStorage.setItem("selectedSatellite",JSON.stringify(s)),console.log("\u30ed\u30b0\u30a4\u30f3\u6210\u529f\u6642: selectedSatellite\u306b\u4fdd\u5b58:",s),t.satellite_ids=[e.satellite_id],I(t,e.access_token,e.refresh_token),await mt({action:"\u30ed\u30b0\u30a4\u30f3",details:`\u6307\u5c0e\u54e1\u300c${e.user_name}\u300d\u304c${e.company_name}\u306e${e.satellite_name}\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3057\u305f`,adminId:e.user_id,adminName:e.user_name}),console.log("=== Navigation Debug ==="),console.log("About to navigate to /instructor/dashboard"),console.log("Current location:",window.location.href),console.log("Current pathname:",window.location.pathname),console.log("Current hash:",window.location.hash),sessionStorage.removeItem("instructorDashboardSelection"),C("/instructor/dashboard",{replace:!0}),console.log("Navigation completed"),console.log("New location after navigation:",window.location.href)}}catch(n){console.error("=== Instructor Login Error ==="),console.error("Error details:",n),console.error("Error message:",n.message),console.error("Error stack:",n.stack),s(n.message||"\u6307\u5c0e\u54e1\u30ed\u30b0\u30a4\u30f3\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}finally{l(!1)}}else s("\u62e0\u70b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044")},O=()=>{i(!1),d(!1),m(!1),g(null),p([]),v(""),N(""),s("")};return o?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-purple-600 flex items-center justify-center p-5",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl p-8 shadow-2xl w-full max-w-md",children:[(0,pt.jsxs)("div",{className:"text-center mb-8",children:[(0,pt.jsx)("h1",{className:"text-4xl font-bold text-indigo-600 mb-2",children:"Study Sphere"}),(0,pt.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-2",children:"\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u9078\u629e"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"})]}),(0,pt.jsxs)("div",{className:"space-y-4",children:[x&&x.role>=9&&(0,pt.jsx)("button",{onClick:()=>A("admin"),className:"w-full bg-gradient-to-r from-red-500 to-red-400 text-white py-3 px-4 rounded-lg hover:from-red-600 hover:to-red-500 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:"\ud83c\udfe2 \u7ba1\u7406\u8005\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9"}),(0,pt.jsx)("button",{onClick:()=>A("instructor"),className:"w-full bg-gradient-to-r from-indigo-600 to-purple-700 text-white py-3 px-4 rounded-lg hover:from-indigo-700 hover:to-purple-800 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",children:"\ud83d\udc68\u200d\ud83c\udfeb \u6307\u5c0e\u54e1\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9"}),(0,pt.jsx)("button",{onClick:O,className:"w-full bg-gray-500 text-white py-3 px-4 rounded-lg hover:bg-gray-600 transition-colors",children:"\u2190 \u623b\u308b"})]})]})}):u?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-purple-600 flex items-center justify-center p-5",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl p-8 shadow-2xl w-full max-w-md",children:[(0,pt.jsxs)("div",{className:"text-center mb-8",children:[(0,pt.jsx)("h1",{className:"text-4xl font-bold text-indigo-600 mb-2",children:"Study Sphere"}),(0,pt.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-2",children:"\u62e0\u70b9\u9078\u629e"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u62e0\u70b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"})]}),n&&(0,pt.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:n}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u62e0\u70b9"}),(0,pt.jsxs)("select",{value:j,onChange:e=>N(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,pt.jsx)("option",{value:"",children:"\u62e0\u70b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),f.map(e=>(0,pt.jsxs)("option",{value:e.id,children:[e.name," ",e.isManager?"(\u7ba1\u7406\u8005)":""]},e.id))]})]}),(0,pt.jsx)("button",{onClick:z,disabled:a||!j,className:"w-full bg-gradient-to-r from-indigo-600 to-purple-700 text-white py-3 px-4 rounded-lg hover:from-indigo-700 hover:to-purple-800 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed",children:a?"\u30ed\u30b0\u30a4\u30f3\u4e2d...":"\u30ed\u30b0\u30a4\u30f3"}),(0,pt.jsx)("button",{onClick:O,className:"w-full bg-gray-500 text-white py-3 px-4 rounded-lg hover:bg-gray-600 transition-colors",children:"\u2190 \u623b\u308b"})]})]})}):c?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-purple-600 flex items-center justify-center p-5",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl p-8 shadow-2xl w-full max-w-md",children:[(0,pt.jsxs)("div",{className:"text-center mb-8",children:[(0,pt.jsx)("h1",{className:"text-4xl font-bold text-indigo-600 mb-2",children:"Study Sphere"}),(0,pt.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-2",children:"\u4f01\u696d\u30fb\u62e0\u70b9\u9078\u629e"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u4f01\u696d\u3068\u62e0\u70b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\uff08\u7ba1\u7406\u8005\u7528\uff09"})]}),n&&(0,pt.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:(0,pt.jsx)("div",{style:{whiteSpace:"pre-line"},children:n})}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4f01\u696d"}),(0,pt.jsxs)("select",{value:y,onChange:e=>{v(e.target.value),N("")},className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",children:[(0,pt.jsx)("option",{value:"",children:"\u4f01\u696d\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),h.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u62e0\u70b9"}),(0,pt.jsxs)("select",{value:j,onChange:e=>N(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",disabled:!y,children:[(0,pt.jsx)("option",{value:"",children:"\u62e0\u70b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),y&&(null===(R=h.find(e=>e.id===parseInt(y)))||void 0===R?void 0:R.satellites.map(e=>(0,pt.jsxs)("option",{value:e.id,children:[e.name," ",e.isManager?"(\u7ba1\u7406\u8005)":""]},e.id)))]})]}),(0,pt.jsx)("button",{onClick:$,disabled:a||!y||!j,className:"w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:a?"\u30ed\u30b0\u30a4\u30f3\u4e2d...":"\u30ed\u30b0\u30a4\u30f3"}),(0,pt.jsx)("button",{onClick:O,className:"w-full bg-gray-500 text-white py-3 px-4 rounded-lg hover:bg-gray-600 transition-colors",children:"\u2190 \u623b\u308b"})]})]})}):(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-purple-600 flex items-center justify-center p-5",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl p-8 shadow-2xl w-full max-w-md",children:[(0,pt.jsxs)("div",{className:"text-center mb-8",children:[(0,pt.jsx)("h1",{className:"text-4xl font-bold text-indigo-600 mb-2",children:"Study Sphere"}),(0,pt.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-2",children:"\u30ed\u30b0\u30a4\u30f3"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u7ba1\u7406\u8005\u30fb\u6307\u5c0e\u54e1\u7528\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8"})]}),(0,pt.jsxs)("form",{onSubmit:async t=>{t.preventDefault(),l(!0),s("");try{const t=await(async(e,t)=>{try{console.log("LoginPage: \u7ba1\u7406\u8005\u30ed\u30b0\u30a4\u30f3API\u547c\u3073\u51fa\u3057\u958b\u59cb"),console.log("LoginPage: \u30ea\u30af\u30a8\u30b9\u30c8\u30c7\u30fc\u30bf",{username:e,password:t?"***":"\u306a\u3057"});const n=JSON.stringify({username:e,password:t});console.log("LoginPage: \u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3",n);const r=await fetch(`${ze.JR}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:n});console.log("LoginPage: \u30ed\u30b0\u30a4\u30f3API\u5fdc\u7b54",{status:r.status,ok:r.ok,statusText:r.statusText,headers:Object.fromEntries(r.headers.entries())});const a=await r.text();let l;console.log("LoginPage: \u30ec\u30b9\u30dd\u30f3\u30b9\u30c6\u30ad\u30b9\u30c8",a);try{l=JSON.parse(a)}catch(s){throw console.error("LoginPage: JSON\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc",s),new Error("\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u306e\u5fdc\u7b54\u304c\u4e0d\u6b63\u3067\u3059")}if(!r.ok)throw console.log("LoginPage: \u30ed\u30b0\u30a4\u30f3\u5931\u6557",l),new Error(l.message||"\u30ed\u30b0\u30a4\u30f3\u306b\u5931\u6557\u3057\u307e\u3057\u305f");return console.log("LoginPage: \u30ed\u30b0\u30a4\u30f3\u6210\u529f",l),l}catch(n){throw console.error("LoginPage: Admin login API error:",n),n}})(e.id,e.password);if(!t.success||!t.data)throw new Error(t.message||"\u7ba1\u7406\u8005\u30ed\u30b0\u30a4\u30f3\u306b\u5931\u6557\u3057\u307e\u3057\u305f");{console.log("=== Login Success Debug ==="),console.log("Full adminData:",t),console.log("adminData.data:",t.data);const r=t.data;if(console.log("User data:",r),console.log("User role:",r.role),console.log("Role type:",typeof r.role),console.log("Role >= 9:",r.role>=9),console.log("Role >= 4:",r.role>=4),console.log("Role >= 6:",r.role>=6),r.role>=9)return console.log("Showing dashboard selection for role 9+"),g(r),i(!0),void l(!1);if(r.role>=4&&r.role<=5){console.log("Showing satellite selection for instructor (role 4-5)"),g(r),console.log("Fetching companies data for user:",e.id);const t=await L(e.id);if(console.log("Companies data response:",t),t.success&&t.data.companies.length>0){console.log("Companies found:",t.data.companies.length);const r=t.data.companies[0],a=r.satellites||[];if(1===a.length){console.log("Single satellite found, auto-selecting and proceeding to dashboard");const t=a[0];try{const n=await E(e.id,e.password,r.id.toString(),t.id.toString());if(n.success&&n.data){const e=n.data,t={id:e.user_id,name:e.user_name,email:e.email||"",login_code:e.login_code,role:e.role,company_id:e.company_id,company_name:e.company_name,satellite_id:e.satellite_id,satellite_name:e.satellite_name,satellite_ids:[e.satellite_id],passwordResetRequired:e.password_reset_required||!1,access_token:e.access_token,refresh_token:e.refresh_token},s={id:e.satellite_id,name:e.satellite_name,company_id:e.company_id,company_name:e.company_name};return sessionStorage.setItem("selectedSatellite",JSON.stringify(s)),console.log("\u30ed\u30b0\u30a4\u30f3\u6210\u529f\u6642: selectedSatellite\u3092\u4fdd\u5b58:",s),I(t,e.access_token,e.refresh_token),await mt({action:"\u30ed\u30b0\u30a4\u30f3",details:`\u6307\u5c0e\u54e1\u300c${e.user_name}\u300d\u304c${e.company_name}\u306e${e.satellite_name}\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3057\u305f\uff08\u81ea\u52d5\u9078\u629e\uff09`,adminId:e.user_id,adminName:e.user_name}),void C("/instructor/dashboard")}}catch(n){console.error("Auto-login failed, falling back to manual selection:",n)}}return a.length>1?(b(a),v(r.id.toString()),m(!0),void l(!1)):(s("\u62e0\u70b9\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30b7\u30b9\u30c6\u30e0\u7ba1\u7406\u8005\u306b\u304a\u554f\u3044\u5408\u308f\u305b\u304f\u3060\u3055\u3044\u3002"),void l(!1))}{console.log("No companies found, proceeding to instructor dashboard");const e={id:r.user_id,name:r.user_name,email:r.email||"",login_code:r.login_code,role:r.role,passwordResetRequired:r.password_reset_required||!1,access_token:r.access_token,refresh_token:r.refresh_token};return I(e,r.access_token,r.refresh_token),await mt({action:"\u30ed\u30b0\u30a4\u30f3",details:`\u6307\u5c0e\u54e1\u300c${r.user_name}\u300d\u304c\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3057\u305f`,adminId:r.user_id,adminName:r.user_name}),void C("/instructor/dashboard")}}if(r.role>=6&&r.role<=8){console.log("Redirecting role 6-8 user to instructor dashboard");const e={id:r.user_id,name:r.user_name,email:r.email||"",login_code:r.login_code,role:r.role,passwordResetRequired:r.password_reset_required||!1,access_token:r.access_token,refresh_token:r.refresh_token};return I(e,r.access_token,r.refresh_token),await mt({action:"\u30ed\u30b0\u30a4\u30f3",details:`\u4e00\u822c\u7ba1\u7406\u8005\u300c${r.user_name}\u300d\u304c\u6307\u5c0e\u54e1\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3057\u305f`,adminId:r.user_id,adminName:r.user_name}),void C("/instructor/dashboard")}console.log("Proceeding to admin dashboard for other roles");const a={id:r.user_id,name:r.user_name,email:r.email||"",login_code:r.login_code,role:r.role,password_reset_required:r.password_reset_required||!1,access_token:r.access_token,refresh_token:r.refresh_token};I(a,r.access_token,r.refresh_token),await mt({action:"\u30ed\u30b0\u30a4\u30f3",details:`\u7ba1\u7406\u8005\u300c${r.user_name}\u300d\u304c\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3057\u305f`,adminId:r.user_id,adminName:r.user_name}),C("/admin/dashboard")}}catch(n){const t=n.message||"\u30ed\u30b0\u30a4\u30f3\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f";t.includes("\u30e6\u30fc\u30b6\u30fc\u540d\u307e\u305f\u306f\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093")?s(`${t}\n\n\u203b \u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u554f\u984c\u306e\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u300c\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\u3057\u3066\u518d\u30ed\u30b0\u30a4\u30f3\u300d\u30dc\u30bf\u30f3\u3092\u8a66\u3057\u3066\u304f\u3060\u3055\u3044\u3002`):s(t),l(!1)}},className:"mb-8",children:[(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{htmlFor:"id",className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30e6\u30fc\u30b6\u30fcID"}),(0,pt.jsx)(Ct,{type:"text",id:"id",name:"id",value:e.id,onChange:D,required:!0,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"\u30e6\u30fc\u30b6\u30fcID\u3092\u5165\u529b",options:_t})]}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30d1\u30b9\u30ef\u30fc\u30c9"}),(0,pt.jsx)(Ct,{type:"password",id:"password",name:"password",value:e.password,onChange:D,required:!0,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",placeholder:"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b",options:_t})]}),n&&(0,pt.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:(0,pt.jsx)("div",{style:{whiteSpace:"pre-line"},children:n})}),(0,pt.jsx)("button",{type:"submit",disabled:a,className:"w-full bg-indigo-600 text-white py-3 px-4 rounded-lg hover:bg-indigo-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:a?"\u30ed\u30b0\u30a4\u30f3\u4e2d...":"\u30ed\u30b0\u30a4\u30f3"})]}),(0,pt.jsxs)("div",{className:"text-center mt-4 space-y-2",children:[(0,pt.jsx)("button",{onClick:()=>{localStorage.clear(),sessionStorage.clear(),window.location.reload()},className:"text-sm text-gray-600 hover:underline block",children:"\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\u3057\u3066\u518d\u30ed\u30b0\u30a4\u30f3"}),(0,pt.jsxs)("div",{className:"border-t border-gray-200 pt-4",style:{display:"none"},children:[(0,pt.jsx)("button",{onClick:async()=>{k(!0),_("");try{const e=await fetch(`${ze.JR}/api/restore-master-user`,{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();t.success?_(`\u2705 ${t.message}\n\n\u30e6\u30fc\u30b6\u30fcID: ${t.data.user_id}\n\u30d1\u30b9\u30ef\u30fc\u30c9: ${t.data.password}\n\u30ed\u30fc\u30eb: ${t.data.role}`):_(`\u274c ${t.message}`)}catch(n){console.error("Master user restoration error:",n),_("\u274c \u30de\u30b9\u30bf\u30fc\u30e6\u30fc\u30b6\u30fc\u5fa9\u65e7\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}finally{k(!1)}},disabled:w,className:"text-sm bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:w?"\u5fa9\u65e7\u4e2d...":"\u30de\u30b9\u30bf\u30fc\u30e6\u30fc\u30b6\u30fc\u5fa9\u65e7"}),(0,pt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\u30c7\u30fc\u30bf\u6d88\u5931\u6642\u306e\u7dca\u6025\u5fa9\u65e7\u7528"})]}),S&&(0,pt.jsx)("div",{className:"mt-3 p-3 bg-gray-100 border border-gray-300 rounded text-sm",children:(0,pt.jsx)("div",{style:{whiteSpace:"pre-line"},children:S})})]})]})});var R},Tt=e=>{let{user:t}=e;const{logout:n}=bt(),s=(()=>{const e=localStorage.getItem("accessToken");if(e){const t=(e=>{try{const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}catch(t){return console.error("JWT\u30c7\u30b3\u30fc\u30c9\u30a8\u30e9\u30fc:",t),null}})(e);if(t&&t.role)return t.role}return null===t||void 0===t?void 0:t.role})();parseInt(s,10);return(0,pt.jsx)("header",{className:"bg-gradient-to-r from-red-500 to-red-400 text-white py-4 shadow-lg",children:(0,pt.jsxs)("div",{className:"max-w-7xl mx-auto px-5 flex justify-between items-center",children:[(0,pt.jsx)("div",{className:"flex items-center gap-4",children:(0,pt.jsx)("h1",{className:"text-2xl font-bold text-white m-0",children:"Study Sphere"})}),(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsx)("span",{className:"font-medium text-white",children:t.name}),(0,pt.jsx)("button",{className:"bg-white bg-opacity-10 text-white border-2 border-white border-opacity-30 px-4 py-2 rounded-md cursor-pointer transition-all duration-200 hover:bg-opacity-20 hover:border-opacity-50",onClick:()=>{window.confirm("\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u307e\u3059\u304b\uff1f")&&n()},children:"\u30ed\u30b0\u30a2\u30a6\u30c8"})]})]})})};var Pt=n(291);const Lt=e=>{let{error:t,onClose:n}=e;return t?(0,pt.jsx)("div",{className:"mb-4 p-4 bg-red-50 border-l-4 border-red-400 rounded-md",children:(0,pt.jsxs)("div",{className:"flex items-start",children:[(0,pt.jsx)("div",{className:"flex-shrink-0",children:(0,pt.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,pt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,pt.jsxs)("div",{className:"ml-3 flex-1",children:[(0,pt.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"\u767b\u9332\u306b\u5931\u6557\u3057\u307e\u3057\u305f"}),(0,pt.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,pt.jsx)("p",{children:t})})]}),n&&(0,pt.jsx)("div",{className:"ml-auto pl-3",children:(0,pt.jsx)("div",{className:"-mx-1.5 -my-1.5",children:(0,pt.jsxs)("button",{type:"button",onClick:n,className:"inline-flex bg-red-50 rounded-md p-1.5 text-red-500 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-red-50 focus:ring-red-600",children:[(0,pt.jsx)("span",{className:"sr-only",children:"\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9589\u3058\u308b"}),(0,pt.jsx)("svg",{className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:(0,pt.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})})})]})}):null},Et=()=>{const{currentUser:e}=bt(),t=(()=>{const t=localStorage.getItem("accessToken");if(t){const e=(e=>{try{const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}catch(d){return console.error("JWT\u30c7\u30b3\u30fc\u30c9\u30a8\u30e9\u30fc:",d),null}})(t);if(e&&e.role)return 4===e.role?5:e.role}return null===e||void 0===e?void 0:e.role})(),n=t>=5,[s,a]=(0,r.useState)([]),[l,o]=(0,r.useState)([]),[i,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(null),[m,x]=(0,r.useState)({show:!1,message:"",type:"success"}),[g,h]=(0,r.useState)(!1),[p,f]=(0,r.useState)(null),[b,y]=(0,r.useState)([]),[v,j]=(0,r.useState)(!1),[N,w]=(0,r.useState)([]),[k,S]=(0,r.useState)(!1),[_,C]=(0,r.useState)([]),[I,T]=(0,r.useState)({}),[P,L]=(0,r.useState)(!1),E=async e=>{if(e)try{L(!0),console.log(`\u62e0\u70b9ID ${e} \u306e\u6307\u5c0e\u54e1\u60c5\u5831\u53d6\u5f97\u958b\u59cb`),console.log("\u5168\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u62e0\u70b9\u306e\u6307\u5c0e\u54e1\u3092\u62bd\u51fa\u3057\u307e\u3059");const t=await fetch(`${ze.JR}/api/users`);if(t.ok){const n=await t.json();console.log("\u5168\u30e6\u30fc\u30b6\u30fc\u53d6\u5f97\u6210\u529f:",n.length,"\u4ef6"),console.log("\u5168\u30e6\u30fc\u30b6\u30fc\u306e\u8a73\u7d30:",n);const s=n.filter(e=>e.role>=4&&e.role<=5);console.log("\u5168\u6307\u5c0e\u54e1:",s);const r=s.filter(t=>{if(console.log(`\u30e6\u30fc\u30b6\u30fc ${t.name} (ID: ${t.id}) \u306esatellite_ids:`,t.satellite_ids),!t.satellite_ids)return console.log(`\u30e6\u30fc\u30b6\u30fc ${t.name} \u306esatellite_ids\u304cnull/undefined`),!1;let n=t.satellite_ids;if("string"===typeof n)try{n=JSON.parse(n)}catch(Yc){console.log(`\u30e6\u30fc\u30b6\u30fc ${t.name} \u306esatellite_ids\u30d1\u30fc\u30b9\u5931\u6557:`,Yc),n=[n]}Array.isArray(n)||(n=[n]);const s=n.some(t=>t.toString()===e.toString()||Number(t)===Number(e));return console.log(`\u30e6\u30fc\u30b6\u30fc ${t.name} \u306e\u51e6\u7406\u6e08\u307fsatellite_ids:`,n),console.log(`\u30e6\u30fc\u30b6\u30fc ${t.name} \u304c\u62e0\u70b9${e}\u306b\u6240\u5c5e:`,s),s});console.log(`\u62e0\u70b9${e}\u306e\u6307\u5c0e\u54e1\uff08\u5168\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u62bd\u51fa\uff09:`,r),console.log("\u62bd\u51fa\u3055\u308c\u305f\u6307\u5c0e\u54e1\u306e\u8a73\u7d30:"),r.forEach(e=>{console.log(`- ID: ${e.id}, \u540d\u524d: ${e.name}, \u30ed\u30fc\u30eb: ${e.role}, satellite_ids: ${e.satellite_ids}`)}),T(t=>{const n={...t,[e]:r};return console.log("\u8a2d\u5b9a\u5f8c\u306esatelliteInstructors:",n),n})}else console.error("\u5168\u30e6\u30fc\u30b6\u30fc\u53d6\u5f97\u5931\u6557:",t.status),T(t=>({...t,[e]:[]}))}catch(t){console.error("\u6307\u5c0e\u54e1\u60c5\u5831\u53d6\u5f97\u30a8\u30e9\u30fc:",t),console.error("\u30a8\u30e9\u30fc\u30b9\u30bf\u30c3\u30af:",t.stack),T(t=>({...t,[e]:[]}))}finally{L(!1)}else console.error("\u62e0\u70b9ID\u304c\u672a\u5b9a\u7fa9\u3067\u3059")},D=e=>{if(!e||0===e.length)return[];const t=Array.isArray(e)?e:[e];console.log("getManagerNames\u547c\u3073\u51fa\u3057 - managerIds:",e),console.log("\u51e6\u7406\u3059\u308bID:",t),console.log("\u73fe\u5728\u306emanagers:",N),console.log("\u73fe\u5728\u306esatelliteInstructors:",I);const n=Object.values(I||{}).flat().filter(e=>e&&"object"===typeof e);console.log("\u5168\u6307\u5c0e\u54e1:",n);const s=t.map(e=>{if(!e)return null;const t=n.find(t=>t&&t.id===parseInt(e));return console.log(`ID ${e} \u306e\u6307\u5c0e\u54e1\u691c\u7d22\u7d50\u679c:`,t),t&&t.name?t.name:null}).filter(e=>null!==e),r=t.filter(e=>e&&!n.find(t=>t&&t.id===parseInt(e)));console.log("\u6b8b\u308a\u306eID\uff08\u7ba1\u7406\u8005\u304b\u3089\u691c\u7d22\uff09:",r);const a=[...s,...r.map(e=>{if(!e)return null;const t=N.find(t=>t&&t.id===parseInt(e));if(console.log(`ID ${e} \u306e\u7ba1\u7406\u8005\u691c\u7d22\u7d50\u679c:`,t),t&&t.name)return t.name;{console.log(`\u7ba1\u7406\u8005ID ${e} \u304c\u898b\u3064\u304b\u3089\u306a\u3044\u305f\u3081\u3001\u5168\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u691c\u7d22\u3057\u307e\u3059`);const t=_.find(t=>t&&t.id===parseInt(e));return t&&t.name?(console.log("\u5168\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u898b\u3064\u304b\u3063\u305f\u8cac\u4efb\u8005:",t),t.name):(console.log(`\u5168\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u3082\u898b\u3064\u304b\u3089\u306a\u3044ID: ${e}`),`ID: ${e}`)}}).filter(e=>null!==e)];return console.log("\u6700\u7d42\u7d50\u679c:",a),a},A=async()=>{try{c(!0),console.log("\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u53d6\u5f97\u958b\u59cb...");const e=new AbortController,t=setTimeout(()=>e.abort(),1e4),n=await fetch(`${ze.JR}/api/office-types`,{signal:e.signal});if(clearTimeout(t),console.log("\u30ec\u30b9\u30dd\u30f3\u30b9\u30b9\u30c6\u30fc\u30bf\u30b9:",n.status),console.log("\u30ec\u30b9\u30dd\u30f3\u30b9\u30d8\u30c3\u30c0\u30fc:",n.headers),!n.ok){const e=await n.text();throw console.error("\u30ec\u30b9\u30dd\u30f3\u30b9\u30a8\u30e9\u30fc:",e),new Error(`\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f (${n.status})`)}const s=await n.json();console.log("\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf:",s),o(s),a(s.map(e=>e.type)),u(null)}catch(e){console.error("\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u53d6\u5f97\u30a8\u30e9\u30fc:",e),"AbortError"===e.name?(u("\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u307e\u3057\u305f\u3002\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),lt("\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u307e\u3057\u305f\u3002\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002","error")):(u(e.message),lt("\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u7ba1\u7406\u304b\u3089\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002","error")),a(["\u5c31\u52b4\u79fb\u884c\u652f\u63f4\u4e8b\u696d\u6240","\u5c31\u52b4\u7d99\u7d9a\u652f\u63f4A\u578b","\u5c31\u52b4\u7d99\u7d9a\u652f\u63f4B\u578b"]),o([{id:1,type:"\u5c31\u52b4\u79fb\u884c\u652f\u63f4\u4e8b\u696d\u6240"},{id:2,type:"\u5c31\u52b4\u7d99\u7d9a\u652f\u63f4A\u578b"},{id:3,type:"\u5c31\u52b4\u7d99\u7d9a\u652f\u63f4B\u578b"}])}finally{c(!1)}},$=async()=>{try{j(!0),console.log("\u4f01\u696d\u4e00\u89a7\u53d6\u5f97\u958b\u59cb");const e=await fetch(`${ze.JR}/api/companies`);if(console.log("\u4f01\u696d\u4e00\u89a7\u53d6\u5f97\u30ec\u30b9\u30dd\u30f3\u30b9:",e.status,e.statusText),!e.ok){const t=await e.text();return console.error("\u4f01\u696d\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc\u8a73\u7d30:",t),console.warn("\u4f01\u696d\u4e00\u89a7\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u304c\u3001\u65b0\u898f\u7d44\u7e54\u4f5c\u6210\u3067\u5bfe\u5fdc\u53ef\u80fd\u3067\u3059"),void y([])}const t=await e.json();console.log("\u4f01\u696d\u4e00\u89a7\u53d6\u5f97\u6210\u529f:",t),y(t),await z()}catch(e){console.error("\u4f01\u696d\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",e),console.warn("\u4f01\u696d\u4e00\u89a7\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u304c\u3001\u65b0\u898f\u7d44\u7e54\u4f5c\u6210\u3067\u5bfe\u5fdc\u53ef\u80fd\u3067\u3059"),y([])}finally{j(!1)}},z=async()=>{try{console.log("satellites\u4e00\u89a7\u53d6\u5f97\u958b\u59cb");const e=await fetch(`${ze.JR}/api/satellites`);if(console.log("satellites\u4e00\u89a7\u53d6\u5f97\u30ec\u30b9\u30dd\u30f3\u30b9:",e.status,e.statusText),!e.ok){const t=await e.text();return console.error("satellites\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc\u8a73\u7d30:",t),void F([])}const t=await e.json();console.log("satellites\u4e00\u89a7\u53d6\u5f97\u6210\u529f:",t);const n=t.success?t.data:[];Array.isArray(n)?(F(n),(e=>{if(g)return;const t=new Date;t.setDate(t.getDate()+14);const n=e.filter(e=>{if(!e.token_expiry)return!1;const n=new Date(e.token_expiry);return n<=t&&n>new Date});if(n.length>0){const e=`\u4ee5\u4e0b\u306e\u4e8b\u696d\u6240\u306e\u6709\u52b9\u671f\u9650\u304c2\u9031\u9593\u4ee5\u5185\u306b\u5207\u308c\u307e\u3059\uff1a\n${n.map(e=>e.name||e.facility_name||"\u4e0d\u660e\u306a\u4e8b\u696d\u6240").join(", ")}`;setTimeout(()=>{alert(e),h(!0)},1e3)}})(n)):(console.warn("satellites\u30c7\u30fc\u30bf\u304c\u914d\u5217\u3067\u306f\u3042\u308a\u307e\u305b\u3093:",n),F([]))}catch(e){console.error("satellites\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",e),F([])}};(0,r.useEffect)(()=>{h(!1);(async()=>{const e=await(async()=>{try{const t=new AbortController,n=setTimeout(()=>t.abort(),5e3),s=[`${ze.JR}/api/health`,`${ze.JR}/api/operation-logs/client-ip`];for(const r of s)try{if((await fetch(r,{method:"GET",signal:t.signal})).ok)return clearTimeout(n),!0}catch(e){console.warn(`\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8 ${r} \u3067\u30a8\u30e9\u30fc:`,e);continue}return clearTimeout(n),!1}catch(d){return console.error("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u63a5\u7d9a\u30a8\u30e9\u30fc:",d),!1}})();e?(console.log("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3067\u304d\u307e\u3057\u305f"),A(),$(),(async()=>{try{S(!0),console.log("\u7ba1\u7406\u8005\u60c5\u5831\u53d6\u5f97\u958b\u59cb");const e=await fetch(`${ze.JR}/api/users`);if(console.log("\u7ba1\u7406\u8005\u60c5\u5831\u53d6\u5f97\u30ec\u30b9\u30dd\u30f3\u30b9:",e.status,e.statusText),!e.ok){const t=await e.text();return console.error("\u7ba1\u7406\u8005\u60c5\u5831\u53d6\u5f97\u30a8\u30e9\u30fc\u8a73\u7d30:",t),void w([])}const t=await e.json();console.log("\u7ba1\u7406\u8005\u60c5\u5831\u53d6\u5f97\u6210\u529f:",t);const n=t.filter(e=>e.role>=9);console.log("\u7ba1\u7406\u8005\u306e\u307f\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u5f8c:",n),w(n),C(t)}catch(e){console.error("\u7ba1\u7406\u8005\u60c5\u5831\u53d6\u5f97\u30a8\u30e9\u30fc:",e),w([])}finally{S(!1)}})()):(console.error("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093"),lt("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093\u3002\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002","error"),u("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093"),a([]),o([]),y([]),w([]))})()},[]);const[O,R]=(0,r.useState)(!1),[M,F]=(0,r.useState)([]),[U,B]=(0,r.useState)({key:"name",direction:"asc"}),[J,q]=(0,r.useState)(""),[V,H]=(0,r.useState)("all"),[W,Q]=(0,r.useState)(!1),[K,Y]=(0,r.useState)({name:"",type:"\u5c31\u52b4\u79fb\u884c\u652f\u63f4\u4e8b\u696d\u6240",address:"",phone:"",contacts:[{name:"",email:""}]}),[G,Z]=(0,r.useState)({facilityId:"",name:"",address:""}),[X,ee]=(0,r.useState)(!1),[te,ne]=(0,r.useState)(!1),[se,re]=(0,r.useState)(!1),[ae,le]=(0,r.useState)(""),[oe,ie]=(0,r.useState)(null),[ce,de]=(0,r.useState)({}),[ue,me]=(0,r.useState)(null),[xe,ge]=(0,r.useState)(null),[he,pe]=(0,r.useState)({company_id:"",name:"",address:"",phone:"",office_type_id:"",contract_type:"30days",max_users:10}),[fe,be]=(0,r.useState)(!1),[ye,ve]=(0,r.useState)({name:"",address:"",phone:""}),[je,Ne]=(0,r.useState)(!1),[we,ke]=(0,r.useState)(null),[Se,_e]=(0,r.useState)([]),[Ce,Ie]=(0,r.useState)(!1),[Te,Pe]=(0,r.useState)(null),[Le,Ee]=(0,r.useState)({}),De=()=>{if(console.log("getAvailableInstructors \u304c\u547c\u3073\u51fa\u3055\u308c\u307e\u3057\u305f"),console.log("selectedOfficeForManager:",we),!we||!we.id)return console.log("\u9078\u629e\u3055\u308c\u305f\u62e0\u70b9\u304c\u672a\u5b9a\u7fa9\u3067\u3059"),[];console.log(`\u62e0\u70b9 ${we.id} \u306e\u6307\u5c0e\u54e1\u3092\u53d6\u5f97\u3057\u307e\u3059`);const e=(e=>{if(!e)return console.log("\u62e0\u70b9ID\u304c\u672a\u5b9a\u7fa9\u3067\u3059"),[];console.log(`\u62e0\u70b9 ${e} \u306e\u6307\u5c0e\u54e1\u53d6\u5f97\u958b\u59cb`),console.log("\u73fe\u5728\u306esatelliteInstructors:",I),console.log("satelliteInstructors\u306e\u578b:",typeof I),console.log("satelliteInstructors[satelliteId]:",I&&I[e]);const t=I&&I[e]||[];console.log(`\u62e0\u70b9 ${e} \u306e\u6307\u5c0e\u54e1\u53d6\u5f97\u7d50\u679c:`,t),console.log("instructors\u306e\u578b:",typeof t),console.log("instructors\u304c\u914d\u5217\u304b:",Array.isArray(t));const n=Array.isArray(t)?t:[];return console.log(`\u62e0\u70b9 ${e} \u306e\u6700\u7d42\u7d50\u679c:`,n),n})(we.id);console.log(`\u62e0\u70b9 ${we.id} \u306e\u5229\u7528\u53ef\u80fd\u306a\u6307\u5c0e\u54e1:`,e),console.log("instructors\u306e\u9577\u3055:",e.length);const t=Array.isArray(e)?e:[];return console.log("\u6700\u7d42\u7684\u306a\u5229\u7528\u53ef\u80fd\u306a\u6307\u5c0e\u54e1:",t),t},[Ae,$e]=(0,r.useState)(!1),[Oe,Re]=(0,r.useState)(null),[Me,Fe]=(0,r.useState)([]),[Ue,Be]=(0,r.useState)([]),[Je,qe]=(0,r.useState)(!1),[Ve,We]=(0,r.useState)(null),[Ke,Ye]=(0,r.useState)(!1),[Ge,Ze]=(0,r.useState)({show:!1,token:"",expiry:""}),[Xe,et]=(0,r.useState)(!1),[tt,nt]=(0,r.useState)(!1),[st,rt]=(0,r.useState)({show:!1,company:null}),at=async()=>{if(console.log("handleAddOffice called"),fe){if(!ye.name.trim())return void lt("\u65b0\u898f\u7d44\u7e54\u306e\u5fc5\u9808\u9805\u76ee\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044","error")}else{if(0===b.length)return be(!0),void lt("\u7d44\u7e54\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u65b0\u898f\u7d44\u7e54\u4f5c\u6210\u306b\u5207\u308a\u66ff\u3048\u307e\u3057\u305f","info");if(!he.company_id||!he.name.trim()||!he.office_type_id||!he.contract_type||!he.max_users)return void lt("\u5fc5\u9808\u9805\u76ee\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044","error")}if(he.name.trim()&&he.office_type_id&&he.contract_type&&he.max_users){Ye(!0);try{let n=he.company_id;if(fe){var e,t;const s={name:ye.name.trim(),address:(null===(e=ye.address)||void 0===e?void 0:e.trim())||null,phone:(null===(t=ye.phone)||void 0===t?void 0:t.trim())||null};console.log("\u65b0\u898f\u7d44\u7e54\u4f5c\u6210\u30c7\u30fc\u30bf:",s),console.log("\u9001\u4fe1\u30c7\u30fc\u30bf\u306e\u8a73\u7d30:",{name:s.name,address:s.address,phone:s.phone,office_type_id:ye.office_type_id||null,phoneType:typeof s.phone,officeTypeIdType:typeof ye.office_type_id});const r=await fetch(`${ze.JR}/api/companies`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),a=await r.json();if(console.log("\u7d44\u7e54\u4f5c\u6210\u30ec\u30b9\u30dd\u30f3\u30b9:",a),!a.success){if(a.errors&&a.errors.length>0){const e=a.errors.map(e=>e.msg).join(", ");throw new Error(`\u7d44\u7e54\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${e}`)}throw new Error(a.message||a.error||"\u7d44\u7e54\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}n=a.data.id,lt("\u7d44\u7e54\u304c\u6b63\u5e38\u306b\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f","success"),await $()}const s={company_id:n,name:he.name,address:he.address,phone:he.phone,office_type_id:he.office_type_id,contract_type:he.contract_type,max_users:he.max_users};console.log("\u62e0\u70b9\u4f5c\u6210\u30c7\u30fc\u30bf:",s);const r=await fetch(`${ze.JR}/api/satellites`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),a=await r.json();if(console.log("\u62e0\u70b9\u4f5c\u6210\u30ec\u30b9\u30dd\u30f3\u30b9:",a),!a.success)throw new Error(a.message||a.error||"\u62e0\u70b9\u306e\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f");Ze({show:!0,token:a.data.token,expiry:a.data.token_expiry_at}),lt("\u62e0\u70b9\u304c\u6b63\u5e38\u306b\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f","success"),R(!1),f(null),pe({company_id:"",name:"",address:"",phone:"",office_type_id:"",contract_type:"30days",max_users:10}),be(!1),ve({name:"",address:"",phone:""}),await $()}catch(n){console.error("\u62e0\u70b9\u8ffd\u52a0\u30a8\u30e9\u30fc:",n),f(n.message)}finally{Ye(!1)}}else lt("\u4e8b\u696d\u6240\u60c5\u5831\u306e\u5fc5\u9808\u9805\u76ee\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044","error")},lt=function(e){x({show:!0,message:e,type:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"}),setTimeout(()=>x({show:!1,message:"",type:"success"}),3e3)},ot=async()=>{if(ae.trim()){if(s.includes(ae.trim()))return void lt("\u540c\u3058\u540d\u524d\u306e\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u304c\u65e2\u306b\u5b58\u5728\u3057\u307e\u3059","error");const e=await(async e=>{try{const t=new AbortController,n=setTimeout(()=>t.abort(),3e4),s=await fetch(`${ze.JR}/api/office-types`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:e}),signal:t.signal});if(clearTimeout(n),!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const r=await s.json();if(!r.success)throw new Error(r.message||"\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u306e\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f");return await A(),{success:!0,message:r.message}}catch(t){return console.error("\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u8ffd\u52a0\u30a8\u30e9\u30fc:",t),"AbortError"===t.name?{success:!1,message:"\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u5f85\u3063\u3066\u304b\u3089\u518d\u8a66\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}:{success:!1,message:t.message}}})(ae.trim());e.success?(le(""),lt(e.message,"success")):lt(e.message,"error")}},it=async e=>{if(window.confirm(`\u300c${e}\u300d\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f\n\n\u6ce8\u610f: \u3053\u306e\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u4f01\u696d\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u306f\u524a\u9664\u3067\u304d\u307e\u305b\u3093\u3002`)){const t=await(async e=>{try{const t=l.find(t=>t.type===e);if(!t)throw new Error("\u524a\u9664\u5bfe\u8c61\u306e\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093");const n=new AbortController,s=setTimeout(()=>n.abort(),3e4),r=await fetch(`${ze.JR}/api/office-types/${t.id}`,{method:"DELETE",signal:n.signal});if(clearTimeout(s),!r.ok){const e=await r.text();throw console.error("\u524a\u9664\u30ec\u30b9\u30dd\u30f3\u30b9\u30a8\u30e9\u30fc:",r.status,e),new Error(`HTTP ${r.status}: ${r.statusText}`)}const a=await r.json();if(!a.success)throw new Error(a.message||"\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f");return await A(),{success:!0,message:a.message}}catch(t){return console.error("\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u524a\u9664\u30a8\u30e9\u30fc:",t),"AbortError"===t.name?{success:!1,message:"\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u5f85\u3063\u3066\u304b\u3089\u518d\u8a66\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}:{success:!1,message:t.message}}})(e);t.success?lt(t.message,"success"):lt(t.message,"error")}},ct=(e,t,n)=>{const s=[...K.contacts];s[e][t]=n,Y({...K,contacts:s})},dt=()=>{ie(null),de({})},ut=(e,t,n)=>{if(ue){const s=[...ue.contacts];s[e]={...s[e],[t]:n},me({...ue,contacts:s})}},mt=M.reduce((e,t)=>e+(t.current_users||0),0),xt=M.reduce((e,t)=>e+(t.max_users||0),0),gt=xt>0?Math.round(mt/xt*100):0,ht=M.filter(e=>!e.manager_ids||0===e.manager_ids.length).length,ft=M.filter(e=>{if(!e.token_expiry_at)return!1;const t=new Date(e.token_expiry_at+"Z"),n=new Date(t.getTime()+324e5)-(0,Pt.pu)(),s=Math.ceil(n/864e5);return s<=30&&s>0}).length,yt=(()=>{let e=M.map(e=>{var t;return{...e,organizationName:(null===(t=b.find(t=>t.id===e.company_id))||void 0===t?void 0:t.name)||"\u4e0d\u660e",organizationId:e.company_id}}).filter(e=>{const t=e.name.toLowerCase().includes(J.toLowerCase())||e.organizationName.toLowerCase().includes(J.toLowerCase())||e.address&&e.address.toLowerCase().includes(J.toLowerCase()),n="all"===V||e.office_type_name===V||e.office_type_id===V,s=!W||(!e.manager_ids||0===e.manager_ids.length);return t&&n&&s});return e.sort((e,t)=>{let n,s;switch(U.key){case"name":default:n=e.name||"",s=t.name||"";break;case"type":n=e.type||"",s=t.type||"";break;case"organization":n=e.organizationName||"",s=t.organizationName||"";break;case"students":n=e.students||0,s=t.students||0;break;case"address":n=e.address||"",s=t.address||""}return n<s?"asc"===U.direction?-1:1:n>s?"asc"===U.direction?1:-1:0}),e})();return n?(0,pt.jsxs)("div",{className:"p-6",children:[m.show&&(0,pt.jsx)("div",{className:"fixed top-4 right-4 z-[10000] p-4 rounded-lg shadow-lg transition-all duration-300 "+("success"===m.type?"bg-green-500 text-white":"bg-red-500 text-white"),children:(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("span",{className:"text-lg",children:"success"===m.type?"\u2713":"\u2717"}),(0,pt.jsx)("span",{children:m.message})]})}),(0,pt.jsxs)("div",{className:"mb-8",children:[(0,pt.jsx)("h2",{className:"text-3xl font-bold text-red-800 mb-6",children:"\u4e8b\u696d\u6240(\u62e0\u70b9)\u7ba1\u7406"}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[(0,pt.jsxs)("div",{className:"bg-white border-2 border-red-200 rounded-xl p-6 text-center transition-all duration-300 hover:border-red-400 hover:shadow-lg",children:[(0,pt.jsx)("h3",{className:"text-red-800 font-medium mb-2",children:"\u5229\u7528\u8005\u7a3c\u50cd\u7387"}),(0,pt.jsxs)("p",{className:"text-3xl font-bold text-red-600",children:[mt," / ",xt,"\u4eba"]}),(0,pt.jsxs)("div",{className:"mt-2",children:[(0,pt.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,pt.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 "+(gt>=80?"bg-red-500":gt>=60?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(gt,100)}%`}})}),(0,pt.jsxs)("small",{className:"font-medium "+(gt>=80?"text-red-600":gt>=60?"text-yellow-600":"text-green-600"),children:["\u7a3c\u50cd\u7387: ",gt,"%"]})]})]}),(0,pt.jsxs)("div",{className:"bg-white border-2 border-yellow-200 rounded-xl p-6 text-center transition-all duration-300 hover:border-yellow-400 hover:shadow-lg",children:[(0,pt.jsx)("h3",{className:"text-yellow-800 font-medium mb-2",children:"\u8cac\u4efb\u8005\u4e0d\u5728\u4e8b\u696d\u6240"}),(0,pt.jsx)("p",{className:"text-3xl font-bold "+(ht>0?"text-red-600":"text-green-600"),children:ht}),(0,pt.jsx)("small",{className:"text-yellow-600",children:"\u4e8b\u696d\u6240\u6570"})]}),(0,pt.jsxs)("div",{className:"bg-white border-2 border-orange-200 rounded-xl p-6 text-center transition-all duration-300 hover:border-orange-400 hover:shadow-lg",children:[(0,pt.jsx)("h3",{className:"text-orange-800 font-medium mb-2",children:"\ud83d\udd12 \u6709\u52b9\u671f\u9650\u9593\u8fd1"}),(0,pt.jsx)("p",{className:"text-3xl font-bold "+(ft>0?"text-orange-600":"text-green-600"),children:ft}),(0,pt.jsx)("small",{className:"text-orange-600",children:"14\u65e5\u4ee5\u5185\u671f\u9650\u5207\u308c"})]})]})]}),(0,pt.jsxs)("div",{className:"flex flex-wrap gap-4 mb-8",children:[(0,pt.jsx)("button",{className:"bg-red-600 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-300 hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed",onClick:()=>{console.log("\u4e8b\u696d\u6240\u3092\u8ffd\u52a0\u30dc\u30bf\u30f3\u304c\u30af\u30ea\u30c3\u30af\u3055\u308c\u307e\u3057\u305f"),console.log("facilities:",M),console.log("showOfficeForm before:",O),R(!0),console.log("setShowOfficeForm(true) called"),setTimeout(()=>{console.log("showOfficeForm after timeout:",O)},100)},disabled:!1,children:"+ \u4e8b\u696d\u6240\u3092\u8ffd\u52a0"}),(0,pt.jsx)("button",{className:"bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-300 hover:bg-gray-700",onClick:()=>re(!0),children:"\ud83d\udcdd \u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u7ba1\u7406"}),(0,pt.jsx)("button",{className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-300 hover:bg-blue-700",onClick:()=>nt(!0),children:"\ud83c\udfe2 \u4f01\u696d\u4e00\u89a7"})]}),(0,pt.jsxs)("div",{className:"space-y-4 mb-6",children:[(0,pt.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,pt.jsx)("div",{className:"flex-1",children:(0,pt.jsx)("input",{type:"text",placeholder:"\u4e8b\u696d\u6240\u540d\u3001\u7d44\u7e54\u540d\u3001\u307e\u305f\u306f\u4f4f\u6240\u3067\u691c\u7d22...",value:J,onChange:e=>q(e.target.value),className:"w-full px-4 py-3 border-2 border-red-200 rounded-lg focus:outline-none focus:border-red-400 transition-colors duration-300"})}),(0,pt.jsx)("div",{className:"md:w-64",children:(0,pt.jsxs)("select",{value:V,onChange:e=>H(e.target.value),className:"w-full px-4 py-3 border-2 border-red-200 rounded-lg focus:outline-none focus:border-red-400 transition-colors duration-300",children:[(0,pt.jsx)("option",{value:"all",children:"\u3059\u3079\u3066\u306e\u4e8b\u696d\u6240\u30bf\u30a4\u30d7"}),s.map(e=>(0,pt.jsx)("option",{value:e,children:e},e))]})})]}),(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[(0,pt.jsx)("input",{type:"checkbox",checked:W,onChange:e=>Q(e.target.checked),className:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"}),(0,pt.jsx)("span",{children:"\u8cac\u4efb\u8005\u4e0d\u5728\u306e\u4e8b\u696d\u6240\u306e\u307f\u8868\u793a"})]}),(J||"all"!==V||W)&&(0,pt.jsx)("button",{onClick:()=>{q(""),H("all"),Q(!1)},className:"text-sm text-red-600 hover:text-red-800 underline",children:"\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u30af\u30ea\u30a2"})]})]}),(J||"all"!==V||W)&&(0,pt.jsx)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,pt.jsxs)("p",{className:"text-blue-800",children:["\u691c\u7d22\u7d50\u679c: ",(0,pt.jsx)("span",{className:"font-semibold",children:yt.length}),"\u4ef6",J&&(0,pt.jsxs)("span",{children:[' (\u691c\u7d22\u8a9e: "',J,'")']}),"all"!==V&&(0,pt.jsxs)("span",{children:[' (\u30bf\u30a4\u30d7: "',V,'")']}),W&&(0,pt.jsx)("span",{children:' (\u8cac\u4efb\u8005\u4e0d\u5728: "\u306f\u3044")'})]})}),(0,pt.jsx)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden mb-12",children:(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"w-full",children:[(0,pt.jsx)("thead",{className:"bg-red-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\u4e8b\u696d\u6240\u540d"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\u4e8b\u696d\u6240\u30bf\u30a4\u30d7"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\u7d44\u7e54\u540d"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\u4f4f\u6240"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\u96fb\u8a71\u756a\u53f7"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\u5229\u7528\u8005\u6570"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\u6709\u52b9\u671f\u9650"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\u8cac\u4efb\u8005"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\u64cd\u4f5c"})]})}),(0,pt.jsx)("tbody",{children:yt.map(e=>(0,pt.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors duration-200 "+(e.manager_ids&&0!==e.manager_ids.length?"":"bg-yellow-50 hover:bg-yellow-100"),children:[(0,pt.jsx)("td",{className:"px-6 py-4",children:e.name}),(0,pt.jsx)("td",{className:"px-6 py-4",children:e.office_type_name||e.office_type_id||"-"}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsx)("strong",{className:"text-gray-800",children:e.organizationName||(0,pt.jsx)("span",{className:"text-gray-500 italic",children:"\u7d44\u7e54\u540d\u306a\u3057"})})}),(0,pt.jsx)("td",{className:"px-6 py-4 text-gray-600",children:e.address||"-"}),(0,pt.jsx)("td",{className:"px-6 py-4 text-gray-600",children:e.phone||"-"}),(0,pt.jsx)("td",{className:"px-6 py-4 text-gray-600",children:(0,pt.jsxs)("div",{className:"flex flex-col",children:[(0,pt.jsxs)("div",{className:"font-medium",children:[e.current_users||0," / ",e.max_users||0,"\u4eba"]}),void 0!==e.utilization_rate&&null!==e.utilization_rate&&(0,pt.jsxs)("div",{className:"text-xs mt-1 px-2 py-1 rounded "+(e.utilization_rate>=80?"bg-red-100 text-red-700":e.utilization_rate>=60?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"),children:["\u7a3c\u50cd\u7387: ",e.utilization_rate,"%"]})]})}),(0,pt.jsx)("td",{className:"px-6 py-4 text-gray-600",children:e.token_expiry_at?(0,pt.jsxs)("div",{className:"text-sm "+((0,Pt.isExpired)(e.token_expiry_at)?"text-red-600 font-medium":"text-gray-600"),children:[(0,pt.jsx)("div",{children:(()=>{try{if(!e.token_expiry_at||"0000-00-00 00:00:00"===e.token_expiry_at||"0000-00-00"===e.token_expiry_at||"null"===e.token_expiry_at||"undefined"===e.token_expiry_at||""===e.token_expiry_at||"NULL"===e.token_expiry_at||"None"===e.token_expiry_at)return"\u671f\u9650\u306a\u3057";const t=String(e.token_expiry_at).trim();if(""===t)return"\u671f\u9650\u306a\u3057";const n=new Date(t);return isNaN(n.getTime())?"\u7121\u52b9\u306a\u65e5\u4ed8":n.toLocaleDateString("ja-JP")}catch(d){return console.error("\u65e5\u4ed8\u8868\u793a\u30a8\u30e9\u30fc:",d,"token_expiry_at:",e.token_expiry_at),"\u30a8\u30e9\u30fc"}})()}),(()=>{try{if(console.log("\u671f\u9650\u5207\u308c\u5224\u5b9a\u958b\u59cb:",{token_expiry_at:e.token_expiry_at,type:typeof e.token_expiry_at}),!e.token_expiry_at||"0000-00-00 00:00:00"===e.token_expiry_at||"0000-00-00"===e.token_expiry_at||"null"===e.token_expiry_at||"undefined"===e.token_expiry_at||""===e.token_expiry_at||"NULL"===e.token_expiry_at||"None"===e.token_expiry_at)return console.log("\u671f\u9650\u5207\u308c\u5224\u5b9a: \u7121\u52b9\u306a\u65e5\u4ed8\u5024\u306e\u305f\u3081\u671f\u9650\u5207\u308c\u3068\u3057\u3066\u6271\u3046:",e.token_expiry_at),(0,pt.jsx)("span",{className:"text-xs bg-red-100 text-red-800 px-1 py-0.5 rounded",children:"\u671f\u9650\u5207\u308c"});const t=String(e.token_expiry_at).trim();if(""===t)return console.log("\u671f\u9650\u5207\u308c\u5224\u5b9a: \u7a7a\u6587\u5b57\u5217\u306e\u305f\u3081\u671f\u9650\u5207\u308c\u3068\u3057\u3066\u6271\u3046"),(0,pt.jsx)("span",{className:"text-xs bg-red-100 text-red-800 px-1 py-0.5 rounded",children:"\u671f\u9650\u5207\u308c"});const n=new Date(t);if(isNaN(n.getTime()))return console.warn("\u671f\u9650\u5207\u308c\u5224\u5b9a: \u7121\u52b9\u306a\u65e5\u4ed8\u5024:",t),(0,pt.jsx)("span",{className:"text-xs bg-red-100 text-red-800 px-1 py-0.5 rounded",children:"\u671f\u9650\u5207\u308c"});const s=(0,Pt.pu)(),r=n-s,a=Math.ceil(r/864e5);return console.log("\u671f\u9650\u5207\u308c\u5224\u5b9a:",{original:e.token_expiry_at,expiryString:t,japanDateValid:!isNaN(n.getTime()),nowValid:!isNaN(s.getTime()),japanDateTimestamp:n.getTime(),nowTimestamp:s.getTime(),diffTime:r,diffDays:a}),a<0?(0,pt.jsx)("span",{className:"text-xs bg-red-100 text-red-800 px-1 py-0.5 rounded",children:"\u671f\u9650\u5207\u308c"}):a<=30?(0,pt.jsxs)("span",{className:"text-xs bg-yellow-100 text-yellow-800 px-1 py-0.5 rounded",children:["\u6b8b\u308a",a,"\u65e5"]}):(0,pt.jsx)("span",{className:"text-xs bg-green-100 text-green-800 px-1 py-0.5 rounded",children:"\u6709\u52b9"})}catch(d){return console.error("\u671f\u9650\u5207\u308c\u5224\u5b9a\u30a8\u30e9\u30fc:",d,"token_expiry_at:",e.token_expiry_at),(0,pt.jsx)("span",{className:"text-xs bg-red-100 text-red-800 px-1 py-0.5 rounded",children:"\u671f\u9650\u5207\u308c"})}})()]}):"-"}),(0,pt.jsx)("td",{className:"px-6 py-4",children:e.manager_ids&&e.manager_ids.length>0?(0,pt.jsx)("div",{className:"space-y-1",children:(0,pt.jsx)("span",{className:"text-sm text-gray-600",children:D(e.manager_ids).join(", ")})}):(0,pt.jsx)("span",{className:"text-red-600 font-medium flex items-center gap-1",children:"\u26a0\ufe0f \u8cac\u4efb\u8005\u672a\u8a2d\u5b9a"})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsxs)("button",{onClick:()=>(async e=>{if(!e||!e.id)return void console.error("\u62e0\u70b9\u60c5\u5831\u304c\u4e0d\u6b63\u3067\u3059:",e);ke(e);const t=e.manager_ids||[];_e(t),Ne(!0),T(t=>({...t,[e.id]:void 0})),await E(e.id)})(e),className:"bg-indigo-500 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300 hover:bg-indigo-600 hover:shadow-md flex items-center gap-1",children:[(0,pt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})}),"\u8cac\u4efb\u8005\u9078\u629e"]}),(0,pt.jsxs)("button",{onClick:()=>(async e=>{Re(e),We(null),qe(!0);try{let t=await He("/api/courses"),n=[];t&&t.success&&Array.isArray(t.data)?n=t.data:Array.isArray(t)&&(n=t),Be(n);let s=await He(`/api/satellites/${e.id}/disabled-courses`),r=[];s&&s.success&&Array.isArray(s.data)?r=s.data.map(e=>Number(e)):Array.isArray(s)&&(r=s.map(e=>Number(e)));const a=n.map(e=>Number(e.id)).filter(e=>!r.includes(e));Fe(a),$e(!0)}catch(Yc){console.error("\u30b3\u30fc\u30b9\u7ba1\u7406\u30c7\u30fc\u30bf\u53d6\u5f97\u30a8\u30e9\u30fc:",Yc),We(Yc.message||"\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}finally{qe(!1)}})(e),className:"bg-blue-500 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300 hover:bg-blue-600 hover:shadow-md flex items-center gap-1",children:[(0,pt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17v-2a4 4 0 014-4h4"})}),"\u30b3\u30fc\u30b9\u7ba1\u7406"]}),(0,pt.jsxs)("button",{onClick:()=>(e=>{Pe(e),Ee({name:e.name,address:e.address||"",phone:e.phone||"",office_type_id:e.office_type_name||e.office_type_id||"",max_users:e.max_users||10,token_expiry_at:e.token_expiry_at||""}),Ie(!0)})(e),className:"bg-emerald-500 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300 hover:bg-emerald-600 hover:shadow-md flex items-center gap-1",children:[(0,pt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"\u7de8\u96c6"]}),(0,pt.jsxs)("button",{onClick:()=>(async e=>{if(window.confirm(`\u300c${e.name}\u300d\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f\n\u3053\u306e\u64cd\u4f5c\u306f\u53d6\u308a\u6d88\u305b\u307e\u305b\u3093\u3002`))try{const t=await fetch(`${ze.JR}/api/satellites/${e.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}}),n=await t.json();n.success?(lt("\u4e8b\u696d\u6240\u304c\u6b63\u5e38\u306b\u524a\u9664\u3055\u308c\u307e\u3057\u305f","success"),await z()):lt(`\u4e8b\u696d\u6240\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${n.message}`,"error")}catch(d){console.error("\u4e8b\u696d\u6240\u524a\u9664\u30a8\u30e9\u30fc:",d),lt("\u4e8b\u696d\u6240\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f","error")}})(e),className:"bg-red-500 text-white px-3 py-2 rounded-lg text-sm font-medium transition-all duration-300 hover:bg-red-600 hover:shadow-md flex items-center gap-1",children:[(0,pt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"\u524a\u9664"]})]})})]},e.id))})]})})}),0===yt.length&&(0,pt.jsx)("div",{className:"text-center py-12",children:(0,pt.jsx)("p",{className:"text-gray-500 text-lg",children:"\u691c\u7d22\u6761\u4ef6\u306b\u4e00\u81f4\u3059\u308b\u4e8b\u696d\u6240\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002"})}),se&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-8 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u7ba1\u7406"}),(0,pt.jsx)("button",{onClick:()=>re(!1),className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"\xd7"})]}),i&&(0,pt.jsxs)("div",{className:"text-center py-8",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]}),d&&(0,pt.jsxs)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,pt.jsxs)("p",{className:"text-red-700 text-sm",children:[(0,pt.jsx)("strong",{children:"\u30a8\u30e9\u30fc:"})," ",d]}),(0,pt.jsx)("button",{onClick:A,className:"mt-2 text-red-600 hover:text-red-800 text-sm underline",children:"\u518d\u8a66\u884c"})]}),!i&&(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-700 mb-4",children:"\u73fe\u5728\u306e\u4e8b\u696d\u6240\u30bf\u30a4\u30d7"}),0===s.length?(0,pt.jsx)("p",{className:"text-gray-500 text-center py-4",children:"\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093"}):(0,pt.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:s.map(e=>(0,pt.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200",children:[(0,pt.jsx)("span",{className:"text-gray-800",children:e}),(0,pt.jsx)("button",{className:"px-3 py-1 bg-red-500 text-white rounded text-sm font-medium transition-colors duration-300 hover:bg-red-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>it(e),disabled:s.length<=1,title:s.length<=1?"\u6700\u4f4e1\u3064\u306e\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u304c\u5fc5\u8981\u3067\u3059":"",children:"\u524a\u9664"})]},e))})]}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-700 mb-4",children:"\u65b0\u3057\u3044\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u3092\u8ffd\u52a0"}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("input",{type:"text",placeholder:"\u65b0\u3057\u3044\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u540d",value:ae,onChange:e=>le(e.target.value),onKeyPress:e=>"Enter"===e.key&&ot(),className:"flex-1 px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"}),(0,pt.jsx)("button",{onClick:ot,disabled:!ae.trim(),className:"px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg font-semibold transition-colors duration-300 hover:-translate-y-0.5 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none",children:"\u8ffd\u52a0"})]})]})]}),(0,pt.jsx)("div",{className:"flex gap-4 pt-4 border-t border-gray-200",children:(0,pt.jsx)("button",{onClick:()=>re(!1),className:"flex-1 bg-gray-100 text-gray-700 border-2 border-gray-200 px-6 py-3 rounded-lg font-semibold transition-colors duration-300 hover:bg-gray-200",children:"\u9589\u3058\u308b"})})]})}),X&&(0,pt.jsx)("div",{className:"form-modal",children:(0,pt.jsxs)("div",{className:"form-content facility-form",children:[(0,pt.jsx)("h3",{children:"\u65b0\u3057\u3044\u4e8b\u696d\u6240\u3092\u8ffd\u52a0"}),(0,pt.jsx)("input",{type:"text",placeholder:"\u4e8b\u696d\u6240\u540d",value:K.name,onChange:e=>Y({...K,name:e.target.value})}),(0,pt.jsx)("select",{value:K.type,onChange:e=>Y({...K,type:e.target.value}),children:s.map(e=>(0,pt.jsx)("option",{value:e,children:e},e))}),(0,pt.jsx)("input",{type:"text",placeholder:"\u4f4f\u6240",value:K.address,onChange:e=>Y({...K,address:e.target.value})}),(0,pt.jsx)("input",{type:"text",placeholder:"\u96fb\u8a71\u756a\u53f7",value:K.phone,onChange:e=>Y({...K,phone:e.target.value})}),(0,pt.jsxs)("div",{className:"contacts-section",children:[(0,pt.jsxs)("div",{className:"contacts-header",children:[(0,pt.jsx)("h4",{children:"\u62c5\u5f53\u8005\u60c5\u5831"}),(0,pt.jsx)("button",{type:"button",className:"add-contact-btn",onClick:()=>{Y({...K,contacts:[...K.contacts,{name:"",email:""}]})},children:"+ \u62c5\u5f53\u8005\u3092\u8ffd\u52a0"})]}),K.contacts.map((e,t)=>(0,pt.jsx)("div",{className:"contact-item",children:(0,pt.jsxs)("div",{className:"contact-inputs",children:[(0,pt.jsx)("input",{type:"text",placeholder:"\u62c5\u5f53\u8005\u540d",value:e.name,onChange:e=>ct(t,"name",e.target.value)}),(0,pt.jsx)("input",{type:"email",placeholder:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9",value:e.email,onChange:e=>ct(t,"email",e.target.value)}),K.contacts.length>1&&(0,pt.jsx)("button",{type:"button",className:"remove-contact-btn",onClick:()=>(e=>{if(K.contacts.length>1){const t=K.contacts.filter((t,n)=>n!==e);Y({...K,contacts:t})}})(t),children:"\u524a\u9664"})]})},t))]}),(0,pt.jsxs)("div",{className:"form-actions",children:[(0,pt.jsx)("button",{onClick:()=>{const e={id:`facility${Date.now()}`,...K,offices:[]};F([...M,e]),Y({name:"",type:"\u5c31\u52b4\u79fb\u884c\u652f\u63f4\u4e8b\u696d\u6240",address:"",phone:"",contacts:[{name:"",email:""}]}),ee(!1)},children:"\u8ffd\u52a0"}),(0,pt.jsx)("button",{onClick:()=>ee(!1),children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})}),te&&(0,pt.jsx)("div",{className:"form-modal",children:(0,pt.jsxs)("div",{className:"form-content",children:[(0,pt.jsx)("h3",{children:"\u65b0\u3057\u3044\u62e0\u70b9\u3092\u8ffd\u52a0"}),(0,pt.jsxs)("select",{value:G.facilityId,onChange:e=>Z({...G,facilityId:e.target.value}),children:[(0,pt.jsx)("option",{value:"",children:"\u4e8b\u696d\u6240\u3092\u9078\u629e"}),M.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,pt.jsx)("input",{type:"text",placeholder:"\u62e0\u70b9\u540d",value:G.name,onChange:e=>Z({...G,name:e.target.value})}),(0,pt.jsx)("input",{type:"text",placeholder:"\u4f4f\u6240",value:G.address,onChange:e=>Z({...G,address:e.target.value})}),(0,pt.jsxs)("div",{className:"form-actions",children:[(0,pt.jsx)("button",{onClick:()=>{if(M.find(e=>e.id===G.facilityId)){const e={id:`location${Date.now()}`,name:G.name,address:G.address,teacherCount:0,studentCount:0,maxStudents:20},t=M.map(t=>t.id===G.facilityId?{...t,offices:[...t.offices,e]}:t);F(t),Z({facilityId:"",name:"",address:""}),ne(!1)}},children:"\u8ffd\u52a0"}),(0,pt.jsx)("button",{onClick:()=>ne(!1),children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})}),oe&&(0,pt.jsx)("div",{className:"modal-overlay",children:(0,pt.jsxs)("div",{className:"facility-detail-modal",children:[(0,pt.jsxs)("div",{className:"modal-header",children:[(0,pt.jsxs)("h3",{children:[oe.facilityId===oe.locationId?"\u4e8b\u696d\u6240\u7de8\u96c6":"\u62e0\u70b9\u7de8\u96c6"," - ",oe.facilityName]}),(0,pt.jsx)("button",{className:"close-button",onClick:dt,children:"\xd7"})]}),(0,pt.jsx)("div",{className:"detail-content",children:oe.facilityId===oe.locationId?(0,pt.jsxs)("div",{className:"edit-form",children:[(0,pt.jsxs)("div",{className:"form-section",children:[(0,pt.jsx)("h4",{children:"\u57fa\u672c\u60c5\u5831"}),(0,pt.jsxs)("div",{className:"form-row",children:[(0,pt.jsxs)("div",{className:"form-group",children:[(0,pt.jsx)("label",{children:"\u4e8b\u696d\u6240\u540d *"}),(0,pt.jsx)("input",{type:"text",value:ue.name||"",onChange:e=>me({...ue,name:e.target.value}),placeholder:"\u4e8b\u696d\u6240\u540d"})]}),(0,pt.jsxs)("div",{className:"form-group",children:[(0,pt.jsx)("label",{children:"\u4e8b\u696d\u6240\u30bf\u30a4\u30d7 *"}),(0,pt.jsx)("select",{value:ue.type||"",onChange:e=>me({...ue,type:e.target.value}),children:s.map(e=>(0,pt.jsx)("option",{value:e,children:e},e))})]})]}),(0,pt.jsxs)("div",{className:"form-row",children:[(0,pt.jsxs)("div",{className:"form-group",children:[(0,pt.jsx)("label",{children:"\u4f4f\u6240 *"}),(0,pt.jsx)("input",{type:"text",value:ue.address||"",onChange:e=>me({...ue,address:e.target.value}),placeholder:"\u4f4f\u6240"})]}),(0,pt.jsxs)("div",{className:"form-group",children:[(0,pt.jsx)("label",{children:"\u96fb\u8a71\u756a\u53f7"}),(0,pt.jsx)("input",{type:"text",value:ue.phone||"",onChange:e=>me({...ue,phone:e.target.value}),placeholder:"\u96fb\u8a71\u756a\u53f7"})]})]})]}),(0,pt.jsxs)("div",{className:"form-section",children:[(0,pt.jsxs)("div",{className:"section-header",children:[(0,pt.jsx)("h4",{children:"\u62c5\u5f53\u8005\u60c5\u5831"}),(0,pt.jsx)("button",{type:"button",className:"add-contact-btn",onClick:()=>{ue&&me({...ue,contacts:[...ue.contacts,{name:"",email:""}]})},children:"+ \u62c5\u5f53\u8005\u3092\u8ffd\u52a0"})]}),ue.contacts&&ue.contacts.map((e,t)=>(0,pt.jsx)("div",{className:"contact-edit-item",children:(0,pt.jsxs)("div",{className:"contact-inputs",children:[(0,pt.jsx)("input",{type:"text",placeholder:"\u62c5\u5f53\u8005\u540d",value:e.name||"",onChange:e=>ut(t,"name",e.target.value)}),(0,pt.jsx)("input",{type:"email",placeholder:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9",value:e.email||"",onChange:e=>ut(t,"email",e.target.value)}),ue.contacts.length>1&&(0,pt.jsx)("button",{type:"button",className:"remove-contact-btn",onClick:()=>(e=>{if(ue&&ue.contacts.length>1){const t=ue.contacts.filter((t,n)=>n!==e);me({...ue,contacts:t})}})(t),children:"\u524a\u9664"})]})},t))]}),(0,pt.jsxs)("div",{className:"form-section",children:[(0,pt.jsx)("h4",{children:"\u62e0\u70b9\u60c5\u5831"}),(0,pt.jsxs)("div",{className:"locations-summary",children:[(0,pt.jsxs)("p",{children:["\u62e0\u70b9\u6570: ",xe.offices.length,"\u62e0\u70b9"]}),(0,pt.jsx)("div",{className:"locations-list",children:xe.offices.map(e=>(0,pt.jsxs)("div",{className:"location-summary-item",children:[(0,pt.jsx)("span",{className:"location-name",children:e.name}),(0,pt.jsxs)("span",{className:"location-stats",children:["\ud83d\udc68\u200d\ud83c\udfeb ",e.teacherCount,"\u4eba / \ud83d\udc65 ",e.studentCount,"/",e.maxStudents,"\u4eba"]})]},e.id))})]})]}),(0,pt.jsxs)("div",{className:"form-actions",children:[(0,pt.jsx)("button",{className:"save-btn",onClick:()=>{ue&&(F(e=>e.map(e=>e.id===ue.id?ue:e)),me(null),ge(null))},children:"\u4fdd\u5b58"}),(0,pt.jsx)("button",{className:"cancel-btn",onClick:()=>{me(null),ge(null)},children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]}):(0,pt.jsxs)("div",{className:"edit-form",children:[(0,pt.jsxs)("div",{className:"form-section",children:[(0,pt.jsx)("h4",{children:"\u62e0\u70b9\u57fa\u672c\u60c5\u5831"}),(0,pt.jsxs)("div",{className:"form-row",children:[(0,pt.jsxs)("div",{className:"form-group",children:[(0,pt.jsx)("label",{children:"\u62e0\u70b9\u540d *"}),(0,pt.jsx)("input",{type:"text",value:ce.name||"",onChange:e=>de({...ce,name:e.target.value}),placeholder:"\u62e0\u70b9\u540d"})]}),(0,pt.jsxs)("div",{className:"form-group",children:[(0,pt.jsx)("label",{children:"\u4f4f\u6240 *"}),(0,pt.jsx)("input",{type:"text",value:ce.address||"",onChange:e=>de({...ce,address:e.target.value}),placeholder:"\u4f4f\u6240"})]})]}),(0,pt.jsxs)("div",{className:"form-row",children:[(0,pt.jsxs)("div",{className:"form-group",children:[(0,pt.jsx)("label",{children:"\u6700\u5927\u5229\u7528\u8005\u6570 *"}),(0,pt.jsx)("input",{type:"number",value:ce.maxStudents||"",onChange:e=>de({...ce,maxStudents:parseInt(e.target.value)||0}),placeholder:"\u6700\u5927\u5229\u7528\u8005\u6570"})]}),(0,pt.jsxs)("div",{className:"form-group",children:[(0,pt.jsx)("label",{children:"\u73fe\u5728\u306e\u5229\u7528\u8005\u6570 *"}),(0,pt.jsx)("input",{type:"number",value:ce.studentCount||"",onChange:e=>de({...ce,studentCount:parseInt(e.target.value)||0}),placeholder:"\u73fe\u5728\u306e\u5229\u7528\u8005\u6570"})]})]}),(0,pt.jsx)("div",{className:"form-row",children:(0,pt.jsxs)("div",{className:"form-group",children:[(0,pt.jsx)("label",{children:"\u73fe\u5728\u306e\u6307\u5c0e\u54e1\u6570 *"}),(0,pt.jsx)("input",{type:"number",value:ce.teacherCount||"",onChange:e=>de({...ce,teacherCount:parseInt(e.target.value)||0}),placeholder:"\u73fe\u5728\u306e\u6307\u5c0e\u54e1\u6570"})]})})]}),(0,pt.jsxs)("div",{className:"form-actions",children:[(0,pt.jsx)("button",{className:"save-btn",onClick:()=>((e,t)=>{const n=M.map(n=>n.id===e?{...n,offices:n.offices.map(e=>e.id===t?{...e,...ce}:e)}:n);F(n),ie(null),de({})})(oe.facilityId,oe.locationId),children:"\u4fdd\u5b58"}),(0,pt.jsx)("button",{className:"cancel-btn",onClick:dt,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})})]})}),oe&&(0,pt.jsx)("div",{className:"modal-overlay",children:(0,pt.jsxs)("div",{className:"location-detail-modal",children:[(0,pt.jsxs)("div",{className:"modal-header",children:[(0,pt.jsxs)("h3",{children:[oe.facilityName," - \u8a73\u7d30\u60c5\u5831"]}),(0,pt.jsx)("button",{className:"close-button",onClick:()=>{ie(null),de({})},children:"\xd7"})]}),(0,pt.jsxs)("div",{className:"detail-content",children:[(0,pt.jsxs)("div",{className:"detail-section",children:[(0,pt.jsx)("h4",{children:"\ud83d\udccd \u57fa\u672c\u60c5\u5831"}),(0,pt.jsxs)("div",{className:"info-grid",children:[(0,pt.jsxs)("div",{className:"info-item",children:[(0,pt.jsx)("label",{children:"\u62e0\u70b9\u540d:"}),(0,pt.jsx)("span",{children:oe.name})]}),(0,pt.jsxs)("div",{className:"info-item",children:[(0,pt.jsx)("label",{children:"\u4e8b\u696d\u6240:"}),(0,pt.jsx)("span",{children:oe.facilityName})]}),(0,pt.jsxs)("div",{className:"info-item",children:[(0,pt.jsx)("label",{children:"\u4f4f\u6240:"}),(0,pt.jsx)("span",{children:oe.address})]}),(0,pt.jsxs)("div",{className:"info-item",children:[(0,pt.jsx)("label",{children:"\u96fb\u8a71\u756a\u53f7:"}),(0,pt.jsx)("span",{children:oe.phone})]}),(0,pt.jsxs)("div",{className:"info-item",children:[(0,pt.jsx)("label",{children:"\u6700\u5927\u5229\u7528\u8005\u6570:"}),(0,pt.jsxs)("span",{children:[oe.maxStudents,"\u540d"]})]}),(0,pt.jsxs)("div",{className:"info-item",children:[(0,pt.jsx)("label",{children:"\u73fe\u5728\u306e\u5229\u7528\u8005\u6570:"}),(0,pt.jsxs)("span",{children:[(oe.locationId,[{id:1,name:"\u7530\u4e2d\u82b1\u5b50",email:"tanaka@example.com",course:"IT\u30ea\u30c6\u30e9\u30b7\u30fc\u30fbAI\u306e\u57fa\u672c",instructor:"\u4f50\u85e4\u6307\u5c0e\u54e1",progress:75,status:"active"},{id:2,name:"\u5c71\u7530\u592a\u90ce",email:"yamada@example.com",course:"SNS\u904b\u7528\u306e\u57fa\u790e\u30fb\u753b\u50cf\u751f\u6210\u7de8\u96c6",instructor:"\u7530\u4e2d\u6307\u5c0e\u54e1",progress:45,status:"active"},{id:3,name:"\u9234\u6728\u4e00\u90ce",email:"suzuki@example.com",course:"LP\u5236\u4f5c(HTML\u30fbCSS)",instructor:"\u5c71\u7530\u6307\u5c0e\u54e1",progress:90,status:"inactive"}]).length,"\u540d"]})]})]})]}),(0,pt.jsxs)("div",{className:"detail-section",children:[(0,pt.jsxs)("h4",{children:["\ud83d\udc65 \u5229\u7528\u8005\u4e00\u89a7 (",(oe.locationId,[{id:1,name:"\u7530\u4e2d\u82b1\u5b50",email:"tanaka@example.com",course:"IT\u30ea\u30c6\u30e9\u30b7\u30fc\u30fbAI\u306e\u57fa\u672c",instructor:"\u4f50\u85e4\u6307\u5c0e\u54e1",progress:75,status:"active"},{id:2,name:"\u5c71\u7530\u592a\u90ce",email:"yamada@example.com",course:"SNS\u904b\u7528\u306e\u57fa\u790e\u30fb\u753b\u50cf\u751f\u6210\u7de8\u96c6",instructor:"\u7530\u4e2d\u6307\u5c0e\u54e1",progress:45,status:"active"},{id:3,name:"\u9234\u6728\u4e00\u90ce",email:"suzuki@example.com",course:"LP\u5236\u4f5c(HTML\u30fbCSS)",instructor:"\u5c71\u7530\u6307\u5c0e\u54e1",progress:90,status:"inactive"}]).length,"\u540d)"]}),(oe.locationId,[{id:1,name:"\u7530\u4e2d\u82b1\u5b50",email:"tanaka@example.com",course:"IT\u30ea\u30c6\u30e9\u30b7\u30fc\u30fbAI\u306e\u57fa\u672c",instructor:"\u4f50\u85e4\u6307\u5c0e\u54e1",progress:75,status:"active"},{id:2,name:"\u5c71\u7530\u592a\u90ce",email:"yamada@example.com",course:"SNS\u904b\u7528\u306e\u57fa\u790e\u30fb\u753b\u50cf\u751f\u6210\u7de8\u96c6",instructor:"\u7530\u4e2d\u6307\u5c0e\u54e1",progress:45,status:"active"},{id:3,name:"\u9234\u6728\u4e00\u90ce",email:"suzuki@example.com",course:"LP\u5236\u4f5c(HTML\u30fbCSS)",instructor:"\u5c71\u7530\u6307\u5c0e\u54e1",progress:90,status:"inactive"}]).length>0?(0,pt.jsx)("div",{className:"students-table-container",children:(0,pt.jsxs)("table",{className:"students-table",children:[(0,pt.jsx)("thead",{children:(0,pt.jsxs)("tr",{children:[(0,pt.jsx)("th",{children:"\u5229\u7528\u8005\u540d"}),(0,pt.jsx)("th",{children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9"}),(0,pt.jsx)("th",{children:"\u30b3\u30fc\u30b9"}),(0,pt.jsx)("th",{children:"\u62c5\u5f53\u6307\u5c0e\u54e1"}),(0,pt.jsx)("th",{children:"\u9032\u6357"}),(0,pt.jsx)("th",{children:"\u30b9\u30c6\u30fc\u30bf\u30b9"})]})}),(0,pt.jsx)("tbody",{children:(oe.locationId,[{id:1,name:"\u7530\u4e2d\u82b1\u5b50",email:"tanaka@example.com",course:"IT\u30ea\u30c6\u30e9\u30b7\u30fc\u30fbAI\u306e\u57fa\u672c",instructor:"\u4f50\u85e4\u6307\u5c0e\u54e1",progress:75,status:"active"},{id:2,name:"\u5c71\u7530\u592a\u90ce",email:"yamada@example.com",course:"SNS\u904b\u7528\u306e\u57fa\u790e\u30fb\u753b\u50cf\u751f\u6210\u7de8\u96c6",instructor:"\u7530\u4e2d\u6307\u5c0e\u54e1",progress:45,status:"active"},{id:3,name:"\u9234\u6728\u4e00\u90ce",email:"suzuki@example.com",course:"LP\u5236\u4f5c(HTML\u30fbCSS)",instructor:"\u5c71\u7530\u6307\u5c0e\u54e1",progress:90,status:"inactive"}]).map(e=>(0,pt.jsxs)("tr",{className:`student-row ${e.status}`,children:[(0,pt.jsx)("td",{className:"student-name",children:e.name}),(0,pt.jsx)("td",{className:"student-email",children:e.email}),(0,pt.jsx)("td",{className:"student-course",children:e.course}),(0,pt.jsx)("td",{className:"student-instructor",children:e.instructor}),(0,pt.jsx)("td",{className:"student-progress",children:(0,pt.jsxs)("div",{className:"progress-info",children:[(0,pt.jsxs)("span",{children:[e.progress,"%"]}),(0,pt.jsx)("div",{className:"progress-bar",children:(0,pt.jsx)("div",{className:"progress-fill",style:{width:`${e.progress}%`}})})]})}),(0,pt.jsx)("td",{className:"student-status",children:(0,pt.jsx)("span",{className:`status-badge ${e.status}`,children:"active"===e.status?"\u30a2\u30af\u30c6\u30a3\u30d6":"\u975e\u30a2\u30af\u30c6\u30a3\u30d6"})})]},e.id))})]})}):(0,pt.jsx)("div",{className:"no-students",children:(0,pt.jsx)("p",{children:"\u3053\u306e\u62e0\u70b9\u306b\u306f\u73fe\u5728\u5229\u7528\u8005\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002"})})]}),(0,pt.jsxs)("div",{className:"detail-section",children:[(0,pt.jsx)("h4",{children:"\ud83d\udcca \u7d71\u8a08\u60c5\u5831"}),(0,pt.jsxs)("div",{className:"stats-row",children:[(0,pt.jsxs)("div",{className:"stat-item",children:[(0,pt.jsx)("span",{className:"stat-label",children:"\u7a3c\u50cd\u7387:"}),(0,pt.jsxs)("span",{className:"stat-value",children:[Math.round((oe.locationId,[{id:1,name:"\u7530\u4e2d\u82b1\u5b50",email:"tanaka@example.com",course:"IT\u30ea\u30c6\u30e9\u30b7\u30fc\u30fbAI\u306e\u57fa\u672c",instructor:"\u4f50\u85e4\u6307\u5c0e\u54e1",progress:75,status:"active"},{id:2,name:"\u5c71\u7530\u592a\u90ce",email:"yamada@example.com",course:"SNS\u904b\u7528\u306e\u57fa\u790e\u30fb\u753b\u50cf\u751f\u6210\u7de8\u96c6",instructor:"\u7530\u4e2d\u6307\u5c0e\u54e1",progress:45,status:"active"},{id:3,name:"\u9234\u6728\u4e00\u90ce",email:"suzuki@example.com",course:"LP\u5236\u4f5c(HTML\u30fbCSS)",instructor:"\u5c71\u7530\u6307\u5c0e\u54e1",progress:90,status:"inactive"}]).length/oe.maxStudents*100),"%"]})]}),(0,pt.jsxs)("div",{className:"stat-item",children:[(0,pt.jsx)("span",{className:"stat-label",children:"\u30a2\u30af\u30c6\u30a3\u30d6\u5229\u7528\u8005:"}),(0,pt.jsxs)("span",{className:"stat-value",children:[(oe.locationId,[{id:1,name:"\u7530\u4e2d\u82b1\u5b50",email:"tanaka@example.com",course:"IT\u30ea\u30c6\u30e9\u30b7\u30fc\u30fbAI\u306e\u57fa\u672c",instructor:"\u4f50\u85e4\u6307\u5c0e\u54e1",progress:75,status:"active"},{id:2,name:"\u5c71\u7530\u592a\u90ce",email:"yamada@example.com",course:"SNS\u904b\u7528\u306e\u57fa\u790e\u30fb\u753b\u50cf\u751f\u6210\u7de8\u96c6",instructor:"\u7530\u4e2d\u6307\u5c0e\u54e1",progress:45,status:"active"},{id:3,name:"\u9234\u6728\u4e00\u90ce",email:"suzuki@example.com",course:"LP\u5236\u4f5c(HTML\u30fbCSS)",instructor:"\u5c71\u7530\u6307\u5c0e\u54e1",progress:90,status:"inactive"}]).filter(e=>"active"===e.status).length,"\u540d"]})]}),(0,pt.jsxs)("div",{className:"stat-item",children:[(0,pt.jsx)("span",{className:"stat-label",children:"\u5e73\u5747\u9032\u6357:"}),(0,pt.jsxs)("span",{className:"stat-value",children:[(oe.locationId,[{id:1,name:"\u7530\u4e2d\u82b1\u5b50",email:"tanaka@example.com",course:"IT\u30ea\u30c6\u30e9\u30b7\u30fc\u30fbAI\u306e\u57fa\u672c",instructor:"\u4f50\u85e4\u6307\u5c0e\u54e1",progress:75,status:"active"},{id:2,name:"\u5c71\u7530\u592a\u90ce",email:"yamada@example.com",course:"SNS\u904b\u7528\u306e\u57fa\u790e\u30fb\u753b\u50cf\u751f\u6210\u7de8\u96c6",instructor:"\u7530\u4e2d\u6307\u5c0e\u54e1",progress:45,status:"active"},{id:3,name:"\u9234\u6728\u4e00\u90ce",email:"suzuki@example.com",course:"LP\u5236\u4f5c(HTML\u30fbCSS)",instructor:"\u5c71\u7530\u6307\u5c0e\u54e1",progress:90,status:"inactive"}]).length>0?Math.round((oe.locationId,[{id:1,name:"\u7530\u4e2d\u82b1\u5b50",email:"tanaka@example.com",course:"IT\u30ea\u30c6\u30e9\u30b7\u30fc\u30fbAI\u306e\u57fa\u672c",instructor:"\u4f50\u85e4\u6307\u5c0e\u54e1",progress:75,status:"active"},{id:2,name:"\u5c71\u7530\u592a\u90ce",email:"yamada@example.com",course:"SNS\u904b\u7528\u306e\u57fa\u790e\u30fb\u753b\u50cf\u751f\u6210\u7de8\u96c6",instructor:"\u7530\u4e2d\u6307\u5c0e\u54e1",progress:45,status:"active"},{id:3,name:"\u9234\u6728\u4e00\u90ce",email:"suzuki@example.com",course:"LP\u5236\u4f5c(HTML\u30fbCSS)",instructor:"\u5c71\u7530\u6307\u5c0e\u54e1",progress:90,status:"inactive"}]).reduce((e,t)=>e+t.progress,0)/(oe.locationId,[{id:1,name:"\u7530\u4e2d\u82b1\u5b50",email:"tanaka@example.com",course:"IT\u30ea\u30c6\u30e9\u30b7\u30fc\u30fbAI\u306e\u57fa\u672c",instructor:"\u4f50\u85e4\u6307\u5c0e\u54e1",progress:75,status:"active"},{id:2,name:"\u5c71\u7530\u592a\u90ce",email:"yamada@example.com",course:"SNS\u904b\u7528\u306e\u57fa\u790e\u30fb\u753b\u50cf\u751f\u6210\u7de8\u96c6",instructor:"\u7530\u4e2d\u6307\u5c0e\u54e1",progress:45,status:"active"},{id:3,name:"\u9234\u6728\u4e00\u90ce",email:"suzuki@example.com",course:"LP\u5236\u4f5c(HTML\u30fbCSS)",instructor:"\u5c71\u7530\u6307\u5c0e\u54e1",progress:90,status:"inactive"}]).length):0,"%"]})]})]})]})]})]})}),O&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-8 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800 mb-6",children:"\u4e8b\u696d\u6240\u8ffd\u52a0"}),(0,pt.jsx)(Lt,{error:p,onClose:()=>f(null)}),(0,pt.jsxs)("form",{className:"space-y-6",onSubmit:e=>{e.preventDefault(),at()},children:[(0,pt.jsxs)("div",{className:"border-b border-gray-200 pb-4",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-700 mb-4",children:"\u7d44\u7e54\u60c5\u5831"}),(0,pt.jsx)("div",{className:"mb-4",children:(0,pt.jsxs)("label",{className:"flex items-center gap-2 text-sm font-medium text-gray-700",children:[(0,pt.jsx)("input",{type:"checkbox",checked:fe,onChange:e=>be(e.target.checked),className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500"}),(0,pt.jsx)("span",{children:"\u65b0\u898f\u7d44\u7e54\u3092\u4f5c\u6210\u3059\u308b"})]})}),fe?(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u7d44\u7e54\u540d *"}),(0,pt.jsx)(Ct,{type:"text",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-400 transition-colors duration-300",value:ye.name,onChange:e=>ve({...ye,name:e.target.value}),required:!0,sanitizeMode:_t.LIGHT})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u4f4f\u6240"}),(0,pt.jsx)(Ct,{type:"text",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-400 transition-colors duration-300",value:ye.address,onChange:e=>ve({...ye,address:e.target.value}),sanitizeMode:_t.LIGHT})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u96fb\u8a71\u756a\u53f7"}),(0,pt.jsx)(Ct,{type:"text",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-400 transition-colors duration-300",value:ye.phone,onChange:e=>ve({...ye,phone:e.target.value}),sanitizeMode:_t.LIGHT})]})]}):(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u7d44\u7e54 *"}),0===b.length?(0,pt.jsxs)("div",{className:"w-full px-4 py-3 border-2 border-yellow-200 rounded-lg bg-yellow-50",children:[(0,pt.jsx)("p",{className:"text-sm text-yellow-700 mb-2",children:"\u7d44\u7e54\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u65b0\u898f\u7d44\u7e54\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}),(0,pt.jsx)("button",{type:"button",onClick:()=>be(!0),className:"text-sm bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 transition-colors duration-300",children:"\u65b0\u898f\u7d44\u7e54\u3092\u4f5c\u6210"})]}):(0,pt.jsxs)("select",{className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-400 transition-colors duration-300",value:he.company_id,onChange:e=>pe({...he,company_id:e.target.value}),required:!0,children:[(0,pt.jsx)("option",{value:"",children:"\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),b.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.name},e.id))]}),v&&(0,pt.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"\u7d44\u7e54\u4e00\u89a7\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-700 mb-4",children:"\u4e8b\u696d\u6240\u60c5\u5831"}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u4e8b\u696d\u6240\u540d *"}),(0,pt.jsx)(Ct,{type:"text",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-400 transition-colors duration-300",value:he.name,onChange:e=>pe({...he,name:e.target.value}),required:!0,sanitizeMode:_t.LIGHT})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u4e8b\u696d\u6240\u30bf\u30a4\u30d7 *"}),(0,pt.jsxs)("select",{className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-400 transition-colors duration-300",value:he.office_type_id,onChange:e=>pe({...he,office_type_id:e.target.value}),required:!0,disabled:i,children:[(0,pt.jsx)("option",{value:"",children:i?"\u8aad\u307f\u8fbc\u307f\u4e2d...":0===s.length?"\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u304c\u3042\u308a\u307e\u305b\u3093":"\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),s.map(e=>(0,pt.jsx)("option",{value:e,children:e},e))]}),i&&(0,pt.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."}),!i&&0===s.length&&(0,pt.jsxs)("p",{className:"text-sm text-red-500 mt-2",children:["\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002",(0,pt.jsx)("button",{type:"button",onClick:()=>et(!0),className:"text-blue-600 hover:text-blue-800 underline ml-1",children:"\u4e8b\u696d\u6240\u30bf\u30a4\u30d7\u7ba1\u7406"}),"\u304b\u3089\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002"]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u4f4f\u6240"}),(0,pt.jsx)(Ct,{type:"text",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-400 transition-colors duration-300",value:he.address,onChange:e=>pe({...he,address:e.target.value}),sanitizeMode:_t.LIGHT})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u96fb\u8a71\u756a\u53f7"}),(0,pt.jsx)(Ct,{type:"text",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-400 transition-colors duration-300",value:he.phone,onChange:e=>pe({...he,phone:e.target.value}),sanitizeMode:_t.LIGHT})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u5951\u7d04\u30b3\u30fc\u30b9 *"}),(0,pt.jsxs)("select",{className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-400 transition-colors duration-300",value:he.contract_type,onChange:e=>pe({...he,contract_type:e.target.value}),required:!0,children:[(0,pt.jsx)("option",{value:"30days",children:"30\u65e5\u30b3\u30fc\u30b9"}),(0,pt.jsx)("option",{value:"90days",children:"90\u65e5\u30b3\u30fc\u30b9"}),(0,pt.jsx)("option",{value:"1year",children:"1\u5e74\u30b3\u30fc\u30b9"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u5229\u7528\u8005\u4e0a\u9650\u6570 *"}),(0,pt.jsx)("input",{type:"number",min:"1",max:"10000",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-indigo-400 transition-colors duration-300",value:he.max_users,onChange:e=>pe({...he,max_users:parseInt(e.target.value)||10}),required:!0})]})]})]}),(0,pt.jsxs)("div",{className:"flex gap-4 pt-4 border-t border-gray-200",children:[(0,pt.jsx)("button",{type:"button",onClick:()=>{R(!1),f(null)},className:"flex-1 bg-gray-100 text-gray-700 border-2 border-gray-200 px-6 py-3 rounded-lg font-semibold transition-colors duration-300 hover:bg-gray-200",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{type:"button",onClick:at,className:"flex-1 bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-indigo-600 hover:to-purple-700 transition-all duration-300",children:fe?"\u7d44\u7e54\u30fb\u4e8b\u696d\u6240\u3092\u8ffd\u52a0":"\u4e8b\u696d\u6240\u3092\u8ffd\u52a0"})]})]})]})}),je&&we&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-8 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\u8cac\u4efb\u8005\u9078\u629e"}),(0,pt.jsx)("button",{onClick:()=>{Ne(!1),_e([])},className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"\xd7"})]}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsxs)("p",{className:"text-gray-600 mb-2",children:["\u62e0\u70b9: ",(0,pt.jsx)("span",{className:"font-semibold text-gray-800",children:we.name})]}),(0,pt.jsxs)("p",{className:"text-sm text-gray-500 mb-2",children:["\u3053\u306e\u62e0\u70b9\u306b\u6240\u5c5e\u3059\u308b\u6307\u5c0e\u54e1\u304b\u3089\u8cac\u4efb\u8005\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002",(0,pt.jsx)("br",{}),(0,pt.jsx)("span",{className:"text-blue-600 font-medium",children:"\u2713 \u30c1\u30a7\u30c3\u30af\u304c\u5165\u3063\u3066\u3044\u308b\u6307\u5c0e\u54e1\u306f\u73fe\u5728\u306e\u8cac\u4efb\u8005\u3067\u3059"})]}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("button",{onClick:async()=>{console.log("\u624b\u52d5\u3067\u6307\u5c0e\u54e1\u60c5\u5831\u3092\u66f4\u65b0\u3057\u307e\u3059"),await E(we.id)},className:"px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors duration-300",children:"\ud83d\udd04 \u6307\u5c0e\u54e1\u60c5\u5831\u3092\u66f4\u65b0"}),(0,pt.jsx)("button",{onClick:()=>_e([]),className:"px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700 transition-colors duration-300",children:"\ud83d\uddd1\ufe0f \u5168\u9078\u629e\u89e3\u9664"})]})]}),(0,pt.jsx)("div",{className:"space-y-3 mb-6 max-h-96 overflow-y-auto",children:P?(0,pt.jsxs)("div",{className:"text-center py-4",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600 mx-auto mb-2"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u6307\u5c0e\u54e1\u60c5\u5831\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]}):0===De().length?(0,pt.jsxs)("div",{className:"text-center py-4",children:[(0,pt.jsx)("p",{className:"text-gray-500",children:"\u3053\u306e\u62e0\u70b9\u306b\u6240\u5c5e\u3059\u308b\u6307\u5c0e\u54e1\u304c\u3044\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-sm text-gray-400 mt-2",children:"\u6307\u5c0e\u54e1\u3092\u62e0\u70b9\u306b\u8ffd\u52a0\u3057\u3066\u304b\u3089\u8cac\u4efb\u8005\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044"}),(0,pt.jsxs)("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,pt.jsxs)("p",{className:"text-sm text-yellow-700",children:["\u30c7\u30d0\u30c3\u30b0\u60c5\u5831: \u62e0\u70b9ID ",null===we||void 0===we?void 0:we.id,", \u6307\u5c0e\u54e1\u6570 ",De().length]}),(0,pt.jsxs)("p",{className:"text-xs text-yellow-600 mt-1",children:["\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u6307\u5c0e\u54e1\u30c7\u30fc\u30bf: ",JSON.stringify(I[null===we||void 0===we?void 0:we.id]||[])]}),(0,pt.jsxs)("p",{className:"text-xs text-yellow-600 mt-1",children:["\u5168\u62e0\u70b9\u306e\u30ad\u30e3\u30c3\u30b7\u30e5: ",JSON.stringify(Object.keys(I||{}))]}),(0,pt.jsxs)("p",{className:"text-xs text-yellow-600 mt-1",children:["\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\u72b6\u614b: ",P?"true":"false"]})]})]}):De().map(e=>{const t=Se.includes(e.id);return(0,pt.jsxs)("label",{className:"flex items-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer transition-all duration-200 "+(t?"border-blue-300 bg-blue-50":"border-gray-200"),children:[(0,pt.jsx)("input",{type:"checkbox",checked:t,onChange:t=>{t.target.checked?_e([...Se,e.id]):_e(Se.filter(t=>t!==e.id))},className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 mr-3"}),(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsxs)("div",{className:"font-medium text-gray-800",children:[e.name,5===e.role&&(0,pt.jsx)("span",{className:"text-yellow-500 text-lg ml-1",children:"\ud83d\udc51"})]}),t&&(0,pt.jsx)("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:"\u73fe\u5728\u306e\u8cac\u4efb\u8005"})]}),(0,pt.jsx)("div",{className:"text-sm text-gray-500",children:e.email||e.login_code}),(0,pt.jsx)("div",{className:"text-xs text-gray-400",children:e.specializations&&e.specializations.length>0?`\u5c02\u9580\u5206\u91ce: ${e.specializations.join(", ")}`:"\u5c02\u9580\u5206\u91ce: \u672a\u8a2d\u5b9a"})]})]},e.id)})}),(0,pt.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,pt.jsx)("button",{onClick:()=>{Ne(!1),_e([])},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-300",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsxs)("button",{onClick:()=>{(async e=>{if(e&&Array.isArray(e))if(we&&we.id)try{const t=e.map(e=>e.id);console.log("\u7ba1\u7406\u8005\u66f4\u65b0\u30ea\u30af\u30a8\u30b9\u30c8:",{satelliteId:we.id,managerIds:t});const n=await fetch(`${ze.JR}/api/satellites/${we.id}/managers`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({manager_ids:t})});if(!n.ok){const e=await n.json();throw new Error(e.message||"\u7ba1\u7406\u8005\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}const s=await n.json();if(!s.success)throw new Error(s.message||"\u7ba1\u7406\u8005\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f");const r=e.map(e=>e&&e.name?e.name:"\u4e0d\u660e").join(", "),a=we.name;lt(`\u300c${a}\u300d\u306e\u8cac\u4efb\u8005\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f: ${r}`,"success"),await z(),Ne(!1),ke(null),_e([])}catch(d){console.error("\u7ba1\u7406\u8005\u66f4\u65b0\u30a8\u30e9\u30fc:",d),lt(d.message,"error")}else console.error("\u9078\u629e\u3055\u308c\u305f\u62e0\u70b9\u304c\u4e0d\u6b63\u3067\u3059:",we);else console.error("\u9078\u629e\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u304c\u4e0d\u6b63\u3067\u3059:",e)})(De().filter(e=>Se.includes(e.id)))},disabled:0===Se.length,className:"px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed",children:["\u9078\u629e\u78ba\u5b9a (",Se.length,"\u4eba\u9078\u629e\u4e2d)"]})]})]})}),Ce&&Te&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-8 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\u4e8b\u696d\u6240\u7de8\u96c6"}),(0,pt.jsx)("button",{onClick:()=>Ie(!1),className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"\xd7"})]}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4e8b\u696d\u6240\u540d"}),(0,pt.jsx)("input",{type:"text",value:Le.name||"",onChange:e=>Ee({...Le,name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-400"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4e8b\u696d\u6240\u30bf\u30a4\u30d7"}),(0,pt.jsxs)("select",{value:Le.office_type_id||"",onChange:e=>Ee({...Le,office_type_id:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-400",children:[(0,pt.jsx)("option",{value:"",children:"\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),s.map(e=>(0,pt.jsx)("option",{value:e,children:e},e))]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4f4f\u6240"}),(0,pt.jsx)("input",{type:"text",value:Le.address||"",onChange:e=>Ee({...Le,address:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-400"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u96fb\u8a71\u756a\u53f7"}),(0,pt.jsx)("input",{type:"text",value:Le.phone||"",onChange:e=>Ee({...Le,phone:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-400"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u5229\u7528\u8005\u4e0a\u9650\u6570"}),(0,pt.jsx)("input",{type:"number",min:"1",max:"10000",value:Le.max_users||10,onChange:e=>Ee({...Le,max_users:parseInt(e.target.value)||10}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-400"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u6709\u52b9\u671f\u9650"}),(0,pt.jsxs)("div",{className:"space-y-2",children:[(0,pt.jsx)("input",{type:"datetime-local",value:Le.token_expiry_at?Le.token_expiry_at.slice(0,16):"",onChange:e=>Ee({...Le,token_expiry_at:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-400"}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("button",{type:"button",onClick:()=>{const e=new Date,t=new Date(e),n=new Date(t.getTime()+2592e6);Ee({...Le,token_expiry_at:n.toISOString().slice(0,16)})},className:"px-3 py-1 text-xs bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors duration-300",children:"+30\u65e5"}),(0,pt.jsx)("button",{type:"button",onClick:()=>{const e=new Date,t=new Date(e),n=new Date(t.getTime()+7776e6);Ee({...Le,token_expiry_at:n.toISOString().slice(0,16)})},className:"px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700 transition-colors duration-300",children:"+90\u65e5"}),(0,pt.jsx)("button",{type:"button",onClick:()=>{const e=new Date,t=new Date(e),n=new Date(t.getTime()+31536e6);Ee({...Le,token_expiry_at:n.toISOString().slice(0,16)})},className:"px-3 py-1 text-xs bg-purple-600 text-white rounded hover:bg-purple-700 transition-colors duration-300",children:"+1\u5e74"})]}),Le.token_expiry_at&&(0,pt.jsxs)("div",{className:"text-xs text-gray-500",children:["\u73fe\u5728\u306e\u8a2d\u5b9a: ",new Date(Le.token_expiry_at).toLocaleString("ja-JP")]})]})]})]}),(0,pt.jsxs)("div",{className:"flex justify-end gap-3 mt-6",children:[(0,pt.jsx)("button",{onClick:()=>{Ie(!1),Pe(null),Ee({})},className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-300",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{onClick:()=>(async()=>{try{const e={...Le};e.token_expiry_at&&(e.token_expiry_at=new Date(e.token_expiry_at).toISOString());const t=await fetch(`${ze.JR}/api/satellites/${Te.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await t.json();if(!n.success)throw new Error(n.message||"\u4e8b\u696d\u6240\u60c5\u5831\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f");lt(`\u300c${Te.name}\u300d\u306e\u60c5\u5831\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002`,"success"),Ie(!1),Pe(null),Ee({}),await z()}catch(d){console.error("\u4e8b\u696d\u6240\u60c5\u5831\u66f4\u65b0\u30a8\u30e9\u30fc:",d),lt(d.message,"error")}})(),className:"px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors duration-300",children:"\u66f4\u65b0"})]})]})}),Ae&&Oe&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-8 w-full max-w-lg mx-4 max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,pt.jsxs)("h3",{className:"text-2xl font-bold text-gray-800 mb-6",children:["\u30b3\u30fc\u30b9\u7ba1\u7406 - ",Oe.name]}),(0,pt.jsxs)("div",{className:"mb-6 space-y-2",children:[Ve&&(0,pt.jsx)("div",{className:"p-3 bg-red-100 text-red-700 rounded",children:Ve}),Je&&(0,pt.jsx)("div",{className:"p-3 bg-gray-50 text-gray-600 rounded",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."}),!Je&&Ue.map(e=>(0,pt.jsxs)("label",{className:"flex items-center gap-3 p-2 border-b border-gray-100",children:[(0,pt.jsx)("input",{type:"checkbox",checked:Me.includes(e.id),onChange:()=>{return t=e.id,void Fe(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,pt.jsx)("span",{className:"text-gray-800",children:e.title})]},e.id))]}),(0,pt.jsxs)("div",{className:"flex justify-end gap-4 mt-6",children:[(0,pt.jsx)("button",{onClick:()=>{$e(!1),Re(null),Fe([])},className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-semibold",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{onClick:async()=>{if(Oe)try{const e=Ue.map(e=>Number(e.id)).filter(e=>!Me.includes(e));await Qe(`/api/satellites/${Oe.id}/disabled-courses`,{disabled_course_ids:e}),await z(),$e(!1),Re(null),Fe([])}catch(Yc){console.error("\u30b3\u30fc\u30b9\u8a2d\u5b9a\u306e\u4fdd\u5b58\u30a8\u30e9\u30fc:",Yc),alert(`\u30b3\u30fc\u30b9\u8a2d\u5b9a\u306e\u4fdd\u5b58\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${Yc.message}`)}},className:"px-6 py-2 bg-blue-600 text-white rounded-lg font-semibold",children:"\u4fdd\u5b58"})]})]})}),Ke&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[99999]",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-8 w-full max-w-md mx-4 shadow-2xl",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"\u51e6\u7406\u4e2d..."}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u4e8b\u696d\u6240\u306e\u8ffd\u52a0\u51e6\u7406\u4e2d\u3067\u3059\u3002\u3057\u3070\u3089\u304f\u304a\u5f85\u3061\u304f\u3060\u3055\u3044\u3002"})]})}),Ge.show&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[99999]",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-8 w-full max-w-md mx-4 shadow-2xl",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"\u30c8\u30fc\u30af\u30f3\u767a\u884c\u60c5\u5831"}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsxs)("div",{className:"mb-2",children:[(0,pt.jsx)("span",{className:"font-semibold",children:"\u30c8\u30fc\u30af\u30f3:"})," ",(0,pt.jsx)("span",{className:"text-lg tracking-widest font-mono",children:Ge.token})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-semibold",children:"\u6709\u52b9\u671f\u9650:"})," ",(0,pt.jsx)("span",{children:Ge.expiry?new Date(Ge.expiry).toLocaleString():"-"})]})]}),(0,pt.jsx)("button",{className:"w-full bg-indigo-600 text-white py-2 rounded-lg font-semibold",onClick:()=>Ze({show:!1,token:"",expiry:""}),children:"\u9589\u3058\u308b"})]})}),tt&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-8 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\u4f01\u696d\u4e00\u89a7"}),(0,pt.jsx)("button",{onClick:()=>nt(!1),className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"\xd7"})]}),v&&(0,pt.jsxs)("div",{className:"text-center py-8",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u4f01\u696d\u4e00\u89a7\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]}),!v&&(0,pt.jsx)(pt.Fragment,{children:(0,pt.jsx)("div",{className:"mb-6",children:(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"w-full",children:[(0,pt.jsx)("thead",{className:"bg-blue-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-blue-800",children:"\u4f01\u696d\u540d"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-blue-800",children:"\u4f4f\u6240"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-blue-800",children:"\u96fb\u8a71\u756a\u53f7"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-blue-800",children:"\u7ba1\u7406\u30c8\u30fc\u30af\u30f3"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-blue-800",children:"\u767a\u884c\u65e5"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-blue-800",children:"\u64cd\u4f5c"})]})}),(0,pt.jsx)("tbody",{children:0===b.length?(0,pt.jsx)("tr",{children:(0,pt.jsx)("td",{colSpan:"6",className:"text-center py-8 text-gray-500",children:"\u4f01\u696d\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093"})}):b.map(e=>(0,pt.jsxs)("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-800 font-medium",children:e.name}),(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-600",children:e.address||"-"}),(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-600",children:e.phone||"-"}),(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-600 font-mono",children:e.token||"-"}),(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-600",children:e.token_issued_at?new Date(e.token_issued_at).toLocaleDateString("ja-JP"):"-"}),(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsx)("div",{className:"flex gap-2",children:(0,pt.jsx)("button",{onClick:()=>(async e=>{if(window.confirm(`\u300c${e.name}\u300d\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f\n\n\u6ce8\u610f: \u3053\u306e\u4f01\u696d\u306b\u6240\u5c5e\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u304c\u5b58\u5728\u3059\u308b\u5834\u5408\u306f\u524a\u9664\u3067\u304d\u307e\u305b\u3093\u3002\n\u3053\u306e\u64cd\u4f5c\u306f\u53d6\u308a\u6d88\u305b\u307e\u305b\u3093\u3002`))try{const t=await fetch(`${ze.JR}/api/companies/${e.id}`,{method:"DELETE",headers:{"Content-Type":"application/json"}}),n=await t.json();if(!n.success)throw new Error(n.message||"\u4f01\u696d\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f");lt(`\u300c${e.name}\u300d\u3092\u524a\u9664\u3057\u307e\u3057\u305f`,"success"),await $()}catch(t){console.error("\u4f01\u696d\u524a\u9664\u30a8\u30e9\u30fc:",t),lt(t.message,"error")}})(e),className:"px-3 py-1 bg-red-500 text-white rounded text-sm font-medium transition-colors duration-300 hover:bg-red-600",title:"\u4f01\u696d\u3092\u524a\u9664",children:"\u524a\u9664"})})})]},e.id))})]})})})}),(0,pt.jsx)("div",{className:"flex gap-4 pt-4 border-t border-gray-200",children:(0,pt.jsx)("button",{onClick:()=>nt(!1),className:"flex-1 bg-gray-100 text-gray-700 border-2 border-gray-200 px-6 py-3 rounded-lg font-semibold transition-colors duration-300 hover:bg-gray-200",children:"\u9589\u3058\u308b"})})]})}),st.show&&st.company&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-8 w-full max-w-md mx-4 shadow-2xl",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\u7ba1\u7406\u7b26\u53f7"}),(0,pt.jsx)("button",{onClick:()=>rt({show:!1,company:null}),className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"\xd7"})]}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsxs)("p",{className:"text-gray-600 mb-4",children:[(0,pt.jsx)("strong",{children:st.company.name})," \u306e\u65b0\u3057\u3044\u7ba1\u7406\u30c8\u30fc\u30af\u30f3\u304c\u751f\u6210\u3055\u308c\u307e\u3057\u305f\u3002"]}),(0,pt.jsxs)("div",{className:"bg-gray-100 p-4 rounded-lg",children:[(0,pt.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"\u7ba1\u7406\u30c8\u30fc\u30af\u30f3:"}),(0,pt.jsx)("p",{className:"text-xl font-mono font-bold text-blue-600",children:st.company.token})]}),(0,pt.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["\u767a\u884c\u65e5: ",new Date(st.company.token_issued_at).toLocaleString("ja-JP")]})]}),(0,pt.jsx)("div",{className:"flex gap-4 pt-4 border-t border-gray-200",children:(0,pt.jsx)("button",{onClick:()=>rt({show:!1,company:null}),className:"flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors duration-300 hover:bg-blue-700",children:"\u9589\u3058\u308b"})})]})})]}):(0,pt.jsx)("div",{className:"p-6",children:(0,pt.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-8 text-center",children:(0,pt.jsxs)("div",{className:"text-red-600 mb-4",children:[(0,pt.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,pt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,pt.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"\u95b2\u89a7\u6a29\u9650\u304c\u3042\u308a\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u62e0\u70b9\u60c5\u5831\u306f\u62e0\u70b9\u7ba1\u7406\u8005\u306e\u307f\u95b2\u89a7\u3067\u304d\u307e\u3059\u3002"})]})})})},Dt=e=>{let{value:t="",onChange:n,onBlur:s,sanitizeMode:a=_t.FULL,debounceMs:l=300,className:o="",placeholder:i="",required:c=!1,disabled:d=!1,maxLength:u,minLength:m,rows:x=3,cols:g,autoComplete:h,autoFocus:p=!1,readOnly:f=!1,id:b,name:y,resize:v="vertical",...j}=e;const[N,w]=(0,r.useState)(t),[k,S]=(0,r.useState)(!1),_=(0,r.useCallback)(()=>{switch(a){case _t.FULL:return wt;case _t.LIGHT:return kt;case _t.HTML_ONLY:return Nt;case _t.NONE:return e=>e;default:return wt}},[a]),C=(0,r.useCallback)(St(e=>{const t=_()(e);t!==e&&(w(t),n&&n({target:{value:t,name:y,id:b}})),S(!1)},l),[_,n,y,b,l]),I=(0,r.useCallback)(e=>{const t=e.target.value;w(t),S(!0),n&&n(e),C(t)},[n,C]),T=(0,r.useCallback)(e=>{const t=_()(e.target.value);t!==e.target.value&&(w(t),n&&n({target:{value:t,name:y,id:b}})),s&&s(e),S(!1)},[_,n,s,y,b]);(0,r.useEffect)(()=>{w(t)},[t]);const P=k&&(0,pt.jsx)("div",{className:"absolute right-2 top-2",children:(0,pt.jsx)("div",{className:"w-3 h-3 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})});return(0,pt.jsxs)("div",{className:"relative",children:[(0,pt.jsx)("textarea",{value:N,onChange:I,onBlur:T,className:`${o} ${(()=>{switch(v){case"none":return"resize-none";case"horizontal":return"resize-x";case"vertical":default:return"resize-y";case"both":return"resize"}})()} ${k?"border-blue-300":""}`,placeholder:i,required:c,disabled:d,maxLength:u,minLength:m,rows:x,cols:g,autoComplete:h,autoFocus:p,readOnly:f,id:b,name:y,...j}),P]})},At=()=>{const{currentUser:e}=bt(),t=(()=>{const t=localStorage.getItem("accessToken");if(t){const e=(e=>{try{const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}catch(i){return console.error("JWT\u30c7\u30b3\u30fc\u30c9\u30a8\u30e9\u30fc:",i),null}})(t);if(e&&e.role)return 4===e.role?5:e.role}return null===e||void 0===e?void 0:e.role})(),n=t>=5,[s,a]=(0,r.useState)([]),[l,o]=(0,r.useState)(!0),[i,c]=(0,r.useState)(null),[d,u]=(0,r.useState)([]),[m,x]=(0,r.useState)([]),[g,h]=(0,r.useState)(!1),[p,f]=(0,r.useState)(!1),[b,y]=(0,r.useState)(!1),[v,j]=(0,r.useState)(null),[N,w]=(0,r.useState)(!1),[k,S]=(0,r.useState)(""),[_,C]=(0,r.useState)(""),[I,T]=(0,r.useState)("all"),[P,L]=(0,r.useState)("all"),[E,D]=(0,r.useState)(!1),[A,$]=(0,r.useState)({}),[z,O]=(0,r.useState)(null),[R,M]=(0,r.useState)({name:"",username:"",email:"",department:"",company_id:"",facilityLocationIds:[],managerSettings:{},password:""}),[F,U]=(0,r.useState)({isChecking:!1,isValid:null,message:"",suggestions:[]}),B=async e=>{if(e&&""!==e.trim()){U(e=>({...e,isChecking:!0}));try{const n=await He(`/api/username/check/${encodeURIComponent(e)}`);if(n.success){if(U({isChecking:!1,isValid:n.available,message:n.message,suggestions:[]}),!n.available)try{const t=await He(`/api/username/suggestions/${encodeURIComponent(e)}`);t.success&&t.suggestions.length>0&&U(e=>({...e,suggestions:t.suggestions}))}catch(t){console.error("\u5019\u88dc\u53d6\u5f97\u30a8\u30e9\u30fc:",t)}}else U({isChecking:!1,isValid:!1,message:n.message||"\u30ed\u30b0\u30a4\u30f3ID\u306e\u30c1\u30a7\u30c3\u30af\u306b\u5931\u6557\u3057\u307e\u3057\u305f",suggestions:[]})}catch(i){console.error("username\u91cd\u8907\u30c1\u30a7\u30c3\u30af\u30a8\u30e9\u30fc:",i),U({isChecking:!1,isValid:!1,message:"\u30ed\u30b0\u30a4\u30f3ID\u306e\u30c1\u30a7\u30c3\u30af\u306b\u5931\u6557\u3057\u307e\u3057\u305f",suggestions:[]})}}else U({isChecking:!1,isValid:null,message:"",suggestions:[]})},[J,q]=(0,r.useState)(null),V=async()=>{try{console.log("\u62e0\u70b9\u4e00\u89a7\u3092\u53d6\u5f97\u4e2d...");const e=await He("/api/satellites");console.log("\u62e0\u70b9\u30c7\u30fc\u30bf:",e);const t=e.success?e.data:[];if(!Array.isArray(t))return console.warn("\u62e0\u70b9\u30c7\u30fc\u30bf\u304c\u914d\u5217\u3067\u306f\u3042\u308a\u307e\u305b\u3093:",t),void u([]);const n=t.map(e=>({id:e.id.toString(),name:e.name,company_id:e.company_id,organizationName:e.company_name||"",type:e.office_type_name||"\u672a\u5206\u985e",address:e.address||"",managerIds:e.manager_ids?Array.isArray(e.manager_ids)?e.manager_ids:JSON.parse(e.manager_ids):[]}));console.log("\u62e0\u70b9\u30c7\u30fc\u30bf\u5909\u63db\u5f8c:",n),u(n);const s={};n.forEach(e=>{e.managerIds&&e.managerIds.length>0?s[e.id]=e.managerIds:s[e.id]=[]}),console.log("\u7ba1\u7406\u8005\u30de\u30c3\u30d7:",s),$(s)}catch(i){console.error("\u62e0\u70b9\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",i),u([])}},H=async()=>{try{console.log("=== \u6307\u5c0e\u54e1\u4e00\u89a7\u53d6\u5f97\u958b\u59cb ==="),console.log("apiGet \u3092\u547c\u3073\u51fa\u3057\u307e\u3059: /api/users");const e=await He("/api/users");if(console.log("API\u30ec\u30b9\u30dd\u30f3\u30b9\u53d6\u5f97\u6210\u529f"),console.log("\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf\u306e\u578b:",typeof e),console.log("\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf\u304c\u914d\u5217\u304b:",Array.isArray(e)),console.log("\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf\u306e\u9577\u3055:",Array.isArray(e)?e.length:"\u914d\u5217\u3067\u306f\u3042\u308a\u307e\u305b\u3093"),console.log("\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf:",e),!Array.isArray(e))return console.warn("API\u304b\u3089\u914d\u5217\u304c\u8fd4\u3055\u308c\u307e\u305b\u3093\u3067\u3057\u305f:",e),void a([]);console.log("\u5168\u30e6\u30fc\u30b6\u30fc\u306e\u30ed\u30fc\u30eb\u78ba\u8a8d:"),e.forEach((e,t)=>{console.log(`\u30e6\u30fc\u30b6\u30fc${t+1}: ID=${e.id}, \u540d\u524d=${e.name}, \u30ed\u30fc\u30eb=${e.role}, \u30ed\u30fc\u30eb\u578b=${typeof e.role}`)});const t=e.filter(e=>{const t=e.role>=4&&e.role<=5;return console.log(`\u30e6\u30fc\u30b6\u30fc ${e.name} (ID: ${e.id}): \u30ed\u30fc\u30eb=${e.role}, \u6307\u5c0e\u54e1\u5224\u5b9a=${t}`),t});if(console.log("\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u5f8c\u306e\u6307\u5c0e\u54e1\u30e6\u30fc\u30b6\u30fc:",t),console.log("\u6307\u5c0e\u54e1\u30e6\u30fc\u30b6\u30fc\u6570:",t.length),console.log("\u6307\u5c0e\u54e1\u30e6\u30fc\u30b6\u30fc\u306e\u8a73\u7d30:",t.map(e=>({id:e.id,name:e.name,username:e.username,role:e.role,email:e.email}))),0===t.length)return console.log("\u6307\u5c0e\u54e1\u30e6\u30fc\u30b6\u30fc\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002\u65b0\u898f\u767b\u9332\u3067\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),void a([]);const n=await Promise.all(t.map(async e=>{try{const t=await He(`/api/instructors/${e.id}/specializations`);let n=[],s=[];if(e.satellite_details&&Array.isArray(e.satellite_details))n=e.satellite_details.map(e=>e.name).filter(e=>e),s=e.satellite_details.map(e=>e.id.toString());else if(e.satellite_ids)try{const t=Array.isArray(e.satellite_ids)?e.satellite_ids:JSON.parse(e.satellite_ids);s=t.map(e=>e.toString()),n=t.map(e=>{const t=d.find(t=>t.id===e.toString());return t?t.name:`\u62e0\u70b9${e}`})}catch(Yc){console.error("\u62e0\u70b9ID\u51e6\u7406\u30a8\u30e9\u30fc:",Yc)}return{id:e.id.toString(),name:e.name,username:e.username||"",email:e.email||"",department:t.success&&t.data.length>0?t.data[0].specialization:"",facilityLocationIds:s,facilityLocationNames:n,status:1===e.status?"active":"inactive",lastLogin:e.last_login_at?new Date(e.last_login_at).toLocaleDateString("ja-JP"):"-",passwordResetRequired:1===e.password_reset_required,specializations:t.success?t.data:[]}}catch(i){console.error(`\u6307\u5c0e\u54e1${e.id}\u306e\u5c02\u9580\u5206\u91ce\u53d6\u5f97\u30a8\u30e9\u30fc:`,i);let n=[],s=[];if(e.satellite_details&&Array.isArray(e.satellite_details))n=e.satellite_details.map(e=>e.name).filter(e=>e),s=e.satellite_details.map(e=>e.id.toString());else if(e.satellite_ids)try{const t=Array.isArray(e.satellite_ids)?e.satellite_ids:JSON.parse(e.satellite_ids),r=Array.isArray(t)?t:[t];s=r.map(e=>e.toString()),n=r.map(e=>{const t=d.find(t=>t.id===e.toString());return t?t.name:`\u62e0\u70b9${e}`})}catch(Yc){console.error("\u62e0\u70b9ID\u51e6\u7406\u30a8\u30e9\u30fc:",Yc)}return{id:e.id.toString(),name:e.name,username:e.username||"",email:e.email||"",department:"",facilityLocationIds:s,facilityLocationNames:n,status:1===e.status?"active":"inactive",lastLogin:e.last_login_at?new Date(e.last_login_at).toLocaleDateString("ja-JP"):"-",passwordResetRequired:1===e.password_reset_required,specializations:[]}}}));console.log("\u6700\u7d42\u7684\u306ainstructors\u30c7\u30fc\u30bf:",n.map(e=>({id:e.id,name:e.name,username:e.username}))),a(n)}catch(i){console.error("\u6307\u5c0e\u54e1\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",i),a([])}};(0,r.useEffect)(()=>{console.log("InstructorManagement useEffect \u304c\u5b9f\u884c\u3055\u308c\u307e\u3057\u305f");(async()=>{console.log("loadData \u95a2\u6570\u304c\u958b\u59cb\u3055\u308c\u307e\u3057\u305f"),o(!0),c(null);try{console.log("fetchCompanies \u3092\u547c\u3073\u51fa\u3057\u307e\u3059"),await(async()=>{try{console.log("=== \u4f01\u696d\u4e00\u89a7\u53d6\u5f97\u958b\u59cb ===");const e=await He("/api/companies");console.log("\u4f01\u696dAPI\u30ec\u30b9\u30dd\u30f3\u30b9:",e),console.log("\u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u578b:",typeof e),console.log("\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u914d\u5217\u304b:",Array.isArray(e));let t=[];e&&e.success&&e.data?(console.log("\u30d1\u30bf\u30fc\u30f31: response.success && response.data"),t=e.data):Array.isArray(e)?(console.log("\u30d1\u30bf\u30fc\u30f32: response\u304c\u914d\u5217"),t=e):e&&Array.isArray(e.data)?(console.log("\u30d1\u30bf\u30fc\u30f33: response.data\u304c\u914d\u5217"),t=e.data):(console.log("\u30d1\u30bf\u30fc\u30f34: \u8a72\u5f53\u306a\u3057\u3001\u7a7a\u914d\u5217\u3092\u8a2d\u5b9a"),t=[]),console.log("\u51e6\u7406\u5f8c\u306e\u4f01\u696d\u30c7\u30fc\u30bf:",t),console.log("\u4f01\u696d\u30c7\u30fc\u30bf\u4ef6\u6570:",t.length),x(t),console.log("=== \u4f01\u696d\u4e00\u89a7\u53d6\u5f97\u5b8c\u4e86 ===")}catch(i){console.error("\u4f01\u696d\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",i),x([])}})(),console.log("fetchFacilityLocations \u3092\u547c\u3073\u51fa\u3057\u307e\u3059"),await V(),console.log("fetchInstructors \u3092\u547c\u3073\u51fa\u3057\u307e\u3059"),await H()}catch(i){console.error("\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u30a8\u30e9\u30fc:",i),console.log("\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u304c\u3001\u51e6\u7406\u3092\u7d9a\u884c\u3057\u307e\u3059\u3002")}finally{o(!1)}})()},[]);const W=()=>s.filter(e=>{const t=e.name.toLowerCase().includes(_.toLowerCase())||e.email.toLowerCase().includes(_.toLowerCase())||e.department.toLowerCase().includes(_.toLowerCase()),n="all"===I||e.facilityLocationIds.includes(I),s="all"===P||e.status===P,r=!E||0===e.facilityLocationIds.length;return t&&n&&s&&r}),Q=async e=>{if(v)try{if("issue_temp_password"===e){const e=await We(`/api/users/${v.id}/reset-password`,{action:"issue_temp_password"});e.success?(S(e.data.tempPassword),w(!0),y(!1)):alert(`\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${e.message}`)}else if("require_password_change"===e){const e=await We(`/api/users/${v.id}/reset-password`,{action:"require_password_change"});e.success?(alert("\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u8981\u6c42\u304c\u9001\u4fe1\u3055\u308c\u307e\u3057\u305f\u3002"),y(!1)):alert(`\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u8981\u6c42\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${e.message}`)}await H()}catch(i){console.error("\u30d1\u30b9\u30ef\u30fc\u30c9\u30ea\u30bb\u30c3\u30c8\u30a8\u30e9\u30fc:",i),alert(`\u30d1\u30b9\u30ef\u30fc\u30c9\u30ea\u30bb\u30c3\u30c8\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${i.message}`)}},K=e=>{const{name:t,value:n}=e.target;if("username"===t){J&&clearTimeout(J);const e=setTimeout(()=>{B(n)},500);q(e)}M(e=>{const s={...e,[t]:n};return"company_id"===t&&(s.facilityLocationIds=[],s.managerSettings={}),s})},[Y,G]=(0,r.useState)({key:"name",direction:"asc"}),Z=e=>{let t="asc";Y.key===e&&"asc"===Y.direction&&(t="desc"),G({key:e,direction:t})},X=()=>[...W()].sort((e,t)=>{let n=e[Y.key],s=t[Y.key];return"status"===Y.key&&(n=ee(n),s=ee(s)),n<s?"asc"===Y.direction?-1:1:n>s?"asc"===Y.direction?1:-1:0}),ee=e=>"active"===e?"\u30a2\u30af\u30c6\u30a3\u30d6":"\u975e\u30a2\u30af\u30c6\u30a3\u30d6",te=e=>{const{name:t,value:n}=e.target;if("username"===t){J&&clearTimeout(J);const e=setTimeout(()=>{B(n)},500);q(e)}j(e=>({...e,[t]:n}))},ne=(e,t)=>{const n=A[t],s=n&&n.includes(Number(e));return console.log(`isSatelliteManager(${e}, ${t}):`,{managerIds:n,instructorId:Number(e),result:s}),s};return l?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 p-6 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]})}):i?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 p-6 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center max-w-md",children:[(0,pt.jsx)("div",{className:"text-red-500 text-4xl mb-4",children:"\u26a0\ufe0f"}),(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}),(0,pt.jsx)("p",{className:"text-gray-600 mb-4",children:i}),(0,pt.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-semibold hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200",children:"\u518d\u8aad\u307f\u8fbc\u307f"})]})}):n?(0,pt.jsxs)("div",{className:"p-6",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-8 pb-4 border-b-2 border-gray-200",children:[(0,pt.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"\u6307\u5c0e\u54e1\u7ba1\u7406"}),(0,pt.jsx)("button",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 hover:-translate-y-0.5 shadow-lg hover:shadow-xl",onClick:()=>h(!0),children:"+ \u65b0\u3057\u3044\u6307\u5c0e\u54e1\u3092\u8ffd\u52a0"})]}),(0,pt.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6 mb-6 shadow-sm",children:[(0,pt.jsx)("div",{className:"mb-4",children:(0,pt.jsx)("input",{type:"text",placeholder:"\u6307\u5c0e\u54e1\u540d\u3001\u30e1\u30fc\u30eb\u3001\u5c02\u9580\u5206\u91ce\u3067\u691c\u7d22...",value:_,onChange:e=>C(e.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})}),(0,pt.jsxs)("div",{className:"flex flex-wrap gap-6 items-end mb-4",children:[(0,pt.jsxs)("div",{className:"flex flex-col min-w-[150px]",children:[(0,pt.jsx)("label",{className:"font-semibold text-gray-700 mb-2 text-sm",children:"\u4e8b\u696d\u6240(\u62e0\u70b9):"}),(0,pt.jsxs)("select",{value:I,onChange:e=>{T(e.target.value)},className:"px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300",children:[(0,pt.jsx)("option",{value:"all",children:"\u5168\u3066\u306e\u4e8b\u696d\u6240(\u62e0\u70b9)"}),d.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,pt.jsxs)("div",{className:"flex flex-col min-w-[150px]",children:[(0,pt.jsx)("label",{className:"font-semibold text-gray-700 mb-2 text-sm",children:"\u30b9\u30c6\u30fc\u30bf\u30b9:"}),(0,pt.jsxs)("select",{value:P,onChange:e=>L(e.target.value),className:"px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300",children:[(0,pt.jsx)("option",{value:"all",children:"\u5168\u3066"}),(0,pt.jsx)("option",{value:"active",children:"\u30a2\u30af\u30c6\u30a3\u30d6"}),(0,pt.jsx)("option",{value:"inactive",children:"\u975e\u30a2\u30af\u30c6\u30a3\u30d6"})]})]}),(0,pt.jsx)("button",{className:"bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-300 hover:bg-gray-700",onClick:()=>{C(""),T("all"),D(!1),L("all")},children:"\u30d5\u30a3\u30eb\u30bf\u30fc\u30af\u30ea\u30a2"})]}),(0,pt.jsx)("div",{className:"flex items-center gap-4 mb-4",children:(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("input",{type:"checkbox",id:"showNoLocationFilter",checked:E,onChange:e=>D(e.target.checked),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,pt.jsx)("label",{htmlFor:"showNoLocationFilter",className:"font-semibold text-gray-700 text-sm cursor-pointer",children:"\u62e0\u70b9\u672a\u8a2d\u5b9a\u306e\u6307\u5c0e\u54e1\u306e\u307f\u8868\u793a"})]})}),(0,pt.jsxs)("div",{className:"font-semibold text-gray-700 text-sm",children:["\u8868\u793a\u4e2d: ",W().length,"\u540d / \u5168",s.length,"\u540d"]})]}),(0,pt.jsxs)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden mb-8",children:[(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"w-full",children:[(0,pt.jsx)("thead",{className:"bg-red-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>Z("name"),children:["\ud83d\udc64 \u6307\u5c0e\u54e1\u540d","name"===Y.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===Y.direction?" \u2191":" \u2193"})]}),(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>Z("username"),children:["\ud83d\udd11 \u30e6\u30fc\u30b6ID","username"===Y.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===Y.direction?" \u2191":" \u2193"})]}),(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>Z("email"),children:["\ud83d\udce7 \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9","email"===Y.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===Y.direction?" \u2191":" \u2193"})]}),(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>Z("department"),children:["\ud83c\udfaf \u5c02\u9580\u5206\u91ce","department"===Y.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===Y.direction?" \u2191":" \u2193"})]}),(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>Z("facilityLocationNames"),children:["\ud83c\udfe2 \u4e8b\u696d\u6240(\u62e0\u70b9)","facilityLocationNames"===Y.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===Y.direction?" \u2191":" \u2193"})]}),(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>Z("status"),children:["\ud83d\udcca \u30b9\u30c6\u30fc\u30bf\u30b9","status"===Y.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===Y.direction?" \u2191":" \u2193"})]}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\ud83d\udd10 \u30d1\u30b9\u30ef\u30fc\u30c9"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\u2699\ufe0f \u64cd\u4f5c"})]})}),(0,pt.jsx)("tbody",{children:X().map((e,t)=>(0,pt.jsxs)("tr",{className:`border-b border-gray-100 hover:bg-gray-50 transition-colors duration-200 ${t%2===0?"bg-white":"bg-gray-50"} ${0===e.facilityLocationIds.length?"bg-yellow-50 hover:bg-yellow-100":""}`,children:[(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsx)("div",{className:"flex items-center",children:(0,pt.jsxs)("div",{children:[(0,pt.jsx)("strong",{className:"text-gray-800",children:e.name}),e.facilityLocationIds.some(t=>ne(e.id,t))&&(0,pt.jsx)("div",{className:"mt-1",children:(0,pt.jsx)("span",{className:"bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-semibold",children:"\ud83d\udc51 \u62e0\u70b9\u7ba1\u7406\u8005"})})]})})}),(0,pt.jsx)("td",{className:"px-6 py-4 text-gray-600",children:(0,pt.jsx)("code",{className:"bg-gray-100 px-2 py-1 rounded text-sm font-mono",children:e.username||"-"})}),(0,pt.jsxs)("td",{className:"px-6 py-4 text-gray-600",children:["\ud83d\udce7 ",e.email]}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsx)("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:e.department})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:e.facilityLocationNames&&e.facilityLocationNames.length>0?(0,pt.jsx)("div",{className:"space-y-1",children:e.facilityLocationNames.map((t,n)=>{const s=e.facilityLocationIds[n],r=ne(e.id,s);return(0,pt.jsxs)("div",{className:"flex flex-col",children:[(0,pt.jsxs)("span",{className:"px-2 py-1 rounded-full text-xs font-medium block "+(r?"bg-yellow-100 text-yellow-800":"bg-green-100 text-green-800"),children:[r&&"\ud83d\udc51 ",t]}),r&&(0,pt.jsx)("span",{className:"text-xs text-gray-500 mt-1",children:"(\u7ba1\u7406\u8005)"})]},n)})}):(0,pt.jsx)("span",{className:"bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium",children:"\u26a0\ufe0f \u62e0\u70b9\u672a\u8a2d\u5b9a"})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold "+("active"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:ee(e.status)})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:e.passwordResetRequired?(0,pt.jsx)("span",{className:"bg-red-100 text-red-800 px-3 py-1 rounded-full text-xs font-semibold",children:"\u26a0\ufe0f \u5909\u66f4\u8981\u6c42"}):(0,pt.jsx)("span",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-semibold",children:"\u2705 \u6b63\u5e38"})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("button",{className:"bg-orange-500 text-white px-3 py-1 rounded text-sm font-medium transition-colors duration-300 hover:bg-orange-600",onClick:()=>(e=>{j(e),y(!0)})(e),title:"\u30d1\u30b9\u30ef\u30fc\u30c9\u30ea\u30bb\u30c3\u30c8",children:"\ud83d\udd11 \u30ea\u30bb\u30c3\u30c8"}),(0,pt.jsx)("button",{className:"bg-blue-500 text-white px-3 py-1 rounded text-sm font-medium transition-colors duration-300 hover:bg-blue-600",onClick:()=>(e=>{const t={};e.facilityLocationIds.forEach(n=>{t[n]=ne(e.id,n)}),j({...e,username:e.username||"",isManager:t}),f(!0)})(e),title:"\u7de8\u96c6",children:"\u270f\ufe0f \u7de8\u96c6"}),e.facilityLocationIds.length>0&&(0,pt.jsx)("button",{className:"px-3 py-1 rounded text-sm font-medium transition-colors duration-300 "+(e.facilityLocationIds.some(t=>ne(e.id,t))?"bg-red-500 text-white hover:bg-red-600":"bg-yellow-500 text-white hover:bg-yellow-600"),onClick:()=>(async e=>{const t=e.facilityLocationIds.some(t=>ne(e.id,t)),n=t?"\u89e3\u9664":"\u8a2d\u5b9a";if(window.confirm(`\u6307\u5c0e\u54e1\u300c${e.name}\u300d\u306e\u7ba1\u7406\u8005\u6a29\u9650\u3092${n}\u3057\u307e\u3059\u304b\uff1f`))try{for(const n of e.facilityLocationIds){const s=A[n]||[],r=s.includes(Number(e.id));if(t&&r)await Ke(`/api/satellites/${n}/managers/${e.id}`),$(t=>({...t,[n]:s.filter(t=>t!==Number(e.id))}));else if(!t&&!r){const t=[...s,Number(e.id)];await Qe(`/api/satellites/${n}/managers`,{manager_ids:t}),$(e=>({...e,[n]:t}))}}await H(),alert(`\u7ba1\u7406\u8005\u6a29\u9650\u3092${n}\u3057\u307e\u3057\u305f\u3002`)}catch(i){console.error("\u7ba1\u7406\u8005\u6a29\u9650\u5207\u308a\u66ff\u3048\u30a8\u30e9\u30fc:",i),alert(`\u7ba1\u7406\u8005\u6a29\u9650\u306e${n}\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${i.message}`)}})(e),title:e.facilityLocationIds.some(t=>ne(e.id,t))?"\u7ba1\u7406\u8005\u6a29\u9650\u3092\u89e3\u9664":"\u7ba1\u7406\u8005\u6a29\u9650\u3092\u4ed8\u4e0e",children:e.facilityLocationIds.some(t=>ne(e.id,t))?"\ud83d\udc51 \u7ba1\u7406\u8005\u89e3\u9664":"\ud83d\udc51 \u7ba1\u7406\u8005\u8a2d\u5b9a"}),(0,pt.jsx)("button",{className:"bg-red-500 text-white px-3 py-1 rounded text-sm font-medium transition-colors duration-300 hover:bg-red-600",onClick:()=>(async e=>{if(window.confirm(`\u6307\u5c0e\u54e1\u300c${e.name}\u300d\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f\n\u3053\u306e\u64cd\u4f5c\u306f\u53d6\u308a\u6d88\u305b\u307e\u305b\u3093\u3002`))try{const t=await Ve(`/api/users/${e.id}`,{method:"DELETE"});if(t.success){for(const t of e.facilityLocationIds){const n=A[t]||[];if(n.includes(Number(e.id))){const s=n.filter(t=>t!==Number(e.id));await Qe(`/api/satellites/${t}/managers`,{manager_ids:s}),$(e=>({...e,[t]:s}))}}await H(),alert("\u6307\u5c0e\u54e1\u3092\u524a\u9664\u3057\u307e\u3057\u305f\u3002")}else alert(`\u6307\u5c0e\u54e1\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${t.message}`)}catch(i){console.error("\u6307\u5c0e\u54e1\u524a\u9664\u30a8\u30e9\u30fc:",i),alert(`\u6307\u5c0e\u54e1\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${i.message}`)}})(e),title:"\u524a\u9664",children:"\ud83d\uddd1\ufe0f \u524a\u9664"})]})})]},e.id))})]})}),0===X().length&&(0,pt.jsx)("div",{className:"text-center py-12",children:(0,pt.jsx)("p",{className:"text-gray-500 text-lg",children:0===s.length?"\u6307\u5c0e\u54e1\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u300c+ \u65b0\u3057\u3044\u6307\u5c0e\u54e1\u3092\u8ffd\u52a0\u300d\u30dc\u30bf\u30f3\u304b\u3089\u6307\u5c0e\u54e1\u3092\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002":"\u6761\u4ef6\u306b\u5408\u81f4\u3059\u308b\u6307\u5c0e\u54e1\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002"})})]}),b&&v&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-2xl mx-4",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsxs)("h3",{className:"text-xl font-bold text-gray-800",children:["\u30d1\u30b9\u30ef\u30fc\u30c9\u7ba1\u7406 - ",v.name]}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold transition-colors duration-200",onClick:()=>y(!1),children:"\xd7"})]}),(0,pt.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-3",children:"\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c"}),(0,pt.jsx)("p",{className:"text-gray-600 text-sm mb-4",children:"\u65b0\u3057\u3044\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u767a\u884c\u3057\u307e\u3059\u3002\u6307\u5c0e\u54e1\u306f\u6b21\u56de\u30ed\u30b0\u30a4\u30f3\u6642\u306b\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"}),(0,pt.jsx)("button",{className:"bg-blue-500 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-300 hover:bg-blue-600",onClick:()=>Q("issue_temp_password"),children:"\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u767a\u884c"})]}),(0,pt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-3",children:"\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u8981\u6c42"}),(0,pt.jsx)("p",{className:"text-gray-600 text-sm mb-4",children:"\u6307\u5c0e\u54e1\u306b\u6b21\u56de\u30ed\u30b0\u30a4\u30f3\u6642\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u3092\u8981\u6c42\u3057\u307e\u3059\u3002\u73fe\u5728\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u7121\u52b9\u306b\u306a\u308a\u307e\u305b\u3093\u3002"}),(0,pt.jsx)("button",{className:"bg-orange-500 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-300 hover:bg-orange-600",onClick:()=>Q("require_password_change"),children:"\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u3092\u8981\u6c42"})]})]}),(0,pt.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[(0,pt.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:"\u73fe\u5728\u306e\u72b6\u6cc1"}),(0,pt.jsxs)("p",{className:"text-blue-700 text-sm",children:["\u30d1\u30b9\u30ef\u30fc\u30c9\u30ea\u30bb\u30c3\u30c8\u8981\u6c42: ",v.passwordResetRequired?"\u3042\u308a":"\u306a\u3057"]})]})]})}),N&&v&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsx)("div",{className:"bg-white rounded-xl p-6 w-full max-w-md mx-4",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u5b8c\u4e86"}),(0,pt.jsxs)("p",{className:"text-gray-600 mb-6",children:["\u6307\u5c0e\u54e1 ",(0,pt.jsx)("strong",{children:v.name})," \u306e\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u767a\u884c\u3057\u307e\u3057\u305f\u3002"]}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9:"}),(0,pt.jsxs)("div",{className:"relative",children:[(0,pt.jsx)("input",{type:"text",value:k,readOnly:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg bg-gray-50 font-mono text-lg text-center"}),(0,pt.jsx)("button",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 bg-gray-200 hover:bg-gray-300 p-2 rounded transition-colors duration-200",onClick:async()=>{try{await navigator.clipboard.writeText(k),alert("\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f\uff01")}catch(i){console.error("\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u306e\u30b3\u30d4\u30fc\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",i),alert("\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u306e\u30b3\u30d4\u30fc\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u624b\u52d5\u3067\u30b3\u30d4\u30fc\u3057\u3066\u304f\u3060\u3055\u3044\u3002")}},title:"\u30b3\u30d4\u30fc",children:"\ud83d\udccb"})]})]}),(0,pt.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:(0,pt.jsxs)("p",{className:"text-yellow-800 text-sm",children:[(0,pt.jsx)("strong",{children:"\u6ce8\u610f:"})," \u3053\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u4e00\u5ea6\u3060\u3051\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u6307\u5c0e\u54e1\u306b\u5b89\u5168\u306b\u4f1d\u9054\u3057\u3066\u304f\u3060\u3055\u3044\u3002"]})}),(0,pt.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,pt.jsx)("button",{className:"bg-blue-500 text-white px-6 py-2 rounded-lg font-medium transition-colors duration-300 hover:bg-blue-600",onClick:async()=>{try{await navigator.clipboard.writeText(k),alert("\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f\uff01"),w(!1),j(null)}catch(i){console.error("\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u306e\u30b3\u30d4\u30fc\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",i),alert("\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u306e\u30b3\u30d4\u30fc\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u624b\u52d5\u3067\u30b3\u30d4\u30fc\u3057\u3066\u304f\u3060\u3055\u3044\u3002")}},children:"\u30b3\u30d4\u30fc\u3057\u3066\u9589\u3058\u308b"}),(0,pt.jsx)("button",{className:"bg-gray-500 text-white px-6 py-2 rounded-lg font-medium transition-colors duration-300 hover:bg-gray-600",onClick:()=>{w(!1),j(null)},children:"\u9589\u3058\u308b"})]})]})})}),g&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl w-full max-w-md max-h-[90vh] flex flex-col",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u65b0\u3057\u3044\u6307\u5c0e\u54e1\u3092\u8ffd\u52a0"}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold transition-colors duration-200",onClick:()=>{h(!1),O(null)},children:"\xd7"})]}),(0,pt.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,pt.jsx)(Lt,{error:z,onClose:()=>O(null)}),(0,pt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),R.username)if(/^[a-zA-Z0-9_/.-]+$/.test(R.username))if(R.company_id)if(0!==R.facilityLocationIds.length)try{const e={name:R.name,username:R.username,password:R.password,role:4,status:1,login_code:(()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=()=>{let t="";for(let n=0;n<4;n++)t+=e.charAt(Math.floor(62*Math.random()));return t};return`${t()}-${t()}-${t()}`})(),company_id:R.company_id,satellite_ids:R.facilityLocationIds,email:R.email};console.log("=== \u6307\u5c0e\u54e1\u8ffd\u52a0API\u547c\u3073\u51fa\u3057 ==="),console.log("\u9001\u4fe1\u30c7\u30fc\u30bf:",e);const t=await We("/api/users/create",e);console.log("API\u30ec\u30b9\u30dd\u30f3\u30b9:",t);const n=Object.keys(R.managerSettings).filter(e=>R.managerSettings[e]).map(e=>parseInt(e));if(n.length>0)for(const s of n){const e=A[s]||[],n=[...e,t.data.id];console.log("\u65b0\u898f\u6307\u5c0e\u54e1\u8ffd\u52a0\u6642\u306e\u7ba1\u7406\u8005\u8a2d\u5b9a:",{satelliteId:s,currentManagers:e,newInstructorId:t.data.id,updatedManagers:n}),await Qe(`/api/satellites/${s}/managers`,{manager_ids:n}),$(e=>({...e,[s]:n}))}R.department&&await We(`/api/instructors/${t.data.id}/specializations`,{specializations:[R.department]}),await H(),await V(),M({name:"",username:"",email:"",department:"",company_id:"",facilityLocationIds:[],managerSettings:{},password:""}),U({isChecking:!1,isValid:null,message:"",suggestions:[]}),h(!1),O(null),alert("\u6307\u5c0e\u54e1\u304c\u6b63\u5e38\u306b\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002")}catch(i){console.error("\u6307\u5c0e\u54e1\u8ffd\u52a0\u30a8\u30e9\u30fc:",i),O(`\u6307\u5c0e\u54e1\u306e\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${i.message}`)}else alert("\u5c11\u306a\u304f\u3068\u30821\u3064\u306e\u62e0\u70b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002");else alert("\u4f01\u696d\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002");else alert("\u30ed\u30b0\u30a4\u30f3ID\u306f\u534a\u89d2\u82f1\u6570\u5b57\u3001\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2\u3001\u30cf\u30a4\u30d5\u30f3\u3001\u30b9\u30e9\u30c3\u30b7\u30e5\u3001\u30c9\u30c3\u30c8\u306e\u307f\u4f7f\u7528\u53ef\u80fd\u3067\u3059\u3002");else alert("\u30ed\u30b0\u30a4\u30f3ID\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002")},className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u6307\u5c0e\u54e1\u540d:"}),(0,pt.jsx)("input",{type:"text",name:"name",value:R.name,onChange:K,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u30e6\u30fc\u30b6ID: ",(0,pt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,pt.jsxs)("div",{className:"relative",children:[(0,pt.jsx)("input",{type:"text",name:"username",value:R.username,onChange:K,required:!0,pattern:"[a-zA-Z0-9_/.-]+",title:"\u534a\u89d2\u82f1\u6570\u5b57\u3001\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2\u3001\u30cf\u30a4\u30d5\u30f3\u3001\u30b9\u30e9\u30c3\u30b7\u30e5\u3001\u30c9\u30c3\u30c8\u306e\u307f\u4f7f\u7528\u53ef\u80fd\u3067\u3059",placeholder:"\u4f8b: instructor001",className:"w-full px-4 py-3 border-2 rounded-lg focus:outline-none transition-colors duration-300 "+(!0===F.isValid?"border-green-400 focus:border-green-500":!1===F.isValid?"border-red-400 focus:border-red-500":"border-gray-200 focus:border-indigo-400")}),F.isChecking&&(0,pt.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,pt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-indigo-500"})}),!0===F.isValid&&!F.isChecking&&(0,pt.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,pt.jsx)("svg",{className:"h-4 w-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),!1===F.isValid&&!F.isChecking&&(0,pt.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,pt.jsx)("svg",{className:"h-4 w-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,pt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\u4f7f\u7528\u53ef\u80fd\u6587\u5b57: \u534a\u89d2\u82f1\u6570\u5b57\u3001\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2(_)\u3001\u30cf\u30a4\u30d5\u30f3(-)\u3001\u30b9\u30e9\u30c3\u30b7\u30e5(/)\u3001\u30c9\u30c3\u30c8(.)"}),F.message&&(0,pt.jsx)("div",{className:"mt-2 text-sm "+(!0===F.isValid?"text-green-600":!1===F.isValid?"text-red-600":"text-gray-600"),children:F.message}),F.suggestions.length>0&&(0,pt.jsxs)("div",{className:"mt-2",children:[(0,pt.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"\u5229\u7528\u53ef\u80fd\u306a\u5019\u88dc:"}),(0,pt.jsx)("div",{className:"flex flex-wrap gap-2",children:F.suggestions.map((e,t)=>(0,pt.jsx)("button",{type:"button",onClick:()=>{M(t=>({...t,username:e})),B(e)},className:"px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200 transition-colors",children:e},t))})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9:"}),(0,pt.jsx)("input",{type:"email",name:"email",value:R.email,onChange:K,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u5c02\u9580\u5206\u91ce:"}),(0,pt.jsx)("input",{type:"text",name:"department",value:R.department,onChange:K,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u4f01\u696d: ",(0,pt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,pt.jsxs)("select",{name:"company_id",value:R.company_id,onChange:K,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300",children:[(0,pt.jsx)("option",{value:"",children:"\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),m&&m.length>0?m.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.name},e.id)):(0,pt.jsx)("option",{value:"",disabled:!0,children:"\u4f01\u696d\u30c7\u30fc\u30bf\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u307e\u305b\u3093"})]}),(0,pt.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["\u4f01\u696d\u6570: ",m?m.length:0]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u4e8b\u696d\u6240(\u62e0\u70b9): ",(0,pt.jsx)("span",{className:"text-red-500",children:"*"})]}),R.company_id?(0,pt.jsx)("div",{className:"max-h-40 overflow-y-auto border-2 border-gray-200 rounded-lg p-2",children:(R.company_id?d.filter(e=>e.company_id==R.company_id):[]).map(e=>(0,pt.jsxs)("div",{className:"p-2 hover:bg-gray-50 rounded",children:[(0,pt.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,pt.jsx)("input",{type:"checkbox",name:"facilityLocationIds",value:e.id,checked:R.facilityLocationIds.includes(e.id),onChange:e=>{const{value:t,checked:n}=e.target;M(e=>({...e,facilityLocationIds:n?[...e.facilityLocationIds,t]:e.facilityLocationIds.filter(e=>e!==t)}))},className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 mr-3"}),(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("div",{className:"font-medium text-gray-800",children:e.name}),(0,pt.jsxs)("div",{className:"text-xs text-gray-500",children:[e.organizationName," - ",e.type]})]})]}),R.facilityLocationIds.includes(e.id)&&(0,pt.jsx)("div",{className:"ml-7 mt-2",children:(0,pt.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,pt.jsx)("input",{type:"checkbox",checked:R.managerSettings[e.id]||!1,onChange:t=>{M(n=>({...n,managerSettings:{...n.managerSettings,[e.id]:t.target.checked}}))},className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 mr-2"}),(0,pt.jsx)("span",{className:"text-sm text-gray-600",children:"\u3053\u306e\u62e0\u70b9\u306e\u7ba1\u7406\u8005\u306b\u3059\u308b"})]})})]},e.id))}):(0,pt.jsx)("p",{className:"text-sm text-gray-500",children:"\u307e\u305a\u4f01\u696d\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),(0,pt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\u8907\u6570\u306e\u62e0\u70b9\u3092\u9078\u629e\u3067\u304d\u307e\u3059\uff08\u5fc5\u9808\uff09"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u521d\u671f\u30d1\u30b9\u30ef\u30fc\u30c9:"}),(0,pt.jsx)("input",{type:"password",name:"password",value:R.password,onChange:K,required:!0,minLength:"6",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"}),(0,pt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"6\u6587\u5b57\u4ee5\u4e0a\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"})]}),(0,pt.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,pt.jsx)("button",{type:"submit",className:"flex-1 bg-indigo-500 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-300 hover:bg-indigo-600",children:"\u8ffd\u52a0"}),(0,pt.jsx)("button",{type:"button",className:"flex-1 bg-gray-500 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-300 hover:bg-gray-600",onClick:()=>h(!1),children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})]})]})}),p&&v&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl w-full max-w-md max-h-[90vh] flex flex-col",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u6307\u5c0e\u54e1\u60c5\u5831\u3092\u7de8\u96c6"}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold transition-colors duration-200",onClick:()=>{f(!1),j(null)},children:"\xd7"})]}),(0,pt.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,pt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),v.username)if(/^[a-zA-Z0-9_/.-]+$/.test(v.username))try{await Qe(`/api/users/${v.id}`,{name:v.name,username:v.username,email:v.email,satellite_ids:v.facilityLocationIds}),v.department&&await We(`/api/instructors/${v.id}/specializations`,{specializations:[v.department]});for(const t of v.facilityLocationIds){const n=v.isManager[t]||!1;try{const s=await He(`/api/satellites/${t}`);if(!s.success){console.error(`\u62e0\u70b9${t}\u306e\u60c5\u5831\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f`);continue}const r=s.data;let a=[];if(r.manager_ids)if(console.log("manager_ids \u306e\u751f\u30c7\u30fc\u30bf:",r.manager_ids),console.log("manager_ids \u306e\u578b:",typeof r.manager_ids),console.log("manager_ids \u304c\u914d\u5217\u304b:",Array.isArray(r.manager_ids)),Array.isArray(r.manager_ids))a=r.manager_ids,console.log("\u65e2\u306b\u914d\u5217\u5f62\u5f0f\u3067\u3059:",a);else if("string"===typeof r.manager_ids)try{const e=JSON.parse(r.manager_ids);a=Array.isArray(e)?e:[e],console.log("\u6587\u5b57\u5217\u304b\u3089\u30d1\u30fc\u30b9\u6210\u529f:",a)}catch(e){console.error("\u7ba1\u7406\u8005ID\u306e\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",e),console.error("\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u305f\u30c7\u30fc\u30bf:",r.manager_ids),a=[]}else null!==r.manager_ids&&void 0!==r.manager_ids?(a=[r.manager_ids],console.log("\u305d\u306e\u4ed6\u306e\u578b\u3092\u914d\u5217\u306b\u5909\u63db:",a)):(a=[],console.log("null/undefined\u306e\u305f\u3081\u7a7a\u914d\u5217\u306b\u8a2d\u5b9a"));const l=a.includes(Number(v.id));if(n&&!l){const e=[...a,Number(v.id)];console.log(`\u62e0\u70b9${t}\u306e\u7ba1\u7406\u8005\u8a2d\u5b9a:`,{currentManagerIds:a,selectedInstructorId:v.id,updatedManagers:e,shouldBeManager:n,isCurrentlyManager:l}),await Qe(`/api/satellites/${t}/managers`,{manager_ids:e}),$(n=>({...n,[t]:e}))}else!n&&l&&(await Ke(`/api/satellites/${t}/managers/${v.id}`),$(e=>({...e,[t]:a.filter(e=>e!==Number(v.id))})))}catch(i){console.error(`\u62e0\u70b9${t}\u306e\u7ba1\u7406\u8005\u66f4\u65b0\u30a8\u30e9\u30fc:`,i)}}await H(),await V(),f(!1),j(null),alert("\u6307\u5c0e\u54e1\u60c5\u5831\u304c\u6b63\u5e38\u306b\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\u3002")}catch(i){console.error("\u6307\u5c0e\u54e1\u66f4\u65b0\u30a8\u30e9\u30fc:",i),alert(`\u6307\u5c0e\u54e1\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${i.message}`)}else alert("\u30ed\u30b0\u30a4\u30f3ID\u306f\u534a\u89d2\u82f1\u6570\u5b57\u3001\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2\u3001\u30cf\u30a4\u30d5\u30f3\u3001\u30b9\u30e9\u30c3\u30b7\u30e5\u3001\u30c9\u30c3\u30c8\u306e\u307f\u4f7f\u7528\u53ef\u80fd\u3067\u3059\u3002");else alert("\u30ed\u30b0\u30a4\u30f3ID\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002")},className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u6307\u5c0e\u54e1\u540d:"}),(0,pt.jsx)("input",{type:"text",name:"name",value:v.name,onChange:te,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u30e6\u30fc\u30b6ID: ",(0,pt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,pt.jsxs)("div",{className:"relative",children:[(0,pt.jsx)("input",{type:"text",name:"username",value:v.username,onChange:te,required:!0,pattern:"[a-zA-Z0-9_/.-]+",title:"\u534a\u89d2\u82f1\u6570\u5b57\u3001\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2\u3001\u30cf\u30a4\u30d5\u30f3\u3001\u30b9\u30e9\u30c3\u30b7\u30e5\u3001\u30c9\u30c3\u30c8\u306e\u307f\u4f7f\u7528\u53ef\u80fd\u3067\u3059",placeholder:"\u4f8b: instructor001",className:"w-full px-4 py-3 border-2 rounded-lg focus:outline-none transition-colors duration-300 "+(!0===F.isValid?"border-green-400 focus:border-green-500":!1===F.isValid?"border-red-400 focus:border-red-500":"border-gray-200 focus:border-indigo-400")}),F.isChecking&&(0,pt.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,pt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-indigo-500"})}),!0===F.isValid&&!F.isChecking&&(0,pt.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,pt.jsx)("svg",{className:"h-4 w-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),!1===F.isValid&&!F.isChecking&&(0,pt.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,pt.jsx)("svg",{className:"h-4 w-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,pt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\u4f7f\u7528\u53ef\u80fd\u6587\u5b57: \u534a\u89d2\u82f1\u6570\u5b57\u3001\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2(_)\u3001\u30cf\u30a4\u30d5\u30f3(-)\u3001\u30b9\u30e9\u30c3\u30b7\u30e5(/)\u3001\u30c9\u30c3\u30c8(.)"}),F.message&&(0,pt.jsx)("div",{className:"mt-2 text-sm "+(!0===F.isValid?"text-green-600":!1===F.isValid?"text-red-600":"text-gray-600"),children:F.message}),F.suggestions.length>0&&(0,pt.jsxs)("div",{className:"mt-2",children:[(0,pt.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"\u5229\u7528\u53ef\u80fd\u306a\u5019\u88dc:"}),(0,pt.jsx)("div",{className:"flex flex-wrap gap-2",children:F.suggestions.map((e,t)=>(0,pt.jsx)("button",{type:"button",onClick:()=>{j(t=>({...t,username:e})),B(e)},className:"px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200 transition-colors",children:e},t))})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9:"}),(0,pt.jsx)("input",{type:"email",name:"email",value:v.email,onChange:te,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u5c02\u9580\u5206\u91ce:"}),(0,pt.jsx)("input",{type:"text",name:"department",value:v.department,onChange:te,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4f01\u696d:"}),(0,pt.jsxs)("select",{name:"company_id",value:v.company_id,onChange:te,disabled:v.role>=4&&v.role<=5,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300 disabled:bg-gray-100 disabled:cursor-not-allowed",children:[(0,pt.jsx)("option",{value:"",children:"\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),m.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4e8b\u696d\u6240(\u62e0\u70b9):"}),(0,pt.jsx)("div",{className:"max-h-40 overflow-y-auto border-2 border-gray-200 rounded-lg p-2",children:d.map(e=>{const t=ne(v.id,e.id),n=v.facilityLocationIds.includes(e.id);return(0,pt.jsxs)("div",{className:"p-2 hover:bg-gray-50 rounded",children:[(0,pt.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,pt.jsx)("input",{type:"checkbox",name:"facilityLocationIds",value:e.id,checked:n,onChange:t=>{return n=e.id,s=t.target.checked,void j(e=>({...e,facilityLocationIds:s?[...e.facilityLocationIds,n]:e.facilityLocationIds.filter(e=>e!==n)}));var n,s},className:"w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500 mr-3"}),(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("div",{className:"font-medium text-gray-800",children:[t&&"\ud83d\udc51 ",e.name]}),(0,pt.jsxs)("div",{className:"text-xs text-gray-500",children:[e.organizationName," - ",e.type]})]})]}),n&&(0,pt.jsx)("div",{className:"mt-2 ml-7",children:(0,pt.jsxs)("label",{className:"flex items-center cursor-pointer",children:[(0,pt.jsx)("input",{type:"checkbox",checked:v.isManager[e.id]||!1,onChange:t=>{return n=e.id,s=t.target.checked,void j(e=>({...e,isManager:{...e.isManager,[n]:s}}));var n,s},className:"w-4 h-4 text-yellow-600 border-gray-300 rounded focus:ring-yellow-500 mr-2"}),(0,pt.jsx)("span",{className:"text-sm text-gray-700",children:"\ud83d\udc51 \u3053\u306e\u62e0\u70b9\u306e\u7ba1\u7406\u8005\u306b\u3059\u308b"})]})})]},e.id)})}),(0,pt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\ud83d\udc51 \u30de\u30fc\u30af\u306f\u62e0\u70b9\u7ba1\u7406\u8005\u3092\u793a\u3057\u307e\u3059"})]}),(0,pt.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,pt.jsx)("button",{type:"submit",className:"flex-1 bg-blue-500 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-300 hover:bg-blue-600",children:"\u66f4\u65b0"}),(0,pt.jsx)("button",{type:"button",className:"flex-1 bg-gray-500 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-300 hover:bg-gray-600",onClick:()=>{f(!1),j(null)},children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})})]})})]}):(0,pt.jsx)("div",{className:"p-6",children:(0,pt.jsx)("div",{className:"bg-white rounded-lg shadow-lg p-8 text-center",children:(0,pt.jsxs)("div",{className:"text-red-600 mb-4",children:[(0,pt.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,pt.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,pt.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"\u95b2\u89a7\u6a29\u9650\u304c\u3042\u308a\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u62e0\u70b9\u60c5\u5831\u306f\u62e0\u70b9\u7ba1\u7406\u8005\u306e\u307f\u95b2\u89a7\u3067\u304d\u307e\u3059\u3002"})]})})})},$t=()=>{const[e,t]=(0,r.useState)([]),[n,s]=(0,r.useState)(!0),[a,l]=(0,r.useState)(null),[o,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(null),[x,g]=(0,r.useState)({title:"",description:"",category:"\u9078\u629e\u79d1\u76ee",order_index:0}),[h,p]=(0,r.useState)(!1),f=(0,r.useRef)(!1),b=async()=>{if(h)console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u306e\u305f\u3081\u3001\u30b3\u30fc\u30b9\u53d6\u5f97\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");else try{s(!0),l(null);const e=await He("/api/courses");console.log("\u30b3\u30fc\u30b9\u53d6\u5f97\u30ec\u30b9\u30dd\u30f3\u30b9:",e),e.success?t(e.data):l("\u30b3\u30fc\u30b9\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(e){if("Authentication failed"===e.message||"Authentication error handling in progress"===e.message)return console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u51e6\u7406\u3092\u505c\u6b62\u3057\u307e\u3059\u3002"),p(!0),void l("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u307e\u3059\u3002");l("\u30b3\u30fc\u30b9\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"),console.error("Error fetching courses:",e)}finally{s(!1)}};(0,r.useEffect)(()=>{b()},[]),(0,r.useEffect)(()=>{h&&console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u72b6\u614b\u306e\u305f\u3081\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u518d\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059")},[h]);const y=e=>{const{name:t,value:n}=e.target;console.log("\u30d5\u30a9\u30fc\u30e0\u5165\u529b\u5909\u66f4:",{name:t,value:n}),g(e=>({...e,[t]:n}))},v=()=>{i(!1),d(!1),m(null),g({title:"",description:"",category:"\u9078\u629e\u79d1\u76ee",order_index:0})};return n?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsx)("div",{className:"text-blue-600 text-xl font-semibold",children:"Loading..."})}):(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 p-6",children:[(0,pt.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent",children:"\u30b3\u30fc\u30b9\u7ba1\u7406"}),(0,pt.jsx)("button",{onClick:()=>{console.log("\u65b0\u898f\u30b3\u30fc\u30b9\u4f5c\u6210\u30e2\u30fc\u30c0\u30eb\u3092\u958b\u304d\u307e\u3059"),i(!0)},className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg font-semibold hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",children:"\uff0b \u65b0\u898f\u30b3\u30fc\u30b9\u4f5c\u6210"})]}),a&&(0,pt.jsx)("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:a}),(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl p-6",children:(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"min-w-full text-sm",children:[(0,pt.jsx)("thead",{className:"bg-blue-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u30b3\u30fc\u30b9\u540d"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u8aac\u660e"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u30ab\u30c6\u30b4\u30ea"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u30ec\u30c3\u30b9\u30f3\u6570"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u8868\u793a\u9806\u5e8f"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u64cd\u4f5c"})]})}),(0,pt.jsx)("tbody",{children:e.map(t=>(0,pt.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-blue-50 transition-colors duration-200",children:[(0,pt.jsx)("td",{className:"px-4 py-3 font-semibold text-gray-800",children:t.title}),(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-600",children:t.description||"-"}),(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold "+("\u5fc5\u4fee\u79d1\u76ee"===t.category?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:t.category})}),(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-600",children:t.lesson_count||0}),(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-600",children:t.order_index||0}),(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("button",{onClick:()=>(e=>{m(e),g({title:e.title,description:e.description||"",category:e.category,order_index:e.order_index||0}),d(!0)})(t),className:"px-3 py-1 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-medium hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",children:"\u270f\ufe0f \u7de8\u96c6"}),(0,pt.jsx)("button",{onClick:()=>(async t=>{if(!window.confirm("\u3053\u306e\u30b3\u30fc\u30b9\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f\u95a2\u9023\u3059\u308b\u30ec\u30c3\u30b9\u30f3\u3082\u524a\u9664\u3055\u308c\u307e\u3059\u3002"))return;if(f.current)return void console.log("\u51e6\u7406\u4e2d\u306e\u305f\u3081\u3001\u91cd\u8907\u64cd\u4f5c\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");if(h)return void console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u306e\u305f\u3081\u3001\u30b3\u30fc\u30b9\u524a\u9664\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");if(e.find(e=>e.id===t)){f.current=!0;try{(await Ke(`/api/courses/${t}`)).success?b():l("\u30b3\u30fc\u30b9\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(n){if("Authentication failed"===n.message||"Authentication error handling in progress"===n.message)return console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u51e6\u7406\u3092\u505c\u6b62\u3057\u307e\u3059\u3002"),p(!0),void l("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u307e\u3059\u3002");l("\u30b3\u30fc\u30b9\u306e\u524a\u9664\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"),console.error("Error deleting course:",n)}finally{setTimeout(()=>{f.current=!1},1e3)}}else l("\u524a\u9664\u5bfe\u8c61\u306e\u30b3\u30fc\u30b9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093")})(t.id),className:"px-3 py-1 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg font-medium hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",children:"\ud83d\uddd1\ufe0f \u524a\u9664"})]})})]},t.id))})]})})})]}),o&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl p-6 w-full max-w-md",children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"\u65b0\u898f\u30b3\u30fc\u30b9\u4f5c\u6210"}),(0,pt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),f.current)console.log("\u51e6\u7406\u4e2d\u306e\u305f\u3081\u3001\u91cd\u8907\u64cd\u4f5c\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");else if(h)console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u306e\u305f\u3081\u3001\u30b3\u30fc\u30b9\u4f5c\u6210\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");else{s(!0),l(null),f.current=!0;try{console.log("\u30b3\u30fc\u30b9\u4f5c\u6210\u30ea\u30af\u30a8\u30b9\u30c8:",x);const e=await We("/api/courses",x);console.log("\u30b3\u30fc\u30b9\u4f5c\u6210\u30ec\u30b9\u30dd\u30f3\u30b9:",e),e.success?(i(!1),g({title:"",description:"",category:"\u9078\u629e\u79d1\u76ee",order_index:0}),b(),alert("\u30b3\u30fc\u30b9\u304c\u6b63\u5e38\u306b\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f")):l(e.message||"\u30b3\u30fc\u30b9\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(t){if(console.error("\u30b3\u30fc\u30b9\u4f5c\u6210\u30a8\u30e9\u30fc:",t),"Authentication failed"===t.message||"Authentication error handling in progress"===t.message)return console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u51e6\u7406\u3092\u505c\u6b62\u3057\u307e\u3059\u3002"),p(!0),void l("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u307e\u3059\u3002");l(`\u30b3\u30fc\u30b9\u306e\u4f5c\u6210\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: ${t.message}`)}finally{s(!1),setTimeout(()=>{f.current=!1},1e3)}}},children:[(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30b3\u30fc\u30b9\u540d *"}),(0,pt.jsx)("input",{type:"text",name:"title",value:x.title,onChange:y,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8aac\u660e"}),(0,pt.jsx)("textarea",{name:"description",value:x.description,onChange:y,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30ab\u30c6\u30b4\u30ea *"}),(0,pt.jsxs)("select",{name:"category",value:x.category,onChange:y,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,pt.jsx)("option",{value:"\u9078\u629e\u79d1\u76ee",children:"\u9078\u629e\u79d1\u76ee"}),(0,pt.jsx)("option",{value:"\u5fc5\u4fee\u79d1\u76ee",children:"\u5fc5\u4fee\u79d1\u76ee"})]})]}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8868\u793a\u9806\u5e8f"}),(0,pt.jsx)("input",{type:"number",name:"order_index",value:x.order_index,onChange:y,min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{className:"flex gap-3",children:[(0,pt.jsx)("button",{type:"submit",disabled:n,className:"flex-1 px-4 py-2 rounded-lg font-semibold transition-all duration-200 "+(n?"bg-gray-400 text-gray-600 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-cyan-600 text-white hover:shadow-lg"),children:n?"\u4f5c\u6210\u4e2d...":"\u4f5c\u6210"}),(0,pt.jsx)("button",{type:"button",onClick:v,className:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-400 transition-all duration-200",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})]})}),c&&u&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl p-6 w-full max-w-md",children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"\u30b3\u30fc\u30b9\u7de8\u96c6"}),(0,pt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),f.current)console.log("\u51e6\u7406\u4e2d\u306e\u305f\u3081\u3001\u91cd\u8907\u64cd\u4f5c\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");else if(h)console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u306e\u305f\u3081\u3001\u30b3\u30fc\u30b9\u66f4\u65b0\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");else{f.current=!0;try{(await Qe(`/api/courses/${u.id}`,x)).success?(d(!1),m(null),g({title:"",description:"",category:"\u9078\u629e\u79d1\u76ee",order_index:0}),b()):l("\u30b3\u30fc\u30b9\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(t){if("Authentication failed"===t.message||"Authentication error handling in progress"===t.message)return console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u51e6\u7406\u3092\u505c\u6b62\u3057\u307e\u3059\u3002"),p(!0),void l("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u307e\u3059\u3002");l("\u30b3\u30fc\u30b9\u306e\u66f4\u65b0\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"),console.error("Error updating course:",t)}finally{setTimeout(()=>{f.current=!1},1e3)}}},children:[(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30b3\u30fc\u30b9\u540d *"}),(0,pt.jsx)("input",{type:"text",name:"title",value:x.title,onChange:y,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8aac\u660e"}),(0,pt.jsx)("textarea",{name:"description",value:x.description,onChange:y,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30ab\u30c6\u30b4\u30ea *"}),(0,pt.jsxs)("select",{name:"category",value:x.category,onChange:y,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,pt.jsx)("option",{value:"\u9078\u629e\u79d1\u76ee",children:"\u9078\u629e\u79d1\u76ee"}),(0,pt.jsx)("option",{value:"\u5fc5\u4fee\u79d1\u76ee",children:"\u5fc5\u4fee\u79d1\u76ee"})]})]}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8868\u793a\u9806\u5e8f"}),(0,pt.jsx)("input",{type:"number",name:"order_index",value:x.order_index,onChange:y,min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{className:"flex gap-3",children:[(0,pt.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-semibold hover:shadow-lg transition-all duration-200",children:"\u66f4\u65b0"}),(0,pt.jsx)("button",{type:"button",onClick:v,className:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-400 transition-all duration-200",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})]})})]})},zt=()=>{var e,t,n,s;const[a,l]=(0,r.useState)([]),[o,i]=(0,r.useState)([]),[c,d]=(0,r.useState)(!0),[u,m]=(0,r.useState)(null),[x,g]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!1),[f,b]=(0,r.useState)(null),[y,v]=(0,r.useState)(""),[j,N]=(0,r.useState)({title:"",description:"",duration:"120\u5206",order_index:0,has_assignment:!1,course_id:"",videos:[]}),[w,k]=(0,r.useState)(!1),[S,_]=(0,r.useState)(null),[C,I]=(0,r.useState)([]),[T,P]=(0,r.useState)({title:"",description:"",youtube_url:"",order_index:0,duration:""}),[L,E]=(0,r.useState)(!1),[D,A]=(0,r.useState)(null),[$,z]=(0,r.useState)(null),[O,R]=(0,r.useState)(!1),[M,F]=(0,r.useState)(null),[U,B]=(0,r.useState)(!1),[J,q]=(0,r.useState)(!1),[V,H]=(0,r.useState)([]),[W,Q]=(0,r.useState)(!1),[K,Y]=(0,r.useState)(null),[G,Z]=(0,r.useState)([]),[X,ee]=(0,r.useState)(!1),[te,ne]=(0,r.useState)(!1),[se,re]=(0,r.useState)(null),[ae,le]=(0,r.useState)([]),[oe,ie]=(0,r.useState)([]),[ce,de]=(0,r.useState)([]),[ue,me]=(0,r.useState)({text_file_key:"",video_id:"",link_order:0}),[xe,ge]=(0,r.useState)(!1),[he,pe]=(0,r.useState)(null),[fe,be]=(0,r.useState)(!1),[ye,ve]=(0,r.useState)(null),je=async()=>{try{d(!0);const e=y?`?courseId=${y}`:"",t=await He(`/api/lessons${e}`);console.log("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u53d6\u5f97\u30ec\u30b9\u30dd\u30f3\u30b9:",t),t.success?(l(t.data),m(null)):m("\u30ec\u30c3\u30b9\u30f3\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(t.message||""))}catch(e){m("\u30ec\u30c3\u30b9\u30f3\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+e.message),console.error("Error fetching lessons:",e)}finally{d(!1)}};(0,r.useEffect)(()=>{(async()=>{try{console.log("LessonManagement: \u30b3\u30fc\u30b9\u4e00\u89a7\u53d6\u5f97\u958b\u59cb");const e=localStorage.getItem("accessToken"),t=localStorage.getItem("refreshToken");let n;if(console.log("LessonManagement: \u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u78ba\u8a8d:",{hasAccessToken:!!e,hasRefreshToken:!!t,accessTokenLength:null===e||void 0===e?void 0:e.length}),e)n=await He("/api/courses");else{console.log("LessonManagement: \u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u304c\u5b58\u5728\u3057\u306a\u3044\u305f\u3081\u3001\u30c6\u30b9\u30c8\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u4f7f\u7528"),n=await fetch(`${ze.JR}/api/test/courses`);const e=await n.json();n=e}console.log("LessonManagement: \u30b3\u30fc\u30b9\u53d6\u5f97\u30ec\u30b9\u30dd\u30f3\u30b9:",n),n.success?(console.log("LessonManagement: \u30b3\u30fc\u30b9\u53d6\u5f97\u6210\u529f\u3001\u30c7\u30fc\u30bf\u6570:",n.data.length),i(n.data)):(console.error("LessonManagement: \u30b3\u30fc\u30b9\u53d6\u5f97\u5931\u6557:",n.message),m("\u30b3\u30fc\u30b9\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+n.message))}catch(e){if(console.error("LessonManagement: \u30b3\u30fc\u30b9\u53d6\u5f97\u30a8\u30e9\u30fc:",e),"Authentication failed"===e.message||e.message.includes("401")||e.message.includes("403")){console.log("LessonManagement: \u8a8d\u8a3c\u30a8\u30e9\u30fc\u306e\u305f\u3081\u3001\u30c6\u30b9\u30c8\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u8a66\u884c");try{const e=await fetch(`${ze.JR}/api/test/courses`),t=await e.json();if(t.success)return console.log("LessonManagement: \u30c6\u30b9\u30c8\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3067\u30b3\u30fc\u30b9\u53d6\u5f97\u6210\u529f"),void i(t.data)}catch(t){console.error("LessonManagement: \u30c6\u30b9\u30c8\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3067\u3082\u30a8\u30e9\u30fc:",t)}}m("\u30b3\u30fc\u30b9\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+e.message)}})()},[]),(0,r.useEffect)(()=>{console.log("LessonManagement: \u30b3\u30fc\u30b9\u30c7\u30fc\u30bf\u72b6\u614b\u66f4\u65b0:",{coursesCount:o.length,courses:o.map(e=>({id:e.id,title:e.title}))})},[o]),(0,r.useEffect)(()=>{je()},[y]);const Ne=e=>{const{name:t,value:n,type:s,checked:r}=e.target;N(e=>({...e,[t]:"checkbox"===s?r:""===n?null:n}))},we=e=>{z(e.target.files[0])},ke=async e=>{try{const t=await He(`/api/lesson-text-files/lesson/${e}`);t.success&&Z(t.data)}catch(u){console.error("\u8907\u6570\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u53d6\u5f97\u30a8\u30e9\u30fc:",u)}},Se=async e=>{try{const t=await He(`/api/lesson-videos/lesson/${e}`);t.success?I(t.data):m("\u52d5\u753b\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(t.message||""))}catch(t){m("\u52d5\u753b\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+t.message)}},_e=e=>{const{name:t,value:n}=e.target;P(e=>({...e,[t]:n}))},Ce=async e=>{try{console.log("fetchTextVideoLinks: \u958b\u59cb",{lessonId:e});const t=await He(`/api/lesson-text-video-links/lesson/${e}`);console.log("fetchTextVideoLinks: \u30ec\u30b9\u30dd\u30f3\u30b9\u53d6\u5f97\u6210\u529f",t),t.success?le(t.data):(console.error("\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u53d6\u5f97\u5931\u6557:",t.message),m("\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+t.message))}catch(u){console.error("\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u53d6\u5f97\u30a8\u30e9\u30fc:",u),"TypeError"===u.name&&"Failed to fetch"===u.message?(console.error("\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a8\u30e9\u30fc: \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093"),m("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093\u3002\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002")):m("\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+u.message)}},Ie=async e=>{try{console.log("fetchAvailableVideos: \u958b\u59cb",{lessonId:e});const t=await He(`/api/lesson-videos/lesson/${e}`);console.log("fetchAvailableVideos: \u30ec\u30b9\u30dd\u30f3\u30b9\u53d6\u5f97\u6210\u529f",t),t.success?ie(t.data):(console.error("\u5229\u7528\u53ef\u80fd\u306a\u52d5\u753b\u53d6\u5f97\u5931\u6557:",t.message),m("\u52d5\u753b\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+t.message))}catch(u){console.error("\u5229\u7528\u53ef\u80fd\u306a\u52d5\u753b\u53d6\u5f97\u30a8\u30e9\u30fc:",u),"TypeError"===u.name&&"Failed to fetch"===u.message?(console.error("\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a8\u30e9\u30fc: \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093"),m("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093\u3002\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002")):m("\u52d5\u753b\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+u.message)}},Te=async e=>{try{console.log("fetchAvailableTextFiles: \u958b\u59cb",{lessonId:e});const t=await He(`/api/lessons/${e}/files`);if(console.log("fetchAvailableTextFiles: \u30ec\u30b9\u30dd\u30f3\u30b9\u53d6\u5f97\u6210\u529f",t),t.success){const e=t.data.filter(e=>{const t=e.file_name.toLowerCase();return"pdf"===e.file_type||"text/plain"===e.file_type||"text/markdown"===e.file_type||"application/rtf"===e.file_type||t.endsWith(".pdf")||t.endsWith(".md")||t.endsWith(".txt")||t.endsWith(".rtf")});console.log("fetchAvailableTextFiles: \u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u6570",e.length),de(e)}else console.error("\u5229\u7528\u53ef\u80fd\u306a\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u53d6\u5f97\u5931\u6557:",t.message),m("\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+t.message)}catch(u){console.error("\u5229\u7528\u53ef\u80fd\u306a\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u53d6\u5f97\u30a8\u30e9\u30fc:",u),"TypeError"===u.name&&"Failed to fetch"===u.message?(console.error("\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a8\u30e9\u30fc: \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093"),m("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093\u3002\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002")):m("\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+u.message)}},Pe=e=>{const{name:t,value:n}=e.target;me(e=>({...e,[t]:n}))},Le=()=>{g(!1),p(!1),R(!1),k(!1),E(!1),ne(!1),ge(!1),be(!1),b(null),F(null),_(null),re(null),ve(null),A(null),pe(null),N({title:"",description:"",duration:"120\u5206",order_index:0,has_assignment:!1,course_id:"",videos:[]}),P({title:"",description:"",youtube_url:"",order_index:0,duration:""}),me({text_file_key:"",video_id:"",link_order:0}),z(null),q(!1)},Ee=()=>{N(e=>({...e,videos:[...e.videos,{title:"",description:"",youtube_url:"",order_index:e.videos.length,duration:""}]}))},De=e=>{N(t=>({...t,videos:t.videos.filter((t,n)=>n!==e)}))},Ae=(e,t,n)=>{N(s=>({...s,videos:s.videos.map((s,r)=>r===e?{...s,[t]:n}:s)}))},$e=(e,t)=>{N(n=>{const s=[...n.videos],r="up"===t?e-1:e+1;return r>=0&&r<s.length&&([s[e],s[r]]=[s[r],s[e]],s[e].order_index=e,s[r].order_index=r),{...n,videos:s}})};return c?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsx)("div",{className:"text-blue-600 text-xl font-semibold",children:"Loading..."})}):(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 p-6",children:[(0,pt.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent",children:"\u30ec\u30c3\u30b9\u30f3\u7ba1\u7406"}),(0,pt.jsx)("button",{onClick:()=>g(!0),className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg font-semibold hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",children:"\uff0b \u65b0\u898f\u30ec\u30c3\u30b9\u30f3\u4f5c\u6210"})]}),u&&(0,pt.jsxs)("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg shadow-md",children:[(0,pt.jsxs)("div",{className:"flex items-center",children:[(0,pt.jsx)("svg",{className:"w-5 h-5 mr-2 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,pt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),(0,pt.jsx)("span",{className:"font-medium",children:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"})]}),(0,pt.jsx)("p",{className:"mt-2 text-sm",children:u}),(0,pt.jsx)("button",{onClick:()=>m(null),className:"mt-3 text-sm text-red-600 hover:text-red-800 underline",children:"\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9589\u3058\u308b"})]}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30b3\u30fc\u30b9\u3067\u7d5e\u308a\u8fbc\u307f"}),(0,pt.jsxs)("select",{value:y,onChange:e=>v(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,pt.jsx)("option",{value:"",children:"\u3059\u3079\u3066\u306e\u30b3\u30fc\u30b9"}),o.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl p-6",children:(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"min-w-full text-sm",children:[(0,pt.jsx)("thead",{className:"bg-blue-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u30ec\u30c3\u30b9\u30f3\u540d"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u30b3\u30fc\u30b9"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u8aac\u660e"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u6240\u8981\u6642\u9593"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u8ab2\u984c"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u30d5\u30a1\u30a4\u30eb"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u52d5\u753b"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u64cd\u4f5c"})]})}),(0,pt.jsx)("tbody",{children:a.map(e=>(0,pt.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-blue-50 transition-colors duration-200",children:[(0,pt.jsx)("td",{className:"px-4 py-3 font-semibold text-gray-800",children:e.title}),(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-600",children:e.course_title}),(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-600",children:e.description||"-"}),(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-600",children:e.duration}),(0,pt.jsx)("td",{className:"px-4 py-3",children:e.has_assignment?(0,pt.jsx)("span",{className:"text-green-600 font-medium",children:"\u3042\u308a"}):(0,pt.jsx)("span",{className:"text-gray-400",children:"\u306a\u3057"})}),(0,pt.jsx)("td",{className:"px-4 py-3",children:e.s3_key?(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("button",{onClick:()=>(async e=>{try{B(!0);const t=await He(`/api/lessons/${e}/files`);if(console.log("\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u53d6\u5f97\u30ec\u30b9\u30dd\u30f3\u30b9:",t),t.success&&t.data){let n;if(console.log("\u30ec\u30b9\u30dd\u30f3\u30b9\u30c7\u30fc\u30bf\u306e\u578b:",typeof t.data),console.log("\u30ec\u30b9\u30dd\u30f3\u30b9\u30c7\u30fc\u30bf\u306e\u5185\u5bb9:",t.data),Array.isArray(t.data)){console.log("\u914d\u5217\u5f62\u5f0f\u306e\u30c7\u30fc\u30bf\u3092\u691c\u51fa");const s=a.find(t=>t.id===e);if(!s)return void m("\u30ec\u30c3\u30b9\u30f3\u60c5\u5831\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093");n={lesson:{title:s.title,courseTitle:s.course_title||"\u4e0d\u660e\u306a\u30b3\u30fc\u30b9"},files:t.data}}else{if(!t.data.lesson||!t.data.files)return console.error("\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u30c7\u30fc\u30bf\u306e\u69cb\u9020\u304c\u4e0d\u6b63:",t.data),void m("\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u30c7\u30fc\u30bf\u306e\u5f62\u5f0f\u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093");console.log("\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u5f62\u5f0f\u306e\u30c7\u30fc\u30bf\u3092\u691c\u51fa"),n=t.data}F(n),R(!0)}else m("\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(t.message||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc"))}catch(t){console.error("\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",t),m("\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+t.message)}finally{B(!1)}})(e.id),className:"text-blue-600 hover:text-blue-800 font-medium",children:"\ud83d\udccb \u30d5\u30a1\u30a4\u30eb\u4e00\u89a7"}),(0,pt.jsx)("button",{onClick:()=>(async e=>{try{const t=await Ye(`/api/lessons/${e}/download-folder`,{method:"GET"}),n=window.URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.setAttribute("download",`lesson-folder-${e}.zip`),document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(n)}catch(t){m("\u30d5\u30a9\u30eb\u30c0\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f"),console.error("Error downloading folder:",t)}})(e.id),className:"text-green-600 hover:text-green-800 font-medium",children:"\ud83d\udcc1 \u30d5\u30a9\u30eb\u30c0"})]}):(0,pt.jsx)("span",{className:"text-gray-400",children:"\u306a\u3057"})}),(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("button",{onClick:()=>(async e=>{_(e),k(!0),await Se(e.id)})(e),className:"text-blue-600 hover:text-blue-800 font-medium",children:"\ud83c\udfa5 \u52d5\u753b\u7ba1\u7406\u30fb\u8996\u8074"}),(0,pt.jsx)("button",{onClick:()=>(async e=>{re(e),ne(!0),await Ce(e.id),await Ie(e.id),await Te(e.id)})(e),className:"text-green-600 hover:text-green-800 font-medium",children:"\ud83d\udd17 \u30c6\u30ad\u30b9\u30c8\u30fb\u52d5\u753b\u7d10\u3065\u3051"})]}),(0,pt.jsx)("div",{className:"text-xs text-gray-500",children:e.videos&&e.videos.length>0&&(0,pt.jsxs)("span",{children:["\u52d5\u753b\u6570: ",e.videos.length,"\u500b"]})})]})}),(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("button",{onClick:()=>(async e=>{try{console.log("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u7de8\u96c6\u30e2\u30fc\u30c0\u30eb\u3092\u958b\u304f",{lesson:e}),b(e),console.log("LessonManagement: \u52d5\u753b\u30c7\u30fc\u30bf\u53d6\u5f97\u958b\u59cb",{lessonId:e.id});const t=await He(`/api/lesson-videos/lesson/${e.id}`);console.log("LessonManagement: \u52d5\u753b\u30c7\u30fc\u30bf\u53d6\u5f97\u30ec\u30b9\u30dd\u30f3\u30b9",{videosResponse:t});const n=t.success?t.data:[];console.log("LessonManagement: \u8a2d\u5b9a\u3059\u308b\u52d5\u753b\u30c7\u30fc\u30bf",{videos:n}),N({title:e.title,description:e.description||"",duration:e.duration||"120\u5206",order_index:e.order_index||0,has_assignment:e.has_assignment||!1,course_id:e.course_id,videos:n}),z(null),q(!1),p(!0)}catch(u){console.error("\u30ec\u30c3\u30b9\u30f3\u7de8\u96c6\u30e2\u30fc\u30c0\u30eb\u3092\u958b\u304f\u969b\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f:",u),m("\u30ec\u30c3\u30b9\u30f3\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}})(e),className:"px-3 py-1 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-medium hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",children:"\u270f\ufe0f \u7de8\u96c6"}),(0,pt.jsx)("button",{onClick:()=>(async e=>{const t=a.find(t=>t.id===e);if(!t)return;const n=t.s3_key?`\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u300c${t.title}\u300d\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f\n\n\u524a\u9664\u3055\u308c\u308b\u5185\u5bb9\uff1a\n\u2022 \u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\n\u2022 \u30b9\u30c8\u30ec\u30fc\u30b8\u4e0a\u306e\u30d5\u30a1\u30a4\u30eb\u30fb\u30d5\u30a9\u30eb\u30c0\n\n\u3053\u306e\u64cd\u4f5c\u306f\u53d6\u308a\u6d88\u305b\u307e\u305b\u3093\u3002`:`\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u300c${t.title}\u300d\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f\n\n\u3053\u306e\u64cd\u4f5c\u306f\u53d6\u308a\u6d88\u305b\u307e\u305b\u3093\u3002`;if(window.confirm(n))try{console.log("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u524a\u9664\u958b\u59cb",{lessonId:e,lessonTitle:t.title});const n=await Ke(`/api/lessons/${e}`);if(console.log("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u524a\u9664\u30ec\u30b9\u30dd\u30f3\u30b9:",n),n.success){console.log("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u524a\u9664\u6210\u529f"),m(null),await je();const e=t.s3_key?`\u30ec\u30c3\u30b9\u30f3\u300c${t.title}\u300d\u304c\u6b63\u5e38\u306b\u524a\u9664\u3055\u308c\u307e\u3057\u305f\u3002\n\u30b9\u30c8\u30ec\u30fc\u30b8\u4e0a\u306e\u30d5\u30a1\u30a4\u30eb\u30fb\u30d5\u30a9\u30eb\u30c0\u3082\u524a\u9664\u3055\u308c\u307e\u3057\u305f\u3002`:`\u30ec\u30c3\u30b9\u30f3\u300c${t.title}\u300d\u304c\u6b63\u5e38\u306b\u524a\u9664\u3055\u308c\u307e\u3057\u305f\u3002`;alert(e)}else console.error("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u524a\u9664\u5931\u6557:",n.message),m("\u30ec\u30c3\u30b9\u30f3\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(n.message||""))}catch(s){console.error("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u524a\u9664\u30a8\u30e9\u30fc:",s),m("\u30ec\u30c3\u30b9\u30f3\u306e\u524a\u9664\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+s.message)}})(e.id),className:"px-3 py-1 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg font-medium hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",children:"\ud83d\uddd1\ufe0f \u524a\u9664"})]})})]},e.id))})]})})})]}),x&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-[95vw] max-h-[90vh] flex flex-col",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"\u65b0\u898f\u30ec\u30c3\u30b9\u30f3\u4f5c\u6210"}),(0,pt.jsx)("button",{onClick:Le,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\xd7"})]}),(0,pt.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,pt.jsxs)("form",{id:"createLessonForm",onSubmit:async e=>{e.preventDefault();try{const e=new FormData;Object.keys(j).forEach(t=>{const n=j[t];"videos"===t?e.append(t,JSON.stringify(n)):e.append(t,void 0===n?null:n)}),$&&(e.append("file",$),e.append("fileName",$.name)),console.log("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u4f5c\u6210\u958b\u59cb");const t=await Ve("/api/lessons",{method:"POST",body:e});console.log("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u4f5c\u6210\u30ec\u30b9\u30dd\u30f3\u30b9:",t),t.success?(console.log("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u4f5c\u6210\u6210\u529f"),te&&se&&(console.log("\u30ec\u30c3\u30b9\u30f3\u4f5c\u6210\u5f8c\u3001\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3092\u518d\u53d6\u5f97"),await Te(se.id)),Le(),m(null),await je()):(console.error("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u4f5c\u6210\u5931\u6557:",t.message),m("\u30ec\u30c3\u30b9\u30f3\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(t.message||"")))}catch(t){console.error("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u4f5c\u6210\u30a8\u30e9\u30fc:",t);let e="\u30ec\u30c3\u30b9\u30f3\u306e\u4f5c\u6210\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f";t.message.includes("\u8a31\u53ef\u3055\u308c\u3066\u3044\u306a\u3044\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f")?e="\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093\u3002PDF\u3001MD\u3001TXT\u3001RTF\u30d5\u30a1\u30a4\u30eb\u306e\u307f\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u53ef\u80fd\u3067\u3059\u3002":t.message.includes("\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3059\u304e\u307e\u3059")?e="\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3059\u304e\u307e\u3059\u300250MB\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002":t.message.includes("\u30d5\u30a1\u30a4\u30eb\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")?e="\u30d5\u30a1\u30a4\u30eb\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u3057\u3066\u304b\u3089\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002":t.message.includes("Authentication failed")?e="\u8a8d\u8a3c\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002":t.message.includes("401")?e="\u8a8d\u8a3c\u304c\u5fc5\u8981\u3067\u3059\u3002\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002":t.message.includes("403")?e="\u7ba1\u7406\u8005\u6a29\u9650\u304c\u5fc5\u8981\u3067\u3059\u3002":t.message.includes("500")?e=t.response&&t.response.data&&t.response.data.message?`\u30b5\u30fc\u30d0\u30fc\u30a8\u30e9\u30fc: ${t.response.data.message}`:"\u30b5\u30fc\u30d0\u30fc\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u6642\u9593\u3092\u304a\u3044\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002":e+=": "+t.message,m(e)}},children:[(0,pt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30b3\u30fc\u30b9 *"}),(0,pt.jsxs)("select",{name:"course_id",value:j.course_id,onChange:Ne,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,pt.jsx)("option",{value:"",children:"\u30b3\u30fc\u30b9\u3092\u9078\u629e"}),o.length>0?o.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.title},e.id)):(0,pt.jsx)("option",{value:"",disabled:!0,children:"\u30b3\u30fc\u30b9\u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u307e\u305b\u3093"})]}),0===o.length&&(0,pt.jsx)("p",{className:"text-xs text-red-500 mt-1",children:"\u30b3\u30fc\u30b9\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30da\u30fc\u30b8\u3092\u518d\u8aad\u307f\u8fbc\u307f\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}),(0,pt.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["\u5229\u7528\u53ef\u80fd\u306a\u30b3\u30fc\u30b9\u6570: ",o.length]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30ec\u30c3\u30b9\u30f3\u540d *"}),(0,pt.jsx)("input",{type:"text",name:"title",value:j.title,onChange:Ne,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u6240\u8981\u6642\u9593"}),(0,pt.jsx)("input",{type:"text",name:"duration",value:j.duration,onChange:Ne,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8868\u793a\u9806\u5e8f"}),(0,pt.jsx)("input",{type:"number",name:"order_index",value:j.order_index,onChange:Ne,min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsx)("div",{children:(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"checkbox",name:"has_assignment",checked:j.has_assignment,onChange:Ne,className:"mr-2"}),(0,pt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"\u8ab2\u984c\u3042\u308a"})]})})]}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8aac\u660e"}),(0,pt.jsx)("textarea",{name:"description",value:j.description,onChange:Ne,rows:"8",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30d5\u30a1\u30a4\u30eb\uff08PDF\u3001MD\u3001TXT\u3001RTF\uff09"}),(0,pt.jsx)("input",{type:"file",onChange:we,accept:".pdf,.md,.txt,.rtf",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u52d5\u753b\u7ba1\u7406"}),(0,pt.jsx)("button",{type:"button",onClick:Ee,className:"px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors",children:"\uff0b \u52d5\u753b\u8ffd\u52a0"})]}),0===j.videos.length?(0,pt.jsx)("div",{className:"text-center py-4 text-gray-500 border-2 border-dashed border-gray-300 rounded-lg",children:"\u52d5\u753b\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093"}):(0,pt.jsx)("div",{className:"space-y-3",children:j.videos.map((e,t)=>(0,pt.jsxs)("div",{className:"border border-gray-300 rounded-lg p-3 bg-gray-50",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,pt.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["\u52d5\u753b ",t+1]}),(0,pt.jsxs)("div",{className:"flex gap-1",children:[(0,pt.jsx)("button",{type:"button",onClick:()=>$e(t,"up"),disabled:0===t,className:"px-2 py-1 text-xs bg-gray-500 text-white rounded disabled:opacity-50",children:"\u2191"}),(0,pt.jsx)("button",{type:"button",onClick:()=>$e(t,"down"),disabled:t===j.videos.length-1,className:"px-2 py-1 text-xs bg-gray-500 text-white rounded disabled:opacity-50",children:"\u2193"}),(0,pt.jsx)("button",{type:"button",onClick:()=>De(t),className:"px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600",children:"\xd7"})]})]}),(0,pt.jsxs)("div",{className:"space-y-2",children:[(0,pt.jsx)("input",{type:"text",placeholder:"\u52d5\u753b\u30bf\u30a4\u30c8\u30eb *",value:e.title,onChange:e=>Ae(t,"title",e.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"}),(0,pt.jsx)("textarea",{placeholder:"\u52d5\u753b\u306e\u8aac\u660e",value:e.description,onChange:e=>Ae(t,"description",e.target.value),rows:"2",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"}),(0,pt.jsx)("input",{type:"url",placeholder:"YouTube URL *",value:e.youtube_url,onChange:e=>Ae(t,"youtube_url",e.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"}),(0,pt.jsx)("input",{type:"text",placeholder:"\u52d5\u753b\u306e\u9577\u3055\uff08\u4f8b\uff1a15\u520630\u79d2\uff09",value:e.duration,onChange:e=>Ae(t,"duration",e.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]},t))})]})]})}),(0,pt.jsx)("div",{className:"p-6 border-t border-gray-200",children:(0,pt.jsxs)("div",{className:"flex gap-3",children:[(0,pt.jsx)("button",{type:"submit",form:"createLessonForm",className:"flex-1 px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg font-semibold hover:shadow-lg transition-all duration-200",children:"\u4f5c\u6210"}),(0,pt.jsx)("button",{type:"button",onClick:Le,className:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-400 transition-all duration-200",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})})]})}),h&&f&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-[95vw] max-h-[90vh] flex flex-col",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"\u30ec\u30c3\u30b9\u30f3\u7de8\u96c6"}),(0,pt.jsx)("button",{onClick:Le,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\xd7"})]}),(0,pt.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,pt.jsxs)("form",{id:"updateLessonForm",onSubmit:async e=>{e.preventDefault();try{var t;const e=localStorage.getItem("accessToken"),n=localStorage.getItem("refreshToken");console.log("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u66f4\u65b0 - \u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u78ba\u8a8d:",{hasAccessToken:!!e,hasRefreshToken:!!n,accessTokenLength:null===e||void 0===e?void 0:e.length,selectedLessonId:null===f||void 0===f?void 0:f.id});const s=new FormData;Object.keys(j).forEach(e=>{const t=j[e];"videos"===e?s.append(e,JSON.stringify(t)):s.append(e,void 0===t?null:t)}),s.append("update_file",J?"true":"false"),J?$?(s.append("file",$),s.append("fileName",$.name),s.append("remove_file","false")):s.append("remove_file","true"):s.append("remove_file","false"),console.log("LessonManagement: \u9001\u4fe1\u3059\u308bFormData\u306e\u5185\u5bb9:");for(let[t,a]of s.entries())console.log(`${t}:`,a);console.log("LessonManagement: \u52d5\u753b\u30c7\u30fc\u30bf\u306e\u8a73\u7d30:",{formDataVideos:j.videos,videosLength:null===(t=j.videos)||void 0===t?void 0:t.length,videosJson:JSON.stringify(j.videos)}),console.log("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u66f4\u65b0\u958b\u59cb");const r=await Ve(`/api/lessons/${f.id}`,{method:"PUT",body:s});console.log("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u66f4\u65b0\u30ec\u30b9\u30dd\u30f3\u30b9:",r),r.success?(console.log("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u66f4\u65b0\u6210\u529f"),te&&se&&(console.log("\u30ec\u30c3\u30b9\u30f3\u66f4\u65b0\u5f8c\u3001\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3092\u518d\u53d6\u5f97"),await Te(se.id)),Le(),m(null),await je()):(console.error("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u66f4\u65b0\u5931\u6557:",r.message),m("\u30ec\u30c3\u30b9\u30f3\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(r.message||"")))}catch(n){console.error("LessonManagement: \u30ec\u30c3\u30b9\u30f3\u66f4\u65b0\u30a8\u30e9\u30fc:",n);let e="\u30ec\u30c3\u30b9\u30f3\u306e\u66f4\u65b0\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f";n.message.includes("\u8a31\u53ef\u3055\u308c\u3066\u3044\u306a\u3044\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f")?e="\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093\u3002PDF\u3001MD\u3001TXT\u3001RTF\u30d5\u30a1\u30a4\u30eb\u306e\u307f\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u53ef\u80fd\u3067\u3059\u3002":n.message.includes("\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3059\u304e\u307e\u3059")?e="\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3059\u304e\u307e\u3059\u300250MB\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002":n.message.includes("\u30d5\u30a1\u30a4\u30eb\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093")?e="\u30d5\u30a1\u30a4\u30eb\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u3057\u3066\u304b\u3089\u66f4\u65b0\u3057\u3066\u304f\u3060\u3055\u3044\u3002":n.message.includes("Authentication failed")?e="\u8a8d\u8a3c\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002":n.message.includes("401")?e="\u8a8d\u8a3c\u304c\u5fc5\u8981\u3067\u3059\u3002\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002":n.message.includes("403")?e="\u7ba1\u7406\u8005\u6a29\u9650\u304c\u5fc5\u8981\u3067\u3059\u3002":n.message.includes("404")?e="\u30ec\u30c3\u30b9\u30f3\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002":n.message.includes("500")?e=n.response&&n.response.data&&n.response.data.message?`\u30b5\u30fc\u30d0\u30fc\u30a8\u30e9\u30fc: ${n.response.data.message}`:"\u30b5\u30fc\u30d0\u30fc\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u6642\u9593\u3092\u304a\u3044\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002":e+=": "+n.message,m(e)}},children:[(0,pt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30b3\u30fc\u30b9 *"}),(0,pt.jsx)("select",{name:"course_id",value:j.course_id,onChange:Ne,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:o.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.title},e.id))})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30ec\u30c3\u30b9\u30f3\u540d *"}),(0,pt.jsx)("input",{type:"text",name:"title",value:j.title,onChange:Ne,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u6240\u8981\u6642\u9593"}),(0,pt.jsx)("input",{type:"text",name:"duration",value:j.duration,onChange:Ne,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8868\u793a\u9806\u5e8f"}),(0,pt.jsx)("input",{type:"number",name:"order_index",value:j.order_index,onChange:Ne,min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsx)("div",{children:(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"checkbox",name:"has_assignment",checked:j.has_assignment,onChange:Ne,className:"mr-2"}),(0,pt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"\u8ab2\u984c\u3042\u308a"})]})})]}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8aac\u660e"}),(0,pt.jsx)("textarea",{name:"description",value:j.description,onChange:Ne,rows:"8",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"flex items-center mb-2",children:[(0,pt.jsx)("input",{type:"checkbox",checked:J,onChange:e=>q(e.target.checked),className:"mr-2"}),(0,pt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"\u30d5\u30a1\u30a4\u30eb\u3092\u66f4\u65b0\u3059\u308b"})]}),J?(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsx)("input",{type:"file",onChange:we,accept:".pdf,.md,.txt,.rtf",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,pt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\u30d5\u30a1\u30a4\u30eb\u672a\u9078\u629e\u3067\u66f4\u65b0\u3059\u308b\u3068\u3001\u65e2\u5b58\u30d5\u30a1\u30a4\u30eb\u306f\u524a\u9664\u3055\u308c\u307e\u3059\u3002"})]}):f.s3_key?(0,pt.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["\u73fe\u5728\u306e\u30d5\u30a1\u30a4\u30eb: ",f.s3_key.split("/").pop()]}):(0,pt.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"\u73fe\u5728\u306e\u30d5\u30a1\u30a4\u30eb: \u306a\u3057"})]})]})]}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u52d5\u753b\u7ba1\u7406"}),(0,pt.jsx)("button",{type:"button",onClick:Ee,className:"px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600 transition-colors",children:"\uff0b \u52d5\u753b\u8ffd\u52a0"})]}),0===j.videos.length?(0,pt.jsx)("div",{className:"text-center py-4 text-gray-500 border-2 border-dashed border-gray-300 rounded-lg",children:"\u52d5\u753b\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093"}):(0,pt.jsx)("div",{className:"space-y-3",children:j.videos.map((e,t)=>(0,pt.jsxs)("div",{className:"border border-gray-300 rounded-lg p-3 bg-gray-50",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,pt.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["\u52d5\u753b ",t+1]}),(0,pt.jsxs)("div",{className:"flex gap-1",children:[(0,pt.jsx)("button",{type:"button",onClick:()=>$e(t,"up"),disabled:0===t,className:"px-2 py-1 text-xs bg-gray-500 text-white rounded disabled:opacity-50",children:"\u2191"}),(0,pt.jsx)("button",{type:"button",onClick:()=>$e(t,"down"),disabled:t===j.videos.length-1,className:"px-2 py-1 text-xs bg-gray-500 text-white rounded disabled:opacity-50",children:"\u2193"}),(0,pt.jsx)("button",{type:"button",onClick:()=>De(t),className:"px-2 py-1 text-xs bg-red-500 text-white rounded hover:bg-red-600",children:"\xd7"})]})]}),(0,pt.jsxs)("div",{className:"space-y-2",children:[(0,pt.jsx)("input",{type:"text",placeholder:"\u52d5\u753b\u30bf\u30a4\u30c8\u30eb *",value:e.title,onChange:e=>Ae(t,"title",e.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"}),(0,pt.jsx)("textarea",{placeholder:"\u52d5\u753b\u306e\u8aac\u660e",value:e.description,onChange:e=>Ae(t,"description",e.target.value),rows:"2",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"}),(0,pt.jsx)("input",{type:"url",placeholder:"YouTube URL *",value:e.youtube_url,onChange:e=>Ae(t,"youtube_url",e.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"}),(0,pt.jsx)("input",{type:"text",placeholder:"\u52d5\u753b\u306e\u9577\u3055\uff08\u4f8b\uff1a15\u520630\u79d2\uff09",value:e.duration,onChange:e=>Ae(t,"duration",e.target.value),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]},t))})]}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\ud83d\udcc4 \u8907\u6570\u30c6\u30ad\u30b9\u30c8\u7ba1\u7406"}),(0,pt.jsx)("button",{type:"button",onClick:()=>{Y(f),Q(!0),ke(f.id)},className:"px-3 py-1 bg-purple-500 text-white text-sm rounded hover:bg-purple-600 transition-colors",children:"\ud83d\udcc4 \u30c6\u30ad\u30b9\u30c8\u7ba1\u7406"})]}),(0,pt.jsx)("div",{className:"text-center py-4 text-gray-500 border-2 border-dashed border-gray-300 rounded-lg",children:"\u8907\u6570\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u7ba1\u7406\u306f\u300c\u30c6\u30ad\u30b9\u30c8\u7ba1\u7406\u300d\u30dc\u30bf\u30f3\u304b\u3089\u884c\u3048\u307e\u3059"})]})]})}),(0,pt.jsx)("div",{className:"p-6 border-t border-gray-200",children:(0,pt.jsxs)("div",{className:"flex gap-3",children:[(0,pt.jsx)("button",{type:"submit",form:"updateLessonForm",className:"flex-1 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-semibold hover:shadow-lg transition-all duration-200",children:"\u66f4\u65b0"}),(0,pt.jsx)("button",{type:"button",onClick:Le,className:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-400 transition-all duration-200",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})})]})}),O&&M&&M.lesson&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl p-6 w-full max-w-4xl max-h-[80vh] overflow-y-auto",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,pt.jsxs)("h2",{className:"text-2xl font-bold text-gray-800",children:["\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7 - ",(null===(e=M.lesson)||void 0===e?void 0:e.title)||"\u4e0d\u660e\u306a\u30ec\u30c3\u30b9\u30f3"]}),(0,pt.jsx)("button",{onClick:Le,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\xd7"})]}),(0,pt.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[(0,pt.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,pt.jsx)("strong",{children:"\u30b3\u30fc\u30b9:"})," ",(null===(t=M.lesson)||void 0===t?void 0:t.courseTitle)||"\u4e0d\u660e\u306a\u30b3\u30fc\u30b9"]}),(0,pt.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,pt.jsx)("strong",{children:"\u30d5\u30a1\u30a4\u30eb\u6570:"})," ",(null===(n=M.files)||void 0===n?void 0:n.length)||0,"\u500b"]})]}),U?(0,pt.jsx)("div",{className:"text-center py-8",children:(0,pt.jsx)("div",{className:"text-blue-600 text-lg",children:"\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})}):(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"min-w-full text-sm",children:[(0,pt.jsx)("thead",{className:"bg-gray-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-gray-800",children:"\u30d5\u30a1\u30a4\u30eb\u540d"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-gray-800",children:"\u30b5\u30a4\u30ba"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-gray-800",children:"\u66f4\u65b0\u65e5\u6642"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-gray-800",children:"\u64cd\u4f5c"})]})}),(0,pt.jsx)("tbody",{children:(null===(s=M.files)||void 0===s?void 0:s.map((e,t)=>(0,pt.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors duration-200",children:[(0,pt.jsx)("td",{className:"px-4 py-3 font-medium text-gray-800",children:(null===e||void 0===e?void 0:e.name)||"\u4e0d\u660e\u306a\u30d5\u30a1\u30a4\u30eb"}),(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-600",children:(null===e||void 0===e?void 0:e.sizeFormatted)||"\u4e0d\u660e"}),(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-600",children:null!==e&&void 0!==e&&e.lastModified?new Date(e.lastModified).toLocaleString("ja-JP"):"\u4e0d\u660e"}),(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsx)("button",{onClick:()=>(async(e,t)=>{try{const n=await Ye("/api/lessons/download-file",{method:"POST",body:JSON.stringify({fileKey:e}),headers:{"Content-Type":"application/json"}}),s=window.URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.setAttribute("download",t),document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(s)}catch(n){m("\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f"),console.error("Error downloading individual file:",n)}})(null===e||void 0===e?void 0:e.key,null===e||void 0===e?void 0:e.name),className:"px-3 py-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-medium hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",children:"\ud83d\udce5 \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9"})})]},t)))||(0,pt.jsx)("tr",{children:(0,pt.jsx)("td",{colSpan:"4",className:"px-4 py-3 text-center text-gray-500",children:"\u30d5\u30a1\u30a4\u30eb\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093"})})})]})}),(0,pt.jsx)("div",{className:"mt-6 flex justify-end",children:(0,pt.jsx)("button",{onClick:Le,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-400 transition-all duration-200",children:"\u9589\u3058\u308b"})})]})}),w&&S&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-[95vw] max-h-[90vh] flex flex-col",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[(0,pt.jsxs)("h2",{className:"text-2xl font-bold text-gray-800",children:["\u52d5\u753b\u7ba1\u7406\u30fb\u8996\u8074 - ",S.title]}),(0,pt.jsx)("button",{onClick:Le,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\xd7"})]}),(0,pt.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,pt.jsxs)("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:[(0,pt.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,pt.jsx)("strong",{children:"\u30b3\u30fc\u30b9:"})," ",S.course_title]}),(0,pt.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,pt.jsx)("strong",{children:"\u52d5\u753b\u6570:"})," ",C.length,"\u500b"]})]}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[C.length>0&&(0,pt.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"\ud83c\udfac \u52d5\u753b\u8996\u8074"}),(0,pt.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:C.map((e,t)=>(0,pt.jsxs)("div",{className:"bg-white p-3 rounded-lg shadow-sm border border-gray-200",children:[(0,pt.jsx)("div",{className:"mb-2",children:(0,pt.jsxs)("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:["\u52d5\u753b ",t+1]})}),(0,pt.jsx)("h4",{className:"font-medium text-gray-800 mb-2 text-sm",children:e.title}),e.description&&(0,pt.jsx)("p",{className:"text-xs text-gray-600 mb-2 line-clamp-2",children:e.description}),(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,pt.jsx)("span",{className:"text-xs text-gray-500",children:e.duration||"\u6642\u9593\u672a\u8a2d\u5b9a"}),(0,pt.jsxs)("span",{className:"text-xs text-gray-500",children:["\u9806\u5e8f: ",e.order_index]})]}),(0,pt.jsx)("button",{onClick:()=>(e=>{ve(e),be(!0)})(e),className:"block w-full px-2 py-1.5 bg-red-600 text-white text-center rounded hover:bg-red-700 transition-colors text-xs",children:"\ud83c\udfa5 \u8996\u8074"})]},e.id))})]}),(0,pt.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"\u2699\ufe0f \u52d5\u753b\u7ba1\u7406"}),(0,pt.jsx)("button",{onClick:()=>E(!0),className:"px-3 py-1.5 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg font-semibold hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200 text-sm",children:"\uff0b \u65b0\u898f\u52d5\u753b\u8ffd\u52a0"})]}),(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"min-w-full text-xs",children:[(0,pt.jsx)("thead",{className:"bg-white",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsx)("th",{className:"px-2 py-1.5 text-left font-semibold text-gray-800",children:"\u9806\u5e8f"}),(0,pt.jsx)("th",{className:"px-2 py-1.5 text-left font-semibold text-gray-800",children:"\u30bf\u30a4\u30c8\u30eb"}),(0,pt.jsx)("th",{className:"px-2 py-1.5 text-left font-semibold text-gray-800",children:"\u8aac\u660e"}),(0,pt.jsx)("th",{className:"px-2 py-1.5 text-left font-semibold text-gray-800",children:"\u9577\u3055"}),(0,pt.jsx)("th",{className:"px-2 py-1.5 text-left font-semibold text-gray-800",children:"\u64cd\u4f5c"})]})}),(0,pt.jsx)("tbody",{children:C.map(e=>(0,pt.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors duration-200 bg-white",children:[(0,pt.jsx)("td",{className:"px-2 py-1.5 text-gray-600",children:e.order_index}),(0,pt.jsx)("td",{className:"px-2 py-1.5 font-medium text-gray-800 max-w-[120px] truncate",children:e.title}),(0,pt.jsx)("td",{className:"px-2 py-1.5 text-gray-600 max-w-[100px] truncate",children:e.description||"-"}),(0,pt.jsx)("td",{className:"px-2 py-1.5 text-gray-600",children:e.duration||"-"}),(0,pt.jsx)("td",{className:"px-2 py-1.5",children:(0,pt.jsxs)("div",{className:"flex gap-1",children:[(0,pt.jsx)("button",{onClick:()=>(e=>{A(e),P({title:e.title,description:e.description||"",youtube_url:e.youtube_url,order_index:e.order_index,duration:e.duration||""}),E(!0)})(e),className:"px-1.5 py-0.5 bg-gradient-to-r from-green-500 to-green-600 text-white rounded text-xs font-medium hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",children:"\u270f\ufe0f \u7de8\u96c6"}),(0,pt.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\u3053\u306e\u52d5\u753b\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f"))try{const t=await Ke(`/api/lesson-videos/${e}`);t.success?await Se(S.id):m("\u52d5\u753b\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(t.message||""))}catch(t){m("\u52d5\u753b\u306e\u524a\u9664\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+t.message)}})(e.id),className:"px-1.5 py-0.5 bg-gradient-to-r from-red-500 to-red-600 text-white rounded text-xs font-medium hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",children:"\ud83d\uddd1\ufe0f \u524a\u9664"})]})})]},e.id))})]})})]})]})]}),(0,pt.jsx)("div",{className:"p-6 border-t border-gray-200 flex justify-end",children:(0,pt.jsx)("button",{onClick:Le,className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-400 transition-all duration-200",children:"\u9589\u3058\u308b"})})]})}),L&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40 p-4",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-lg max-h-[95vh] flex flex-col",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:D?"\u52d5\u753b\u7de8\u96c6":"\u65b0\u898f\u52d5\u753b\u4f5c\u6210"})}),(0,pt.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,pt.jsxs)("form",{id:D?"updateVideoForm":"createVideoForm",onSubmit:D?async e=>{e.preventDefault();try{const e=await Qe(`/api/lesson-videos/${D.id}`,T);e.success?(await Se(S.id),E(!1),P({title:"",description:"",youtube_url:"",order_index:0,duration:""}),A(null)):m("\u52d5\u753b\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(e.message||""))}catch(t){m("\u52d5\u753b\u306e\u66f4\u65b0\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+t.message)}}:async e=>{e.preventDefault();try{const e=await We("/api/lesson-videos",{...T,lesson_id:S.id});e.success?(await Se(S.id),E(!1),P({title:"",description:"",youtube_url:"",order_index:0,duration:""}),A(null)):m("\u52d5\u753b\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(e.message||""))}catch(t){m("\u52d5\u753b\u306e\u4f5c\u6210\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+t.message)}},children:[(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30bf\u30a4\u30c8\u30eb *"}),(0,pt.jsx)("input",{type:"text",name:"title",value:T.title,onChange:_e,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8aac\u660e"}),(0,pt.jsx)("textarea",{name:"description",value:T.description,onChange:_e,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"YouTube\u52d5\u753bURL *"}),(0,pt.jsx)("input",{type:"url",name:"youtube_url",value:T.youtube_url,onChange:_e,required:!0,placeholder:"https://www.youtube.com/watch?v=...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8868\u793a\u9806\u5e8f"}),(0,pt.jsx)("input",{type:"number",name:"order_index",value:T.order_index,onChange:_e,min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u52d5\u753b\u306e\u9577\u3055"}),(0,pt.jsx)("input",{type:"text",name:"duration",value:T.duration,onChange:_e,placeholder:"\u4f8b\uff1a15\u520630\u79d2",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}),(0,pt.jsx)("div",{className:"p-6 border-t border-gray-200",children:(0,pt.jsxs)("div",{className:"flex gap-3",children:[(0,pt.jsx)("button",{type:"submit",form:D?"updateVideoForm":"createVideoForm",className:"flex-1 px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg font-semibold hover:shadow-lg transition-all duration-200",children:D?"\u66f4\u65b0":"\u4f5c\u6210"}),(0,pt.jsx)("button",{type:"button",onClick:()=>{E(!1),A(null),P({title:"",description:"",youtube_url:"",order_index:0,duration:""})},className:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-400 transition-all duration-200",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})})]})}),te&&se&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsxs)("h2",{className:"text-2xl font-bold text-gray-800",children:["\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u7ba1\u7406 - ",se.title]}),(0,pt.jsx)("button",{onClick:()=>ne(!1),className:"text-gray-500 hover:text-gray-700",children:(0,pt.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,pt.jsx)("div",{className:"mb-6",children:(0,pt.jsx)("button",{onClick:()=>ge(!0),className:"px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-semibold hover:shadow-lg transition-all duration-200",children:"\u65b0\u3057\u3044\u7d10\u3065\u3051\u3092\u8ffd\u52a0"})}),(0,pt.jsx)("div",{className:"space-y-4",children:0===ae.length?(0,pt.jsx)("p",{className:"text-gray-500 text-center py-8",children:"\u307e\u3060\u7d10\u3065\u3051\u304c\u3042\u308a\u307e\u305b\u3093"}):ae.map((e,t)=>(0,pt.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,pt.jsxs)("div",{className:"flex justify-between items-start",children:[(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("div",{className:"flex items-center gap-4 mb-2",children:(0,pt.jsxs)("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-sm font-medium",children:["\u9806\u5e8f: ",e.link_order+1]})}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h4",{className:"font-semibold text-gray-800 mb-1",children:"\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb"}),(0,pt.jsx)("p",{className:"text-sm text-gray-600 break-all",children:e.text_file_key})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h4",{className:"font-semibold text-gray-800 mb-1",children:"\u52d5\u753b"}),(0,pt.jsx)("p",{className:"text-sm text-gray-600",children:e.video_title}),(0,pt.jsx)("p",{className:"text-xs text-gray-500",children:e.youtube_url})]})]})]}),(0,pt.jsxs)("div",{className:"flex gap-2 ml-4",children:[(0,pt.jsx)("button",{onClick:()=>(e=>{pe(e),me({text_file_key:e.text_file_key,video_id:e.video_id,link_order:e.link_order}),ge(!0)})(e),className:"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600",children:"\u7de8\u96c6"}),(0,pt.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\u3053\u306e\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f"))try{const t=await Ke(`/api/lesson-text-video-links/${e}`);t.success?await Ce(se.id):m("\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+t.message)}catch(u){console.error("\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u524a\u9664\u30a8\u30e9\u30fc:",u),m("\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u524a\u9664\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+u.message)}})(e.id),className:"px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600",children:"\u524a\u9664"})]})]})},e.id))})]})}),xe&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-lg max-h-[95vh] flex flex-col",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:he?"\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u7de8\u96c6":"\u65b0\u3057\u3044\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051"})}),(0,pt.jsx)("div",{className:"flex-1 overflow-y-auto p-6",children:(0,pt.jsxs)("form",{id:he?"updateLinkForm":"createLinkForm",onSubmit:he?async e=>{e.preventDefault();try{const e=await Qe(`/api/lesson-text-video-links/${he.id}`,{...ue});e.success?(await Ce(se.id),ge(!1),me({text_file_key:"",video_id:"",link_order:0}),pe(null)):m("\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+e.message)}catch(u){console.error("\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u66f4\u65b0\u30a8\u30e9\u30fc:",u),m("\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u66f4\u65b0\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+u.message)}}:async e=>{e.preventDefault();try{const e=await We("/api/lesson-text-video-links",{lesson_id:se.id,...ue});e.success?(await Ce(se.id),ge(!1),me({text_file_key:"",video_id:"",link_order:0}),pe(null)):m("\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+e.message)}catch(u){console.error("\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u4f5c\u6210\u30a8\u30e9\u30fc:",u),m("\u30c6\u30ad\u30b9\u30c8\u3068\u52d5\u753b\u306e\u7d10\u3065\u3051\u4f5c\u6210\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+u.message)}},children:[(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb *"}),(0,pt.jsxs)("select",{name:"text_file_key",value:ue.text_file_key,onChange:Pe,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,pt.jsx)("option",{value:"",children:"\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e"}),ce.map(e=>(0,pt.jsx)("option",{value:e.file_name,children:e.file_name},e.file_name))]})]}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u52d5\u753b *"}),(0,pt.jsxs)("select",{name:"video_id",value:ue.video_id,onChange:Pe,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,pt.jsx)("option",{value:"",children:"\u52d5\u753b\u3092\u9078\u629e"}),oe.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8868\u793a\u9806\u5e8f"}),(0,pt.jsx)("input",{type:"number",name:"link_order",value:ue.link_order,onChange:Pe,min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})}),(0,pt.jsx)("div",{className:"p-6 border-t border-gray-200",children:(0,pt.jsxs)("div",{className:"flex gap-3",children:[(0,pt.jsx)("button",{type:"submit",form:he?"updateLinkForm":"createLinkForm",className:"flex-1 px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg font-semibold hover:shadow-lg transition-all duration-200",children:he?"\u66f4\u65b0":"\u4f5c\u6210"}),(0,pt.jsx)("button",{type:"button",onClick:()=>{ge(!1),pe(null),me({text_file_key:"",video_id:"",link_order:0})},className:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-400 transition-all duration-200",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})})]})}),fe&&ye&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[(0,pt.jsxs)("h2",{className:"text-2xl font-bold text-gray-800",children:["\ud83c\udfac \u52d5\u753b\u8996\u8074 - ",ye.title]}),(0,pt.jsx)("button",{onClick:()=>be(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\xd7"})]}),(0,pt.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,pt.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 rounded-lg",children:[(0,pt.jsx)("h3",{className:"font-semibold text-blue-800 mb-2",children:ye.title}),ye.description&&(0,pt.jsx)("p",{className:"text-sm text-blue-600 mb-2",children:ye.description}),(0,pt.jsxs)("div",{className:"flex gap-4 text-xs text-blue-600",children:[ye.duration&&(0,pt.jsxs)("span",{children:["\u23f1\ufe0f ",ye.duration]}),(0,pt.jsx)("span",{children:"\ud83d\udcfa YouTube"})]})]}),(0,pt.jsx)("div",{className:"bg-gray-100 rounded-lg overflow-hidden",children:(()=>{const e=(e=>{const t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/);return t&&11===t[2].length?t[2]:null})(ye.youtube_url);return e?(0,pt.jsx)("div",{className:"aspect-video bg-gray-100 rounded-lg overflow-hidden",children:(0,pt.jsx)("iframe",{src:`https://www.youtube.com/embed/${e}`,title:ye.title,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"w-full h-full border-0"})}):(0,pt.jsx)("div",{className:"aspect-video bg-gray-100 rounded-lg flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("p",{className:"text-gray-500 mb-4",children:"\u52d5\u753bURL\u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093"}),(0,pt.jsx)("a",{href:ye.youtube_url,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"YouTube\u3067\u958b\u304f"})]})})})()}),(0,pt.jsx)("div",{className:"mt-4 text-center",children:(0,pt.jsxs)("a",{href:ye.youtube_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[(0,pt.jsx)("span",{children:"\ud83c\udfa5"}),"YouTube\u3067\u958b\u304f"]})})]}),(0,pt.jsx)("div",{className:"p-6 border-t border-gray-200 flex justify-end",children:(0,pt.jsx)("button",{onClick:()=>be(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-400 transition-all duration-200",children:"\u9589\u3058\u308b"})})]})}),W&&K&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl w-full max-w-[95vw] max-h-[90vh] flex flex-col",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-gray-200",children:[(0,pt.jsxs)("h2",{className:"text-2xl font-bold text-gray-800",children:["\ud83d\udcc4 \u8907\u6570\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u7ba1\u7406 - ",K.title]}),(0,pt.jsx)("button",{onClick:()=>Q(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\xd7"})]}),(0,pt.jsxs)("div",{className:"flex-1 overflow-y-auto p-6",children:[(0,pt.jsxs)("div",{className:"mb-4 p-3 bg-purple-50 rounded-lg",children:[(0,pt.jsxs)("p",{className:"text-sm text-purple-800",children:[(0,pt.jsx)("strong",{children:"\u30b3\u30fc\u30b9:"})," ",K.course_title]}),(0,pt.jsxs)("p",{className:"text-sm text-purple-800",children:[(0,pt.jsx)("strong",{children:"\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u6570:"})," ",G.length,"\u500b"]})]}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"\ud83d\udce4 \u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8907\u6570\u30d5\u30a1\u30a4\u30eb\u9078\u629e"}),(0,pt.jsx)("input",{type:"file",multiple:!0,accept:".pdf,.txt,.md,.docx,.pptx",onChange:e=>{const t=Array.from(e.target.files);H(e=>[...e,...t])},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"}),(0,pt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"PDF\u3001\u30c6\u30ad\u30b9\u30c8\u3001Markdown\u3001Word\u3001PowerPoint\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u3067\u304d\u307e\u3059"})]}),V.length>0&&(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"\u9078\u629e\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb:"}),(0,pt.jsx)("div",{className:"space-y-2",children:V.map((e,t)=>(0,pt.jsxs)("div",{className:"flex items-center justify-between bg-white p-2 rounded border",children:[(0,pt.jsx)("span",{className:"text-sm text-gray-700 truncate",children:e.name}),(0,pt.jsx)("button",{onClick:()=>(e=>{H(t=>t.filter((t,n)=>n!==e))})(t),className:"text-red-500 hover:text-red-700 text-sm",children:"\xd7"})]},t))})]}),(0,pt.jsx)("button",{onClick:async()=>{if(0!==V.length){ee(!0);try{const e=V.map(async(e,t)=>{const n=new FormData;n.append("file",e),n.append("lessonId",K.id),n.append("order",t);const s=await fetch(`${ze.JR}/api/lesson-text-files`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:n});if(!s.ok)throw new Error(`\u30d5\u30a1\u30a4\u30eb ${e.name} \u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f`);return await s.json()});await Promise.all(e),alert("\u3059\u3079\u3066\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u307e\u3057\u305f"),H([]),Q(!1),je()}catch(u){console.error("\u8907\u6570\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30a8\u30e9\u30fc:",u),alert("\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+u.message)}finally{ee(!1)}}else alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044")},disabled:0===V.length||X,className:"w-full px-4 py-2 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg font-semibold hover:shadow-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:X?"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u4e2d...":"\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"})]}),(0,pt.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"\ud83d\udccb \u30d5\u30a1\u30a4\u30eb\u4e00\u89a7"}),G.length>0?(0,pt.jsx)("div",{className:"space-y-2",children:G.map((e,t)=>(0,pt.jsx)("div",{className:"bg-white p-3 rounded-lg border border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,pt.jsxs)("span",{className:"bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs",children:["\u30d5\u30a1\u30a4\u30eb ",t+1]}),(0,pt.jsxs)("span",{className:"text-xs text-gray-500",children:["\u9806\u5e8f: ",e.order_index+1]})]}),(0,pt.jsx)("h4",{className:"font-medium text-gray-800 text-sm",children:e.file_name}),(0,pt.jsxs)("p",{className:"text-xs text-gray-500",children:["\u30b5\u30a4\u30ba: ",e.file_size?`${(e.file_size/1024).toFixed(1)}KB`:"\u4e0d\u660e"]}),(0,pt.jsxs)("p",{className:"text-xs text-gray-500",children:["\u30bf\u30a4\u30d7: ",e.file_type||"\u4e0d\u660e"]})]}),(0,pt.jsx)("div",{className:"flex gap-1 ml-2",children:(0,pt.jsx)("button",{onClick:()=>(async e=>{if(window.confirm("\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f"))try{const t=await Ke(`/api/lesson-text-files/${e}`);t.success?(alert("\u30d5\u30a1\u30a4\u30eb\u304c\u524a\u9664\u3055\u308c\u307e\u3057\u305f"),await ke(K.id)):alert("\u30d5\u30a1\u30a4\u30eb\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+t.message)}catch(u){console.error("\u8907\u6570\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u524a\u9664\u30a8\u30e9\u30fc:",u),alert("\u30d5\u30a1\u30a4\u30eb\u306e\u524a\u9664\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+u.message)}})(e.id),className:"px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600",children:"\u524a\u9664"})})]})},e.id))}):(0,pt.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,pt.jsx)("p",{children:"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308a\u307e\u305b\u3093"})})]})]})]}),(0,pt.jsx)("div",{className:"p-6 border-t border-gray-200 flex justify-end",children:(0,pt.jsx)("button",{onClick:()=>Q(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-400 transition-all duration-200",children:"\u9589\u3058\u308b"})})]})})]})},Ot=e=>{let{availableCourses:t,onAdd:n,onClose:s}=e;const[a,l]=(0,r.useState)({name:"",description:"",target_audience:"",duration:"",status:"draft",courses:(o=[],o&&Array.isArray(o)?o.map(e=>({courseId:e.course_id||e.courseId,order:e.order_index||e.order||1,isRequired:!1!==e.is_required,estimatedDuration:e.estimated_duration||e.estimatedDuration||"3\u30f6\u6708"})):[])});var o;const i=e=>{const{name:t,value:n}=e.target;l(e=>({...e,[t]:n}))};return(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u65b0\u898f\u4f5c\u6210"}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold transition-colors duration-200",onClick:s,children:"\xd7"})]}),(0,pt.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t={id:`path${Date.now()}`,...a,totalCourses:a.courses.length,createdAt:(new Date).toISOString().split("T")[0],updatedAt:(new Date).toISOString().split("T")[0]};n(t),s()},className:"space-y-6",children:[(0,pt.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30d1\u30b9\u540d *"}),(0,pt.jsx)("input",{type:"text",name:"name",value:a.name,onChange:i,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u5bfe\u8c61\u8005 *"}),(0,pt.jsx)("textarea",{name:"target_audience",value:a.target_audience,onChange:i,required:!0,rows:3,placeholder:"\u4f8b\uff1aWeb\u5236\u4f5c\u8077\u5fd7\u671b\u8005\n\u30c7\u30b8\u30bf\u30eb\u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0\u306b\u8208\u5473\u304c\u3042\u308b\u65b9\n\u500b\u4eba\u4e8b\u696d\u4e3b\u30fb\u30d5\u30ea\u30fc\u30e9\u30f3\u30b9\u5fd7\u671b\u8005",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8aac\u660e *"}),(0,pt.jsx)("textarea",{name:"description",value:a.description,onChange:i,required:!0,rows:3,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u671f\u9593 *"}),(0,pt.jsx)("input",{type:"text",name:"duration",value:a.duration,onChange:i,required:!0,placeholder:"\u4f8b: 12\u30f6\u6708",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30b9\u30c6\u30fc\u30bf\u30b9"}),(0,pt.jsxs)("select",{name:"status",value:a.status,onChange:i,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300",children:[(0,pt.jsx)("option",{value:"draft",children:"\u4e0b\u66f8\u304d"}),(0,pt.jsx)("option",{value:"active",children:"\u516c\u958b\u4e2d"}),(0,pt.jsx)("option",{value:"inactive",children:"\u975e\u516c\u958b"})]})]})]}),(0,pt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800",children:"\u30b3\u30fc\u30b9\u69cb\u6210"}),(0,pt.jsx)("button",{type:"button",onClick:()=>{const e={courseId:"",order:a.courses.length+1,isRequired:!0,estimatedDuration:"3\u30f6\u6708"};l(t=>({...t,courses:[...t.courses,e]}))},className:"bg-indigo-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-300 hover:bg-indigo-700",children:"+ \u30b3\u30fc\u30b9\u3092\u8ffd\u52a0"})]}),a.courses.map((e,n)=>(0,pt.jsxs)("div",{className:"flex items-center gap-4 mb-4 p-4 bg-white rounded-lg border",children:[(0,pt.jsx)("div",{className:"flex-1",children:(0,pt.jsxs)("select",{value:e.courseId||"",onChange:e=>{const t=[...a.courses];t[n].courseId=e.target.value,l(e=>({...e,courses:t}))},required:!0,className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400",children:[(0,pt.jsx)("option",{value:"",children:"\u30b3\u30fc\u30b9\u3092\u9078\u629e"}),t.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.title},e.id))]})}),(0,pt.jsx)("div",{className:"w-20",children:(0,pt.jsx)("input",{type:"number",value:e.order||1,onChange:e=>((e,t)=>{const n=[...a.courses];n[e].order=parseInt(t),n.sort((e,t)=>e.order-t.order),l(e=>({...e,courses:n}))})(n,e.target.value),min:"1",className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400"})}),(0,pt.jsx)("div",{className:"w-32",children:(0,pt.jsx)("input",{type:"text",value:e.estimatedDuration||"3\u30f6\u6708",onChange:e=>{const t=[...a.courses];t[n].estimatedDuration=e.target.value,l(e=>({...e,courses:t}))},placeholder:"\u671f\u9593",className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400"})}),(0,pt.jsx)("button",{type:"button",onClick:()=>(e=>{const t=a.courses.filter((t,n)=>n!==e);t.forEach((e,t)=>{e.order=t+1}),l(e=>({...e,courses:t}))})(n),className:"text-red-600 hover:text-red-800 font-medium",children:"\u524a\u9664"})]},n))]}),(0,pt.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,pt.jsx)("button",{type:"button",onClick:s,className:"px-6 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium transition-colors duration-300 hover:bg-gray-50",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{type:"submit",className:"px-6 py-3 bg-indigo-600 text-white rounded-lg font-medium transition-colors duration-300 hover:bg-indigo-700",children:"\u4f5c\u6210"})]})]})]})})},Rt=e=>{let{path:t,availableCourses:n,onUpdate:s,onClose:a}=e;const l=(o=t.courses)&&Array.isArray(o)?o.map(e=>({courseId:e.course_id||e.courseId,order:e.order_index||e.order||1,isRequired:!1!==e.is_required,estimatedDuration:e.estimated_duration||e.estimatedDuration||"3\u30f6\u6708"})):[];var o;console.log("\u5909\u63db\u5f8c\u306e\u30b3\u30fc\u30b9\u30c7\u30fc\u30bf:",l);const[i,c]=(0,r.useState)({name:t.name,description:t.description,target_audience:t.target_audience,duration:t.duration,status:t.status,courses:l}),d=e=>{const{name:t,value:n}=e.target;c(e=>({...e,[t]:n}))};return(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsxs)("h3",{className:"text-xl font-bold text-gray-800",children:["\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u7de8\u96c6: ",t.name]}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold transition-colors duration-200",onClick:a,children:"\xd7"})]}),(0,pt.jsxs)("form",{onSubmit:e=>{e.preventDefault();const n={...t,...i,totalCourses:i.courses.length,updatedAt:(new Date).toISOString().split("T")[0]};s(n)},className:"space-y-6",children:[(0,pt.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30d1\u30b9\u540d"}),(0,pt.jsx)("input",{type:"text",name:"name",value:i.name,onChange:d,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u5bfe\u8c61\u8005"}),(0,pt.jsx)("textarea",{name:"target_audience",value:i.target_audience,onChange:d,required:!0,rows:3,placeholder:"\u4f8b\uff1aWeb\u5236\u4f5c\u8077\u5fd7\u671b\u8005\n\u30c7\u30b8\u30bf\u30eb\u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0\u306b\u8208\u5473\u304c\u3042\u308b\u65b9\n\u500b\u4eba\u4e8b\u696d\u4e3b\u30fb\u30d5\u30ea\u30fc\u30e9\u30f3\u30b9\u5fd7\u671b\u8005",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8aac\u660e"}),(0,pt.jsx)("textarea",{name:"description",value:i.description,onChange:d,required:!0,rows:3,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u671f\u9593"}),(0,pt.jsx)("input",{type:"text",name:"duration",value:i.duration,onChange:d,required:!0,placeholder:"\u4f8b: 12\u30f6\u6708",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30b9\u30c6\u30fc\u30bf\u30b9"}),(0,pt.jsxs)("select",{name:"status",value:i.status,onChange:d,required:!0,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300",children:[(0,pt.jsx)("option",{value:"active",children:"\u516c\u958b\u4e2d"}),(0,pt.jsx)("option",{value:"inactive",children:"\u975e\u516c\u958b"}),(0,pt.jsx)("option",{value:"draft",children:"\u4e0b\u66f8\u304d"})]})]})]}),(0,pt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800",children:"\u30b3\u30fc\u30b9\u69cb\u6210"}),(0,pt.jsx)("button",{type:"button",onClick:()=>{const e={courseId:"",order:i.courses.length+1,isRequired:!0,estimatedDuration:"3\u30f6\u6708"};c(t=>({...t,courses:[...t.courses,e]}))},className:"bg-indigo-500 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-300 hover:bg-indigo-600",children:"+ \u30b3\u30fc\u30b9\u3092\u8ffd\u52a0"})]}),(0,pt.jsx)("div",{className:"space-y-4",children:i.courses.map((e,t)=>(0,pt.jsx)("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:(0,pt.jsxs)("div",{className:"grid md:grid-cols-5 gap-4 items-center",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u9806\u5e8f"}),(0,pt.jsx)("input",{type:"number",value:e.order||1,onChange:e=>((e,t)=>{const n=[...i.courses];n[e].order=parseInt(t),n.sort((e,t)=>e.order-t.order),c(e=>({...e,courses:n}))})(t,e.target.value),min:"1",className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{className:"md:col-span-2",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30b3\u30fc\u30b9"}),(0,pt.jsxs)("select",{value:e.courseId||"",onChange:e=>{const n=[...i.courses];n[t].courseId=e.target.value,c(e=>({...e,courses:n}))},required:!0,className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300",children:[(0,pt.jsx)("option",{value:"",children:"\u30b3\u30fc\u30b9\u3092\u9078\u629e"}),n.map(e=>(0,pt.jsxs)("option",{value:e.id,children:[e.title," (",e.category,")"]},e.id))]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u671f\u9593"}),(0,pt.jsx)("input",{type:"text",value:e.estimatedDuration||"3\u30f6\u6708",onChange:e=>{const n=[...i.courses];n[t].estimatedDuration=e.target.value,c(e=>({...e,courses:n}))},placeholder:"\u4f8b: 3\u30f6\u6708",className:"w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsx)("div",{className:"flex items-end",children:(0,pt.jsx)("button",{type:"button",onClick:()=>(e=>{const t=i.courses.filter((t,n)=>n!==e);t.forEach((e,t)=>{e.order=t+1}),c(e=>({...e,courses:t}))})(t),className:"bg-red-500 text-white px-3 py-2 rounded-lg font-medium transition-colors duration-300 hover:bg-red-600",children:"\u524a\u9664"})})]})},t))})]}),(0,pt.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,pt.jsx)("button",{type:"submit",className:"flex-1 bg-indigo-500 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-300 hover:bg-indigo-600",children:"\u4fdd\u5b58"}),(0,pt.jsx)("button",{type:"button",className:"flex-1 bg-gray-500 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-300 hover:bg-gray-600",onClick:a,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})]})})},Mt=()=>{const[e,t]=(0,r.useState)([]),[n,s]=(0,r.useState)([]),[a,l]=(0,r.useState)(!0),[o,i]=(0,r.useState)(null),[c,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),[x,g]=(0,r.useState)(null),[h,p]=(0,r.useState)(""),[f,b]=(0,r.useState)("all"),[y,v]=(0,r.useState)(!1),j=(0,r.useRef)(!1),N=async()=>{if(y)console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u306e\u305f\u3081\u3001\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u53d6\u5f97\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");else try{l(!0),i(null);const e=await He("/api/curriculum-paths");console.log("\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u53d6\u5f97\u30ec\u30b9\u30dd\u30f3\u30b9:",e),e.success?t(e.data):i("\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(e){if("Authentication failed"===e.message||"Authentication error handling in progress"===e.message)return console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u51e6\u7406\u3092\u505c\u6b62\u3057\u307e\u3059\u3002"),v(!0),void i("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u307e\u3059\u3002");i("\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"),console.error("Error fetching curriculum paths:",e)}finally{l(!1)}};(0,r.useEffect)(()=>{N(),(async()=>{try{const e=await He("/api/curriculum-paths/available-courses");e.success&&s(e.data)}catch(e){console.error("Error fetching available courses:",e)}})()},[]);const[w,k]=(0,r.useState)({key:"name",direction:"asc"}),S=e=>{let t="asc";w.key===e&&"asc"===w.direction&&(t="desc"),k({key:e,direction:t})},_=()=>{const t=(()=>{let t=e;return h&&(t=t.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())||e.description.toLowerCase().includes(h.toLowerCase())||e.target_audience.toLowerCase().includes(h.toLowerCase()))),"all"!==f&&(t=t.filter(e=>e.status===f)),t})();return[...t].sort((e,t)=>{let n=e[w.key],s=t[w.key];return"status"===w.key&&(n=C(n),s=C(s)),n<s?"asc"===w.direction?-1:1:n>s?"asc"===w.direction?1:-1:0})},C=e=>{switch(e){case"active":return"\u516c\u958b\u4e2d";case"inactive":return"\u975e\u516c\u958b";case"draft":return"\u4e0b\u66f8\u304d";default:return e}};return a?(0,pt.jsx)("div",{className:"p-6 max-w-7xl mx-auto",children:(0,pt.jsxs)("div",{className:"text-center py-12",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,pt.jsx)("p",{className:"mt-4 text-gray-600",children:"\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]})}):o?(0,pt.jsx)("div",{className:"p-6 max-w-7xl mx-auto",children:(0,pt.jsxs)("div",{className:"text-center py-12",children:[(0,pt.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[(0,pt.jsx)("p",{className:"font-bold",children:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}),(0,pt.jsx)("p",{children:o})]}),(0,pt.jsx)("button",{onClick:()=>{i(null),v(!1),N()},className:"bg-indigo-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-300 hover:bg-indigo-700",children:"\u518d\u8a66\u884c"})]})}):(0,pt.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,pt.jsxs)("div",{className:"text-center mb-8",children:[(0,pt.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-4",children:"\ud83c\udfaf \u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u7ba1\u7406"}),(0,pt.jsx)("p",{className:"text-gray-600 text-lg",children:"\u8907\u6570\u306e\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u3092\u4f5c\u6210\u30fb\u7ba1\u7406\u3057\u3001\u53d7\u8b1b\u8005\u306e\u5b66\u7fd2\u7d4c\u8def\u3092\u6700\u9069\u5316\u3067\u304d\u307e\u3059\u3002"})]}),(0,pt.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6 mb-6 shadow-sm",children:[(0,pt.jsx)("div",{className:"mb-4",children:(0,pt.jsx)("input",{type:"text",placeholder:"\u30d1\u30b9\u540d\u3001\u8aac\u660e\u3001\u5bfe\u8c61\u8005\u3067\u691c\u7d22...",value:h,onChange:e=>p(e.target.value),className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})}),(0,pt.jsxs)("div",{className:"flex flex-wrap gap-6 items-end mb-4",children:[(0,pt.jsxs)("div",{className:"flex flex-col min-w-[150px]",children:[(0,pt.jsx)("label",{className:"font-semibold text-gray-700 mb-2 text-sm",children:"\u30b9\u30c6\u30fc\u30bf\u30b9:"}),(0,pt.jsxs)("select",{value:f,onChange:e=>b(e.target.value),className:"px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300",children:[(0,pt.jsx)("option",{value:"all",children:"\u5168\u3066\u306e\u30b9\u30c6\u30fc\u30bf\u30b9"}),(0,pt.jsx)("option",{value:"active",children:"\u516c\u958b\u4e2d"}),(0,pt.jsx)("option",{value:"inactive",children:"\u975e\u516c\u958b"}),(0,pt.jsx)("option",{value:"draft",children:"\u4e0b\u66f8\u304d"})]})]}),(0,pt.jsx)("button",{className:"bg-gray-600 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-300 hover:bg-gray-700",onClick:()=>{p(""),b("all")},children:"\u30d5\u30a3\u30eb\u30bf\u30fc\u30af\u30ea\u30a2"})]}),(0,pt.jsxs)("div",{className:"font-semibold text-gray-700 text-sm",children:["\u8868\u793a\u4e2d: ",_().length,"\u30d1\u30b9 / \u5168",e.length,"\u30d1\u30b9"]})]}),(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl overflow-x-auto p-6 mb-8 w-full",children:(0,pt.jsxs)("table",{className:"min-w-full text-sm",children:[(0,pt.jsx)("thead",{className:"bg-red-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>S("name"),children:["\ud83c\udfaf \u30d1\u30b9\u540d","name"===w.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===w.direction?" \u2191":" \u2193"})]}),(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>S("target_audience"),children:["\ud83d\udc65 \u5bfe\u8c61\u8005","target_audience"===w.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===w.direction?" \u2191":" \u2193"})]}),(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>S("duration"),children:["\u23f1\ufe0f \u671f\u9593","duration"===w.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===w.direction?" \u2191":" \u2193"})]}),(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>S("total_courses"),children:["\ud83d\udcda \u30b3\u30fc\u30b9\u6570","total_courses"===w.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===w.direction?" \u2191":" \u2193"})]}),(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>S("status"),children:["\ud83d\udcca \u30b9\u30c6\u30fc\u30bf\u30b9","status"===w.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===w.direction?" \u2191":" \u2193"})]}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\ud83d\udcd6 \u30b3\u30fc\u30b9\u69cb\u6210"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\ud83d\udcc5 \u6700\u7d42\u66f4\u65b0"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\u2699\ufe0f \u64cd\u4f5c"})]})}),(0,pt.jsx)("tbody",{children:_().map(t=>(0,pt.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors duration-200",children:[(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsxs)("div",{children:[(0,pt.jsx)("strong",{className:"text-gray-800",children:t.name}),(0,pt.jsx)("div",{className:"text-xs text-gray-500 mt-1 max-w-xs truncate",children:t.description})]})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsx)("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:t.target_audience})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsx)("span",{className:"text-gray-700 font-medium",children:t.duration})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsxs)("span",{className:"font-medium text-gray-800",children:[t.total_courses,"\u30b3\u30fc\u30b9"]})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold "+("active"===t.status?"bg-green-100 text-green-800":"inactive"===t.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:C(t.status)})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:t.courses&&t.courses.length>0?t.courses.map((e,n)=>(0,pt.jsxs)("div",{className:"flex items-center gap-1",children:[(0,pt.jsx)("span",{className:"w-6 h-6 bg-indigo-500 text-white rounded-full flex items-center justify-center text-xs font-bold",children:e.order_index}),(0,pt.jsx)("span",{className:"text-gray-700 text-sm",children:e.course_title}),n<t.courses.length-1&&(0,pt.jsx)("span",{className:"text-gray-400 text-sm",children:"\u2192"})]},e.id)):(0,pt.jsx)("span",{className:"text-gray-500 text-sm",children:"\u30b3\u30fc\u30b9\u672a\u8a2d\u5b9a"})})}),(0,pt.jsxs)("td",{className:"px-6 py-4 text-gray-600 text-sm",children:["\ud83d\udcc5 ",new Date(t.updated_at).toLocaleDateString("ja-JP")]}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("button",{className:"bg-blue-500 text-white px-3 py-1 rounded text-sm font-medium transition-colors duration-300 hover:bg-blue-600",onClick:()=>(e=>{console.log("\u7de8\u96c6\u5bfe\u8c61\u306e\u30d1\u30b9\u30c7\u30fc\u30bf:",e),console.log("\u30d1\u30b9\u306e\u30b3\u30fc\u30b9\u30c7\u30fc\u30bf:",e.courses),g(e),m(!0)})(t),title:"\u7de8\u96c6",children:"\u270f\ufe0f \u7de8\u96c6"}),(0,pt.jsx)("button",{className:"bg-red-500 text-white px-3 py-1 rounded text-sm font-medium transition-colors duration-300 hover:bg-red-600",onClick:()=>(async t=>{if(!window.confirm("\u3053\u306e\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u3092\u524a\u9664\u3057\u3066\u3082\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f\n\u203b\u524a\u9664\u3059\u308b\u3068\u5143\u306b\u623b\u305b\u307e\u305b\u3093\u3002"))return;if(j.current)return void console.log("\u51e6\u7406\u4e2d\u306e\u305f\u3081\u3001\u91cd\u8907\u64cd\u4f5c\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");if(y)return void console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u306e\u305f\u3081\u3001\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u524a\u9664\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");const n=e.find(e=>e.id===t);if(n){j.current=!0;try{(await Ke(`/api/curriculum-paths/${t}`)).success?N():i("\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(s){if("Authentication failed"===s.message||"Authentication error handling in progress"===s.message)return console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u51e6\u7406\u3092\u505c\u6b62\u3057\u307e\u3059\u3002"),v(!0),void i("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u307e\u3059\u3002");i("\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u306e\u524a\u9664\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"),console.error("Error deleting curriculum path:",s)}finally{setTimeout(()=>{j.current=!1},1e3)}}else i("\u524a\u9664\u5bfe\u8c61\u306e\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093")})(t.id),title:"\u524a\u9664",children:"\ud83d\uddd1\ufe0f \u524a\u9664"})]})})]},t.id))})]})}),0===_().length&&(0,pt.jsx)("div",{className:"text-center py-12",children:(0,pt.jsx)("p",{className:"text-gray-500 text-lg",children:"\u6761\u4ef6\u306b\u5408\u81f4\u3059\u308b\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002"})}),(0,pt.jsx)("div",{className:"text-center mb-8",children:(0,pt.jsx)("button",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-8 py-4 rounded-xl font-medium transition-all duration-300 hover:-translate-y-0.5 shadow-lg hover:shadow-xl",onClick:()=>d(!0),children:"+ \u65b0\u3057\u3044\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u3092\u4f5c\u6210"})}),(0,pt.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 mb-8",children:[(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 text-center transition-transform duration-300 hover:-translate-y-1 hover:shadow-lg",children:[(0,pt.jsx)("h3",{className:"text-gray-700 font-semibold mb-4",children:"\u7dcf\u30d1\u30b9\u6570"}),(0,pt.jsx)("p",{className:"text-3xl font-bold text-indigo-600 mb-2",children:e.length}),(0,pt.jsx)("small",{className:"text-gray-500",children:"\u5168\u30ab\u30c6\u30b4\u30ea"})]}),(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 text-center transition-transform duration-300 hover:-translate-y-1 hover:shadow-lg",children:[(0,pt.jsx)("h3",{className:"text-gray-700 font-semibold mb-4",children:"\u516c\u958b\u4e2d\u30d1\u30b9"}),(0,pt.jsx)("p",{className:"text-3xl font-bold text-green-600 mb-2",children:e.filter(e=>"active"===e.status).length}),(0,pt.jsx)("small",{className:"text-gray-500",children:"\u30a2\u30af\u30c6\u30a3\u30d6"})]}),(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 text-center transition-transform duration-300 hover:-translate-y-1 hover:shadow-lg",children:[(0,pt.jsx)("h3",{className:"text-gray-700 font-semibold mb-4",children:"\u5e73\u5747\u30b3\u30fc\u30b9\u6570"}),(0,pt.jsx)("p",{className:"text-3xl font-bold text-blue-600 mb-2",children:e.length>0?Math.round(e.reduce((e,t)=>e+(t.total_courses||0),0)/e.length):0}),(0,pt.jsx)("small",{className:"text-gray-500",children:"\u30d1\u30b9\u3042\u305f\u308a"})]}),(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200 text-center transition-transform duration-300 hover:-translate-y-1 hover:shadow-lg",children:[(0,pt.jsx)("h3",{className:"text-gray-700 font-semibold mb-4",children:"\u4e0b\u66f8\u304d\u30d1\u30b9"}),(0,pt.jsx)("p",{className:"text-3xl font-bold text-purple-600 mb-2",children:e.filter(e=>"draft"===e.status).length}),(0,pt.jsx)("small",{className:"text-gray-500",children:"\u7de8\u96c6\u4e2d"})]})]}),c&&(0,pt.jsx)(Ot,{availableCourses:n,onAdd:async e=>{var t;if(j.current)console.log("\u51e6\u7406\u4e2d\u306e\u305f\u3081\u3001\u91cd\u8907\u64cd\u4f5c\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");else if(y)console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u306e\u305f\u3081\u3001\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u4f5c\u6210\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");else{console.log("\u9001\u4fe1\u3059\u308b\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u30c7\u30fc\u30bf:",e),console.log("\u30b3\u30fc\u30b9\u6570:",(null===(t=e.courses)||void 0===t?void 0:t.length)||0),j.current=!0;try{(await We("/api/curriculum-paths",e)).success?N():i("\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(n){if("Authentication failed"===n.message||"Authentication error handling in progress"===n.message)return console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u51e6\u7406\u3092\u505c\u6b62\u3057\u307e\u3059\u3002"),v(!0),void i("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u307e\u3059\u3002");i("\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u306e\u4f5c\u6210\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"),console.error("Error creating curriculum path:",n)}finally{setTimeout(()=>{j.current=!1},1e3)}}},onClose:()=>d(!1)}),u&&x&&(0,pt.jsx)(Rt,{path:x,availableCourses:n,onUpdate:async e=>{if(j.current)console.log("\u51e6\u7406\u4e2d\u306e\u305f\u3081\u3001\u91cd\u8907\u64cd\u4f5c\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");else if(y)console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u306e\u305f\u3081\u3001\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u66f4\u65b0\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");else{j.current=!0;try{(await Qe(`/api/curriculum-paths/${e.id}`,e)).success?(N(),m(!1),g(null)):i("\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(t){if("Authentication failed"===t.message||"Authentication error handling in progress"===t.message)return console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u51e6\u7406\u3092\u505c\u6b62\u3057\u307e\u3059\u3002"),v(!0),void i("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u307e\u3059\u3002");i("\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u306e\u66f4\u65b0\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"),console.error("Error updating curriculum path:",t)}finally{setTimeout(()=>{j.current=!1},1e3)}}},onClose:()=>{m(!1),g(null)}})]})},Ft=()=>{const[e,t]=(0,r.useState)([]),[n,s]=(0,r.useState)([]),[a,l]=(0,r.useState)({}),[o,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),[u,m]=(0,r.useState)(!0),[x,g]=(0,r.useState)(null),[h,p]=(0,r.useState)({name:"",email:"",username:"",password:"",role:9,status:"active",company_id:null}),[f,b]=(0,r.useState)({isChecking:!1,isValid:null,message:"",suggestions:[]}),[y,v]=(0,r.useState)(!1),[j,N]=(0,r.useState)({key:"name",direction:"asc"}),[w,k]=(0,r.useState)({adminName:"",action:"",startDate:"",endDate:""}),[S,_]=(0,r.useState)(!1),C=async()=>{try{m(!0),g(null);const e=await He(`/api/admins?includeDeleted=${y}`);t(e.admins||[])}catch(e){console.error("\u7ba1\u7406\u8005\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",e),g("\u7ba1\u7406\u8005\u4e00\u89a7\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}finally{m(!1)}};(0,r.useEffect)(()=>{(async()=>{await C(),await I()})()},[y]);const I=async()=>{try{const e=await xt(),t=await ht();console.log("\u53d6\u5f97\u3057\u305f\u64cd\u4f5c\u30ed\u30b0:",e),console.log("\u53d6\u5f97\u3057\u305f\u7d71\u8a08\u60c5\u5831:",t),s(e),l(t)}catch(x){console.error("\u64cd\u4f5c\u30ed\u30b0\u306e\u8aad\u307f\u8fbc\u307f\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",x)}},T=e=>{const t=(e=>{if(!e||"string"!==typeof e)return null;try{return JSON.parse(e)}catch(t){return null}})(e.details);if(!t)return e.details||"-";switch(e.action){case"create_lesson":{const e=t.hasFile?"\u3042\u308a":"\u306a\u3057",n=t.courseTitle?`, \u30b3\u30fc\u30b9: ${t.courseTitle}`:null!=t.courseId?`, \u30b3\u30fc\u30b9ID: ${t.courseId}`:"";return`\u30ec\u30c3\u30b9\u30f3\u300c${t.title||"-"}\u300d\u3092\u4f5c\u6210\uff08\u30d5\u30a1\u30a4\u30eb: ${e}${n}\uff09`}case"update_lesson":{const e=t.hasFile?"\u3042\u308a":"\u306a\u3057",n=t.courseTitle?`, \u30b3\u30fc\u30b9: ${t.courseTitle}`:"";return`\u30ec\u30c3\u30b9\u30f3\u300c${t.title||"-"}\u300d\u3092\u66f4\u65b0\uff08\u30d5\u30a1\u30a4\u30eb: ${e}${n}\uff09`}case"delete_lesson":{const e=t.hasS3File?"\u3042\u308a":"\u306a\u3057";return`\u30ec\u30c3\u30b9\u30f3\u300c${t.title||"-"}\u300d\u3092\u524a\u9664\uff08S3\u30d5\u30a1\u30a4\u30eb: ${e}\uff09`}case"create_course":return`\u30b3\u30fc\u30b9\u300c${t.title||"-"}\u300d\u3092\u4f5c\u6210\uff08\u30ab\u30c6\u30b4\u30ea: ${t.category||"-"}\uff09`;case"update_course":return`\u30b3\u30fc\u30b9\u300c${t.title||"-"}\u300d\u3092\u66f4\u65b0\uff08\u30ab\u30c6\u30b4\u30ea: ${t.category||"-"}\uff09`;case"delete_course":return`\u30b3\u30fc\u30b9\u300c${t.title||"-"}\u300d\u3092\u524a\u9664`;case"create_admin":return`\u7ba1\u7406\u8005\u300c${t.name||"-"}\u300d\u3092\u4f5c\u6210`;case"update_admin":return`\u7ba1\u7406\u8005\u300c${t.name||"-"}\u300d\u3092\u66f4\u65b0`;case"delete_admin":return`\u7ba1\u7406\u8005\u300c${t.name||"-"}\u300d\u3092\u524a\u9664`;case"restore_admin":return`\u7ba1\u7406\u8005\u300c${t.name||"-"}\u300d\u3092\u5fa9\u5143`;case"permanently_delete_admin":return`\u7ba1\u7406\u8005\u300c${t.name||"-"}\u300d\u3092\u5b8c\u5168\u524a\u9664`;default:return e.details}},P=e=>e?e.replace(/\uff08\d+\uff09$/,"").replace(/\(\d+\)$/,""):e,L=async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const s={action:e,details:t};n&&n.adminId&&(s.adminId=n.adminId),n&&n.adminName&&(s.adminName=n.adminName),await mt(s),I()},E=e=>{let t="asc";j.key===e&&"asc"===j.direction&&(t="desc"),N({key:e,direction:t})},D=e=>"active"===e?"\u6709\u52b9":"\u7121\u52b9",A=async e=>{if(e&&""!==e.trim()){b(e=>({...e,isChecking:!0}));try{const n=await He(`/api/username/check/${encodeURIComponent(e)}`);if(n.success){if(b({isChecking:!1,isValid:n.available,message:n.message,suggestions:[]}),!n.available)try{const t=await He(`/api/username/suggestions/${encodeURIComponent(e)}`);t.success&&t.suggestions.length>0&&b(e=>({...e,suggestions:t.suggestions}))}catch(t){console.error("\u5019\u88dc\u53d6\u5f97\u30a8\u30e9\u30fc:",t)}}else b({isChecking:!1,isValid:!1,message:n.message||"\u30ed\u30b0\u30a4\u30f3ID\u306e\u30c1\u30a7\u30c3\u30af\u306b\u5931\u6557\u3057\u307e\u3057\u305f",suggestions:[]})}catch(x){console.error("username\u91cd\u8907\u30c1\u30a7\u30c3\u30af\u30a8\u30e9\u30fc:",x),b({isChecking:!1,isValid:!1,message:"\u30ed\u30b0\u30a4\u30f3ID\u306e\u30c1\u30a7\u30c3\u30af\u306b\u5931\u6557\u3057\u307e\u3057\u305f",suggestions:[]})}}else b({isChecking:!1,isValid:null,message:"",suggestions:[]})},[$,z]=(0,r.useState)(null),O=e=>{const{name:t,value:n,type:s,checked:r}=e.target;if("username"===t){if(!/^[a-zA-Z0-9_/.-]*$/.test(n))return;$&&clearTimeout($);const e=setTimeout(()=>{A(n)},500);z(e)}p(e=>({...e,[t]:"checkbox"===s?r:n}))},R=async e=>{if(window.confirm(`\u7ba1\u7406\u8005\u300c${e.name}\u300d\u3092\u5fa9\u5143\u3057\u307e\u3059\u304b\uff1f`))try{const t=await We(`/api/admins/${e.id}/restore`);if(t.success){await C();const t=Ue(),n=t?t.name||t.username:"\u4e0d\u660e\u306a\u7ba1\u7406\u8005",s=t?t.id:"unknown";await L("\u7ba1\u7406\u8005\u5fa9\u5143",`\u7ba1\u7406\u8005\u300c${P(e.name)}\u300d\u3092\u5fa9\u5143\u3057\u307e\u3057\u305f`,{adminId:s,adminName:n})}else g(t.message||"\u7ba1\u7406\u8005\u306e\u5fa9\u5143\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(t){console.error("\u7ba1\u7406\u8005\u5fa9\u5143\u30a8\u30e9\u30fc:",t),g("\u5fa9\u5143\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}},M=e=>{const{name:t,value:n}=e.target;k(e=>({...e,[t]:n}))};return u?(0,pt.jsx)("div",{className:"p-6 max-w-7xl mx-auto",children:(0,pt.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-500 mx-auto mb-4"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]})})}):(0,pt.jsxs)("div",{className:"p-6 max-w-7xl mx-auto",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-8 pb-6 border-b-2 border-gray-200",children:[(0,pt.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"\u7ba1\u7406\u8005\u7ba1\u7406"}),(0,pt.jsx)("button",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 hover:-translate-y-0.5 shadow-lg hover:shadow-xl",onClick:()=>i(!0),children:"\uff0b \u7ba1\u7406\u8005\u8ffd\u52a0"})]}),x&&(0,pt.jsxs)("div",{className:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:[(0,pt.jsx)("p",{className:"font-semibold",children:"\u30a8\u30e9\u30fc:"}),(0,pt.jsx)("p",{children:x}),(0,pt.jsx)("button",{onClick:()=>g(null),className:"mt-2 text-red-600 hover:text-red-800 underline",children:"\u9589\u3058\u308b"})]}),(0,pt.jsxs)("div",{className:"mb-4 flex items-center",children:[(0,pt.jsx)("input",{type:"checkbox",id:"showDeleted",checked:y,onChange:e=>{return t=e.target.checked,void v(t);var t},className:"mr-2"}),(0,pt.jsx)("label",{htmlFor:"showDeleted",className:"text-gray-700",children:"\u524a\u9664\u6e08\u307f\u3082\u8868\u793a"})]}),o&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-8 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800 mb-6",children:c?"\u7ba1\u7406\u8005\u60c5\u5831\u7de8\u96c6":"\u7ba1\u7406\u8005\u8ffd\u52a0"}),(0,pt.jsx)(Lt,{error:x,onClose:()=>g(null)}),(0,pt.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{if(c){const e=await Qe(`/api/admins/${c.id}`,h);if(!e.success)return void g(e.message||"\u7ba1\u7406\u8005\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f");{await C();const e=Ue(),t=e?e.name||e.username:"\u4e0d\u660e\u306a\u7ba1\u7406\u8005",n=e?e.id:"unknown";await L("\u7ba1\u7406\u8005\u66f4\u65b0",`\u7ba1\u7406\u8005\u300c${P(h.name)}\u300d\u306e\u60c5\u5831\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f`,{adminId:n,adminName:t}),p({name:"",email:"",username:"",password:"",role:9,status:"active",company_id:null}),b({isChecking:!1,isValid:null,message:"",suggestions:[]}),i(!1),d(null),g(null)}}else{const e=await We("/api/admins",h);if(!e.success)return void g(e.message||"\u7ba1\u7406\u8005\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f");{await C();const e=Ue(),t=e?e.name||e.username:"\u4e0d\u660e\u306a\u7ba1\u7406\u8005",n=e?e.id:"unknown";await L("\u7ba1\u7406\u8005\u4f5c\u6210",`\u7ba1\u7406\u8005\u300c${P(h.name)}\u300d\u3092\u65b0\u898f\u4f5c\u6210\u3057\u307e\u3057\u305f`,{adminId:n,adminName:t}),p({name:"",email:"",username:"",password:"",role:9,status:"active",company_id:null}),b({isChecking:!1,isValid:null,message:"",suggestions:[]}),i(!1),d(null),g(null)}}}catch(t){console.error("\u7ba1\u7406\u8005\u64cd\u4f5c\u30a8\u30e9\u30fc:",t),g("\u64cd\u4f5c\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}},className:"space-y-6",children:[(0,pt.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u30e6\u30fc\u30b6\u540d *"}),(0,pt.jsx)("input",{type:"text",name:"name",value:h.name,onChange:O,required:!0,placeholder:"\u5c71\u7530\u7ba1\u7406\u8005",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u30e6\u30fc\u30b6ID *"}),(0,pt.jsxs)("div",{className:"relative",children:[(0,pt.jsx)("input",{type:"text",name:"username",value:h.username,onChange:O,required:!0,placeholder:"yamada_admin",className:"w-full px-4 py-3 border-2 rounded-lg focus:outline-none transition-colors duration-300 "+(!0===f.isValid?"border-green-400 focus:border-green-500":!1===f.isValid?"border-red-400 focus:border-red-500":"border-gray-200 focus:border-indigo-400")}),f.isChecking&&(0,pt.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,pt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-indigo-500"})}),!0===f.isValid&&!f.isChecking&&(0,pt.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,pt.jsx)("svg",{className:"h-4 w-4 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),!1===f.isValid&&!f.isChecking&&(0,pt.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,pt.jsx)("svg",{className:"h-4 w-4 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,pt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\u4f7f\u7528\u53ef\u80fd\u6587\u5b57: \u534a\u89d2\u82f1\u6570\u5b57\u3001\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2(_)\u3001\u30cf\u30a4\u30d5\u30f3(-)\u3001\u30b9\u30e9\u30c3\u30b7\u30e5(/)\u3001\u30c9\u30c3\u30c8(.)"}),f.message&&(0,pt.jsx)("div",{className:"mt-2 text-sm "+(!0===f.isValid?"text-green-600":!1===f.isValid?"text-red-600":"text-gray-600"),children:f.message}),f.suggestions.length>0&&(0,pt.jsxs)("div",{className:"mt-2",children:[(0,pt.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:"\u5229\u7528\u53ef\u80fd\u306a\u5019\u88dc:"}),(0,pt.jsx)("div",{className:"flex flex-wrap gap-2",children:f.suggestions.map((e,t)=>(0,pt.jsx)("button",{type:"button",onClick:()=>{p(t=>({...t,username:e})),A(e)},className:"px-3 py-1 text-xs bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200 transition-colors",children:e},t))})]})]})]}),(0,pt.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9"}),(0,pt.jsx)("input",{type:"email",name:"email",value:h.email,onChange:O,placeholder:"yamada@studysphere.com",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:c?"\u30d1\u30b9\u30ef\u30fc\u30c9\uff08\u5909\u66f4\u3059\u308b\u5834\u5408\u306e\u307f\uff09":"\u30d1\u30b9\u30ef\u30fc\u30c9 *"}),(0,pt.jsx)("input",{type:"password",name:"password",value:h.password,onChange:O,required:!c,minLength:"6",placeholder:"\u30d1\u30b9\u30ef\u30fc\u30c9",className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300"}),(0,pt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"6\u6587\u5b57\u4ee5\u4e0a\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"})]})]}),(0,pt.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u6a29\u9650\u30ec\u30d9\u30eb"}),(0,pt.jsx)("select",{name:"role",value:h.role,onChange:O,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300",children:(0,pt.jsx)("option",{value:9,children:"\u30a2\u30c9\u30df\u30f3\u30e6\u30fc\u30b6\u30fc"})})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u30b9\u30c6\u30fc\u30bf\u30b9"}),(0,pt.jsxs)("select",{name:"status",value:h.status,onChange:O,className:"w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-indigo-400 transition-colors duration-300",children:[(0,pt.jsx)("option",{value:"active",children:"\u6709\u52b9"}),(0,pt.jsx)("option",{value:"inactive",children:"\u7121\u52b9"})]})]})]}),(0,pt.jsxs)("div",{className:"flex gap-4 pt-6 border-t border-gray-200",children:[(0,pt.jsx)("button",{type:"button",onClick:()=>{i(!1),d(null),p({name:"",email:"",username:"",password:"",role:5,status:"active",company_id:null}),b({isChecking:!1,isValid:null,message:"",suggestions:[]}),g(null)},className:"flex-1 bg-gray-100 text-gray-700 border-2 border-gray-200 px-6 py-3 rounded-lg font-semibold transition-all duration-300 hover:bg-gray-200 hover:border-gray-300",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{type:"submit",className:"flex-1 bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-300 hover:-translate-y-0.5 shadow-lg hover:shadow-xl",children:c?"\u66f4\u65b0":"\u8ffd\u52a0"})]})]})]})}),(0,pt.jsxs)("div",{className:"mb-10",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:"\u7ba1\u7406\u8005\u4e00\u89a7"}),(0,pt.jsx)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"w-full",children:[(0,pt.jsx)("thead",{className:"bg-red-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>E("name"),children:["\ud83d\udc64 \u30e6\u30fc\u30b6\u540d","name"===j.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===j.direction?" \u2191":" \u2193"})]}),(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>E("username"),children:["\ud83c\udd94 \u30e6\u30fc\u30b6ID","username"===j.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===j.direction?" \u2191":" \u2193"})]}),(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>E("email"),children:["\ud83d\udce7 \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9","email"===j.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===j.direction?" \u2191":" \u2193"})]}),(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>E("role"),children:["\ud83d\udd11 \u6a29\u9650","role"===j.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===j.direction?" \u2191":" \u2193"})]}),(0,pt.jsxs)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800 cursor-pointer hover:bg-red-100 transition-colors duration-200",onClick:()=>E("status"),children:["\ud83d\udcca \u30b9\u30c6\u30fc\u30bf\u30b9","status"===j.key&&(0,pt.jsx)("span",{className:"ml-1",children:"asc"===j.direction?" \u2191":" \u2193"})]}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",children:"\u2699\ufe0f \u64cd\u4f5c"})]})}),(0,pt.jsx)("tbody",{children:[...e].sort((e,t)=>{let n=e[j.key],s=t[j.key];return"status"===j.key&&(n=D(e.status),s=D(t.status)),n<s?"asc"===j.direction?-1:1:n>s?"asc"===j.direction?1:-1:0}).filter(e=>y||"active"===e.status).map((e,t)=>{return(0,pt.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors duration-200 "+(t%2===0?"bg-white":"bg-gray-50"),children:[(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsx)("strong",{className:"text-gray-800",children:e.name})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsx)("strong",{className:"text-gray-800",children:e.username})}),(0,pt.jsxs)("td",{className:"px-6 py-4 text-gray-600",children:["\ud83d\udce7 ",e.email||"-"]}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsx)("span",{className:"bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium",children:10===e.role?"\u30de\u30b9\u30bf\u30fc\u30e6\u30fc\u30b6\u30fc":"\u30a2\u30c9\u30df\u30f3\u30e6\u30fc\u30b6\u30fc"})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(n=e.status,"active"===n?(0,pt.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800",children:"\u6709\u52b9"}):(0,pt.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-gray-200 text-gray-500",children:"\u7121\u52b9"})),e.isDeleted&&(0,pt.jsx)("span",{className:"bg-red-100 text-red-800 px-2 py-1 rounded text-xs font-medium",children:"\u524a\u9664\u6e08\u307f"})]})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsxs)("div",{className:"flex gap-2",children:[!e.isDeleted&&(0,pt.jsx)("button",{className:"bg-blue-500 text-white px-3 py-1 rounded text-sm font-medium transition-colors duration-300 hover:bg-blue-600",onClick:()=>(e=>{d(e),p({name:e.name,email:e.email||"",username:e.username||"",password:"",role:e.role,status:e.status,company_id:e.company_id}),b({isChecking:!1,isValid:null,message:"",suggestions:[]}),i(!0)})(e),title:"\u7de8\u96c6",children:"\u270f\ufe0f \u7de8\u96c6"}),"active"!==e.status||e.isDeleted?e.isDeleted?(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("button",{className:"bg-green-500 text-white px-3 py-1 rounded text-sm font-medium transition-colors duration-300 hover:bg-green-600",onClick:()=>R(e),title:"\u5fa9\u5143",children:"\ud83d\udd04 \u5fa9\u5143"}),(0,pt.jsx)("button",{className:"bg-red-600 text-white px-3 py-1 rounded text-sm font-medium transition-colors duration-300 hover:bg-red-700",onClick:()=>(async e=>{if(window.confirm(`\u7ba1\u7406\u8005\u300c${e.name}\u300d\u3092\u5b8c\u5168\u306b\u524a\u9664\u3057\u307e\u3059\u304b\uff1f\n\n\u3053\u306e\u64cd\u4f5c\u306f\u53d6\u308a\u6d88\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002`))try{const t=await Ke(`/api/admins/${e.id}/permanent`);if(t.success){await C();const t=Ue(),n=t?t.name||t.username:"\u4e0d\u660e\u306a\u7ba1\u7406\u8005",s=t?t.id:"unknown";await L("\u7ba1\u7406\u8005\u7269\u7406\u524a\u9664",`\u7ba1\u7406\u8005\u300c${P(e.name)}\u300d\u3092\u5b8c\u5168\u306b\u524a\u9664\u3057\u307e\u3057\u305f`,{adminId:s,adminName:n})}else g(t.message||"\u7ba1\u7406\u8005\u306e\u5b8c\u5168\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(t){console.error("\u7ba1\u7406\u8005\u7269\u7406\u524a\u9664\u30a8\u30e9\u30fc:",t),g("\u7ba1\u7406\u8005\u306e\u5b8c\u5168\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}})(e),title:"\u5b8c\u5168\u524a\u9664",children:"\u26a0\ufe0f \u5b8c\u5168\u524a\u9664"})]}):(0,pt.jsx)("button",{className:"bg-green-500 text-white px-3 py-1 rounded text-sm font-medium transition-colors duration-300 hover:bg-green-600",onClick:()=>R(e),title:"\u5fa9\u5143",children:"\ud83d\udd04 \u5fa9\u5143"}):(0,pt.jsx)("button",{className:"bg-red-500 text-white px-3 py-1 rounded text-sm font-medium transition-colors duration-300 hover:bg-red-600",onClick:()=>(async e=>{if(window.confirm(`${e.name} \u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f`))try{const t=await Ke(`/api/admins/${e.id}`);if(t.success){await C();const t=Ue(),n=t?t.name||t.username:"\u4e0d\u660e\u306a\u7ba1\u7406\u8005",s=t?t.id:"unknown";await L("\u7ba1\u7406\u8005\u524a\u9664",`\u7ba1\u7406\u8005\u300c${P(e.name)}\u300d\u3092\u524a\u9664\u3057\u307e\u3057\u305f`,{adminId:s,adminName:n})}else g(t.message||"\u7ba1\u7406\u8005\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(t){console.error("\u7ba1\u7406\u8005\u524a\u9664\u30a8\u30e9\u30fc:",t),g("\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}})(e),title:"\u524a\u9664",children:"\ud83d\uddd1\ufe0f \u524a\u9664"})]})})]},e.id);var n})})]})})})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u64cd\u4f5c\u30ed\u30b0"}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("button",{onClick:()=>_(!S),className:"bg-blue-500 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-300 hover:bg-blue-600",children:"\ud83d\udd0d \u691c\u7d22\u30fb\u30d5\u30a3\u30eb\u30bf\u30fc"}),(0,pt.jsx)("button",{onClick:async()=>{try{const e=await(async()=>{const e=await xt(),t=Array.isArray(e)?e:[],n=[["\u65e5\u6642","\u7ba1\u7406\u8005\u540d","\u64cd\u4f5c","\u8a73\u7d30","IP\u30a2\u30c9\u30ec\u30b9"].join(",")];return t.forEach(e=>{const t=e=>e?`"${e.toString().replace(/"/g,'""')}"`:"",s=[new Date(e.timestamp).toLocaleString("ja-JP"),t(e.adminName),t(e.action),t(e.details),t(e.ipAddress)];n.push(s.join(","))}),n.join("\n")})(),t=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a"),s=URL.createObjectURL(t);n.setAttribute("href",s),n.setAttribute("download",`admin_operation_logs_${(new Date).toISOString().split("T")[0]}.csv`),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n);const r=Ue(),a=r?r.name||r.username:"\u4e0d\u660e\u306a\u7ba1\u7406\u8005",l=r?r.id:"unknown";await L("\u30ed\u30b0\u30a8\u30af\u30b9\u30dd\u30fc\u30c8","\u64cd\u4f5c\u30ed\u30b0\u3092CSV\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u3057\u307e\u3057\u305f",{adminId:l,adminName:a})}catch(x){console.error("CSV\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30a8\u30e9\u30fc:",x),g("CSV\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}},className:"bg-green-500 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-300 hover:bg-green-600",children:"\ud83d\udce5 \u30a8\u30af\u30b9\u30dd\u30fc\u30c8"}),(0,pt.jsx)("button",{onClick:async()=>{if(window.confirm("\u3059\u3079\u3066\u306e\u64cd\u4f5c\u30ed\u30b0\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f\u3053\u306e\u64cd\u4f5c\u306f\u53d6\u308a\u6d88\u305b\u307e\u305b\u3093\u3002"))try{const t=await(async()=>{try{const e=await Ke("/api/operation-logs?clearAll=true");return e.success?(localStorage.removeItem(dt),console.log("\u30ed\u30b0\u30af\u30ea\u30a2\u6210\u529f:",e.message),!0):(console.error("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30ed\u30b0\u30af\u30ea\u30a2\u306b\u5931\u6557:",e.message),!1)}catch(x){console.error("\u64cd\u4f5c\u30ed\u30b0\u306e\u30af\u30ea\u30a2\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",x);try{return localStorage.removeItem(dt),console.log("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u30ed\u30b0\u3092\u30af\u30ea\u30a2\u3057\u307e\u3057\u305f"),!0}catch(e){return console.error("\u30ed\u30fc\u30ab\u30eb\u30ed\u30b0\u30af\u30ea\u30a2\u306b\u3082\u5931\u6557\u3057\u307e\u3057\u305f:",e),!1}}})();if(t){s([]),l({totalLogs:0,todayLogs:0,thisWeekLogs:0,thisMonthLogs:0,actionCounts:{}}),g(null);try{const e=await ht();l(e)}catch(e){console.log("\u7d71\u8a08\u60c5\u5831\u306e\u518d\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\uff08\u6b63\u5e38\u306a\u52d5\u4f5c\u3067\u3059\uff09:",e)}const t=Ue(),n=t?t.name||t.username:"\u4e0d\u660e\u306a\u7ba1\u7406\u8005",r=t?t.id:"unknown";await L("\u30ed\u30b0\u30af\u30ea\u30a2","\u3059\u3079\u3066\u306e\u64cd\u4f5c\u30ed\u30b0\u3092\u524a\u9664\u3057\u307e\u3057\u305f",{adminId:r,adminName:n}),alert("\u3059\u3079\u3066\u306e\u64cd\u4f5c\u30ed\u30b0\u3092\u524a\u9664\u3057\u307e\u3057\u305f")}else g("\u30ed\u30b0\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(x){console.error("\u30ed\u30b0\u30af\u30ea\u30a2\u30a8\u30e9\u30fc:",x),g("\u30ed\u30b0\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}},className:"bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-300 hover:bg-red-600",children:"\ud83d\uddd1\ufe0f \u30ed\u30b0\u30af\u30ea\u30a2"})]})]}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,pt.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[(0,pt.jsx)("div",{className:"text-blue-800 font-semibold",children:"\u7dcf\u30ed\u30b0\u6570"}),(0,pt.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:a.totalLogs||0})]}),(0,pt.jsxs)("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[(0,pt.jsx)("div",{className:"text-green-800 font-semibold",children:"\u4eca\u65e5\u306e\u30ed\u30b0"}),(0,pt.jsx)("div",{className:"text-2xl font-bold text-green-600",children:a.todayLogs||0})]}),(0,pt.jsxs)("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[(0,pt.jsx)("div",{className:"text-yellow-800 font-semibold",children:"\u4eca\u9031\u306e\u30ed\u30b0"}),(0,pt.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:a.thisWeekLogs||0})]}),(0,pt.jsxs)("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[(0,pt.jsx)("div",{className:"text-purple-800 font-semibold",children:"\u4eca\u6708\u306e\u30ed\u30b0"}),(0,pt.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:a.thisMonthLogs||0})]})]}),S&&(0,pt.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg mb-6 border border-gray-200",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\u691c\u7d22\u30fb\u30d5\u30a3\u30eb\u30bf\u30fc\u6761\u4ef6"}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u7ba1\u7406\u8005\u540d"}),(0,pt.jsx)("input",{type:"text",name:"adminName",value:w.adminName,onChange:M,placeholder:"\u7ba1\u7406\u8005\u540d\u3067\u691c\u7d22",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-400"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u64cd\u4f5c\u5185\u5bb9"}),(0,pt.jsx)("input",{type:"text",name:"action",value:w.action,onChange:M,placeholder:"\u64cd\u4f5c\u5185\u5bb9\u3067\u691c\u7d22",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-400"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u958b\u59cb\u65e5"}),(0,pt.jsx)("input",{type:"date",name:"startDate",value:w.startDate,onChange:M,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-400"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u7d42\u4e86\u65e5"}),(0,pt.jsx)("input",{type:"date",name:"endDate",value:w.endDate,onChange:M,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-400"})]})]}),(0,pt.jsxs)("div",{className:"flex gap-2 mt-4",children:[(0,pt.jsx)("button",{onClick:async()=>{try{const e=await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{const t=await xt();return(Array.isArray(t)?t:[]).filter(t=>{if(e.adminName&&!t.adminName.includes(e.adminName))return!1;if(e.action&&!t.action.includes(e.action))return!1;if(e.startDate||e.endDate){const n=new Date(t.timestamp);if(e.startDate&&n<new Date(e.startDate))return!1;if(e.endDate){const t=new Date(e.endDate);if(t.setHours(23,59,59,999),n>t)return!1}}return!0})}catch(x){return console.error("\u30ed\u30b0\u691c\u7d22\u30a8\u30e9\u30fc:",x),[]}}(w);s(e)}catch(x){console.error("\u30ed\u30b0\u30d5\u30a3\u30eb\u30bf\u30fc\u9069\u7528\u30a8\u30e9\u30fc:",x)}},className:"bg-blue-500 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-300 hover:bg-blue-600",children:"\u691c\u7d22\u5b9f\u884c"}),(0,pt.jsx)("button",{onClick:async()=>{k({adminName:"",action:"",startDate:"",endDate:""}),await I()},className:"bg-gray-500 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-300 hover:bg-gray-600",children:"\u6761\u4ef6\u30af\u30ea\u30a2"})]})]}),(0,pt.jsxs)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"w-full table-fixed",children:[(0,pt.jsx)("thead",{className:"bg-red-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",style:{width:"180px"},children:"\ud83d\udcc5 \u65e5\u6642"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",style:{width:"150px"},children:"\ud83d\udc64 \u7ba1\u7406\u8005\u30fb\u6307\u5c0e\u54e1"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",style:{width:"120px"},children:"\u26a1 \u64cd\u4f5c"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",style:{width:"300px"},children:"\ud83d\udcdd \u8a73\u7d30"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-red-800",style:{width:"140px"},children:"\ud83c\udf10 IP\u30a2\u30c9\u30ec\u30b9"})]})}),(0,pt.jsx)("tbody",{children:n.length>0?n.map(e=>{return(0,pt.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50 transition-colors duration-200",children:[(0,pt.jsxs)("td",{className:"px-6 py-4 text-gray-600 text-sm",children:["\ud83d\udcc5 ",(n=e.timestamp,new Date(n).toLocaleString("ja-JP"))]}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsx)("span",{className:"bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium",children:P(e.adminName)})}),(0,pt.jsx)("td",{className:"px-6 py-4 text-gray-700",children:(t=e.action,{create_lesson:"\u30ec\u30c3\u30b9\u30f3\u4f5c\u6210",update_lesson:"\u30ec\u30c3\u30b9\u30f3\u66f4\u65b0",delete_lesson:"\u30ec\u30c3\u30b9\u30f3\u524a\u9664",create_course:"\u30b3\u30fc\u30b9\u4f5c\u6210",update_course:"\u30b3\u30fc\u30b9\u66f4\u65b0",delete_course:"\u30b3\u30fc\u30b9\u524a\u9664",create_admin:"\u7ba1\u7406\u8005\u4f5c\u6210",update_admin:"\u7ba1\u7406\u8005\u66f4\u65b0",delete_admin:"\u7ba1\u7406\u8005\u524a\u9664",restore_admin:"\u7ba1\u7406\u8005\u5fa9\u5143",permanently_delete_admin:"\u7ba1\u7406\u8005\u7269\u7406\u524a\u9664",unknown_action:"\u4e0d\u660e\u306a\u64cd\u4f5c"}[t]||t||"\u4e0d\u660e\u306a\u64cd\u4f5c")}),(0,pt.jsx)("td",{className:"px-6 py-4 text-gray-600",children:T(e)}),(0,pt.jsxs)("td",{className:"px-6 py-4 text-gray-500 text-sm",children:["\ud83c\udf10 ",e.ipAddress]})]},e.id);var t,n}):(0,pt.jsx)("tr",{children:(0,pt.jsx)("td",{colSpan:"5",className:"px-6 py-8 text-center text-gray-500",children:"\u64cd\u4f5c\u30ed\u30b0\u304c\u3042\u308a\u307e\u305b\u3093"})})})]})}),n.length>0&&(0,pt.jsxs)("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200 text-sm text-gray-600",children:["\u8868\u793a\u4e2d: ",n.length,"\u4ef6\u306e\u30ed\u30b0\uff08\u6700\u5927100\u4ef6\u300130\u65e5\u9593\u4fdd\u6301\uff09"]})]})]})]})},Ut=()=>{const{currentUser:e,isAuthenticated:t}=bt(),[n,s]=(0,r.useState)([]),[a,l]=(0,r.useState)([]),[o,i]=(0,r.useState)([]),[c,d]=(0,r.useState)([]),[u,m]=(0,r.useState)([]),[x,g]=(0,r.useState)([]),[h,p]=(0,r.useState)(""),[f,b]=(0,r.useState)(""),[y,v]=(0,r.useState)(""),[j,N]=(0,r.useState)(!1),[w,k]=(0,r.useState)(""),[S,_]=(0,r.useState)("initial"),C=(0,r.useCallback)(async()=>{if(t&&e)try{N(!0);const e=new URLSearchParams;c.length>0&&c.forEach(t=>{e.append("selected_companies",t)}),u.length>0&&u.forEach(t=>{e.append("selected_satellites",t)}),x.length>0&&x.forEach(t=>{"none"!==t?e.append("selected_instructors",t):e.append("selected_instructors","none")}),console.log("API\u547c\u3073\u51fa\u3057\u30d1\u30e9\u30e1\u30fc\u30bf:",e.toString());const t=await He(`/api/temp-passwords/users-by-hierarchy?${e}`);if(t.success){console.log("\u5229\u7528\u8005\u30c7\u30fc\u30bf:",t.data),console.log("\u5229\u7528\u8005\u30c7\u30fc\u30bf\u306e\u8a73\u7d30:"),t.data.forEach((e,t)=>{console.log(`${t+1}. ${e.name} - ${e.company_name}/${e.satellite_name} (instructor_id: ${e.instructor_id}, satellite_ids: ${JSON.stringify(e.satellite_ids)})`)}),s(t.data);const e=T(t.data,S).map(e=>e.id);l(e)}}catch(n){console.error("\u5229\u7528\u8005\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",n),k("\u5229\u7528\u8005\u4e00\u89a7\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}finally{N(!1)}else k("\u30ed\u30b0\u30a4\u30f3\u304c\u5fc5\u8981\u3067\u3059\u3002")},[t,e,c,u,x]);(0,r.useEffect)(()=>{(async()=>{if(t&&e)try{const e=await He("/api/temp-passwords/hierarchy");e.success&&(console.log("\u968e\u5c64\u30c7\u30fc\u30bf:",e.data),i(e.data))}catch(n){console.error("\u968e\u5c64\u30c7\u30fc\u30bf\u53d6\u5f97\u30a8\u30e9\u30fc:",n),k("\u968e\u5c64\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}else k("\u30ed\u30b0\u30a4\u30f3\u304c\u5fc5\u8981\u3067\u3059\u3002")})()},[]),(0,r.useEffect)(()=>{o.length>0&&C()},[C,o.length]);const I=e=>{g(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e]),setTimeout(()=>{o.length>0&&C()},100)},T=(e,t)=>{switch(t){case"initial":return e.filter(e=>"no_instructor"===e.user_type||"selected_instructor"===e.user_type);case"all":default:return e;case"no_instructor":return e.filter(e=>"no_instructor"===e.user_type);case"selected_instructor":return e.filter(e=>"selected_instructor"===e.user_type);case"other_instructor":return e.filter(e=>"other_instructor"===e.user_type)}},P=()=>T(n,S),L=e=>{switch(e){case"no_instructor":return"\u62c5\u5f53\u306a\u3057";case"selected_instructor":return"\u9078\u629e\u62c5\u5f53\u8005\u306e\u5229\u7528\u8005";case"other_instructor":return"\u305d\u306e\u4ed6\u306e\u62c5\u5f53\u8005\u306e\u5229\u7528\u8005";case"my_user":return"\u81ea\u5206\u306e\u62c5\u5f53\u5229\u7528\u8005";case"no_instructor_no_temp":return"\u62c5\u5f53\u306a\u3057\u30fb\u30d1\u30b9\u30ef\u30fc\u30c9\u672a\u767a\u884c";default:return"\u305d\u306e\u4ed6"}},E=()=>0===c.length?[]:o.filter(e=>c.includes(e.id)).flatMap(e=>e.satellites);return(0,pt.jsxs)("div",{className:"max-w-6xl mx-auto p-6",children:[(0,pt.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u7ba1\u7406"}),w&&(0,pt.jsx)("div",{className:"p-4 mb-4 rounded "+(w.includes("\u5931\u6557")?"bg-red-100 text-red-700":"bg-green-100 text-green-700"),children:w}),(0,pt.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[(0,pt.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"\u62c5\u5f53\u8005\u9078\u629e"}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("h3",{className:"text-md font-medium mb-3 text-gray-700",children:"\u4f01\u696d\u9078\u629e"}),(0,pt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:o.map(e=>(0,pt.jsxs)("label",{className:"flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer",children:[(0,pt.jsx)("input",{type:"checkbox",checked:c.includes(e.id),onChange:()=>{return t=e.id,d(e=>{const n=e.includes(t)?e.filter(e=>e!==t):[...e,t];if(e.includes(t)){const e=o.find(e=>e.id===t);if(e){const t=e.satellites.map(e=>e.id),n=e.satellites.flatMap(e=>e.instructors.map(e=>e.id));m(e=>e.filter(e=>!t.includes(e))),g(e=>e.filter(e=>!n.includes(e)))}}return n}),void setTimeout(()=>{o.length>0&&C()},100);var t},className:"mr-3"}),(0,pt.jsx)("span",{className:"font-medium",children:e.name})]},e.id))})]}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("h3",{className:"text-md font-medium mb-3 text-gray-700",children:"\u62e0\u70b9\u9078\u629e"}),0===c.length?(0,pt.jsx)("p",{className:"text-gray-500 italic",children:"\u4f01\u696d\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}):(0,pt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:E().map(e=>{var t;return(0,pt.jsxs)("label",{className:"flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer",children:[(0,pt.jsx)("input",{type:"checkbox",checked:u.includes(e.id),onChange:()=>{return t=e.id,m(e=>{const n=e.includes(t)?e.filter(e=>e!==t):[...e,t];if(e.includes(t)){const e=o.flatMap(e=>e.satellites).find(e=>e.id===t);if(e){const t=e.instructors.map(e=>e.id);g(e=>e.filter(e=>!t.includes(e)))}}return n}),void setTimeout(()=>{o.length>0&&C()},100);var t},className:"mr-3"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:e.name}),(0,pt.jsx)("div",{className:"text-sm text-gray-500",children:null===(t=o.find(t=>t.id===e.company_id))||void 0===t?void 0:t.name})]})]},e.id)})})]}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("h3",{className:"text-md font-medium mb-3 text-gray-700",children:"\u62c5\u5f53\u8005\u9078\u629e\uff08\u8907\u6570\u9078\u629e\u53ef\u80fd\uff09"}),0===c.length?(0,pt.jsx)("p",{className:"text-gray-500 italic",children:"\u4f01\u696d\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}):(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[(0,pt.jsxs)("label",{className:"flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer",children:[(0,pt.jsx)("input",{type:"checkbox",checked:x.includes("none"),onChange:()=>I("none"),className:"mr-3"}),(0,pt.jsx)("span",{className:"font-medium text-gray-600",children:"\u62c5\u5f53\u306a\u3057"})]}),(()=>{const e=E();return 0===u.length?o.filter(e=>c.includes(e.id)).flatMap(e=>e.satellites).flatMap(e=>e.instructors).filter((e,t,n)=>n.findIndex(t=>t.id===e.id)===t):e.filter(e=>u.includes(e.id)).flatMap(e=>e.instructors).filter((e,t,n)=>n.findIndex(t=>t.id===e.id)===t)})().map(e=>{var t,n,s;return(0,pt.jsxs)("label",{className:"flex items-center p-3 border rounded hover:bg-gray-50 cursor-pointer",children:[(0,pt.jsx)("input",{type:"checkbox",checked:x.includes(e.id),onChange:()=>I(e.id),className:"mr-3"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:e.name}),(0,pt.jsxs)("div",{className:"text-sm text-gray-500",children:[null===(t=o.find(t=>t.id===e.company_id))||void 0===t?void 0:t.name," /",null===(n=o.find(t=>t.id===e.company_id))||void 0===n||null===(s=n.satellites.find(t=>t.id===e.satellite_id))||void 0===s?void 0:s.name]})]})]},e.id)})]})]})]}),(0,pt.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,pt.jsx)("h2",{className:"text-lg font-semibold",children:"\u5229\u7528\u8005\u9078\u629e"}),(0,pt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,pt.jsxs)("select",{value:S,onChange:e=>_(e.target.value),className:"px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,pt.jsx)("option",{value:"initial",children:"\u521d\u671f\u8868\u793a\uff08\u62c5\u5f53\u306a\u3057\uff0b\u9078\u629e\u62c5\u5f53\u8005\uff09"}),(0,pt.jsx)("option",{value:"all",children:"\u5168\u3066\u306e\u5229\u7528\u8005"}),(0,pt.jsx)("option",{value:"no_instructor",children:"\u62c5\u5f53\u306a\u3057\u306e\u307f"}),(0,pt.jsx)("option",{value:"selected_instructor",children:"\u9078\u629e\u62c5\u5f53\u8005\u306e\u5229\u7528\u8005\u306e\u307f"}),(0,pt.jsx)("option",{value:"other_instructor",children:"\u305d\u306e\u4ed6\u306e\u62c5\u5f53\u8005\u306e\u5229\u7528\u8005\u306e\u307f"})]}),(0,pt.jsx)("button",{onClick:()=>{const e=P().map(e=>e.id);if(a.filter(t=>e.includes(t)).length===e.length)l(a.filter(t=>!e.includes(t)));else{const t=[...new Set([...a,...e])];l(t)}},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:(()=>{const e=P().map(e=>e.id);return a.filter(t=>e.includes(t)).length===e.length?"\u5168\u89e3\u9664":"\u5168\u9078\u629e"})()})]})]}),j?(0,pt.jsx)("div",{className:"text-center py-4",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."}):0===n.length?(0,pt.jsx)("div",{className:"text-center py-8 text-gray-500",children:0===c.length?(0,pt.jsxs)("div",{children:[(0,pt.jsx)("p",{children:"\u62c5\u5f53\u306a\u3057\u307e\u305f\u306f\u81ea\u62c5\u5f53\u3067\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u672a\u767a\u884c\u306e\u5229\u7528\u8005\u304c\u3044\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-sm mt-2",children:"\u4f01\u696d\u30fb\u62e0\u70b9\u30fb\u62c5\u5f53\u8005\u3092\u9078\u629e\u3057\u3066\u8a73\u7d30\u306a\u6761\u4ef6\u3067\u691c\u7d22\u3057\u3066\u304f\u3060\u3055\u3044"})]}):(0,pt.jsxs)("div",{children:[(0,pt.jsx)("p",{children:"\u9078\u629e\u6761\u4ef6\u306b\u8a72\u5f53\u3059\u308b\u5229\u7528\u8005\u304c\u3044\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-sm mt-2",children:"\u62c5\u5f53\u8005\u3092\u9078\u629e\u3059\u308b\u304b\u3001\u6761\u4ef6\u3092\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044"})]})}):(0,pt.jsxs)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[P().map(e=>(0,pt.jsxs)("div",{className:"flex items-center p-3 border rounded hover:bg-gray-50",children:[(0,pt.jsx)("input",{type:"checkbox",checked:a.includes(e.id),onChange:()=>{return t=e.id,void l(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"mr-3"}),(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("div",{className:"font-medium",children:e.name}),(0,pt.jsxs)("div",{className:"text-sm text-gray-600",children:[e.company_name," / ",e.satellite_name]}),(0,pt.jsx)("div",{className:"text-xs text-blue-600",children:L(e.user_type)})]})]},e.id)),0===P().length&&n.length>0&&(0,pt.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,pt.jsx)("p",{children:"\u9078\u629e\u3057\u305f\u30d5\u30a3\u30eb\u30bf\u30fc\u6761\u4ef6\u306b\u8a72\u5f53\u3059\u308b\u5229\u7528\u8005\u304c\u3044\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-sm mt-2",children:"\u30d5\u30a3\u30eb\u30bf\u30fc\u6761\u4ef6\u3092\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044"})]})]})]}),(0,pt.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[(0,pt.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"\u6709\u52b9\u671f\u9650\u8a2d\u5b9a\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09"}),(0,pt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,pt.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),placeholder:"HH:DD\uff08\u4f8b\uff1a23:59\uff09",pattern:"^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",className:"p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,pt.jsx)("span",{className:"text-gray-600",children:"\u307e\u3067\u6709\u52b9"})]}),(0,pt.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"\u6307\u5b9a\u306a\u3057\u306e\u5834\u5408\u306f\u65e5\u672c\u6642\u959323:59\u307e\u3067\u6709\u52b9\u3067\u3059\uff08HH:DD\u5f62\u5f0f\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\uff09"})]}),(0,pt.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow mb-6",children:[(0,pt.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"\u30a2\u30ca\u30a6\u30f3\u30b9\u30e1\u30c3\u30bb\u30fc\u30b8\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09"}),(0,pt.jsx)("input",{type:"text",value:f,onChange:e=>b(e.target.value),placeholder:"\u30a2\u30ca\u30a6\u30f3\u30b9\u30bf\u30a4\u30c8\u30eb",className:"w-full p-2 border border-gray-300 rounded mb-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,pt.jsx)("textarea",{value:y,onChange:e=>v(e.target.value),placeholder:"\u30a2\u30ca\u30a6\u30f3\u30b9\u30e1\u30c3\u30bb\u30fc\u30b8",rows:"4",className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,pt.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"\u9078\u629e\u3055\u308c\u305f\u5229\u7528\u8005\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u95b2\u89a7\u3067\u304d\u308b\u30a2\u30ca\u30a6\u30f3\u30b9\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4e00\u62ec\u9001\u4fe1\u3057\u307e\u3059"})]}),(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("button",{onClick:async()=>{if(t&&e)if(0!==a.length)try{N(!0);const e={user_ids:a,expiry_time:h||null,announcement_title:f||null,announcement_message:y||null},t=await We("/api/temp-passwords/issue",e);t.success&&(k(`${t.message}`),await C(),l([]),p(""),b(""),v(""))}catch(n){console.error("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u30a8\u30e9\u30fc:",n),k(n.message||"\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u767a\u884c\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}finally{N(!1)}else k("\u5229\u7528\u8005\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044");else k("\u30ed\u30b0\u30a4\u30f3\u304c\u5fc5\u8981\u3067\u3059\u3002")},disabled:j||0===a.length,className:"px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:j?"\u767a\u884c\u4e2d...":`${a.length}\u540d\u306b\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u767a\u884c`}),a.length>0&&(0,pt.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:["\u9078\u629e\u4e2d\u306e\u5229\u7528\u8005: ",a.length,"\u540d",P().length>0&&(0,pt.jsxs)("span",{className:"ml-2",children:["\uff08\u8868\u793a\u4e2d: ",P().filter(e=>a.includes(e.id)).length,"\u540d\uff09"]})]})]})]})},Bt=e=>{let{isOpen:t,onClose:n,onPasswordChange:s,user:a}=e;const[l,o]=(0,r.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),[i,c]=(0,r.useState)({}),[d,u]=(0,r.useState)(!1),m=e=>{const{name:t,value:n}=e.target;o(e=>({...e,[t]:n})),i[t]&&c(e=>({...e,[t]:""}))};return t?(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-lg p-8 max-w-md w-full mx-4",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"\ud83d\udd10 \u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4"}),(0,pt.jsx)("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"\xd7"})]}),(null===a||void 0===a?void 0:a.passwordResetRequired)&&(0,pt.jsxs)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2 text-red-600",children:[(0,pt.jsx)("span",{className:"text-red-500",children:"\u26a0\ufe0f"}),(0,pt.jsx)("span",{className:"font-medium",children:"\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u5909\u66f4\u304c\u5fc5\u8981\u3067\u3059"})]}),(0,pt.jsx)("p",{className:"text-red-600 text-sm mt-2",children:"\u7ba1\u7406\u8005\u304b\u3089\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u304c\u8981\u6c42\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})]}),(0,pt.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),c({});const t={};if(l.currentPassword||(t.currentPassword="\u73fe\u5728\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),l.newPassword){const e=(e=>{const t=[];return e.length<8&&t.push("8\u6587\u5b57\u4ee5\u4e0a\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),/[A-Z]/.test(e)||t.push("\u5927\u6587\u5b57\u3092\u542b\u3081\u3066\u304f\u3060\u3055\u3044"),/[a-z]/.test(e)||t.push("\u5c0f\u6587\u5b57\u3092\u542b\u3081\u3066\u304f\u3060\u3055\u3044"),/[0-9]/.test(e)||t.push("\u6570\u5b57\u3092\u542b\u3081\u3066\u304f\u3060\u3055\u3044"),t})(l.newPassword);e.length>0&&(t.newPassword=e.join(", "))}else t.newPassword="\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044";if(l.confirmPassword?l.newPassword!==l.confirmPassword&&(t.confirmPassword="\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u4e00\u81f4\u3057\u307e\u305b\u3093"):t.confirmPassword="\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u78ba\u8a8d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",Object.keys(t).length>0)c(t);else{u(!0);try{await s(l.currentPassword,l.newPassword),o({currentPassword:"",newPassword:"",confirmPassword:""}),n()}catch(r){console.error("\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u30a8\u30e9\u30fc:",r)}finally{u(!1)}}},className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u73fe\u5728\u306e\u30d1\u30b9\u30ef\u30fc\u30c9"}),(0,pt.jsx)(Ct,{type:"password",name:"currentPassword",value:l.currentPassword,onChange:m,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 "+(i.currentPassword?"border-red-500":"border-gray-300"),placeholder:"\u73fe\u5728\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b"}),i.currentPassword&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.currentPassword})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9"}),(0,pt.jsx)(Ct,{type:"password",name:"newPassword",value:l.newPassword,onChange:m,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 "+(i.newPassword?"border-red-500":"border-gray-300"),placeholder:"\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b"}),i.newPassword&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.newPassword}),(0,pt.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"8\u6587\u5b57\u4ee5\u4e0a\u3001\u5927\u6587\u5b57\u30fb\u5c0f\u6587\u5b57\u30fb\u6570\u5b57\u3092\u542b\u3081\u3066\u304f\u3060\u3055\u3044"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9\uff08\u78ba\u8a8d\uff09"}),(0,pt.jsx)(Ct,{type:"password",name:"confirmPassword",value:l.confirmPassword,onChange:m,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 "+(i.confirmPassword?"border-red-500":"border-gray-300"),placeholder:"\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u518d\u5165\u529b"}),i.confirmPassword&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.confirmPassword})]}),(0,pt.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,pt.jsx)("button",{type:"submit",disabled:d,className:"flex-1 bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d?"\u5909\u66f4\u4e2d...":"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4"}),(0,pt.jsx)("button",{type:"button",onClick:n,className:"flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-400 transition-colors",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})]})}):null},Jt=()=>{var e;const[t,n]=(0,r.useState)(()=>sessionStorage.getItem("adminDashboardActiveTab")||"locations"),[s,a]=(0,r.useState)(!1),{currentUser:l}=(ne(),(()=>{const{isAuthenticated:e,isLoading:t,currentUser:n}=bt(),s=ne();return(0,r.useEffect)(()=>{if(console.log("=== useAdminGuard Debug ==="),console.log("isLoading:",t),console.log("isAuthenticated:",e),console.log("currentUser:",n),console.log("currentUser.role:",null===n||void 0===n?void 0:n.role),console.log("currentUser.role type:",typeof(null===n||void 0===n?void 0:n.role)),console.log("Pathname:",window.location.pathname),console.log("Timestamp:",(new Date).toISOString()),"true"!==sessionStorage.getItem("instructorDashboardSelection"))if(t)console.log("Still loading, skipping guard check");else{if(!e)return console.log("Not authenticated, redirecting to homepage"),console.log("Reason: isAuthenticated is false"),void s("/homepage");if(!n)return console.log("No currentUser, redirecting to homepage"),console.log("Reason: currentUser is null/undefined"),void s("/homepage");if(n.role<6)return console.log("User role not authorized for admin pages, redirecting to homepage"),console.log("User role:",n.role,"Expected: 6+ (admin)"),console.log("User role type:",typeof n.role),console.log("User role comparison:",n.role<6),console.log("Full currentUser object:",n),void s("/homepage");console.log("AdminGuard: User authorized"),console.log("User role:",n.role,"is authorized for admin pages")}else console.log("\u6307\u5c0e\u54e1\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u9078\u629e\u4e2d - AdminGuard\u51e6\u7406\u3092\u30b9\u30ad\u30c3\u30d7")},[e,t,n,s]),{isAuthenticated:e,isLoading:t,currentUser:n}})());(0,r.useEffect)(()=>{null!==l&&void 0!==l&&l.passwordResetRequired&&a(!0)},[l]);if(!l)return(0,pt.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,pt.jsx)("div",{className:"text-gray-600 text-lg",children:"\u8a8d\u8a3c\u4e2d..."})});const o=[{id:"locations",label:"\ud83c\udfe2 \u4e8b\u696d\u6240(\u62e0\u70b9)\u7ba1\u7406",component:(0,pt.jsx)(Et,{})},{id:"instructors",label:"\ud83d\udc68\u200d\ud83c\udfeb \u6307\u5c0e\u54e1\u7ba1\u7406",component:(0,pt.jsx)(At,{})},{id:"courses",label:"\ud83d\udcda \u30b3\u30fc\u30b9\u7ba1\u7406",component:(0,pt.jsx)($t,{})},{id:"lessons",label:"\ud83d\udcd6 \u30ec\u30c3\u30b9\u30f3\u7ba1\u7406",component:(0,pt.jsx)(zt,{})},{id:"paths",label:"\ud83c\udfaf \u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u7ba1\u7406",component:(0,pt.jsx)(Mt,{})},{id:"temp-passwords",label:"\ud83d\udd11 \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u7ba1\u7406",component:(0,pt.jsx)(Ut,{})},{id:"admins",label:"\ud83d\udc65 \u7ba1\u7406\u8005\u7ba1\u7406",component:(0,pt.jsx)(Ft,{})}];return(0,pt.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-50",children:[(0,pt.jsx)("div",{className:s?"pointer-events-none opacity-50":"",children:(0,pt.jsx)(Tt,{user:l})}),(0,pt.jsxs)("div",{className:"flex flex-col flex-1 h-[calc(100vh-80px)] overflow-hidden",children:[(0,pt.jsx)("aside",{className:"w-full bg-white border-b border-gray-200 flex-shrink-0",children:(0,pt.jsx)("nav",{className:"p-4 flex flex-row gap-2 overflow-x-auto "+(s?"pointer-events-none opacity-50":""),children:o.map(e=>(0,pt.jsx)("button",{className:"flex items-center gap-3 px-6 py-4 bg-transparent border-none text-gray-700 cursor-pointer transition-all duration-300 text-center text-sm min-w-[150px] flex-shrink-0 rounded-lg hover:bg-red-50 hover:-translate-y-0.5 "+(t===e.id?"bg-gradient-to-r from-red-500 to-red-400 text-white shadow-lg":""),onClick:()=>{n(e.id),sessionStorage.setItem("adminDashboardActiveTab",e.id)},children:e.label},e.id))})}),(0,pt.jsx)("main",{className:"flex-1 p-8 overflow-y-auto bg-white",children:s?(0,pt.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto mb-4"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u753b\u9762\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]})}):null===(e=o.find(e=>e.id===t))||void 0===e?void 0:e.component})]}),(0,pt.jsx)(Bt,{isOpen:s,onClose:()=>a(!1),onPasswordChange:async(e,t)=>{try{const n=localStorage.getItem("accessToken"),s=await fetch(`${ze.JR}/api/users/${l.id}/change-password`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({currentPassword:e,newPassword:t})}),r=await s.json();if(!r.success)throw new Error(r.message||"\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u306b\u5931\u6557\u3057\u307e\u3057\u305f");{alert("\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u6b63\u5e38\u306b\u5909\u66f4\u3055\u308c\u307e\u3057\u305f\u3002");const e={...l,passwordResetRequired:!1};localStorage.setItem("currentUser",JSON.stringify(e)),window.location.reload()}}catch(n){throw console.error("\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u306b\u5931\u6557:",n),alert(`\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${n.message}`),n}},user:l})]})},qt=(e,t)=>{try{const n=JSON.parse(localStorage.getItem("currentUser")||"{}"),s=JSON.parse(localStorage.getItem("adminOperationLogs")||"[]"),r={id:Date.now(),adminId:n.id||"unknown",adminName:n.name||"Unknown",action:e,details:t,timestamp:(new Date).toISOString(),ipAddress:"192.168.1.100"};return s.unshift(r),s.length>1e3&&s.splice(1e3),localStorage.setItem("adminOperationLogs",JSON.stringify(s)),r}catch(n){return console.error("\u64cd\u4f5c\u30ed\u30b0\u306e\u8a18\u9332\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",n),null}},Vt=e=>{let{isOpen:t,onClose:n,currentCompany:s,currentSatellite:a,onCompanySelect:l,onSatelliteSelect:o,userRole:i,userSatellites:c}=e;const[d,u]=(0,r.useState)([]),[m,x]=(0,r.useState)([]),[g,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(null),[b,y]=(0,r.useState)(!1),[v,j]=(0,r.useState)("satellite"),N=i>=9;(0,r.useEffect)(()=>{t&&(h(s),f(a),w())},[t,s,a]);const w=async()=>{y(!0);try{if(console.log("CompanySatelliteSwitchModal loadData\u958b\u59cb:",{canSwitchCompany:N,userRole:i,userSatellites:c}),N){const e=await He("/api/companies");console.log("\u4f01\u696d\u30c7\u30fc\u30bf\u53d6\u5f97\u7d50\u679c:",e);const t=e.success?e.data:e;console.log("\u51e6\u7406\u5f8c\u306e\u4f01\u696d\u30c7\u30fc\u30bf:",t),console.log("\u51e6\u7406\u5f8c\u306e\u4f01\u696d\u30c7\u30fc\u30bf\u306e\u578b:",typeof t),console.log("\u51e6\u7406\u5f8c\u306e\u4f01\u696d\u30c7\u30fc\u30bf\u304c\u914d\u5217\u304b:",Array.isArray(t)),console.log("\u51e6\u7406\u5f8c\u306e\u4f01\u696d\u30c7\u30fc\u30bf\u306e\u9577\u3055:",null===t||void 0===t?void 0:t.length),u(Array.isArray(t)?t:[])}if(i>=9){const e=await He("/api/satellites");console.log("\u62e0\u70b9\u30c7\u30fc\u30bf\u53d6\u5f97\u7d50\u679c:",e),console.log("\u62e0\u70b9\u30c7\u30fc\u30bf\u306e\u578b:",typeof e),console.log("\u62e0\u70b9\u30c7\u30fc\u30bf\u304c\u914d\u5217\u304b:",Array.isArray(e)),console.log("\u62e0\u70b9\u30c7\u30fc\u30bf\u306e\u9577\u3055:",null===e||void 0===e?void 0:e.length),console.log("\u62e0\u70b9\u30c7\u30fc\u30bf\u306e\u8a73\u7d30:",JSON.stringify(e,null,2));const t=e.success?e.data:e;console.log("\u51e6\u7406\u5f8c\u306e\u62e0\u70b9\u30c7\u30fc\u30bf:",t),console.log("\u51e6\u7406\u5f8c\u306e\u62e0\u70b9\u30c7\u30fc\u30bf\u306e\u578b:",typeof t),console.log("\u51e6\u7406\u5f8c\u306e\u62e0\u70b9\u30c7\u30fc\u30bf\u304c\u914d\u5217\u304b:",Array.isArray(t)),console.log("\u51e6\u7406\u5f8c\u306e\u62e0\u70b9\u30c7\u30fc\u30bf\u306e\u9577\u3055:",null===t||void 0===t?void 0:t.length),x(Array.isArray(t)?t:[])}else c&&c.length>0&&(console.log("\u30e6\u30fc\u30b6\u30fc\u62e0\u70b9\u30c7\u30fc\u30bf\u8a2d\u5b9a:",c),x(Array.isArray(c)?c:[]))}catch(e){console.error("\u30c7\u30fc\u30bf\u53d6\u5f97\u30a8\u30e9\u30fc:",e),u([]),x([])}finally{y(!1)}},k=i>=9&&m.length>0,S=Array.isArray(c)&&c.length>0,_=k||S;return console.log("CompanySatelliteSwitchModal Debug:",{userRole:i,satellites:m,satellitesLength:null===m||void 0===m?void 0:m.length,userSatellites:c,userSatellitesLength:null===c||void 0===c?void 0:c.length,canSwitchSatelliteForAdmin:k,canSwitchSatelliteForUser:S,canSwitchSatellite:_,activeTab:v,loading:b}),t?(0,pt.jsx)("div",{className:"fixed inset-0 bg-gray-900/50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-4xl shadow-xl",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"\u4f01\u696d\u30fb\u62e0\u70b9\u306e\u5207\u308a\u66ff\u3048"}),(0,pt.jsx)("button",{onClick:n,className:"text-gray-500 hover:text-gray-700 transition-colors",children:(0,pt.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,pt.jsxs)("div",{className:"flex border-b border-gray-200 mb-6",children:[_&&(0,pt.jsx)("button",{onClick:()=>j("satellite"),className:"px-4 py-2 font-medium transition-colors "+("satellite"===v?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"),children:"\u62e0\u70b9\u5207\u308a\u66ff\u3048"}),N&&(0,pt.jsx)("button",{onClick:()=>j("company"),className:"px-4 py-2 font-medium transition-colors "+("company"===v?"text-indigo-600 border-b-2 border-indigo-600":"text-gray-500 hover:text-gray-700"),children:"\u4f01\u696d\u5207\u308a\u66ff\u3048"})]}),(0,pt.jsx)("div",{className:"bg-indigo-50 border border-indigo-100 rounded-lg p-4 mb-6",children:(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsxs)("svg",{className:"w-5 h-5 text-indigo-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("div",{className:"text-sm text-indigo-700 font-medium",children:"\u73fe\u5728\u9078\u629e\u4e2d"}),(0,pt.jsxs)("div",{className:"text-lg font-bold text-indigo-900",children:[(null===s||void 0===s?void 0:s.name)||"\u672a\u9078\u629e"," / ",(null===a||void 0===a?void 0:a.name)||"\u672a\u9078\u629e"]})]})]})}),b?(0,pt.jsx)("div",{className:"flex justify-center items-center py-8",children:(0,pt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"})}):(0,pt.jsxs)(pt.Fragment,{children:["satellite"===v&&_&&(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsx)("h3",{className:"font-medium text-gray-700",children:i>=9?"\u5168\u62e0\u70b9\u304b\u3089\u9078\u629e":"\u6240\u5c5e\u62e0\u70b9\u304b\u3089\u9078\u629e"}),i<9&&c&&1===c.length&&(0,pt.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:(0,pt.jsx)("p",{className:"text-sm text-blue-700",children:"\u73fe\u57281\u3064\u306e\u62e0\u70b9\u306b\u306e\u307f\u6240\u5c5e\u3057\u3066\u3044\u307e\u3059\u3002\u62e0\u70b9\u5207\u308a\u66ff\u3048\u3092\u884c\u3046\u306b\u306f\u3001\u7ba1\u7406\u8005\u306b\u8907\u6570\u62e0\u70b9\u3078\u306e\u6240\u5c5e\u3092\u4f9d\u983c\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})}),(0,pt.jsx)("div",{className:"grid grid-cols-1 gap-3",children:(()=>{const e=i>=9?m||[]:c||[];return console.log("\u62e0\u70b9\u30ea\u30b9\u30c8\u8868\u793a:",{userRole:i,satellites:m,userSatellites:c,satelliteList:e,satelliteListLength:e.length}),e.map(e=>{var t,n,s,r;return(0,pt.jsxs)("button",{onClick:()=>f(e),className:"w-full flex items-center p-4 rounded-lg transition-all duration-200 "+((null===p||void 0===p?void 0:p.id)===e.id?"bg-indigo-50 border-2 border-indigo-500":"bg-gray-50 border-2 border-transparent hover:border-indigo-200"),children:[(0,pt.jsxs)("div",{className:"flex-1 flex items-center gap-3",children:[(0,pt.jsx)("span",{className:"text-2xl",children:null!==(t=e.office_type_name)&&void 0!==t&&t.includes("\u5b66\u7fd2\u587e")?"\ud83d\udcda":null!==(n=e.office_type_name)&&void 0!==n&&n.includes("\u5c31\u52b4\u79fb\u884c")?"\ud83c\udfe2":null!==(s=e.office_type_name)&&void 0!==s&&s.includes("A\u578b")?"\ud83c\udfed":null!==(r=e.office_type_name)&&void 0!==r&&r.includes("B\u578b")?"\ud83c\udfd7\ufe0f":"\ud83c\udfeb"}),(0,pt.jsxs)("div",{className:"text-left",children:[(0,pt.jsx)("div",{className:"font-medium text-gray-800",children:e.name}),(0,pt.jsx)("div",{className:"text-sm text-gray-600",children:e.office_type_name})]})]}),(0,pt.jsx)("div",{className:"flex items-center justify-center w-6 h-6 rounded-full border-2 ml-4 "+((null===p||void 0===p?void 0:p.id)===e.id?"border-indigo-500 bg-indigo-500":"border-gray-300"),children:(null===p||void 0===p?void 0:p.id)===e.id&&(0,pt.jsx)("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,pt.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},e.id)})})()})]}),"company"===v&&N&&(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsx)("h3",{className:"font-medium text-gray-700",children:"\u4f01\u696d\u304b\u3089\u9078\u629e"}),(0,pt.jsx)("div",{className:"grid grid-cols-1 gap-3",children:(d||[]).map(e=>(0,pt.jsxs)("button",{onClick:()=>h(e),className:"w-full flex items-center p-4 rounded-lg transition-all duration-200 "+((null===g||void 0===g?void 0:g.id)===e.id?"bg-indigo-50 border-2 border-indigo-500":"bg-gray-50 border-2 border-transparent hover:border-indigo-200"),children:[(0,pt.jsxs)("div",{className:"flex-1 flex items-center gap-3",children:[(0,pt.jsx)("span",{className:"text-2xl",children:"\ud83c\udfe2"}),(0,pt.jsxs)("div",{className:"text-left",children:[(0,pt.jsx)("div",{className:"font-medium text-gray-800",children:e.name}),(0,pt.jsx)("div",{className:"text-sm text-gray-600",children:e.address})]})]}),(0,pt.jsx)("div",{className:"flex items-center justify-center w-6 h-6 rounded-full border-2 ml-4 "+((null===g||void 0===g?void 0:g.id)===e.id?"border-indigo-500 bg-indigo-500":"border-gray-300"),children:(null===g||void 0===g?void 0:g.id)===e.id&&(0,pt.jsx)("svg",{className:"w-4 h-4 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,pt.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]},e.id))})]}),!N&&!_&&(0,pt.jsxs)("div",{className:"text-center py-8",children:[(0,pt.jsx)("div",{className:"text-gray-500 mb-2",children:(0,pt.jsx)("svg",{className:"w-12 h-12 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u4f01\u696d\u30fb\u62e0\u70b9\u306e\u5207\u308a\u66ff\u3048\u6a29\u9650\u304c\u3042\u308a\u307e\u305b\u3093"})]})]}),(0,pt.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,pt.jsx)("button",{onClick:n,className:"flex-1 py-3 px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg transition-colors duration-200",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),"satellite"===v&&_&&(0,pt.jsxs)("button",{onClick:async()=>{if(p&&o)try{console.log("\u62e0\u70b9\u5207\u308a\u66ff\u3048\u78ba\u8a8d\u51e6\u7406\u958b\u59cb:",p),await o(p),n()}catch(e){console.error("\u62e0\u70b9\u5207\u308a\u66ff\u3048\u30a8\u30e9\u30fc:",e)}},disabled:!p,className:"flex-1 py-3 px-4 font-medium rounded-lg transition-colors duration-200 flex items-center justify-center gap-2\n                "+(p?"bg-indigo-600 hover:bg-indigo-700 text-white":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:["\u3053\u306e\u62e0\u70b9\u3067\u4f5c\u696d\u3092\u958b\u59cb\u3059\u308b",(0,pt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]}),"company"===v&&N&&(0,pt.jsxs)("button",{onClick:()=>{g&&l&&(l(g),n())},disabled:!g,className:"flex-1 py-3 px-4 font-medium rounded-lg transition-colors duration-200 flex items-center justify-center gap-2\n                "+(g?"bg-indigo-600 hover:bg-indigo-700 text-white":"bg-gray-100 text-gray-400 cursor-not-allowed"),children:["\u3053\u306e\u4f01\u696d\u3067\u4f5c\u696d\u3092\u958b\u59cb\u3059\u308b",(0,pt.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]})]})]})}):null},Ht=e=>{var t,n,s,a;let{user:l,onLocationChange:o}=e;const[i,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[g,h]=(0,r.useState)([]),[p,f]=(0,r.useState)(!1),[b,y]=(0,r.useState)(!1),{logout:v,updateAuthForSatellite:j}=bt();(0,r.useEffect)(()=>{const e=sessionStorage.getItem("selectedSatellite");if(console.log("InstructorHeader: \u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u62e0\u70b9\u60c5\u5831\u3092\u53d6\u5f97\u958b\u59cb"),console.log("selectedSatellite:",e),e)try{const t=JSON.parse(e);console.log("InstructorHeader: \u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u62e0\u70b9\u60c5\u5831\u3092\u53d6\u5f97:",t),x(t),t.company_id&&t.company_name&&u({id:t.company_id,name:t.company_name})}catch(t){console.error("InstructorHeader: \u62e0\u70b9\u60c5\u5831\u306e\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",t)}else console.log("InstructorHeader: \u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u62e0\u70b9\u60c5\u5831\u304c\u3042\u308a\u307e\u305b\u3093")},[]);const N=e=>{try{const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}catch(t){return console.error("JWT\u30c7\u30b3\u30fc\u30c9\u30a8\u30e9\u30fc:",t),null}},w=()=>{if(!m)return console.log("\u62e0\u70b9\u7ba1\u7406\u8005\u5224\u5b9a: \u62e0\u70b9\u60c5\u5831\u304c\u4e0d\u8db3"),!1;const e=localStorage.getItem("accessToken");let t=null;if(e){const n=N(e);t=null===n||void 0===n?void 0:n.user_id}if(!t)return console.log("\u62e0\u70b9\u7ba1\u7406\u8005\u5224\u5b9a: \u30e6\u30fc\u30b6\u30fcID\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093"),!1;console.log("\u7ba1\u7406\u8005\u5224\u5b9a\u958b\u59cb:",{userId:t,satelliteId:m.id,satelliteName:m.name,managerIds:m.manager_ids,isManager:m.is_manager});const n=!0===m.is_manager;let s=!1;if(m.manager_ids)try{let e=m.manager_ids;if("string"===typeof e&&(e=JSON.parse(e)),console.log("\u7ba1\u7406\u8005ID\u89e3\u6790\u7d50\u679c:",{originalManagerIds:m.manager_ids,parsedManagerIds:e,isArray:Array.isArray(e),length:Array.isArray(e)?e.length:0}),Array.isArray(e)){const n=parseInt(t);s=e.some(e=>{const s=parseInt(e),r=s===n;return console.log(`\u7ba1\u7406\u8005ID\u6bd4\u8f03: ${e} (${typeof e}) == ${t} (${typeof t}) = ${r}`,{managerIdNum:s,userIdNum:n,isMatch:r}),r})}}catch(a){console.error("manager_ids parse error:",a)}const r=n||s;return console.log("\u62e0\u70b9\u7ba1\u7406\u8005\u5224\u5b9a\u6700\u7d42\u7d50\u679c:",{userId:t,satelliteName:m.name,satelliteId:m.id,apiIsManager:n,backupIsManager:s,finalIsManager:r,managerIds:m.manager_ids,userRole:null===l||void 0===l?void 0:l.role}),r},k=async()=>{if(p)console.log("loadUserInfo: \u65e2\u306b\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\u4e2d\u306e\u305f\u3081\u30b9\u30ad\u30c3\u30d7");else{f(!0);try{const e=await He("/api/user-info");if(e.success&&e.data){const{user:t,satellites:n,companies:s}=e.data;if(console.log("API\u304b\u3089\u53d6\u5f97\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u60c5\u5831:",t),console.log("API\u304b\u3089\u53d6\u5f97\u3057\u305f\u30ed\u30fc\u30eb:",t.role),console.log("API\u304b\u3089\u53d6\u5f97\u3057\u305f\u62e0\u70b9\u60c5\u5831:",n),console.log("API\u304b\u3089\u53d6\u5f97\u3057\u305f\u4f01\u696d\u60c5\u5831:",s),h(Array.isArray(n)?n:[]),t.role>=9){u({id:null,name:"\u30b7\u30b9\u30c6\u30e0\u7ba1\u7406\u8005",address:null,phone:null});const e=null===l||void 0===l?void 0:l.satellite_id;let t=null;e&&n&&n.length>0?t=n.find(t=>t.id===e)||n[0]:n&&n.length>0&&(t=n[0]),t&&x(t)}else{u({id:t.company_id,name:t.company_name,address:t.company_address,phone:t.company_phone});const e=null===l||void 0===l?void 0:l.satellite_id;let s=null;e&&n&&n.length>0?s=n.find(t=>t.id===e)||n[0]:n&&n.length>0&&(s=n[0]),s&&x(s)}}}catch(e){console.error("\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u53d6\u5f97\u30a8\u30e9\u30fc:",e)}finally{f(!1)}}};(0,r.useEffect)(()=>{b||p||(k(),y(!0))},[b,p]),(0,r.useEffect)(()=>{if(console.log("InstructorHeader: \u62e0\u70b9\u60c5\u5831\u5909\u66f4\u3092\u76e3\u8996"),console.log("currentSatellite:",m),m&&m.id){const t=sessionStorage.getItem("selectedSatellite");let n=null;try{t&&(n=JSON.parse(t))}catch(e){console.error("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u62e0\u70b9\u60c5\u5831\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",e)}if(!n||n.id!==m.id){const e={id:m.id,name:m.name,company_id:m.company_id,company_name:m.company_name};sessionStorage.setItem("selectedSatellite",JSON.stringify(e)),console.log("InstructorHeader: \u62e0\u70b9\u60c5\u5831\u5909\u66f4\u306b\u3088\u308a\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u66f4\u65b0:",e)}}},[null===m||void 0===m?void 0:m.id]);const S=m?(()=>{const e=localStorage.getItem("accessToken");if(e){const t=N(e);if(console.log("JWT\u30c8\u30fc\u30af\u30f3\u30c7\u30b3\u30fc\u30c9\u7d50\u679c:",t),t&&t.role){console.log("JWT\u30c8\u30fc\u30af\u30f3\u304b\u3089\u53d6\u5f97\u3057\u305f\u30ed\u30fc\u30eb:",t.role);const e=!!m&&w();return 4===t.role&&e?(console.log("\u62e0\u70b9\u7ba1\u7406\u8005\u3068\u3057\u3066\u5224\u5b9a\u3055\u308c\u305f\u305f\u3081\u3001\u30ed\u30fc\u30eb\u30925\u306b\u66f4\u65b0\u3057\u307e\u3059"),5):t.role}}return console.log("\u30e6\u30fc\u30b6\u30fc\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304b\u3089\u53d6\u5f97\u3057\u305f\u30ed\u30fc\u30eb:",null===l||void 0===l?void 0:l.role),null===l||void 0===l?void 0:l.role})():(null===l||void 0===l?void 0:l.role)||4,_=m?(e=>{const t=parseInt(e,10);let n={4:"\u6307\u5c0e\u54e1",5:"\u62e0\u70b9\u7ba1\u7406\u8005",9:"\u30b7\u30b9\u30c6\u30e0\u7ba1\u7406\u8005",10:"\u30de\u30b9\u30bf\u30fc\u30e6\u30fc\u30b6"}[t]||"\u6307\u5c0e\u54e1";const s=!!m&&w();return console.log("\u30ed\u30fc\u30eb\u540d\u5224\u5b9a:",{roleId:e,numericRoleId:t,baseRoleName:n,isManager:s,currentSatellite:m}),4===t&&s&&(n="\u62e0\u70b9\u7ba1\u7406\u8005",console.log("\u62e0\u70b9\u7ba1\u7406\u8005\u3068\u3057\u3066\u8868\u793a\u306b\u5909\u66f4")),t>=9&&(n="\u30b7\u30b9\u30c6\u30e0\u7ba1\u7406\u8005",console.log("\u30b7\u30b9\u30c6\u30e0\u7ba1\u7406\u8005\u3068\u3057\u3066\u8868\u793a")),console.log("\u6700\u7d42\u7684\u306a\u30ed\u30fc\u30eb\u540d:",n),n})(S):"\u6307\u5c0e\u54e1",C=S>=9,I=S>=9||Array.isArray(g)&&g.length>0,T=C||I;return(0,pt.jsxs)("header",{className:"bg-gradient-to-r from-indigo-600 to-purple-700 text-white py-4 shadow-lg",children:[(0,pt.jsxs)("div",{className:"max-w-7xl mx-auto px-5 flex justify-between items-center",children:[(0,pt.jsx)("div",{className:"flex items-center gap-4",children:(0,pt.jsx)("h1",{className:"text-2xl font-bold text-white m-0",children:"Study Sphere"})}),(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("span",{className:"font-medium text-white",children:null===l||void 0===l?void 0:l.name}),(0,pt.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold bg-white bg-opacity-20 text-white",children:_})]}),(0,pt.jsxs)("div",{className:"flex flex-col items-end",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("div",{className:"text-lg font-bold",children:(null===m||void 0===m?void 0:m.name)||"\u62e0\u70b9\u672a\u9078\u629e"}),(0,pt.jsx)("span",{className:"text-sm bg-white/20 px-2 py-0.5 rounded",children:null!==m&&void 0!==m&&null!==(t=m.office_type_name)&&void 0!==t&&t.includes("\u5b66\u7fd2\u587e")?"\ud83d\udcda":null!==m&&void 0!==m&&null!==(n=m.office_type_name)&&void 0!==n&&n.includes("\u5c31\u52b4\u79fb\u884c")?"\ud83c\udfe2":null!==m&&void 0!==m&&null!==(s=m.office_type_name)&&void 0!==s&&s.includes("A\u578b")?"\ud83c\udfed":null!==m&&void 0!==m&&null!==(a=m.office_type_name)&&void 0!==a&&a.includes("B\u578b")?"\ud83c\udfd7\ufe0f":"\ud83c\udfeb"})]}),(0,pt.jsx)("div",{className:"text-sm text-white/80",children:(null===d||void 0===d?void 0:d.name)||"\u4f01\u696d\u672a\u9078\u629e"})]})]}),T&&(0,pt.jsxs)("button",{onClick:()=>c(!0),className:"bg-white bg-opacity-10 text-white border-2 border-white border-opacity-30 px-4 py-2 rounded-md cursor-pointer transition-all duration-200 hover:bg-opacity-20 hover:border-opacity-50 flex items-center gap-2",children:[(0,pt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})}),"\u4f01\u696d\u30fb\u62e0\u70b9\u5207\u308a\u66ff\u3048"]}),(0,pt.jsx)("button",{className:"bg-white bg-opacity-10 text-white border-2 border-white border-opacity-30 px-4 py-2 rounded-md cursor-pointer transition-all duration-200 hover:bg-opacity-20 hover:border-opacity-50",onClick:()=>{window.confirm("\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u307e\u3059\u304b\uff1f")&&(l&&"instructor"===l.role&&((e,t)=>{const n={create:"\u7ba1\u7406\u8005\u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210",update:"\u7ba1\u7406\u8005\u30a2\u30ab\u30a6\u30f3\u30c8\u66f4\u65b0",login:"\u7ba1\u7406\u8005\u30ed\u30b0\u30a4\u30f3",logout:"\u7ba1\u7406\u8005\u30ed\u30b0\u30a2\u30a6\u30c8",view:"\u7ba1\u7406\u8005\u60c5\u5831\u95b2\u89a7"}[e]||e,s=`${t.name} (${t.id}) \u306e${n}`;qt(n,s)})("logout",l),v())},children:"\u30ed\u30b0\u30a2\u30a6\u30c8"})]})]}),(0,pt.jsx)(Vt,{isOpen:i,onClose:()=>c(!1),currentCompany:d,currentSatellite:m,onCompanySelect:e=>{u(e);const t=g.filter(t=>t.company_id===e.id);t.length>0&&x(t[0])},onSatelliteSelect:async e=>{console.log("=== \u62e0\u70b9\u9078\u629e\u51e6\u7406\u958b\u59cb ==="),console.log("\u9078\u629e\u3055\u308c\u305f\u62e0\u70b9:",e),console.log("\u73fe\u5728\u306e\u30e6\u30fc\u30b6\u30fc:",l);try{console.log("\u62e0\u70b9\u5909\u66f4\u6642\u518d\u8a8d\u8a3cAPI\u547c\u3073\u51fa\u3057\u958b\u59cb...");const n=await(e=>{const t=JSON.parse(localStorage.getItem("currentUser")||"{}"),n=t.user_id||t.id;return We("/api/reauthenticate-satellite",{userId:n,satelliteId:e})})(e.id);if(console.log("\u62e0\u70b9\u5909\u66f4\u6642\u518d\u8a8d\u8a3c\u7d50\u679c:",n),n.success&&n.data){const{access_token:s,refresh_token:r}=n.data,a={...l,role:n.data.user.role,company_id:n.data.user.company_id,company_name:n.data.user.company_name,satellite_id:n.data.user.satellite_id,satellite_name:n.data.user.satellite_name};j(a,s,r),console.log("\u62e0\u70b9\u5909\u66f4\u5f8c\u306e\u30e6\u30fc\u30b6\u30fc\u60c5\u5831:",a),sessionStorage.removeItem("selectedSatellite"),console.log("\u53e4\u3044selectedSatellite\u60c5\u5831\u3092\u30af\u30ea\u30a2\u3057\u307e\u3057\u305f");const i={id:e.id,name:e.name,company_id:e.company_id||n.data.user.company_id,company_name:e.company_name||n.data.user.company_name};sessionStorage.setItem("selectedSatellite",JSON.stringify(i)),console.log("\u65b0\u3057\u3044\u62e0\u70b9\u60c5\u5831\u3092selectedSatellite\u306b\u4fdd\u5b58:",i);const c=sessionStorage.getItem("selectedSatellite");if(console.log("\u4fdd\u5b58\u5f8c\u306eselectedSatellite\u78ba\u8a8d:",c),c)try{const e=JSON.parse(c);console.log("\u30d1\u30fc\u30b9\u3055\u308c\u305f\u62e0\u70b9\u60c5\u5831:",e)}catch(t){console.error("\u4fdd\u5b58\u5f8c\u306e\u62e0\u70b9\u60c5\u5831\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",t)}return x(e),void(o&&o(e))}return console.error("\u62e0\u70b9\u5909\u66f4\u6642\u518d\u8a8d\u8a3c\u306b\u5931\u6557:",n.message),void alert("\u62e0\u70b9\u5909\u66f4\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+n.message)}catch(t){return console.error("\u62e0\u70b9\u5909\u66f4\u6642\u518d\u8a8d\u8a3c\u30a8\u30e9\u30fc:",t),void alert("\u62e0\u70b9\u5909\u66f4\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+t.message)}},userRole:S,userSatellites:g})]})},Wt=e=>{const t=localStorage.getItem("accessToken");if(t){const e=(e=>{try{const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(n)}catch(t){return console.error("JWT\u30c7\u30b3\u30fc\u30c9\u30a8\u30e9\u30fc:",t),null}})(t);if(e&&e.role)return 4===e.role?5:e.role}return null===e||void 0===e?void 0:e.role},Qt=e=>{if(console.log("=== getCurrentUserSatelliteId \u30c7\u30d0\u30c3\u30b0 ==="),console.log("\u73fe\u5728\u306e\u30e6\u30fc\u30b6\u30fc\u60c5\u5831:",e),console.log("\u30e6\u30fc\u30b6\u30fc\u30ed\u30fc\u30eb:",null===e||void 0===e?void 0:e.role),console.log("satellite_ids:",null===e||void 0===e?void 0:e.satellite_ids),console.log("satellite_id:",null===e||void 0===e?void 0:e.satellite_id),console.log("satellite_name:",null===e||void 0===e?void 0:e.satellite_name),e&&e.role>=6&&e.satellite_id){console.log("\u7ba1\u7406\u8005\u7528: \u30ed\u30b0\u30a4\u30f3\u6642\u9078\u629e\u62e0\u70b9ID\u3092\u4f7f\u7528:",e.satellite_id);if(!sessionStorage.getItem("selectedSatellite")&&e.satellite_name){const t={id:e.satellite_id,name:e.satellite_name,company_id:e.company_id,company_name:e.company_name};sessionStorage.setItem("selectedSatellite",JSON.stringify(t)),console.log("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u62e0\u70b9\u60c5\u5831\u3092\u540c\u671f:",t)}return e.satellite_id}try{const e=sessionStorage.getItem("selectedSatellite");if(e){const t=JSON.parse(e);if(console.log("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u53d6\u5f97\u3057\u305f\u62e0\u70b9\u60c5\u5831:",t),t.id)return console.log("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u62e0\u70b9ID\u3092\u53d6\u5f97:",t.id),t.id}}catch(t){console.error("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u62e0\u70b9\u60c5\u5831\u8aad\u307f\u8fbc\u307f\u30a8\u30e9\u30fc:",t)}if(e&&e.satellite_ids&&e.satellite_ids.length>0){const n=e.satellite_ids[0];console.log("\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u53d6\u5f97\u3057\u305f\u62e0\u70b9ID:",n);const s=sessionStorage.getItem("selectedSatellite");if(s)try{JSON.parse(s).id!==n&&(console.log("\u62e0\u70b9ID\u304c\u4e00\u81f4\u3057\u307e\u305b\u3093\u3002sessionStorage\u306eselectedSatellite\u3092\u30af\u30ea\u30a2\u3057\u307e\u3059"),sessionStorage.removeItem("selectedSatellite"))}catch(t){console.error("sessionStorage\u306eselectedSatellite\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",t),sessionStorage.removeItem("selectedSatellite")}return n}try{const e=JSON.parse(localStorage.getItem("currentUser")||"{}");if(console.log("localStorage\u306e\u30e6\u30fc\u30b6\u30fc\u60c5\u5831:",e),e.role>=6&&e.satellite_id)return console.log("localStorage\u7ba1\u7406\u8005\u7528: \u30ed\u30b0\u30a4\u30f3\u6642\u9078\u629e\u62e0\u70b9ID\u3092\u4f7f\u7528:",e.satellite_id),e.satellite_id;if(e.satellite_ids&&e.satellite_ids.length>0){const t=e.satellite_ids[0];return console.log("localStorage\u304b\u3089\u53d6\u5f97\u3057\u305f\u62e0\u70b9ID:",t),t}}catch(t){console.error("localStorage\u306e\u8aad\u307f\u8fbc\u307f\u30a8\u30e9\u30fc:",t)}return console.log("\u62e0\u70b9ID\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093"),null},Kt=(e,t,n)=>{console.log(`=== \u6307\u5c0e\u54e1 ${e} \u306e\u7ba1\u7406\u8005\u5224\u5b9a\u958b\u59cb ===`),console.log("\u5224\u5b9a\u5bfe\u8c61\u6307\u5c0e\u8005ID:",e,"\u578b:",typeof e),console.log("\u73fe\u5728\u306einstructors:",t),console.log("\u73fe\u5728\u306elocationInfo:",n);const s=t.find(t=>t.id===e);if(console.log("instructors\u304b\u3089\u898b\u3064\u304b\u3063\u305f\u6307\u5c0e\u54e1:",s),s&&void 0!==s.is_manager)return console.log("API\u304b\u3089\u8fd4\u3055\u308c\u305fis_manager\u30d5\u30e9\u30b0\u3092\u4f7f\u7528:",s.is_manager),console.log(`=== \u6307\u5c0e\u54e1 ${e} \u306e\u7ba1\u7406\u8005\u5224\u5b9a\u5b8c\u4e86\uff08API\u30d5\u30e9\u30b0\uff09 ===`),s.is_manager;if(console.log("API\u30d5\u30e9\u30b0\u304c\u672a\u5b9a\u7fa9\u3001locationInfo.manager_ids\u3092\u4f7f\u7528"),!n.manager_ids)return console.log("locationInfo.manager_ids\u304c\u672a\u5b9a\u7fa9"),console.log(`=== \u6307\u5c0e\u54e1 ${e} \u306e\u7ba1\u7406\u8005\u5224\u5b9a\u5b8c\u4e86\uff08manager_ids\u672a\u5b9a\u7fa9\uff09 ===`),!1;try{let t=n.manager_ids;console.log("locationInfo.manager_ids\u751f\u30c7\u30fc\u30bf:",t,"\u578b:",typeof t),"string"===typeof t&&(t.includes(",")?(t=t.split(",").map(e=>e.trim()),console.log("\u30ab\u30f3\u30de\u533a\u5207\u308a\u6587\u5b57\u5217\u304b\u3089\u5909\u63db:",t)):(t=JSON.parse(t),console.log("JSON\u30d1\u30fc\u30b9\u7d50\u679c:",t))),console.log("\u51e6\u7406\u5f8c\u306emanagerIds:",t,"\u578b:",typeof t,"\u914d\u5217\u304b:",Array.isArray(t));let s=!1;if(Array.isArray(t))console.log("\u914d\u5217\u3068\u3057\u3066\u7ba1\u7406\u8005\u5224\u5b9a\u3092\u5b9f\u884c:"),t.forEach((t,n)=>{const r=Number(t)===Number(e);console.log(`  \u6bd4\u8f03${n+1}: ${t} (${typeof t}) == ${e} (${typeof e}) = ${r}`),r&&(s=!0)});else{const n=Number(t),r=Number(e);s=n===r,console.log("\u5358\u4e00\u5024\u3068\u3057\u3066\u7ba1\u7406\u8005\u5224\u5b9a:",n,"==",r,"=",s)}return console.log(`\u6700\u7d42\u7684\u306a\u7ba1\u7406\u8005\u5224\u5b9a\u7d50\u679c: ${s}`),console.log(`=== \u6307\u5c0e\u54e1 ${e} \u306e\u7ba1\u7406\u8005\u5224\u5b9a\u5b8c\u4e86\uff08locationInfo\u4f7f\u7528\uff09 ===`),s}catch(Yc){return console.error("\u7ba1\u7406\u8005ID\u30c1\u30a7\u30c3\u30af\u30a8\u30e9\u30fc:",Yc),console.log(`=== \u6307\u5c0e\u54e1 ${e} \u306e\u7ba1\u7406\u8005\u5224\u5b9a\u5b8c\u4e86\uff08\u30a8\u30e9\u30fc\uff09 ===`),!1}},Yt=()=>{(()=>{console.log("=== \u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8 \u30c7\u30d0\u30c3\u30b0 ===");const e=sessionStorage.getItem("selectedSatellite");if(console.log("selectedSatellite:",e),e)try{const t=JSON.parse(e);console.log("\u30d1\u30fc\u30b9\u3055\u308c\u305f\u62e0\u70b9\u60c5\u5831:",t)}catch(n){console.error("\u62e0\u70b9\u60c5\u5831\u306e\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",n)}const t=Object.keys(sessionStorage);console.log("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u5168\u30ad\u30fc:",t),t.forEach(e=>{"selectedSatellite"!==e&&console.log(`${e}:`,sessionStorage.getItem(e))})})(),(()=>{console.log("=== \u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8 \u30c7\u30d0\u30c3\u30b0 ===");const e=localStorage.getItem("currentUser");if(console.log("currentUser:",e),e)try{const t=JSON.parse(e);console.log("\u30d1\u30fc\u30b9\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u60c5\u5831:",t)}catch(n){console.error("\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u306e\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",n)}const t=Object.keys(localStorage);console.log("\u30ed\u30fc\u30ab\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u5168\u30ad\u30fc:",t),t.forEach(e=>{"currentUser"!==e&&console.log(`${e}:`,localStorage.getItem(e))})})()},Gt=e=>{let{students:t,onStudentsUpdate:n}=e;const{currentUser:s,isAuthenticated:a}=bt(),[l,o]=(0,r.useState)([]),[i,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(""),[m,x]=(0,r.useState)(""),[g,h]=(0,r.useState)(""),[p,f]=(0,r.useState)(""),[b,y]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{(async()=>{try{console.log("\u6307\u5c0e\u54e1\u30c7\u30fc\u30bf\u53d6\u5f97\u958b\u59cb...");const t=await fetch(`${ze.JR}/api/users`);if(console.log("API\u30ec\u30b9\u30dd\u30f3\u30b9:",t),t.ok){var e;const n=await t.json();console.log("API\u304b\u3089\u53d6\u5f97\u3057\u305f\u5168\u30c7\u30fc\u30bf:",n),console.log("\u30c7\u30fc\u30bf\u306e\u578b:",typeof n);const s=(null===(e=n.data)||void 0===e?void 0:e.users)||n,r=Array.isArray(s)?s:[];console.log("\u30e6\u30fc\u30b6\u30fc\u914d\u5217:",r),console.log("\u30e6\u30fc\u30b6\u30fc\u914d\u5217\u306e\u9577\u3055:",r.length),r.forEach((e,t)=>{console.log(`\u30e6\u30fc\u30b6\u30fc${t+1}:`,{id:e.id,name:e.name,role:e.role,roleType:typeof e.role})});const a=r.filter(e=>{const t=4===e.role;return console.log(`\u30e6\u30fc\u30b6\u30fc ${e.name} (ID: ${e.id}): \u30ed\u30fc\u30eb=${e.role}, \u6307\u5c0e\u54e1\u5224\u5b9a=${t}`),t});console.log("\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u5f8c\u306e\u6307\u5c0e\u54e1\u30c7\u30fc\u30bf:",a),console.log("\u6307\u5c0e\u54e1\u6570:",a.length),c(a)}else{console.error("API\u30ec\u30b9\u30dd\u30f3\u30b9\u30a8\u30e9\u30fc:",t.status,t.statusText);const e=await t.text();console.error("\u30a8\u30e9\u30fc\u30ec\u30b9\u30dd\u30f3\u30b9:",e)}}catch(t){console.error("\u6307\u5c0e\u54e1\u30c7\u30fc\u30bf\u53d6\u5f97\u30a8\u30e9\u30fc:",t)}})(),(async()=>{try{const t=await fetch(`${ze.JR}/api/users`);if(t.ok){var e;const n=await t.json(),s=((null===(e=n.data)||void 0===e?void 0:e.users)||n).filter(e=>1===e.role);o(s)}}catch(t){console.error("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u5229\u7528\u8005\u53d6\u5f97\u30a8\u30e9\u30fc:",t)}})()},[]),{issueTemporaryPassword:async e=>{try{const s=`${ze.JR}/api/users/${e}/issue-temp-password`;console.log("=== \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u30ea\u30af\u30a8\u30b9\u30c8 ==="),console.log("URL:",s),console.log("userId:",e);const r=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"}});console.log("=== \u30ec\u30b9\u30dd\u30f3\u30b9\u60c5\u5831 ==="),console.log("response.status:",r.status),console.log("response.ok:",r.ok),console.log("response.headers:",Object.fromEntries(r.headers.entries()));const a=await r.text();let l;console.log("response.text():",a);try{l=JSON.parse(a)}catch(t){return console.error("JSON\u89e3\u6790\u30a8\u30e9\u30fc:",t),console.error("\u89e3\u6790\u3067\u304d\u306a\u304b\u3063\u305f\u30c6\u30ad\u30b9\u30c8:",a),void alert("\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u306e\u5fdc\u7b54\u306e\u89e3\u6790\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}if(console.log("=== \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u30c7\u30d0\u30c3\u30b0 ==="),console.log("response.status:",r.status),console.log("result:",l),console.log("result.success:",l.success),console.log("result.data:",l.data),!l.success||!l.data)return console.error("API\u30ec\u30b9\u30dd\u30f3\u30b9\u30a8\u30e9\u30fc:",l),void alert(`\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${l.message||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc"}`);console.log("result.data.expiresAt:",l.data.expiresAt),n(t=>{const n=t.map(t=>t.id===e?{...t,temp_password:l.data.tempPassword,expires_at:l.data.expires_at||l.data.expiresAt,is_used:0}:t);return console.log("=== \u30ed\u30fc\u30ab\u30eb\u72b6\u614b\u66f4\u65b0\u5b8c\u4e86 ==="),console.log("\u66f4\u65b0\u3055\u308c\u305f\u5b66\u751f:",n.find(t=>t.id===e)),n}),l.success?alert(`\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u767a\u884c\u3055\u308c\u307e\u3057\u305f\u3002\n\n\u30d1\u30b9\u30ef\u30fc\u30c9: ${l.data.tempPassword}`):alert(`\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${l.message}`)}catch(s){console.error("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u30a8\u30e9\u30fc:",s),console.error("\u30a8\u30e9\u30fc\u306e\u8a73\u7d30:",{message:s.message,stack:s.stack,name:s.name});let e="\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u306b\u5931\u6557\u3057\u307e\u3057\u305f";s.message&&(e+=`\n\u8a73\u7d30: ${s.message}`),alert(e)}},tempPasswordUsers:l,instructors:i,selectedInstructor:d,setSelectedInstructor:u,expiryTime:m,setExpiryTime:x,announcementTitle:g,setAnnouncementTitle:h,announcementMessage:p,setAnnouncementMessage:f,tempPasswordLoading:b,setTempPasswordLoading:y}},Zt=e=>{let{student:t,onUpdate:n,onClose:s,instructors:a}=e;const[l,o]=(0,r.useState)({name:(null===t||void 0===t?void 0:t.name)||"",instructor_id:(null===t||void 0===t?void 0:t.instructor_id)||"",tags:(null===t||void 0===t?void 0:t.tags)||[]}),[i,c]=(0,r.useState)({long_term_goal:"",short_term_goal:"",needs:"",support_content:"",goal_date:""}),[d,u]=(0,r.useState)(null),[m,x]=(0,r.useState)(!1),[g,h]=(0,r.useState)(null);return{openEditModal:async e=>{h(e),o({name:e.name||"",instructor_id:e.instructor_id||"",tags:e.tags||[]}),x(!0);try{const t=await fetch(`${ze.JR}/api/support-plans/${e.id}`);if(t.ok){const e=await t.json();e.success&&e.data?(u(e.data),c({long_term_goal:e.data.long_term_goal||"",short_term_goal:e.data.short_term_goal||"",needs:e.data.needs||"",support_content:e.data.support_content||"",goal_date:e.data.goal_date||""})):(u(null),c({long_term_goal:"",short_term_goal:"",needs:"",support_content:"",goal_date:""}))}}catch(t){console.error("\u500b\u5225\u652f\u63f4\u8a08\u753b\u53d6\u5f97\u30a8\u30e9\u30fc:",t)}},handleUpdateStudent:async()=>{try{console.log("\u5229\u7528\u8005\u60c5\u5831\u66f4\u65b0\u958b\u59cb:",g.id,l);const t=await Ge(g.id,{name:l.name,instructor_id:l.instructor_id||null,tags:l.tags||[]});if(t.success){console.log("\u5229\u7528\u8005\u60c5\u5831\u66f4\u65b0\u6210\u529f");try{const e=await(e=>We("/api/support-plans/upsert",e))({user_id:g.id,...i});e.success?(console.log("\u500b\u5225\u652f\u63f4\u8a08\u753b\u66f4\u65b0\u6210\u529f"),alert("\u5229\u7528\u8005\u60c5\u5831\u3068\u500b\u5225\u652f\u63f4\u8a08\u753b\u304c\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f")):(console.error("\u500b\u5225\u652f\u63f4\u8a08\u753b\u66f4\u65b0\u5931\u6557:",e.message),alert("\u5229\u7528\u8005\u60c5\u5831\u306f\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\u304c\u3001\u500b\u5225\u652f\u63f4\u8a08\u753b\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f"))}catch(e){console.error("\u500b\u5225\u652f\u63f4\u8a08\u753b\u66f4\u65b0\u30a8\u30e9\u30fc:",e),alert("\u5229\u7528\u8005\u60c5\u5831\u306f\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\u304c\u3001\u500b\u5225\u652f\u63f4\u8a08\u753b\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}x(!1),n()}else console.error("\u5229\u7528\u8005\u60c5\u5831\u66f4\u65b0\u5931\u6557:",t.message),alert("\u5229\u7528\u8005\u60c5\u5831\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+t.message)}catch(t){console.error("\u66f4\u65b0\u30a8\u30e9\u30fc:",t),alert("\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(t.message||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"))}},editFormData:l,setEditFormData:o,supportPlanData:i,setSupportPlanData:c,existingSupportPlan:d,showEditModal:m,setShowEditModal:x,editingStudent:g,handleInputChange:e=>{const{name:t,value:n}=e.target;o(e=>({...e,[t]:n}))},handleTagChange:e=>{const t=e.target.value.split(",").map(e=>e.trim()).filter(e=>e);o(e=>({...e,tags:t}))},handleSupportPlanChange:e=>{const{name:t,value:n}=e.target;c(e=>({...e,[t]:n}))}}},Xt=e=>{let{students:t,onStudentsUpdate:n,satelliteId:s}=e;const[a,l]=(0,r.useState)([]),[o,i]=(0,r.useState)([]),[c,d]=(0,r.useState)([]),[u,m]=(0,r.useState)([]),[x,g]=(0,r.useState)(""),h=async()=>{try{if(!s)return void console.warn("\u62e0\u70b9ID\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u30b3\u30fc\u30b9\u60c5\u5831\u306e\u53d6\u5f97\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");const e=await nt(s);e.success&&n(t=>t.map(t=>{const n=e.data.filter(e=>e.user_id===t.id);return{...t,courses:n}}))}catch(e){console.error("\u5229\u7528\u8005\u30b3\u30fc\u30b9\u53d6\u5f97\u30a8\u30e9\u30fc:",e)}};return(0,r.useEffect)(()=>{(()=>{const e=localStorage.getItem("courses");if(e)l(JSON.parse(e));else{const e=[{id:"course001",title:"\u30aa\u30d5\u30a3\u30b9\u30bd\u30d5\u30c8\u306e\u64cd\u4f5c\u30fb\u6587\u66f8\u4f5c\u6210",category:"\u9078\u629e\u79d1\u76ee",description:"Word\u3001Excel\u3001PowerPoint\u306e\u57fa\u672c\u64cd\u4f5c\u3092\u5b66\u3073\u3001\u5b9f\u52d9\u3067\u4f7f\u3048\u308b\u6587\u66f8\u4f5c\u6210\u30b9\u30ad\u30eb\u3092\u7fd2\u5f97",duration:"3\u30f6\u6708",difficulty:"beginner",totalLessons:6,enrolledStudents:12,completionRate:85,status:"active",createdDate:"2023-06-01",lastUpdated:"2024-01-10",tags:["Word","Excel","PowerPoint","\u6587\u66f8\u4f5c\u6210","\u9078\u629e\u79d1\u76ee"],isElective:!0,prerequisites:[],order:0},{id:"course002",title:"IT\u30ea\u30c6\u30e9\u30b7\u30fc\u30fbAI\u306e\u57fa\u672c",category:"\u5fc5\u4fee\u79d1\u76ee",description:"IT\u306e\u57fa\u790e\u77e5\u8b58\u3068AI\u306e\u57fa\u672c\u6982\u5ff5\u3092\u5b66\u3073\u3001\u30c7\u30b8\u30bf\u30eb\u793e\u4f1a\u3067\u6d3b\u8e8d\u3059\u308b\u305f\u3081\u306e\u571f\u53f0\u3092\u69cb\u7bc9",duration:"3\u30f6\u6708",difficulty:"beginner",totalLessons:6,enrolledStudents:15,completionRate:92,status:"active",createdDate:"2023-06-01",lastUpdated:"2024-01-15",tags:["IT\u57fa\u790e","AI","\u30c7\u30b8\u30bf\u30eb\u30ea\u30c6\u30e9\u30b7\u30fc","\u5fc5\u4fee\u79d1\u76ee"],isElective:!1,prerequisites:[],order:1}];l(e),localStorage.setItem("courses",JSON.stringify(e))}})(),(async()=>{try{if(!s)return void console.warn("\u62e0\u70b9ID\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u5229\u7528\u53ef\u80fd\u30b3\u30fc\u30b9\u306e\u53d6\u5f97\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");const e=await st(s);e.success&&l(e.data)}catch(e){console.error("\u5229\u7528\u53ef\u80fd\u30b3\u30fc\u30b9\u53d6\u5f97\u30a8\u30e9\u30fc:",e)}})(),(async()=>{try{if(!s)return void console.warn("\u62e0\u70b9ID\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u5229\u7528\u53ef\u80fd\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u306e\u53d6\u5f97\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");const e=await rt(s);e.success&&i(e.data)}catch(e){console.error("\u5229\u7528\u53ef\u80fd\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u53d6\u5f97\u30a8\u30e9\u30fc:",e)}})(),h()},[s]),{availableCourses:a,availableCurriculumPaths:o,selectedStudents:c,setSelectedStudents:d,selectedCourses:u,setSelectedCourses:m,selectedCurriculumPath:x,setSelectedCurriculumPath:g,handleBulkAssignCourses:async()=>{if(0!==c.length&&0!==u.length)try{const e=await at(c,u);e.success?(alert("\u30b3\u30fc\u30b9\u306e\u4e00\u62ec\u5272\u308a\u5f53\u3066\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f"),d([]),m([]),h()):alert(`\u30b3\u30fc\u30b9\u306e\u4e00\u62ec\u5272\u308a\u5f53\u3066\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${e.message}`)}catch(e){console.error("\u30b3\u30fc\u30b9\u4e00\u62ec\u5272\u308a\u5f53\u3066\u30a8\u30e9\u30fc:",e),alert("\u30b3\u30fc\u30b9\u306e\u4e00\u62ec\u5272\u308a\u5f53\u3066\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}else alert("\u5229\u7528\u8005\u3068\u30b3\u30fc\u30b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044")},handleBulkRemoveCourses:async()=>{if(0!==c.length&&0!==u.length){if(window.confirm("\u9078\u629e\u3055\u308c\u305f\u5229\u7528\u8005\u304b\u3089\u30b3\u30fc\u30b9\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f"))try{const e=await lt(c,u);e.success?(alert("\u30b3\u30fc\u30b9\u306e\u4e00\u62ec\u524a\u9664\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f"),d([]),m([]),h()):alert(`\u30b3\u30fc\u30b9\u306e\u4e00\u62ec\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${e.message}`)}catch(e){console.error("\u30b3\u30fc\u30b9\u4e00\u62ec\u524a\u9664\u30a8\u30e9\u30fc:",e),alert("\u30b3\u30fc\u30b9\u306e\u4e00\u62ec\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}}else alert("\u5229\u7528\u8005\u3068\u30b3\u30fc\u30b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044")},handleBulkAssignCurriculumPath:async()=>{if(0!==c.length&&x)try{const e=await ot(c,x);e.success?(alert("\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u306e\u4e00\u62ec\u5272\u308a\u5f53\u3066\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f"),d([]),g(""),h()):alert(`\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u306e\u4e00\u62ec\u5272\u308a\u5f53\u3066\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${e.message}`)}catch(e){console.error("\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u4e00\u62ec\u5272\u308a\u5f53\u3066\u30a8\u30e9\u30fc:",e),alert("\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u306e\u4e00\u62ec\u5272\u308a\u5f53\u3066\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}else alert("\u5229\u7528\u8005\u3068\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044")},fetchUserCourses:h}},en=e=>{let{onStudentAdded:t,instructors:n}=e;const{currentUser:s}=bt(),[a,l]=(0,r.useState)(!1),[o,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)({name:"",email:"",instructor_id:"",tags:[]}),[u,m]=(0,r.useState)(""),[x,g]=(0,r.useState)(""),[h,p]=(0,r.useState)([]),[f,b]=(0,r.useState)(!1),[y,v]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{b(!0);try{const e=await fetch(`${ze.JR}/api/companies`);if(e.ok){const t=await e.json();p(t)}else console.error("\u4f01\u696d\u4e00\u89a7\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(e){console.error("\u4f01\u696d\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",e)}finally{b(!1)}})()},[]);return{showAddForm:a,setShowAddForm:l,bulkInputMode:o,setBulkInputMode:i,newStudent:c,setNewStudent:d,bulkInputText:u,setBulkInputText:m,bulkInstructorId:x,setBulkInstructorId:g,companies:h,loadingCompanies:f,currentUser:s,modalError:y,setModalError:v,handleInputChange:e=>{const{name:t,value:n}=e.target;d(e=>({...e,[t]:n}))},handleTagChange:e=>{const t=e.target.value.split(",").map(e=>e.trim()).filter(e=>e);d(e=>({...e,tags:t}))},handleAddStudent:async e=>{e.preventDefault();let n=(null===s||void 0===s?void 0:s.company_id)||1,r=null;try{const e=sessionStorage.getItem("selectedSatellite");if(e){const t=JSON.parse(e);t.company_id&&(n=t.company_id),t.id&&(r=t.id)}}catch(o){console.error("selectedSatellite\u306e\u8aad\u307f\u8fbc\u307f\u30a8\u30e9\u30fc:",o)}const a={name:c.name,email:c.email,instructor_id:c.instructor_id||null,company_id:n,satellite_id:r,tags:c.tags};try{const e=await fetch(`${ze.JR}/api/users/create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(e.ok)alert("\u5229\u7528\u8005\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f"),l(!1),v(null),d({name:"",email:"",instructor_id:"",tags:[]}),t();else{const t=await e.json();v(`\u5229\u7528\u8005\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${t.message}`)}}catch(o){console.error("\u5229\u7528\u8005\u8ffd\u52a0\u30a8\u30e9\u30fc:",o),v("\u5229\u7528\u8005\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}},handleBulkAddStudents:async()=>{if(!u.trim())return void alert("\u5229\u7528\u8005\u60c5\u5831\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044");const e=u.trim().split("\n").filter(e=>e.trim()),n=[],r=[];for(let t=0;t<e.length;t++){const l=e[t].split(",").map(e=>e.trim());if(l.length<1){r.push(`\u884c${t+1}: \u5229\u7528\u8005\u540d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044`);continue}const o=l[0],i=l[1]||"";if(!o||""===o.trim()){r.push(`\u884c${t+1}: \u5229\u7528\u8005\u540d\u306f\u5fc5\u9808\u3067\u3059`);continue}if(i&&""!==i.trim()){if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i.trim())){r.push(`\u884c${t+1}: \u6709\u52b9\u306a\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5f62\u5f0f\u3067\u306f\u3042\u308a\u307e\u305b\u3093: ${i}`);continue}}let c=(null===s||void 0===s?void 0:s.company_id)||1,d=null;try{const e=sessionStorage.getItem("selectedSatellite");if(console.log("=== selectedSatellite \u30c7\u30d0\u30c3\u30b0 ==="),console.log("selectedSatellite (raw):",e),e){const t=JSON.parse(e);console.log("selectedSatellite (parsed):",t),t.company_id?(c=t.company_id,console.log("selectedSatellite\u304b\u3089\u53d6\u5f97\u3057\u305fcompany_id:",c)):console.log("selectedSatellite\u306bcompany_id\u304c\u3042\u308a\u307e\u305b\u3093"),t.id?(d=t.id,console.log("selectedSatellite\u304b\u3089\u53d6\u5f97\u3057\u305fsatellite_id:",d)):console.log("selectedSatellite\u306bid\u304c\u3042\u308a\u307e\u305b\u3093")}else console.log("selectedSatellite\u304c\u5b58\u5728\u3057\u307e\u305b\u3093");console.log("\u6700\u7d42\u7684\u306acompany_id:",c),console.log("\u6700\u7d42\u7684\u306asatellite_id:",d)}catch(a){console.error("selectedSatellite\u306e\u8aad\u307f\u8fbc\u307f\u30a8\u30e9\u30fc:",a)}n.push({name:o,email:i&&""!==i.trim()?i:null,instructor_id:x||null,company_id:c,satellite_id:d,tags:[]})}if(r.length>0)alert(`\u4ee5\u4e0b\u306e\u884c\u306b\u554f\u984c\u304c\u3042\u308a\u307e\u3059:\n${r.join("\n")}`);else if(0!==n.length)try{console.log("=== \u4e00\u62ec\u5229\u7528\u8005\u8ffd\u52a0\u30ea\u30af\u30a8\u30b9\u30c8 ==="),console.log("API URL:",`${ze.JR}/api/users/bulk-create`),console.log("\u9001\u4fe1\u30c7\u30fc\u30bf:",{users:n}),console.log("\u9001\u4fe1\u30c7\u30fc\u30bf\u306e\u8a73\u7d30:"),n.forEach((e,t)=>{console.log(`\u5b66\u751f${t+1}:`,{name:e.name,email:e.email,instructor_id:e.instructor_id,company_id:e.company_id,satellite_id:e.satellite_id,tags:e.tags})});const e=await fetch(`${ze.JR}/api/users/bulk-create`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users:n})});if(console.log("\u30ec\u30b9\u30dd\u30f3\u30b9\u30b9\u30c6\u30fc\u30bf\u30b9:",e.status),console.log("\u30ec\u30b9\u30dd\u30f3\u30b9OK:",e.ok),e.ok)alert(`${n.length}\u540d\u306e\u5229\u7528\u8005\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f`),l(!1),v(null),m(""),g(""),t();else{const t=await e.json();console.log("\u30a8\u30e9\u30fc\u30ec\u30b9\u30dd\u30f3\u30b9:",t);let n=`\u4e00\u62ec\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${t.message}`;t.errors&&Array.isArray(t.errors)&&(n+="\n\n\u8a73\u7d30:\n"+t.errors.join("\n")),t.successCount>0&&(n+=`\n\n\u6210\u529f: ${t.successCount}\u4ef6`),v(n)}}catch(a){console.error("\u4e00\u62ec\u8ffd\u52a0\u30a8\u30e9\u30fc:",a),v("\u4e00\u62ec\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}else alert("\u6709\u52b9\u306a\u5229\u7528\u8005\u60c5\u5831\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f")}}},tn=e=>{let{students:t,onStudentsUpdate:n}=e;const[s,a]=(0,r.useState)(!1),[l,o]=(0,r.useState)(""),[i,c]=(0,r.useState)([]),[d,u]=(0,r.useState)([]),[m,x]=(0,r.useState)(""),[g,h]=(0,r.useState)([]),[p,f]=(0,r.useState)(["\u512a\u79c0","\u8981\u30d5\u30a9\u30ed\u30fc","\u7a4d\u6975\u7684","\u6d88\u6975\u7684","\u6b20\u5e2d\u304c\u591a\u3044","\u8cea\u554f\u304c\u591a\u3044","\u7406\u89e3\u5ea6\u9ad8\u3044","\u7406\u89e3\u5ea6\u4f4e\u3044"]),b=()=>{let e=t;return m&&(e=e.filter(e=>e.name.toLowerCase().includes(m.toLowerCase())||e.login_code.toLowerCase().includes(m.toLowerCase())||e.instructor_name&&e.instructor_name.toLowerCase().includes(m.toLowerCase()))),g.length>0&&(e=e.filter(e=>g.every(t=>e.tags&&e.tags.includes(t)))),e};return{showTagModal:s,setShowTagModal:a,newTagName:l,setNewTagName:o,tagsToAdd:i,setTagsToAdd:c,customTags:p,setCustomTags:f,selectedStudents:d,setSelectedStudents:u,searchTerm:m,setSearchTerm:x,selectedTags:g,setSelectedTags:h,getAllTags:()=>{const e=new Set;return t.forEach(t=>{t.tags&&Array.isArray(t.tags)&&t.tags.forEach(t=>e.add(t))}),Array.from(e).sort()},getFilteredStudents:b,toggleStudentSelection:e=>{u(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},toggleAllStudents:()=>{const e=b();d.length===e.length?u([]):u(e.map(e=>e.id))},toggleTagFilter:e=>{h(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},handleBulkAddTags:async()=>{if(0!==d.length)if(0!==i.length)try{const e=await fetch(`${ze.JR}/api/users/bulk-add-tags`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userIds:d,tags:i})});if(e.ok)alert(`${d.length}\u540d\u306e\u5229\u7528\u8005\u306b\u30bf\u30b0\u306e\u4e00\u62ec\u8ffd\u52a0\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f`),a(!1),c([]),u([]),x(""),h([]),n();else{const t=await e.json();alert(`\u30bf\u30b0\u4e00\u62ec\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${t.message}`)}}catch(e){console.error("\u30bf\u30b0\u4e00\u62ec\u8ffd\u52a0\u30a8\u30e9\u30fc:",e),alert("\u30bf\u30b0\u4e00\u62ec\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}else alert("\u8ffd\u52a0\u3059\u308b\u30bf\u30b0\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044");else alert("\u5229\u7528\u8005\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044")},addNewTag:()=>{l.trim()&&!p.includes(l.trim())&&(f([...p,l.trim()]),c([...i,l.trim()]),o(""))},toggleTag:e=>{c(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},resetModal:()=>{a(!1),c([]),u([]),x(""),h([]),o("")}}},nn=e=>{var t;let{isOpen:n,onClose:s,students:a,instructors:l,onCoursesUpdated:o}=e;const[i,c]=(0,r.useState)([]),[d,u]=(0,r.useState)([]),[m,x]=(0,r.useState)([]),[g,h]=(0,r.useState)([]),[p,f]=(0,r.useState)([]),[b,y]=(0,r.useState)(""),[v,j]=(0,r.useState)(""),[N,w]=(0,r.useState)("courses"),[k,S]=(0,r.useState)(""),[_,C]=(0,r.useState)(""),[I,T]=(0,r.useState)("all"),P=JSON.parse(localStorage.getItem("currentUser")||"{}"),L=()=>{var e;const t=sessionStorage.getItem("selectedSatellite");if(t)try{const e=JSON.parse(t);if(e.id)return e.id}catch(n){console.error("sessionStorage\u306eselectedSatellite\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",n)}return JSON.parse(localStorage.getItem("selectedSatellite")||"{}").id||(null===(e=P.satellite_ids)||void 0===e?void 0:e[0])||P.satellite_id||1},E=async()=>{try{const e=L();if(!e)return;const t=await nt(e);t.success&&c(t.data||[])}catch(e){console.error("\u5229\u7528\u8005\u306e\u30b3\u30fc\u30b9\u95a2\u9023\u4ed8\u3051\u53d6\u5f97\u30a8\u30e9\u30fc:",e)}},D=()=>{let e=a;return k&&(e=e.filter(e=>{var t,n;return e.name.toLowerCase().includes(k.toLowerCase())||(null===(t=e.email)||void 0===t?void 0:t.toLowerCase().includes(k.toLowerCase()))||(null===(n=e.instructor_name)||void 0===n?void 0:n.toLowerCase().includes(k.toLowerCase()))})),_&&(e=e.filter(e=>e.instructor_id===parseInt(_))),"all"!==I&&(e=e.filter(e=>e.status===parseInt(I))),e},A=()=>{h([]),f([]),y(""),j(""),w("courses"),S(""),C(""),T("all"),s()};return(0,r.useEffect)(()=>{n&&(E(),(async()=>{try{const e=L();if(!e)return;const t=await st(e);t.success&&u(t.data||[])}catch(e){console.error("\u5229\u7528\u53ef\u80fd\u306a\u30b3\u30fc\u30b9\u53d6\u5f97\u30a8\u30e9\u30fc:",e)}})(),(async()=>{try{const e=L();if(!e)return;const t=await rt(e);t.success&&x(t.data||[])}catch(e){console.error("\u5229\u7528\u53ef\u80fd\u306a\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u53d6\u5f97\u30a8\u30e9\u30fc:",e)}})())},[n]),n?(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[95vh] flex flex-col",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\ud83d\udcda \u5b66\u7fd2\u30b3\u30fc\u30b9\u30fb\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u7ba1\u7406"}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all duration-200",onClick:A,children:"\xd7"})]})}),(0,pt.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-8",children:[(0,pt.jsxs)("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 rounded-xl p-6",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\ud83d\udc65 \u5bfe\u8c61\u5229\u7528\u8005\u9078\u629e"}),(0,pt.jsxs)("div",{className:"mb-4 space-y-3",children:[(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,pt.jsx)("div",{children:(0,pt.jsx)("input",{type:"text",placeholder:"\u5229\u7528\u8005\u540d\u3001\u30e1\u30fc\u30eb\u3001\u6307\u5c0e\u54e1\u540d\u3067\u691c\u7d22...",value:k,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200"})}),(0,pt.jsx)("div",{children:(0,pt.jsxs)("select",{value:_,onChange:e=>C(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200",children:[(0,pt.jsx)("option",{value:"",children:"\u5168\u3066\u306e\u6307\u5c0e\u54e1"}),l.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.name},e.id))]})}),(0,pt.jsx)("div",{children:(0,pt.jsxs)("select",{value:I,onChange:e=>T(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200",children:[(0,pt.jsx)("option",{value:"all",children:"\u5168\u3066\u306e\u30b9\u30c6\u30fc\u30bf\u30b9"}),(0,pt.jsx)("option",{value:"1",children:"\u7a3c\u50cd\u4e2d"}),(0,pt.jsx)("option",{value:"0",children:"\u505c\u6b62\u4e2d"})]})})]}),(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsxs)("p",{className:"text-gray-700",children:["\u8868\u793a\u4e2d: ",(0,pt.jsxs)("strong",{className:"text-orange-600",children:[D().length,"\u540d"]})," / \u9078\u629e\u4e2d: ",(0,pt.jsxs)("strong",{className:"text-orange-600",children:[g.length,"\u540d"]})]}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-orange-100 text-orange-700 rounded-lg font-medium hover:bg-orange-200 transition-all duration-200",onClick:()=>{const e=D();g.length===e.length?h([]):h(e.map(e=>e.id))},children:g.length===D().length?"\u5168\u9078\u629e\u89e3\u9664":"\u5168\u9078\u629e"})]})]}),(0,pt.jsx)("div",{className:"max-h-40 overflow-y-auto space-y-2",children:D().map(e=>(0,pt.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg border border-gray-200",children:[(0,pt.jsx)("input",{type:"checkbox",checked:g.includes(e.id),onChange:()=>{h(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id])},className:"w-4 h-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500"}),(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-800",children:e.name}),(0,pt.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["\u62c5\u5f53: ",e.instructor_name||"\u672a\u8a2d\u5b9a"]}),(0,pt.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["\u30e1\u30fc\u30eb: ",e.email||"\u672a\u8a2d\u5b9a"]}),(0,pt.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ml-2 "+(1===e.status?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:1===e.status?"\u7a3c\u50cd\u4e2d":"\u505c\u6b62\u4e2d"})]})]},e.id))})]}),(0,pt.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6",children:[(0,pt.jsxs)("div",{className:"flex gap-2 mb-6 p-1 bg-gray-100 rounded-xl",children:[(0,pt.jsx)("button",{className:"flex-1 py-3 px-4 rounded-lg font-medium transition-all duration-200 "+("courses"===N?"bg-white text-blue-600 shadow-md":"text-gray-600 hover:text-gray-800"),onClick:()=>w("courses"),children:"\ud83d\udcd6 \u500b\u5225\u30b3\u30fc\u30b9\u9078\u629e"}),(0,pt.jsx)("button",{className:"flex-1 py-3 px-4 rounded-lg font-medium transition-all duration-200 "+("curriculum"===N?"bg-white text-blue-600 shadow-md":"text-gray-600 hover:text-gray-800"),onClick:()=>w("curriculum"),children:"\ud83d\udee4\ufe0f \u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u9078\u629e"})]}),"courses"===N?(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("p",{className:"text-gray-700",children:["\u9078\u629e\u4e2d\u306e\u30b3\u30fc\u30b9: ",(0,pt.jsxs)("strong",{className:"text-blue-600",children:[p.length,"\u500b"]})]}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-blue-100 text-blue-700 rounded-lg font-medium hover:bg-blue-200 transition-all duration-200",onClick:()=>f([]),children:"\u5168\u9078\u629e\u89e3\u9664"})]}),(0,pt.jsx)("div",{className:"max-h-40 overflow-y-auto space-y-2",children:d.map(e=>(0,pt.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-white rounded-lg border border-gray-200",children:[(0,pt.jsx)("input",{type:"checkbox",checked:p.includes(e.id),onChange:()=>{f(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id])},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-800",children:e.title}),(0,pt.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["\u30ab\u30c6\u30b4\u30ea: ",e.category]}),(0,pt.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["\u30ec\u30c3\u30b9\u30f3\u6570: ",e.lesson_count,"\u56de"]})]})]},e.id))})]}):(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("p",{className:"text-gray-700",children:["\u9078\u629e\u4e2d\u306e\u30d1\u30b9: ",(0,pt.jsx)("strong",{className:"text-purple-600",children:b?null===(t=m.find(e=>e.id===parseInt(b)))||void 0===t?void 0:t.name:"\u306a\u3057"})]}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-purple-100 text-purple-700 rounded-lg font-medium hover:bg-purple-200 transition-all duration-200",onClick:()=>{y(""),f([])},children:"\u9078\u629e\u89e3\u9664"})]}),(0,pt.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-3",children:m.map(e=>{var t;return(0,pt.jsx)("div",{className:"p-4 bg-white rounded-lg border border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-start gap-3",children:[(0,pt.jsx)("input",{type:"radio",name:"curriculumPath",value:e.id,checked:b===e.id.toString(),onChange:e=>(e=>{if(y(e),e){const t=m.find(t=>t.id===parseInt(e));if(t&&t.courses){const e=t.courses.map(e=>e.course_id);f(e)}}else f([])})(e.target.value),className:"w-4 h-4 text-purple-600 border-gray-300 focus:ring-purple-500 mt-1"}),(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,pt.jsx)("span",{className:"font-semibold text-gray-800",children:e.name}),(0,pt.jsxs)("span",{className:"px-2 py-1 bg-purple-100 text-purple-700 text-xs rounded-full",children:[e.total_courses,"\u30b3\u30fc\u30b9"]})]}),(0,pt.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:e.description}),(0,pt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,pt.jsx)("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"\u542b\u307e\u308c\u308b\u30b3\u30fc\u30b9:"}),(0,pt.jsx)("div",{className:"space-y-1",children:null===(t=e.courses)||void 0===t?void 0:t.map((e,t)=>(0,pt.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,pt.jsx)("span",{className:"w-6 h-6 bg-purple-100 text-purple-700 rounded-full flex items-center justify-center font-medium",children:t+1}),(0,pt.jsx)("span",{className:"text-gray-700",children:e.course_title}),(0,pt.jsxs)("span",{className:"text-gray-500",children:["(",e.course_category,")"]})]},e.course_id))})]})]})]})},e.id)})})]})]}),(0,pt.jsxs)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\ud83d\udcdd \u5099\u8003\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09"}),(0,pt.jsx)("textarea",{value:v,onChange:e=>j(e.target.value),placeholder:"\u30b3\u30fc\u30b9\u5272\u308a\u5f53\u3066\u306b\u95a2\u3059\u308b\u5099\u8003\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044...",rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 resize-none"})]})]}),(0,pt.jsx)("div",{className:"p-6 border-t border-gray-200",children:(0,pt.jsxs)("div",{className:"flex gap-4",children:[(0,pt.jsx)("button",{className:"flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-all duration-200",onClick:A,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),"courses"===N?(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsx)("button",{className:"flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200",onClick:async()=>{if(0!==g.length)if(0!==p.length){if(window.confirm(`\u9078\u629e\u3055\u308c\u305f${g.length}\u540d\u306e\u5229\u7528\u8005\u304b\u3089${p.length}\u500b\u306e\u30b3\u30fc\u30b9\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f`))try{const e=L();if(!e)return;const t=await lt(e,{userIds:g,courseIds:p});if(!t.success)throw new Error(t.message||"\u30b3\u30fc\u30b9\u306e\u4e00\u62ec\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f");await E(),h([]),f([]),o&&o(),alert(t.message),s()}catch(e){console.error("\u30b3\u30fc\u30b9\u4e00\u62ec\u524a\u9664\u30a8\u30e9\u30fc:",e),alert(`\u30b3\u30fc\u30b9\u306e\u4e00\u62ec\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${e.message}`)}}else alert("\u524a\u9664\u3059\u308b\u30b3\u30fc\u30b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044");else alert("\u524a\u9664\u5bfe\u8c61\u306e\u5229\u7528\u8005\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044")},disabled:0===g.length||0===p.length,children:"\ud83d\uddd1\ufe0f \u4e00\u62ec\u524a\u9664"}),(0,pt.jsx)("button",{className:"flex-1 px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200",onClick:async()=>{if(0!==g.length)if(0!==p.length)try{const e=L();if(!e)return;const t=await at(e,{userIds:g,courseIds:p,notes:v});if(!t.success)throw new Error(t.message||"\u30b3\u30fc\u30b9\u306e\u4e00\u62ec\u5272\u308a\u5f53\u3066\u306b\u5931\u6557\u3057\u307e\u3057\u305f");await E(),h([]),f([]),j(""),o&&o(),alert(t.message),s()}catch(e){console.error("\u30b3\u30fc\u30b9\u4e00\u62ec\u5272\u308a\u5f53\u3066\u30a8\u30e9\u30fc:",e),alert(`\u30b3\u30fc\u30b9\u306e\u4e00\u62ec\u5272\u308a\u5f53\u3066\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${e.message}`)}else alert("\u5272\u308a\u5f53\u3066\u308b\u30b3\u30fc\u30b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044");else alert("\u4e00\u62ec\u64cd\u4f5c\u3059\u308b\u5229\u7528\u8005\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044")},disabled:0===g.length||0===p.length,children:"\u2795 \u4e00\u62ec\u8ffd\u52a0"})]}):(0,pt.jsx)("button",{className:"flex-1 px-6 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200",onClick:async()=>{if(0!==g.length)if(b)try{const e=L();if(!e)return;const t=await ot(e,{userIds:g,curriculumPathId:b,notes:v});if(!t.success)throw new Error(t.message||"\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u306e\u4e00\u62ec\u5272\u308a\u5f53\u3066\u306b\u5931\u6557\u3057\u307e\u3057\u305f");await E(),h([]),y(""),j(""),o&&o(),alert(t.message),s()}catch(e){console.error("\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u4e00\u62ec\u5272\u308a\u5f53\u3066\u30a8\u30e9\u30fc:",e),alert(`\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u306e\u4e00\u62ec\u5272\u308a\u5f53\u3066\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${e.message}`)}else alert("\u5272\u308a\u5f53\u3066\u308b\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044");else alert("\u4e00\u62ec\u64cd\u4f5c\u3059\u308b\u5229\u7528\u8005\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044")},disabled:0===g.length||!b,children:"\u2795 \u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9\u8ffd\u52a0"})]})})]})}):null},sn=e=>{if(!e)return"";try{return new Date(e).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Tokyo"})}catch(t){return console.error("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u6709\u52b9\u671f\u9650\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30a8\u30e9\u30fc:",t),e}},rn=e=>{let{students:t,onIssueTemporaryPassword:n,onEditStudent:s,onToggleStatus:r,onDeleteStudent:a,onViewDailyReports:l,onViewTestResults:o,onTestApproval:i,onSubmissionApproval:c}=e;return console.log("=== StudentTable \u30ec\u30f3\u30c0\u30ea\u30f3\u30b0 ==="),console.log("\u53d7\u3051\u53d6\u3063\u305fstudents:",t),console.log("students.length:",t.length),(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100",children:(0,pt.jsx)("div",{className:"overflow-x-auto",style:{minWidth:"1200px"},children:(0,pt.jsxs)("table",{className:"w-full table-fixed",children:[(0,pt.jsx)("thead",{className:"bg-gradient-to-r from-indigo-50 to-purple-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-indigo-800 border-b border-indigo-200",style:{width:"150px"},children:"\u5229\u7528\u8005\u540d"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-indigo-800 border-b border-indigo-200",style:{width:"120px"},children:"\u62c5\u5f53\u6307\u5c0e\u54e1"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-indigo-800 border-b border-indigo-200",style:{width:"200px"},children:"\u30b3\u30fc\u30b9\u30fb\u30bf\u30b0"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-indigo-800 border-b border-indigo-200",style:{width:"180px"},children:"\u9032\u6357\u72b6\u6cc1"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-indigo-800 border-b border-indigo-200",style:{width:"120px"},children:"\u30d1\u30b9\u30ef\u30fc\u30c9"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left text-sm font-semibold text-indigo-800 border-b border-indigo-200",style:{width:"200px"},children:"\u64cd\u4f5c"})]})}),(0,pt.jsx)("tbody",{className:"divide-y divide-gray-100",children:t.map((e,t)=>(0,pt.jsxs)("tr",{id:`student-row-${e.id}`,className:"hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 transition-all duration-200 "+(t%2===0?"bg-white":"bg-gray-50"),children:[(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsxs)("div",{className:"flex flex-col",children:[(0,pt.jsx)("button",{className:"text-left font-semibold text-indigo-600 hover:text-indigo-800 transition-colors duration-200",onClick:()=>{},title:"\u5229\u7528\u8005\u8a73\u7d30\u3092\u8868\u793a",children:e.name}),(0,pt.jsx)("div",{className:"text-xs text-gray-500 mt-1 font-mono",children:e.login_code})]})}),(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsx)("span",{className:"text-sm text-gray-600",children:e.instructor_name||"\u672a\u8a2d\u5b9a"})}),(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsxs)("div",{className:"space-y-2",children:[(0,pt.jsx)("div",{className:"flex flex-wrap gap-1",children:(()=>{const t=e.courses||[];return console.log(`\u5229\u7528\u8005 ${e.name} \u306e\u30b3\u30fc\u30b9\u60c5\u5831:`,t),console.log(`\u5229\u7528\u8005 ${e.name} \u306e\u5168\u30c7\u30fc\u30bf:`,e),(0,pt.jsxs)(pt.Fragment,{children:[t.slice(0,4).map((e,t)=>{const n=e.title||e.course_title||"",s=e.category||"",r="\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9"===s;return(0,pt.jsx)("span",{className:"px-2 py-1 text-xs rounded-full font-medium "+(r?"bg-blue-100 text-blue-700":"bg-orange-100 text-orange-700"),title:`${n} (${s})`,children:n&&n.length>12?n.substring(0,12)+"...":n},t)}),t.length>4&&(0,pt.jsxs)("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:["+",t.length-4]}),0===t.length&&(0,pt.jsx)("span",{className:"text-gray-400 text-xs",children:"\u672a\u5272\u308a\u5f53\u3066"})]})})()}),(0,pt.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.tags&&Array.isArray(e.tags)&&e.tags.length>0?e.tags.slice(0,5).map(e=>(0,pt.jsx)("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-700 text-xs rounded-full font-medium",children:e.length>10?e.substring(0,10)+"...":e},e)):(0,pt.jsx)("span",{className:"text-gray-400 text-xs",children:"\u30bf\u30b0\u306a\u3057"}),e.tags&&Array.isArray(e.tags)&&e.tags.length>5&&(0,pt.jsxs)("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:["+",e.tags.length-5]})]})]})}),(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsxs)("div",{className:"space-y-2",children:[(0,pt.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,pt.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 "+((e.progress||0)>=75?"bg-gradient-to-r from-green-400 to-green-600":(e.progress||0)>=50?"bg-gradient-to-r from-yellow-400 to-yellow-600":"bg-gradient-to-r from-red-400 to-red-600"),style:{width:`${e.progress||0}%`}})}),(0,pt.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,pt.jsxs)("span",{className:"font-medium",children:[e.progress||0,"%"]}),(0,pt.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold "+((e.progress||0)>=75?"bg-green-100 text-green-800":(e.progress||0)>0?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:(e.progress||0)>=75?"\u5408\u683c":(e.progress||0)>0?"\u53d7\u8b1b\u4e2d":"\u672a\u958b\u59cb"})]}),(0,pt.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold "+(1===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:1===e.status?"\u7a3c\u50cd\u4e2d":"\u505c\u6b62\u4e2d"})]})}),(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsxs)("div",{className:"space-y-1",children:[e.temp_password?(0,pt.jsxs)("div",{className:"text-xs",children:[(0,pt.jsx)("div",{className:"font-semibold text-blue-600 font-mono",children:e.temp_password}),(0,pt.jsx)("div",{className:"text-gray-500",children:(0,pt.jsxs)("div",{className:"flex items-center gap-1",children:[(0,pt.jsx)("span",{className:e.expires_at&&!(0,Pt.isExpired)(e.expires_at)?"text-green-600":"text-red-600",children:e.expires_at&&!(0,Pt.isExpired)(e.expires_at)?"\u6709\u52b9":"\u671f\u9650\u5207\u308c"}),e.expires_at&&(0,pt.jsxs)("span",{className:"text-gray-400",children:["(",sn(e.expires_at),")"]})]})})]}):(0,pt.jsxs)("div",{className:"text-xs",children:[(0,pt.jsx)("div",{className:"text-gray-400 mb-1",children:"\u672a\u767a\u884c"}),(0,pt.jsx)("button",{className:"px-2 py-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-xs rounded font-medium hover:from-blue-600 hover:to-blue-700 transition-all duration-200",onClick:()=>{console.log(`\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u30dc\u30bf\u30f3\u30af\u30ea\u30c3\u30af: \u30e6\u30fc\u30b6\u30fc${e.id} (${e.name})`),n(e.id)},title:"\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u767a\u884c",children:"\u767a\u884c"})]}),e.temp_password&&(0,pt.jsx)("button",{className:"px-2 py-1 bg-gradient-to-r from-orange-500 to-orange-600 text-white text-xs rounded font-medium hover:from-orange-600 hover:to-orange-700 transition-all duration-200",onClick:()=>n(e.id),title:"\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u518d\u767a\u884c",children:"\u518d\u767a\u884c"})]})}),(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsxs)("div",{className:"grid grid-cols-2 gap-1",children:[(0,pt.jsx)("button",{className:"px-2 py-1 bg-blue-600 text-white rounded text-xs font-medium hover:bg-blue-700 transition-all duration-200",onClick:()=>s(e),title:"\u5229\u7528\u8005\u60c5\u5831\u3068\u500b\u5225\u652f\u63f4\u8a08\u753b\u3092\u7de8\u96c6",children:"\u270f\ufe0f \u7de8\u96c6"}),(0,pt.jsx)("button",{className:"px-2 py-1 bg-orange-600 text-white rounded text-xs font-medium hover:bg-orange-700 transition-all duration-200",onClick:()=>l(e),title:"\u65e5\u5831\u78ba\u8a8d\u30fb\u7de8\u96c6\u30fb\u30b3\u30e1\u30f3\u30c8",children:"\ud83d\udcca \u65e5\u5831\u78ba\u8a8d"}),(0,pt.jsx)("button",{className:"px-2 py-1 bg-green-600 text-white rounded text-xs font-medium hover:bg-green-700 transition-all duration-200",onClick:()=>i&&i(e),title:"\u30c6\u30b9\u30c8\u306e\u5408\u683c\u627f\u8a8d",children:"\u2705 \u5408\u683c\u627f\u8a8d"}),(0,pt.jsx)("button",{className:"px-2 py-1 bg-purple-600 text-white rounded text-xs font-medium hover:bg-purple-700 transition-all duration-200",onClick:()=>c&&c(e),title:"\u63d0\u51fa\u7269\u306e\u78ba\u8a8d\u30fb\u627f\u8a8d",children:"\ud83d\udcc4 \u63d0\u51fa\u7269\u78ba\u8a8d"}),(0,pt.jsx)("button",{className:"px-2 py-1 rounded text-xs font-medium transition-all duration-200 "+(1===e.status?"bg-red-600 text-white hover:bg-red-700":"bg-green-600 text-white hover:bg-green-700"),onClick:()=>r(e.id),children:1===e.status?"\u505c\u6b62":"\u518d\u958b"}),(0,pt.jsx)("button",{className:"px-2 py-1 bg-red-600 text-white rounded text-xs font-medium hover:bg-red-700 transition-all duration-200",onClick:()=>a(e.id),children:"\u524a\u9664"})]})})]},e.id))})]})})})},an=e=>{let{isOpen:t,onClose:n,student:s,satelliteId:a,onApprovalSuccess:l}=e;const[o,i]=(0,r.useState)([]),[c,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),[x,g]=(0,r.useState)(null),h=async()=>{if(!a||!s)return;d(!0),g(null);const e=localStorage.getItem("accessToken");console.log("TestApprovalModal: \u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u78ba\u8a8d:",{hasToken:!!e,tokenLength:e?e.length:0,tokenPreview:e?e.substring(0,20)+"...":"\u306a\u3057"});try{console.log("TestApprovalModal: getPendingApprovals\u547c\u3073\u51fa\u3057\u958b\u59cb, satelliteId:",a,"type:",typeof a);const e=await ct(a);if(console.log("TestApprovalModal: getPendingApprovals\u30ec\u30b9\u30dd\u30f3\u30b9:",e),e.success){const t=e.data.filter(e=>e.user_id===s.id);i(t)}else g("\u672a\u627f\u8a8d\u30c6\u30b9\u30c8\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(x){console.error("\u672a\u627f\u8a8d\u30c6\u30b9\u30c8\u53d6\u5f97\u30a8\u30e9\u30fc:",x),console.error("\u30a8\u30e9\u30fc\u8a73\u7d30:",{message:x.message,stack:x.stack,response:x.response,status:x.status}),g(`\u672a\u627f\u8a8d\u30c6\u30b9\u30c8\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: ${x.message}`)}finally{d(!1)}},p=async e=>{if(window.confirm(`${e.lesson_name}\u306e\u30c6\u30b9\u30c8\u5408\u683c\u3092\u627f\u8a8d\u3057\u307e\u3059\u304b\uff1f`)){m(!0),g(null);try{const t=await(async(e,t,n)=>We("/api/test/instructor/approve-test",{examResultId:e,studentId:t,lessonId:n}))(e.exam_result_id,e.user_id,e.lesson_id);t.success?(alert(t.message),await h(),l&&l()):g(t.message||"\u627f\u8a8d\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(x){console.error("\u30c6\u30b9\u30c8\u627f\u8a8d\u30a8\u30e9\u30fc:",x),g("\u627f\u8a8d\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}finally{m(!1)}}};return(0,r.useEffect)(()=>{t&&s&&a&&h()},[t,s,a]),t?(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("h3",{className:"text-2xl font-bold text-gray-800",children:["\ud83d\udcdd \u5408\u683c\u627f\u8a8d - ",null===s||void 0===s?void 0:s.name]}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all duration-200",onClick:n,children:"\xd7"})]})}),(0,pt.jsxs)("div",{className:"p-6",children:[x&&(0,pt.jsx)("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,pt.jsxs)("div",{className:"flex items-center",children:[(0,pt.jsx)("span",{className:"text-red-500 mr-2",children:"\u26a0\ufe0f"}),(0,pt.jsx)("span",{className:"text-red-700",children:x})]})}),c?(0,pt.jsx)("div",{className:"text-center py-8",children:(0,pt.jsx)("div",{className:"text-lg text-gray-600",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."})}):0===o.length?(0,pt.jsxs)("div",{className:"text-center py-8",children:[(0,pt.jsx)("div",{className:"text-6xl mb-4",children:"\u2705"}),(0,pt.jsx)("h4",{className:"text-xl font-semibold text-gray-800 mb-2",children:"\u672a\u627f\u8a8d\u306e\u5408\u683c\u30c6\u30b9\u30c8\u306f\u3042\u308a\u307e\u305b\u3093"}),(0,pt.jsxs)("p",{className:"text-gray-600",children:[null===s||void 0===s?void 0:s.name,"\u3055\u3093\u306e\u672a\u627f\u8a8d\u306e\u5408\u683c\u30c6\u30b9\u30c8\u306f\u73fe\u5728\u3042\u308a\u307e\u305b\u3093\u3002"]})]}):(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6",children:(0,pt.jsxs)("div",{className:"flex items-center",children:[(0,pt.jsx)("span",{className:"text-blue-500 mr-2",children:"\ud83d\udca1"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h4",{className:"font-semibold text-blue-800",children:"\u627f\u8a8d\u306b\u3064\u3044\u3066"}),(0,pt.jsxs)("p",{className:"text-blue-700 text-sm mt-1",children:["\u63d0\u51fa\u7269\u304c\u306a\u3044\u30ec\u30c3\u30b9\u30f3\uff1a\u627f\u8a8d\u3067\u5b8c\u4e86",(0,pt.jsx)("br",{}),"\u63d0\u51fa\u7269\u304c\u3042\u308b\u30ec\u30c3\u30b9\u30f3\uff1a\u30c6\u30b9\u30c8\u627f\u8a8d\uff0b\u63d0\u51fa\u7269\u627f\u8a8d\u306e\u4e21\u65b9\u3067\u5b8c\u4e86"]})]})]})}),o.map(e=>(0,pt.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800",children:e.lesson_name}),(0,pt.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("lesson"===e.test_type?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800"),children:"lesson"===e.test_type?"\u7dcf\u5408\u30c6\u30b9\u30c8":"\u30bb\u30af\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8"}),e.has_assignment&&(0,pt.jsx)("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs font-medium",children:"\u63d0\u51fa\u7269\u3042\u308a"})]}),(0,pt.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm text-gray-600",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u5f97\u70b9:"}),(0,pt.jsxs)("span",{className:"ml-1",children:[e.score,"/",e.total_questions]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u6b63\u7b54\u7387:"}),(0,pt.jsxs)("span",{className:"ml-1",children:[e.percentage,"%"]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u53d7\u9a13\u65e5:"}),(0,pt.jsx)("span",{className:"ml-1",children:new Date(e.exam_date).toLocaleDateString("ja-JP")})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u30b9\u30c6\u30fc\u30bf\u30b9:"}),(0,pt.jsx)("span",{className:"ml-1 text-green-600 font-medium",children:"\u5408\u683c"})]})]})]}),(0,pt.jsx)("div",{className:"ml-4",children:(0,pt.jsx)("button",{onClick:()=>p(e),disabled:u,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2",children:u?(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"\u627f\u8a8d\u4e2d..."]}):(0,pt.jsx)(pt.Fragment,{children:"\u2705 \u627f\u8a8d"})})})]})},e.exam_result_id))]})]}),(0,pt.jsx)("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:(0,pt.jsx)("div",{className:"flex justify-end",children:(0,pt.jsx)("button",{onClick:n,className:"px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200",children:"\u9589\u3058\u308b"})})})]})}):null},ln=e=>{let{satelliteId:t,onApprovalClick:n,onStudentClick:s}=e;const[a,l]=(0,r.useState)([]),[o,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),u=async()=>{if(t){i(!0),d(null);try{const e=await ct(t);e.success?l(e.data):d("\u672a\u627f\u8a8d\u30c6\u30b9\u30c8\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(c){console.error("\u672a\u627f\u8a8d\u30c6\u30b9\u30c8\u53d6\u5f97\u30a8\u30e9\u30fc:",c),d("\u672a\u627f\u8a8d\u30c6\u30b9\u30c8\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}finally{i(!1)}}};if((0,r.useEffect)(()=>{if(t){u();const e=setInterval(u,3e5);return()=>clearInterval(e)}},[t]),!t||o||c||0===a.length)return null;const m=a.reduce((e,t)=>{const n=t.user_id;return e[n]||(e[n]={student_name:t.student_name,tests:[]}),e[n].tests.push(t),e},{});return(0,pt.jsxs)("div",{className:"mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,pt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,pt.jsxs)("div",{className:"flex items-center",children:[(0,pt.jsx)("span",{className:"text-yellow-600 text-lg mr-2",children:"\u26a0\ufe0f"}),(0,pt.jsx)("h3",{className:"font-semibold text-yellow-800",children:"\u672a\u627f\u8a8d\u306e\u5408\u683c\u30c6\u30b9\u30c8\u304c\u3042\u308a\u307e\u3059"})]}),(0,pt.jsx)("button",{onClick:()=>window.location.reload(),className:"text-yellow-600 hover:text-yellow-800 text-sm",children:"\ud83d\udd04 \u66f4\u65b0"})]}),(0,pt.jsx)("div",{className:"space-y-2",children:Object.entries(m).map(e=>{let[t,n]=e;return(0,pt.jsx)("div",{className:"bg-white rounded-lg p-3 border border-yellow-200",children:(0,pt.jsx)("div",{className:"flex items-center justify-between",children:(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("h4",{className:"font-medium text-gray-800 mb-1 cursor-pointer hover:text-yellow-700 transition-colors",onClick:()=>s&&s(t),title:"\u30af\u30ea\u30c3\u30af\u3057\u3066\u8a72\u5f53\u8005\u306e\u884c\u306b\u79fb\u52d5",children:[n.student_name,"\u3055\u3093"]}),(0,pt.jsx)("div",{className:"space-y-1",children:n.tests.map(e=>(0,pt.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,pt.jsxs)("span",{className:"text-gray-600",children:[e.lesson_name,"\u306e\u30c6\u30b9\u30c8\u5408\u683c\u304c\u672a\u627f\u8a8d\u3067\u3059",e.score&&e.score>0&&(0,pt.jsxs)("span",{className:"ml-1 text-gray-500",children:["(",e.score,"\u70b9)"]})]}),1===e.has_assignment&&(0,pt.jsx)("span",{className:"text-orange-600",children:"\uff08\u63d0\u51fa\u7269\u306e\u627f\u8a8d\u3082\u5fc5\u8981\uff09"})]},e.exam_result_id))})]})})},t)})}),(0,pt.jsx)("div",{className:"mt-3 text-xs text-yellow-700",children:"\ud83d\udca1 \u5b66\u751f\u540d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u8a72\u5f53\u8005\u306e\u884c\u306b\u79fb\u52d5\u3057\u3001\u5408\u683c\u627f\u8a8d\u30dc\u30bf\u30f3\u304b\u3089\u500b\u5225\u306b\u627f\u8a8d\u3067\u304d\u307e\u3059"})]})},on=e=>{let{isOpen:t,onClose:n,student:s,onApprovalSuccess:a}=e;const[l,o]=(0,r.useState)([]),[i,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)(null),[g,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(""),b=async()=>{if(s){c(!0),x(null);try{const e=await(async e=>He(`/api/submissions/instructor/student/${e}/submissions`))(s.id);e.success?o(e.data):x("\u63d0\u51fa\u7269\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(m){console.error("\u63d0\u51fa\u7269\u53d6\u5f97\u30a8\u30e9\u30fc:",m),x("\u63d0\u51fa\u7269\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}finally{c(!1)}}},y=e=>{if(!e)return null;const t=e.split("/"),n=t[t.length-1];return n&&n.includes(".")?n:null},v=async e=>{try{x(null);const t=await(async e=>Ye(`/api/submissions/instructor/download/${e}`))(e.submission_id);let n=y(e.file_url);n||(n=e.file_name||`submission_${e.submission_id}`),console.log("\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30d5\u30a1\u30a4\u30eb\u540d:",n),console.log("file_url:",e.file_url),console.log("file_name:",e.file_name);const s=window.URL.createObjectURL(t),r=document.createElement("a");r.href=s,r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(s)}catch(m){console.error("\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30a8\u30e9\u30fc:",m),x("\u30d5\u30a1\u30a4\u30eb\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}},j=async e=>{if(window.confirm(`${e.lesson_name}\u306e\u63d0\u51fa\u7269\u3092\u627f\u8a8d\u3057\u307e\u3059\u304b\uff1f`)){u(!0),x(null);try{const t=await async function(e,t,n){return We("/api/submissions/instructor/approve-submission",{submissionId:e,studentId:t,lessonId:n,comment:arguments.length>3&&void 0!==arguments[3]?arguments[3]:""})}(e.submission_id,e.user_id,e.lesson_id,p);t.success?(alert(t.message),await b(),a&&a(),f("")):x(t.message||"\u627f\u8a8d\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(m){console.error("\u63d0\u51fa\u7269\u627f\u8a8d\u30a8\u30e9\u30fc:",m),x("\u627f\u8a8d\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}finally{u(!1)}}},N=e=>{if(!e)return"";return e.replace(/-/g,"/").replace("T"," ").replace(/\.\d{3}Z?$/,"").replace(/\s+/g," ")};return(0,r.useEffect)(()=>{t&&s&&b()},[t,s]),t?(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-4 pb-4 border-b",children:[(0,pt.jsxs)("h2",{className:"text-xl font-bold text-gray-800",children:["\u63d0\u51fa\u7269\u78ba\u8a8d - ",null===s||void 0===s?void 0:s.name]}),(0,pt.jsx)("button",{onClick:n,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"\xd7"})]}),m&&(0,pt.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded",children:m}),i&&(0,pt.jsxs)("div",{className:"flex justify-center items-center py-8",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),(0,pt.jsx)("span",{className:"ml-2 text-gray-600",children:"\u63d0\u51fa\u7269\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]}),!i&&(0,pt.jsx)("div",{className:"flex-1 overflow-y-auto",children:0===l.length?(0,pt.jsx)("div",{className:"text-center py-8 text-gray-500",children:"\u63d0\u51fa\u7269\u304c\u3042\u308a\u307e\u305b\u3093"}):(0,pt.jsx)("div",{className:"space-y-4",children:l.map(e=>(0,pt.jsx)("div",{className:"p-4 border rounded-lg "+(e.instructor_approved?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"),children:(0,pt.jsxs)("div",{className:"flex justify-between items-start",children:[(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,pt.jsx)("h3",{className:"font-semibold text-gray-800",children:e.lesson_name}),(0,pt.jsx)("span",{className:"px-2 py-1 text-xs rounded-full "+(e.instructor_approved?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:e.instructor_approved?"\u627f\u8a8d\u6e08\u307f":"\u672a\u627f\u8a8d"})]}),(0,pt.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600 mb-3",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u30d5\u30a1\u30a4\u30eb\u540d:"})," ",y(e.file_url)||e.file_name]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u63d0\u51fa\u65e5\u6642:"})," ",N(e.uploaded_at)]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u30ec\u30c3\u30b9\u30f3:"})," ",e.lesson_name]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u30b3\u30fc\u30b9:"})," ",e.course_title]})]}),1===e.instructor_approved&&e.approver_name&&(0,pt.jsxs)("div",{className:"text-sm text-green-700 mb-2",children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u627f\u8a8d\u8005:"})," ",e.approver_name,e.instructor_approved_at&&(0,pt.jsxs)("span",{className:"ml-2",children:["(",N(e.instructor_approved_at),")"]})]}),e.instructor_comment&&(0,pt.jsxs)("div",{className:"text-sm text-gray-600 mb-2",children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u30b3\u30e1\u30f3\u30c8:"})," ",e.instructor_comment]})]}),(0,pt.jsxs)("div",{className:"flex flex-col gap-2 ml-4",children:[(0,pt.jsx)("button",{onClick:()=>v(e),className:"px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors",disabled:d,children:"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9"}),!e.instructor_approved&&(0,pt.jsx)("button",{onClick:()=>j(e),className:"px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 transition-colors",disabled:d,children:d?"\u627f\u8a8d\u4e2d...":"\u627f\u8a8d"})]})]})},e.submission_id))})}),!1,(0,pt.jsx)("div",{className:"mt-4 pt-4 border-t flex justify-end gap-3",children:(0,pt.jsx)("button",{onClick:n,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors",disabled:d,children:"\u9589\u3058\u308b"})})]})}):null},cn=e=>{let{satelliteId:t,onSubmissionClick:n,onStudentClick:s}=e;const[a,l]=(0,r.useState)([]),[o,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),u=async()=>{if(t){i(!0),d(null);try{const e=await(async e=>He(`/api/submissions/instructor/pending-submissions/${e}`))(t);e.success?l(e.data):d("\u672a\u627f\u8a8d\u63d0\u51fa\u7269\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(c){console.error("\u672a\u627f\u8a8d\u63d0\u51fa\u7269\u53d6\u5f97\u30a8\u30e9\u30fc:",c),d("\u672a\u627f\u8a8d\u63d0\u51fa\u7269\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}finally{i(!1)}}};if((0,r.useEffect)(()=>{if(t){u();const e=setInterval(u,3e5);return()=>clearInterval(e)}},[t]),!t||o||c||0===a.length)return null;const m=a.reduce((e,t)=>{const n=t.user_id;return e[n]||(e[n]={student_name:t.student_name,submissions:[]}),e[n].submissions.push(t),e},{});return(0,pt.jsxs)("div",{className:"mb-6 p-4 bg-orange-50 border border-orange-200 rounded-lg",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,pt.jsx)("div",{className:"w-3 h-3 bg-orange-500 rounded-full animate-pulse"}),(0,pt.jsx)("h3",{className:"font-semibold text-orange-800",children:"\u672a\u627f\u8a8d\u306e\u63d0\u51fa\u7269\u304c\u3042\u308a\u307e\u3059"})]}),(0,pt.jsx)("div",{className:"space-y-2",children:Object.entries(m).map(e=>{let[t,n]=e;return(0,pt.jsx)("div",{className:"bg-white rounded-lg p-3 border border-orange-200",children:(0,pt.jsx)("div",{className:"flex items-center justify-between",children:(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("h4",{className:"font-medium text-gray-800 mb-1 cursor-pointer hover:text-orange-700 transition-colors",onClick:()=>s&&s(t),title:"\u30af\u30ea\u30c3\u30af\u3057\u3066\u8a72\u5f53\u8005\u306e\u884c\u306b\u79fb\u52d5",children:[n.student_name,"\u3055\u3093"]}),(0,pt.jsx)("div",{className:"space-y-1",children:n.submissions.map(e=>(0,pt.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,pt.jsxs)("span",{className:"text-gray-600",children:[e.lesson_name,"\u306e\u63d0\u51fa\u7269\u304c\u672a\u627f\u8a8d\u3067\u3059"]}),(0,pt.jsxs)("span",{className:"text-orange-600",style:{display:"none"},children:["\uff08",e.file_name,"\uff09"]})]},e.submission_id))})]})})},t)})}),(0,pt.jsx)("div",{className:"mt-3 text-xs text-orange-700",children:"\ud83d\udca1 \u5b66\u751f\u540d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u8a72\u5f53\u8005\u306e\u884c\u306b\u79fb\u52d5\u3057\u3001\u63d0\u51fa\u7269\u78ba\u8a8d\u30dc\u30bf\u30f3\u304b\u3089\u500b\u5225\u306b\u78ba\u8a8d\u30fb\u627f\u8a8d\u3067\u304d\u307e\u3059"})]})},dn=e=>{let{isOpen:t,onClose:n,students:s,selectedStudents:a,onStudentsUpdate:l,onSelectStudents:o}=e;const{currentUser:i}=bt(),[c,d]=(0,r.useState)([]),[u,m]=(0,r.useState)([]),[x,g]=(0,r.useState)([]),[h,p]=(0,r.useState)(""),[f,b]=(0,r.useState)(""),[y,v]=(0,r.useState)(""),[j,N]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&w()},[t]),(0,r.useEffect)(()=>{t&&k()},[x,t]);const w=async()=>{try{N(!0);const e=Qt(i),t=new URLSearchParams;e&&t.append("satellite_id",e);const n=await He(`/api/temp-passwords/instructors?${t}`);console.log("\u6307\u5c0e\u54e1\u4e00\u89a7\u53d6\u5f97\u30ec\u30b9\u30dd\u30f3\u30b9:",n),n.success?(console.log("\u53d6\u5f97\u3057\u305f\u6307\u5c0e\u54e1\u6570:",n.data.length),m(n.data)):(console.error("\u6307\u5c0e\u54e1\u4e00\u89a7\u53d6\u5f97\u5931\u6557:",n),alert("\u6307\u5c0e\u54e1\u4e00\u89a7\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(n.message||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc"))),await k()}catch(e){console.error("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u6a5f\u80fd\u521d\u671f\u5316\u30a8\u30e9\u30fc:",e),alert("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u6a5f\u80fd\u306e\u521d\u671f\u5316\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}finally{N(!1)}},k=async()=>{try{var e;const t=new URLSearchParams,n=Qt(i);console.log("=== TodayActiveModal fetchTempPasswordUsers \u30c7\u30d0\u30c3\u30b0 ==="),console.log("currentUser:",i),console.log("currentSatelliteId:",n),console.log("selectedInstructors:",x),n?(t.append("satellite_id",n),console.log("satellite_id \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8ffd\u52a0:",n)):console.log("satellite_id \u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f"),x.length>0&&(x.forEach(e=>{t.append("selected_instructor_ids",e)}),console.log("selected_instructor_ids \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8ffd\u52a0:",x)),console.log("\u9001\u4fe1\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf:",t.toString());const s=await He(`/api/temp-passwords/users?${t}`);if(console.log("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u5bfe\u8c61\u5229\u7528\u8005\u53d6\u5f97\u30ec\u30b9\u30dd\u30f3\u30b9:",s),console.log("\u53d6\u5f97\u3057\u305f\u5229\u7528\u8005\u6570:",(null===(e=s.data)||void 0===e?void 0:e.length)||0),console.log("\u5229\u7528\u8005\u30c7\u30fc\u30bf\u8a73\u7d30:",s.data),s.success){d(s.data);const e=s.data.map(e=>e.id);o(e)}else console.error("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u5bfe\u8c61\u5229\u7528\u8005\u53d6\u5f97\u5931\u6557:",s),d([])}catch(t){console.error("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u5bfe\u8c61\u5229\u7528\u8005\u53d6\u5f97\u30a8\u30e9\u30fc:",t)}},S=e=>{switch(e){case"my_user":return"\u81ea\u5206\u306e\u62c5\u5f53\u5229\u7528\u8005";case"no_instructor_no_temp":return"\u62c5\u5f53\u306a\u3057\u30fb\u30d1\u30b9\u30ef\u30fc\u30c9\u672a\u767a\u884c";case"selected_instructor":return"\u9078\u629e\u6307\u5c0e\u54e1\u306e\u62c5\u5f53\u5229\u7528\u8005";case"other_instructor":return"\u305d\u306e\u4ed6\u306e\u62c5\u5f53\u8005\u306e\u5229\u7528\u8005";default:return"\u305d\u306e\u4ed6"}},_=()=>{p(""),b(""),v(""),n()};return t?(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\ud83d\udd11 \u672c\u65e5\u6709\u52b9 - \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c"}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all duration-200",onClick:_,children:"\xd7"})]})}),(0,pt.jsxs)("div",{className:"p-6 space-y-8",children:[(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"\u5225\u62c5\u5f53\u8005\u9078\u629e\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09"}),(0,pt.jsx)("div",{className:"flex flex-wrap gap-3 max-h-48 overflow-y-auto",children:u.map((e,t)=>(0,pt.jsxs)("button",{onClick:()=>(e=>{const t=x.includes(e)?x.filter(t=>t!==e):[...x,e];g(t)})(e.id),className:"px-4 py-2 rounded-lg border transition-all duration-200 min-w-0 flex-1 basis-64 text-left "+(x.includes(e.id)?"bg-blue-500 text-white border-blue-500 hover:bg-blue-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50 hover:border-gray-400"),children:[(0,pt.jsx)("div",{className:"font-medium truncate",children:e.name}),(0,pt.jsxs)("div",{className:"text-sm truncate "+(x.includes(e.id)?"text-blue-100":"text-gray-600"),children:[e.company_name," ",e.satellite_name?`/ ${e.satellite_name}`:""]})]},`instructor-${e.id}-${t}`))}),(0,pt.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"\u9078\u629e\u3059\u308b\u3068\u3001\u305d\u306e\u6307\u5c0e\u54e1\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u672a\u767a\u884c\u62c5\u5f53\u5229\u7528\u8005\u3082\u30ea\u30b9\u30c8\u306b\u8ffd\u52a0\u3055\u308c\u307e\u3059"})]}),(0,pt.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold",children:"\u5229\u7528\u8005\u9078\u629e"}),(0,pt.jsx)("button",{onClick:()=>{a.length===c.length?o([]):o(c.map(e=>e.id))},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:a.length===c.length?"\u5168\u89e3\u9664":"\u5168\u9078\u629e"})]}),j?(0,pt.jsx)("div",{className:"text-center py-4",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."}):(0,pt.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:0===c.length?(0,pt.jsx)("div",{className:"text-center py-4 text-gray-500",children:"\u5229\u7528\u8005\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093"}):c.map((e,t)=>(0,pt.jsxs)("div",{className:"flex items-center p-3 border rounded hover:bg-gray-50",children:[(0,pt.jsx)("input",{type:"checkbox",checked:a.includes(e.id),onChange:()=>(e=>{const t=a.includes(e)?a.filter(t=>t!==e):[...a,e];o(t)})(e.id),className:"mr-3"}),(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("div",{className:"font-medium",children:e.name}),(0,pt.jsxs)("div",{className:"text-sm text-gray-600",children:[e.company_name," / ",e.satellite_name]}),(0,pt.jsx)("div",{className:"text-xs text-blue-600",children:S(e.user_type)})]})]},`${e.id}-${e.user_type}-${t}`))})]}),(0,pt.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"\u6709\u52b9\u671f\u9650\u8a2d\u5b9a\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09"}),(0,pt.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,pt.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),placeholder:"HH:DD\uff08\u4f8b\uff1a23:59\uff09",pattern:"^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$",className:"p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,pt.jsx)("span",{className:"text-gray-600",children:"\u307e\u3067\u6709\u52b9"})]}),(0,pt.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"\u6307\u5b9a\u306a\u3057\u306e\u5834\u5408\u306f\u65e5\u672c\u6642\u959323:59\u307e\u3067\u6709\u52b9\u3067\u3059\uff08HH:DD\u5f62\u5f0f\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\uff09"})]}),(0,pt.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold mb-4",children:"\u30a2\u30ca\u30a6\u30f3\u30b9\u30e1\u30c3\u30bb\u30fc\u30b8\uff08\u30aa\u30d7\u30b7\u30e7\u30f3\uff09"}),(0,pt.jsx)("input",{type:"text",value:f,onChange:e=>b(e.target.value),placeholder:"\u30a2\u30ca\u30a6\u30f3\u30b9\u30bf\u30a4\u30c8\u30eb",className:"w-full p-2 border border-gray-300 rounded mb-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,pt.jsx)("textarea",{value:y,onChange:e=>v(e.target.value),placeholder:"\u30a2\u30ca\u30a6\u30f3\u30b9\u30e1\u30c3\u30bb\u30fc\u30b8",rows:"4",className:"w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,pt.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:"\u9078\u629e\u3055\u308c\u305f\u5229\u7528\u8005\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u95b2\u89a7\u3067\u304d\u308b\u30a2\u30ca\u30a6\u30f3\u30b9\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4e00\u62ec\u9001\u4fe1\u3057\u307e\u3059"})]})]}),(0,pt.jsxs)("div",{className:"flex gap-4 pt-6 border-t border-gray-200",children:[(0,pt.jsx)("button",{className:"flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-all duration-200",onClick:_,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{className:"flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200",onClick:async()=>{if(0!==a.length)try{N(!0);const e={user_ids:a,expiry_time:h||null,announcement_title:f||null,announcement_message:y||null};(await We("/api/temp-passwords/issue",e)).success?(alert(`${a.length}\u540d\u306e\u5229\u7528\u8005\u306b\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u767a\u884c\u3057\u307e\u3057\u305f\u3002`),l(),_()):alert("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u767a\u884c\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}catch(e){console.error("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u30a8\u30e9\u30fc:",e),alert("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u767a\u884c\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}finally{N(!1)}else alert("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u5bfe\u8c61\u306e\u5229\u7528\u8005\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002")},disabled:j||0===a.length,children:j?"\u51e6\u7406\u4e2d...":`${a.length}\u540d\u306b\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u767a\u884c`})]})]})]})}):null},un=e=>{let{student:t,onClose:n}=e;const{currentUser:s}=bt(),[a,l]=(0,r.useState)([]),[o,i]=(0,r.useState)(!0),[c,d]=(0,r.useState)(null),[u,m]=(0,r.useState)(!1),[x,g]=(0,r.useState)({}),[h,p]=(0,r.useState)(""),[f,b]=(0,r.useState)((new Date).toISOString().split("T")[0]),[y,v]=(0,r.useState)(!1),j=async()=>{try{i(!0);const e=await fetch(`${ze.JR}/api/remote-support/daily-reports?userId=${t.id}&startDate=${f}&endDate=${f}`);if(e.ok){const t=await e.json();l(t.data.reports||[]),console.log("\u65e5\u5831\u53d6\u5f97\u6210\u529f:",t.data)}else{const t=await e.json();console.error("\u65e5\u5831\u53d6\u5f97\u30a8\u30e9\u30fc:",e.status,t),alert(`\u65e5\u5831\u53d6\u5f97\u30a8\u30e9\u30fc: ${t.message||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}`)}}catch(e){console.error("\u65e5\u5831\u53d6\u5f97\u30a8\u30e9\u30fc:",e),alert(`\u65e5\u5831\u53d6\u5f97\u30a8\u30e9\u30fc: ${e.message}`)}finally{i(!1)}},N=async e=>{try{const t=await fetch(`${ze.JR}/api/remote-support/daily-reports/${e}`);if(t.ok){const e=await t.json();d(e.data);const n=e=>{if(!e)return"";const t=new Date(e).toTimeString().slice(0,5);return console.log(`\u6642\u9593\u5909\u63db: ${e} -> ${t} (\u578b: ${typeof t})`),t};g({temperature:e.data.temperature||"",condition:e.data.condition||"",condition_note:e.data.condition_note||"",work_note:e.data.work_note||"",work_result:e.data.work_result||"",daily_report:e.data.daily_report||"",support_method:e.data.support_method||"",support_method_note:e.data.support_method_note||"",task_content:e.data.task_content||"",support_content:e.data.support_content||"",advice:e.data.advice||"",mark_start:n(e.data.mark_start),mark_lunch_start:n(e.data.mark_lunch_start),mark_lunch_end:n(e.data.mark_lunch_end),mark_end:n(e.data.mark_end)})}}catch(t){console.error("\u65e5\u5831\u8a73\u7d30\u53d6\u5f97\u30a8\u30e9\u30fc:",t)}},w=e=>{if(!e)return 0;try{const t=JSON.parse(e);return Array.isArray(t)?t.length:0}catch(Yc){return 0}},k=e=>{const t=["bg-blue-100 text-blue-800","bg-green-100 text-green-800","bg-purple-100 text-purple-800","bg-orange-100 text-orange-800","bg-pink-100 text-pink-800","bg-indigo-100 text-indigo-800","bg-red-100 text-red-800","bg-yellow-100 text-yellow-800"];let n=0;for(let s=0;s<e.length;s++)n=e.charCodeAt(s)+((n<<5)-n);return t[Math.abs(n)%t.length]};(0,r.useEffect)(()=>{j()},[f,t.id]);const S=e=>{switch(e){case"good":return"\u826f\u597d";case"normal":return"\u666e\u901a";case"bad":return"\u60aa\u3044";default:return e}},_=e=>{switch(e){case"good":return"bg-green-100 text-green-800";case"normal":return"bg-yellow-100 text-yellow-800";case"bad":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},C=e=>e?new Date(e).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}):"--";return(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-6xl max-h-[95vh] flex flex-col",children:[(0,pt.jsx)("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-6",children:(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold",children:"\u65e5\u5831\u7ba1\u7406"}),(0,pt.jsxs)("p",{className:"text-indigo-100 mt-1",children:[t.name," \u69d8\u306e\u65e5\u5831\u78ba\u8a8d\u30fb\u7de8\u96c6\u30fb\u30b3\u30e1\u30f3\u30c8"]})]}),(0,pt.jsx)("button",{onClick:n,className:"text-white hover:text-indigo-200 transition-colors duration-200",children:(0,pt.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,pt.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,pt.jsxs)("div",{className:"w-1/3 border-r border-gray-200 flex flex-col",children:[(0,pt.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,pt.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"\u65e5\u4ed8:"}),(0,pt.jsx)("input",{type:"date",value:f,onChange:e=>b(e.target.value),className:"px-3 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsx)("button",{onClick:j,className:"w-full px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors duration-200",children:"\u66f4\u65b0"})]}),(0,pt.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:o?(0,pt.jsx)("div",{className:"text-center text-gray-500",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."}):0===a.length?(0,pt.jsx)("div",{className:"text-center text-gray-500",children:"\u65e5\u5831\u304c\u3042\u308a\u307e\u305b\u3093"}):(0,pt.jsx)("div",{className:"space-y-2",children:a.map(e=>(0,pt.jsxs)("div",{onClick:()=>N(e.id),className:"p-3 border rounded-lg cursor-pointer transition-all duration-200 "+((null===c||void 0===c?void 0:c.id)===e.id?"border-indigo-500 bg-indigo-50":"border-gray-200 hover:border-indigo-300 hover:bg-indigo-25"),children:[(0,pt.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,pt.jsx)("span",{className:"text-sm font-medium text-gray-900",children:new Date(e.date).toLocaleDateString("ja-JP")}),(0,pt.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${_(e.condition)}`,children:S(e.condition)})]}),(0,pt.jsxs)("div",{className:"text-xs text-gray-600 space-y-1",children:[(0,pt.jsxs)("div",{children:["\u4f53\u6e29: ",e.temperature||"--","\u2103"]}),(0,pt.jsxs)("div",{children:["\u958b\u59cb: ",C(e.mark_start)]}),(0,pt.jsxs)("div",{children:["\u7d42\u4e86: ",C(e.mark_end)]}),(0,pt.jsxs)("div",{className:"flex items-center gap-1 mt-2",children:[(0,pt.jsx)("span",{className:"text-blue-600",children:"\ud83d\udcac"}),(0,pt.jsxs)("span",{className:"text-blue-600 font-medium",children:[w(e.instructor_comment),"\u4ef6\u306e\u30b3\u30e1\u30f3\u30c8"]})]})]})]},e.id))})})]}),(0,pt.jsx)("div",{className:"flex-1 flex flex-col overflow-hidden",children:c?(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsx)("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:[new Date(c.date).toLocaleDateString("ja-JP")," \u306e\u65e5\u5831"]}),(0,pt.jsxs)("p",{className:"text-sm text-gray-600",children:["\u6700\u7d42\u66f4\u65b0: ",new Date(c.updated_at).toLocaleString("ja-JP")]})]}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[!u&&(0,pt.jsx)("button",{onClick:()=>{const e={};if(c.mark_start){const t=new Date(c.mark_start);e.mark_start=t.toTimeString().slice(0,5)}if(c.mark_lunch_start){const t=new Date(c.mark_lunch_start);e.mark_lunch_start=t.toTimeString().slice(0,5)}if(c.mark_lunch_end){const t=new Date(c.mark_lunch_end);e.mark_lunch_end=t.toTimeString().slice(0,5)}if(c.mark_end){const t=new Date(c.mark_end);e.mark_end=t.toTimeString().slice(0,5)}g({temperature:c.temperature||"",condition:c.condition||"good",condition_note:c.condition_note||"",work_note:c.work_note||"",work_result:c.work_result||"",daily_report:c.daily_report||"",support_method:c.support_method||"",support_method_note:c.support_method_note||"",task_content:c.task_content||"",support_content:c.support_content||"",advice:c.advice||"",instructor_comment:c.instructor_comment||"",...e}),m(!0)},className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200",children:"\u7de8\u96c6"}),(0,pt.jsx)("button",{onClick:()=>v(!y),className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200",children:"\u30b3\u30e1\u30f3\u30c8\u8ffd\u52a0"})]})]})}),(0,pt.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[u?(0,pt.jsxs)("div",{className:"space-y-6",children:[(0,pt.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4f53\u6e29"}),(0,pt.jsx)(Ct,{type:"text",value:x.temperature,onChange:e=>g({...x,temperature:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"36.5"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4f53\u8abf"}),(0,pt.jsxs)("select",{value:x.condition,onChange:e=>g({...x,condition:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,pt.jsx)("option",{value:"good",children:"\u826f\u597d"}),(0,pt.jsx)("option",{value:"normal",children:"\u666e\u901a"}),(0,pt.jsx)("option",{value:"bad",children:"\u60aa\u3044"})]})]})]}),(0,pt.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u958b\u59cb\u6642\u9593"}),(0,pt.jsx)("input",{type:"time",value:x.mark_start||"",onChange:e=>g({...x,mark_start:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u663c\u4f11\u307f\u958b\u59cb"}),(0,pt.jsx)("input",{type:"time",value:x.mark_lunch_start||"",onChange:e=>g({...x,mark_lunch_start:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u663c\u4f11\u307f\u7d42\u4e86"}),(0,pt.jsx)("input",{type:"time",value:x.mark_lunch_end||"",onChange:e=>g({...x,mark_lunch_end:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u7d42\u696d\u6642\u9593"}),(0,pt.jsx)("input",{type:"time",value:x.mark_end||"",onChange:e=>g({...x,mark_end:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4f53\u8abf\u5099\u8003"}),(0,pt.jsx)(Dt,{value:x.condition_note,onChange:e=>g({...x,condition_note:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"\u4f53\u8abf\u306b\u3064\u3044\u3066\u306e\u8a73\u7d30\u306a\u5099\u8003"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u672c\u65e5\u306e\u4f5c\u696d\u5185\u5bb9\uff08\u4e88\u5b9a\uff09"}),(0,pt.jsx)(Dt,{value:x.work_note,onChange:e=>g({...x,work_note:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"\u672c\u65e5\u306e\u4f5c\u696d\u4e88\u5b9a"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4f5c\u696d\u5185\u5bb9\u5b9f\u7e3e"}),(0,pt.jsx)(Dt,{value:x.work_result,onChange:e=>g({...x,work_result:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"\u5b9f\u969b\u306b\u884c\u3063\u305f\u4f5c\u696d\u5185\u5bb9"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u65e5\u5831"}),(0,pt.jsx)(Dt,{value:x.daily_report,onChange:e=>g({...x,daily_report:e.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"\u672c\u65e5\u306e\u65e5\u5831"})]}),!0===t.is_remote_user&&(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u652f\u63f4\u65b9\u6cd5"}),(0,pt.jsxs)("select",{value:x.support_method,onChange:e=>g({...x,support_method:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,pt.jsx)("option",{value:"",children:"\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),(0,pt.jsx)("option",{value:"\u8a2a\u554f",children:"\u8a2a\u554f"}),(0,pt.jsx)("option",{value:"\u96fb\u8a71",children:"\u96fb\u8a71"}),(0,pt.jsx)("option",{value:"\u305d\u306e\u4ed6",children:"\u305d\u306e\u4ed6"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4f5c\u696d\u30fb\u8a13\u7df4\u5185\u5bb9"}),(0,pt.jsx)(Dt,{value:x.task_content,onChange:e=>g({...x,task_content:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"\u4f5c\u696d\u30fb\u8a13\u7df4\u5185\u5bb9\u306e\u8a73\u7d30"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u652f\u63f4\u5185\u5bb9"}),(0,pt.jsx)(Dt,{value:x.support_content,onChange:e=>g({...x,support_content:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"\u652f\u63f4\u5185\u5bb9\u306e\u8a73\u7d30"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u52a9\u8a00\u5185\u5bb9"}),(0,pt.jsx)(Dt,{value:x.advice,onChange:e=>g({...x,advice:e.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"\u5bfe\u8c61\u8005\u306e\u5fc3\u8eab\u306e\u72b6\u6cc1\u30fb\u52a9\u8a00\u5185\u5bb9"})]})]})]}):(0,pt.jsxs)("div",{className:"space-y-6",children:[(0,pt.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u4f53\u6e29:"}),(0,pt.jsxs)("span",{className:"text-gray-800",children:[c.temperature||"--","\u2103"]})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u4f53\u8abf:"}),(0,pt.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${_(c.condition)}`,children:S(c.condition)})]}),c.condition_note&&(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u4f53\u8abf\u5099\u8003:"}),(0,pt.jsx)("p",{className:"mt-1 text-gray-800",children:c.condition_note})]})]}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u958b\u59cb\u6642\u9593:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:C(c.mark_start)})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u663c\u4f11\u61a9\u958b\u59cb:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:C(c.mark_lunch_start)})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u663c\u4f11\u61a9\u7d42\u4e86:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:C(c.mark_lunch_end)})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u7d42\u4e86\u6642\u9593:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:C(c.mark_end)})]})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-3",children:"\u4f5c\u696d\u5185\u5bb9"}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u672c\u65e5\u306e\u4f5c\u696d\u5185\u5bb9\uff08\u4e88\u5b9a\uff09:"}),(0,pt.jsx)("p",{className:"mt-1 text-gray-800",children:c.work_note||"\u672a\u5165\u529b"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u4f5c\u696d\u5185\u5bb9\u5b9f\u7e3e:"}),(0,pt.jsx)("p",{className:"mt-1 text-gray-800",children:c.work_result||"\u672a\u5165\u529b"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u65e5\u5831:"}),(0,pt.jsx)("p",{className:"mt-1 text-gray-800",children:c.daily_report||"\u672a\u5165\u529b"})]})]})]}),!0===t.is_remote_user&&(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-3",children:"\u652f\u63f4\u60c5\u5831"}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u652f\u63f4\u65b9\u6cd5:"}),(0,pt.jsx)("p",{className:"mt-1 text-gray-800",children:c.support_method||"\u672a\u8a2d\u5b9a"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u4f5c\u696d\u30fb\u8a13\u7df4\u5185\u5bb9:"}),(0,pt.jsx)("p",{className:"mt-1 text-gray-800",children:c.task_content||"\u672a\u5165\u529b"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u652f\u63f4\u5185\u5bb9:"}),(0,pt.jsx)("p",{className:"mt-1 text-gray-800",children:c.support_content||"\u672a\u5165\u529b"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u52a9\u8a00\u5185\u5bb9:"}),(0,pt.jsx)("p",{className:"mt-1 text-gray-800",children:c.advice||"\u672a\u5165\u529b"})]})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800",children:"\u6307\u5c0e\u54e1\u30b3\u30e1\u30f3\u30c8"}),(0,pt.jsxs)("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full",children:[w(c.instructor_comment),"\u4ef6"]})]}),c.instructor_comment?(0,pt.jsx)("div",{className:"space-y-4",children:(e=>{if(!e)return[];try{const t=JSON.parse(e);return Array.isArray(t)?t.sort((e,t)=>new Date(t.created_at)-new Date(e.created_at)):[]}catch(Yc){return[]}})(c.instructor_comment).map((e,t)=>(0,pt.jsxs)("div",{className:"bg-white border border-gray-200 p-4 rounded-lg shadow-sm",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${k(e.instructor_name)}`,children:e.instructor_name}),e.instructor_name===s.name&&(0,pt.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"\u3042\u306a\u305f"})]}),(0,pt.jsx)("span",{className:"text-sm text-gray-500",children:new Date(e.created_at).toLocaleString("ja-JP")})]}),(0,pt.jsx)("div",{className:"bg-gray-50 p-3 rounded-lg",children:(0,pt.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:e.comment})})]},e.id||t))}):(0,pt.jsxs)("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[(0,pt.jsx)("div",{className:"text-gray-400 mb-2",children:(0,pt.jsx)("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),(0,pt.jsx)("p",{className:"text-gray-500",children:"\u307e\u3060\u30b3\u30e1\u30f3\u30c8\u306f\u3042\u308a\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"\u6700\u521d\u306e\u30b3\u30e1\u30f3\u30c8\u3092\u8ffd\u52a0\u3057\u3066\u307f\u307e\u3057\u3087\u3046"})]})]})]}),y&&(0,pt.jsxs)("div",{className:"mt-6 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,pt.jsx)("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:(0,pt.jsx)("span",{className:"text-white text-sm font-bold",children:s.name.charAt(0)})}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800",children:"\u30b3\u30e1\u30f3\u30c8\u8ffd\u52a0"}),(0,pt.jsxs)("p",{className:"text-sm text-gray-600",children:["\u6307\u5c0e\u54e1: ",s.name]})]})]}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30b3\u30e1\u30f3\u30c8\u5185\u5bb9"}),(0,pt.jsx)(Dt,{value:h,onChange:e=>p(e.target.value),rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200",placeholder:"\u5229\u7528\u8005\u306e\u72b6\u6cc1\u3084\u30a2\u30c9\u30d0\u30a4\u30b9\u3001\u6b21\u56de\u306e\u652f\u63f4\u65b9\u91dd\u306a\u3069\u3092\u8a18\u5165\u3057\u3066\u304f\u3060\u3055\u3044..."}),(0,pt.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,pt.jsxs)("span",{className:"text-xs "+(h.length>1e3?"text-red-500":"text-gray-500"),children:[h.length,"/1000\u6587\u5b57"]}),(0,pt.jsx)("span",{className:"text-xs text-gray-500",children:"Enter + Shift \u3067\u6539\u884c"})]})]}),(0,pt.jsxs)("div",{className:"flex gap-3",children:[(0,pt.jsx)("button",{onClick:async()=>{if(h.trim())if(h.length>1e3)alert("\u30b3\u30e1\u30f3\u30c8\u306f1000\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044");else try{const e=await fetch(`${ze.JR}/api/remote-support/daily-reports/${c.id}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comment:h,instructor_name:s.name})});if(e.ok)alert("\u30b3\u30e1\u30f3\u30c8\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f"),p(""),v(!1),N(c.id);else{const t=await e.json();alert(t.message||"\u30b3\u30e1\u30f3\u30c8\u306e\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}}catch(e){console.error("\u30b3\u30e1\u30f3\u30c8\u8ffd\u52a0\u30a8\u30e9\u30fc:",e),alert("\u30b3\u30e1\u30f3\u30c8\u306e\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}else alert("\u30b3\u30e1\u30f3\u30c8\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044")},disabled:!h.trim()||h.length>1e3,className:"flex-1 px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all duration-200 font-medium",children:"\ud83d\udcac \u30b3\u30e1\u30f3\u30c8\u8ffd\u52a0"}),(0,pt.jsx)("button",{onClick:()=>{v(!1),p("")},className:"px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all duration-200",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})]}),u&&(0,pt.jsx)("div",{className:"p-6 border-t border-gray-200 bg-gray-50 flex-shrink-0",children:(0,pt.jsxs)("div",{className:"flex gap-4",children:[(0,pt.jsx)("button",{onClick:async()=>{try{const e={...x};if(x.mark_start&&""!==x.mark_start.trim())if(x.mark_start instanceof Date){const t=x.mark_start.toTimeString().slice(0,5);e.mark_start=(0,Pt.NR)(t)}else if("string"===typeof x.mark_start)if(/^\d{2}:\d{2}$/.test(x.mark_start))e.mark_start=(0,Pt.NR)(x.mark_start);else try{const t=new Date(x.mark_start);if(isNaN(t.getTime()))e.mark_start=null;else{const n=t.toTimeString().slice(0,5);e.mark_start=(0,Pt.NR)(n)}}catch(Yc){e.mark_start=null}else e.mark_start=null;else e.mark_start=null;if(x.mark_lunch_start&&""!==x.mark_lunch_start.trim())if(x.mark_lunch_start instanceof Date){const t=x.mark_lunch_start.toTimeString().slice(0,5);e.mark_lunch_start=(0,Pt.NR)(t)}else if("string"===typeof x.mark_lunch_start)if(/^\d{2}:\d{2}$/.test(x.mark_lunch_start))e.mark_lunch_start=(0,Pt.NR)(x.mark_lunch_start);else try{const t=new Date(x.mark_lunch_start);if(isNaN(t.getTime()))e.mark_lunch_start=null;else{const n=t.toTimeString().slice(0,5);e.mark_lunch_start=(0,Pt.NR)(n)}}catch(Yc){e.mark_lunch_start=null}else e.mark_lunch_start=null;else e.mark_lunch_start=null;if(x.mark_lunch_end&&""!==x.mark_lunch_end.trim())if(x.mark_lunch_end instanceof Date){const t=x.mark_lunch_end.toTimeString().slice(0,5);e.mark_lunch_end=(0,Pt.NR)(t)}else if("string"===typeof x.mark_lunch_end)if(/^\d{2}:\d{2}$/.test(x.mark_lunch_end))e.mark_lunch_end=(0,Pt.NR)(x.mark_lunch_end);else try{const t=new Date(x.mark_lunch_end);if(isNaN(t.getTime()))e.mark_lunch_end=null;else{const n=t.toTimeString().slice(0,5);e.mark_lunch_end=(0,Pt.NR)(n)}}catch(Yc){e.mark_lunch_end=null}else e.mark_lunch_end=null;else e.mark_lunch_end=null;if(x.mark_end&&""!==x.mark_end.trim())if(x.mark_end instanceof Date){const t=x.mark_end.toTimeString().slice(0,5);e.mark_end=(0,Pt.NR)(t)}else if("string"===typeof x.mark_end)if(/^\d{2}:\d{2}$/.test(x.mark_end))e.mark_end=(0,Pt.NR)(x.mark_end);else try{const t=new Date(x.mark_end);if(isNaN(t.getTime()))e.mark_end=null;else{const n=t.toTimeString().slice(0,5);e.mark_end=(0,Pt.NR)(n)}}catch(Yc){e.mark_end=null}else e.mark_end=null;else e.mark_end=null;console.log("\u9001\u4fe1\u30c7\u30fc\u30bf:",e),console.log("\u6642\u9593\u30d5\u30a3\u30fc\u30eb\u30c9\u8a73\u7d30\uff08MySQL\u5f62\u5f0f\uff09:",{mark_start:{value:e.mark_start,type:typeof e.mark_start,stringified:JSON.stringify(e.mark_start)},mark_lunch_start:{value:e.mark_lunch_start,type:typeof e.mark_lunch_start,stringified:JSON.stringify(e.mark_lunch_start)},mark_lunch_end:{value:e.mark_lunch_end,type:typeof e.mark_lunch_end,stringified:JSON.stringify(e.mark_lunch_end)},mark_end:{value:e.mark_end,type:typeof e.mark_end,stringified:JSON.stringify(e.mark_end)}}),console.log("\u6642\u9593\u30d5\u30a3\u30fc\u30eb\u30c9\u5024\uff08MySQL\u5f62\u5f0f\uff09:",{mark_start:e.mark_start,mark_lunch_start:e.mark_lunch_start,mark_lunch_end:e.mark_lunch_end,mark_end:e.mark_end});const t=await fetch(`${ze.JR}/api/remote-support/daily-reports/${c.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(t.ok)alert("\u65e5\u5831\u304c\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f"),m(!1),N(c.id),j();else{const e=await t.json();console.error("\u65e5\u5831\u66f4\u65b0\u30a8\u30e9\u30fc\u8a73\u7d30:",e),alert(`\u65e5\u5831\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${e.message||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc"}`)}}catch(e){console.error("\u65e5\u5831\u66f4\u65b0\u30a8\u30e9\u30fc:",e),alert("\u65e5\u5831\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}},className:"flex-1 px-6 py-3 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors duration-200 font-medium",children:"\ud83d\udcbe \u4fdd\u5b58"}),(0,pt.jsx)("button",{onClick:()=>m(!1),className:"flex-1 px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors duration-200 font-medium",children:"\u274c \u30ad\u30e3\u30f3\u30bb\u30eb"})]})})]})]}):(0,pt.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center text-gray-500",children:[(0,pt.jsx)("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,pt.jsx)("p",{children:"\u5de6\u5074\u304b\u3089\u65e5\u5831\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"})]})})})]})]})})},mn=e=>{let{teacherId:t,onTestApproval:n,onSubmissionApproval:s}=e;const{currentUser:a,isAuthenticated:l}=bt(),o=ne(),[i,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(!0),[m,x]=(0,r.useState)(null),[g,h]=(0,r.useState)(""),[p,f]=(0,r.useState)(null),[b,y]=(0,r.useState)([]),[v,j]=(0,r.useState)(""),[N,w]=(0,r.useState)([]),[k,S]=(0,r.useState)("all"),[_,C]=(0,r.useState)([]),[I,T]=(0,r.useState)(!1),[P,L]=(0,r.useState)(!1),[E,D]=(0,r.useState)(!1),[A,$]=(0,r.useState)(!1),[z,O]=(0,r.useState)(null),[R,M]=(0,r.useState)(!1),[F,U]=(0,r.useState)(null),[B,J]=(0,r.useState)(!1),[q,V]=(0,r.useState)(null),H=e=>{n?n(e):(U(e),M(!0))},W=e=>{s?s(e):(V(e),J(!0))},Q=e=>{const t=document.getElementById(`student-row-${e}`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.style.backgroundColor="#fef3c7",setTimeout(()=>{t.style.backgroundColor=""},2e3))},K=()=>{Y()};(0,r.useEffect)(()=>{console.log("=== StudentManagement \u62e0\u70b9ID\u53d6\u5f97\u958b\u59cb ==="),console.log("currentUser:",a),console.log("currentUser.role:",null===a||void 0===a?void 0:a.role),console.log("currentUser.satellite_id:",null===a||void 0===a?void 0:a.satellite_id),console.log("currentUser.satellite_ids:",null===a||void 0===a?void 0:a.satellite_ids),console.log("currentUser.satellite_name:",null===a||void 0===a?void 0:a.satellite_name),Yt();const e=sessionStorage.getItem("selectedSatellite");if(console.log("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306eselectedSatellite:",e),e)try{const t=JSON.parse(e);console.log("\u30d1\u30fc\u30b9\u3055\u308c\u305f\u62e0\u70b9\u30c7\u30fc\u30bf:",t)}catch(p){console.error("\u62e0\u70b9\u60c5\u5831\u306e\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",p)}const t=Qt(a);if(x(t),console.log("=== \u62e0\u70b9ID\u53d6\u5f97 ==="),console.log("\u73fe\u5728\u306e\u62e0\u70b9ID:",t),!t){console.log("=== \u62e0\u70b9ID\u53d6\u5f97\u5931\u6557\u306e\u8a73\u7d30\u30c7\u30d0\u30c3\u30b0 ==="),console.log("currentUser:",a),console.log("currentUser.role:",null===a||void 0===a?void 0:a.role),console.log("currentUser.satellite_id:",null===a||void 0===a?void 0:a.satellite_id),console.log("currentUser.satellite_ids:",null===a||void 0===a?void 0:a.satellite_ids),console.log("currentUser.satellite_name:",null===a||void 0===a?void 0:a.satellite_name);const e=sessionStorage.getItem("selectedSatellite");if(console.log("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306eselectedSatellite:",e),e)try{const t=JSON.parse(e);console.log("\u30d1\u30fc\u30b9\u3055\u308c\u305f\u62e0\u70b9\u30c7\u30fc\u30bf:",t)}catch(p){console.error("\u62e0\u70b9\u60c5\u5831\u306e\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",p)}const t=JSON.parse(localStorage.getItem("currentUser")||"{}");console.log("localStorage\u306ecurrentUser:",t)}if(t)if(e)try{const t=JSON.parse(e);console.log("\u30d1\u30fc\u30b9\u3055\u308c\u305f\u62e0\u70b9\u30c7\u30fc\u30bf:",t),h(t.name||"")}catch(p){console.error("\u62e0\u70b9\u60c5\u5831\u306e\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",p)}else console.log("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u62e0\u70b9\u60c5\u5831\u306a\u3057\u3001\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u304b\u3089\u53d6\u5f97"),a&&a.satellite_name&&(console.log("\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u304b\u3089\u62e0\u70b9\u540d\u3092\u53d6\u5f97:",a.satellite_name),h(a.satellite_name));else console.log("\u62e0\u70b9ID\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f"),console.log("currentUser.role:",null===a||void 0===a?void 0:a.role),console.log("currentUser.satellite_id:",null===a||void 0===a?void 0:a.satellite_id),console.log("currentUser.satellite_ids:",null===a||void 0===a?void 0:a.satellite_ids);console.log("=== StudentManagement \u62e0\u70b9ID\u53d6\u5f97\u5b8c\u4e86 ===")},[a]);const Y=async()=>{try{if(console.log("=== fetchStudents\u958b\u59cb ==="),console.log("currentSatelliteId:",m),console.log("localStorage accessToken:",localStorage.getItem("accessToken")?"\u5b58\u5728":"\u306a\u3057"),u(!0),f(null),!m)return console.log("\u62e0\u70b9ID\u304c\u53d6\u5f97\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u5229\u7528\u8005\u53d6\u5f97\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),f("\u62e0\u70b9ID\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002\u62e0\u70b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),void c([]);console.log(`\u62e0\u70b9ID ${m} \u306e\u5229\u7528\u8005\u3092\u53d6\u5f97\u3057\u307e\u3059`);const e=localStorage.getItem("accessToken");console.log("\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u78ba\u8a8d:",{hasToken:!!e,tokenLength:e?e.length:0,tokenPreview:e?e.substring(0,20)+"...":"\u306a\u3057"}),console.log("getSatelliteUsers\u547c\u3073\u51fa\u3057\u524d");const t=await(e=>{if(!e||"undefined"===e)throw console.error("\u62e0\u70b9ID\u304c\u7121\u52b9\u3067\u3059:",e),new Error("\u62e0\u70b9ID\u304c\u7121\u52b9\u3067\u3059");return He(`/api/satellites/${e}/users`)})(m);if(console.log("getSatelliteUsers\u547c\u3073\u51fa\u3057\u5f8c:",t),console.log("\u30ec\u30b9\u30dd\u30f3\u30b9\u8a73\u7d30:",{success:t.success,message:t.message,error:t.error,hasData:!!t.data,dataLength:t.data?t.data.length:0}),t.success){console.log("=== \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u524d\u306e\u30c7\u30fc\u30bf ==="),console.log("\u5168\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf:",t.data);const e=t.data.filter(e=>1===e.role);console.log("=== \u62e0\u70b9\u5229\u7528\u8005\u30c7\u30fc\u30bf\u53d6\u5f97\u30c7\u30d0\u30c3\u30b0 ==="),console.log("\u62e0\u70b9ID:",m),console.log("\u5168\u30e6\u30fc\u30b6\u30fc\u6570:",t.data.length),console.log("\u5229\u7528\u8005\u6570:",e.length),e.forEach((e,t)=>{console.log(`\u5229\u7528\u8005${t+1} (${e.name}):`,{id:e.id,name:e.name,tags:e.tags,tagsType:typeof e.tags,courses:e.courses,coursesType:typeof e.courses,temp_password:e.temp_password,expires_at:e.expires_at,instructor_name:e.instructor_name,is_remote_user:e.is_remote_user})}),console.log("=== \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u5f8c\u306e\u5229\u7528\u8005\u30c7\u30fc\u30bf ==="),console.log("studentUsers:",e),c(e)}else{if(console.error("\u62e0\u70b9\u5229\u7528\u8005\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",t.message||t.error||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc"),console.error("\u5931\u6557\u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u8a73\u7d30:",{response:t,responseType:typeof t,responseKeys:Object.keys(t||{}),message:t.message,error:t.error,success:t.success}),t.message&&t.message.includes("\u8a8d\u8a3c")||t.error&&t.error.includes("\u8a8d\u8a3c"))f("\u8a8d\u8a3c\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30ed\u30b0\u30a4\u30f3\u3057\u76f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002");else{const e=t.message||t.error||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc";f(`\u62e0\u70b9\u5229\u7528\u8005\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${e}`)}c([])}}catch(p){console.error("\u5229\u7528\u8005\u30c7\u30fc\u30bf\u53d6\u5f97\u30a8\u30e9\u30fc:",p),console.error("\u30a8\u30e9\u30fc\u8a73\u7d30:",{errorMessage:p.message,errorName:p.name,errorStack:p.stack,errorType:typeof p}),p.message&&p.message.includes("Authentication")?f("\u8a8d\u8a3c\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30ed\u30b0\u30a4\u30f3\u3057\u76f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):p.message&&p.message.includes("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093")?f("\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3067\u304d\u307e\u305b\u3093\u3002\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):p.message&&p.message.includes("\u62e0\u70b9ID\u304c\u7121\u52b9\u3067\u3059")?f("\u62e0\u70b9ID\u304c\u7121\u52b9\u3067\u3059\u3002\u62e0\u70b9\u3092\u9078\u629e\u3057\u76f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002"):f("\u5229\u7528\u8005\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"),c([])}finally{u(!1)}},G=Gt({students:i,onStudentsUpdate:e=>{c(e),setTimeout(()=>{console.log("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u5f8c\u3001\u30c7\u30fc\u30bf\u3092\u518d\u53d6\u5f97\u3057\u307e\u3059"),Y()},1e3)}}),Z=Zt({student:null,onUpdate:Y,onClose:()=>{},instructors:b}),X=m,ee=en({onStudentAdded:Y,instructors:b}),te=tn({students:i,onStudentsUpdate:Y});if((0,r.useEffect)(()=>{Y(),(async()=>{try{const t=await fetch(`${ze.JR}/api/users`);if(t.ok){var e;const n=await t.json(),s=((null===(e=n.data)||void 0===e?void 0:e.users)||n).filter(e=>4===e.role);y(s)}}catch(p){console.error("\u6307\u5c0e\u54e1\u30c7\u30fc\u30bf\u53d6\u5f97\u30a8\u30e9\u30fc:",p)}})()},[m]),d)return(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:(0,pt.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,pt.jsx)("div",{className:"text-xl text-gray-600",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."})})});if(!m)return(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udccd"}),(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"\u62e0\u70b9\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-gray-600 mb-6",children:"\u5229\u7528\u8005\u4e00\u89a7\u3092\u8868\u793a\u3059\u308b\u306b\u306f\u3001\u307e\u305a\u62e0\u70b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}),(0,pt.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:(0,pt.jsx)("p",{className:"text-yellow-800 text-sm",children:"\ud83d\udca1 \u30d2\u30f3\u30c8: \u53f3\u4e0a\u306e\u62e0\u70b9\u5207\u308a\u66ff\u3048\u30dc\u30bf\u30f3\u304b\u3089\u62e0\u70b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})}),a&&a.role>=6&&(0,pt.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:(0,pt.jsxs)("p",{className:"text-blue-800 text-sm",children:["\ud83d\udd27 \u7ba1\u7406\u8005\u5411\u3051: \u30ed\u30b0\u30a4\u30f3\u6642\u306b\u9078\u629e\u3057\u305f\u62e0\u70b9\u60c5\u5831\u304c\u6b63\u3057\u304f\u4fdd\u5b58\u3055\u308c\u3066\u3044\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002",(0,pt.jsx)("br",{}),"\u89e3\u6c7a\u65b9\u6cd5: \u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u3066\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002"]})}),(0,pt.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 mr-4",children:"\ud83d\udd04 \u30da\u30fc\u30b8\u3092\u518d\u8aad\u307f\u8fbc\u307f"}),(0,pt.jsx)("button",{onClick:()=>window.location.href="/instructor/dashboard",className:"px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200",children:"\ud83c\udfe0 \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u623b\u308b"})]})})})});if(p)return(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"text-6xl mb-4",children:"\u26a0\ufe0f"}),(0,pt.jsx)("h2",{className:"text-2xl font-bold text-red-800 mb-4",children:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}),(0,pt.jsx)("p",{className:"text-gray-600 mb-6",children:p}),(0,pt.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:(0,pt.jsx)("p",{className:"text-red-800 text-sm",children:"\ud83d\udca1 \u89e3\u6c7a\u65b9\u6cd5: \u30da\u30fc\u30b8\u3092\u518d\u8aad\u307f\u8fbc\u307f\u3059\u308b\u304b\u3001\u7ba1\u7406\u8005\u306b\u9023\u7d61\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})}),(0,pt.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200",children:"\ud83d\udd04 \u30da\u30fc\u30b8\u3092\u518d\u8aad\u307f\u8fbc\u307f"})]})})})});const se=i.filter(e=>{const t=!v||e.name.toLowerCase().includes(v.toLowerCase())||e.login_code.toLowerCase().includes(v.toLowerCase())||e.instructor_name&&e.instructor_name.toLowerCase().includes(v.toLowerCase()),n="all"===k||e.status.toString()===k,s=0===N.length||N.some(t=>e.tags&&e.tags.includes(t));return t&&n&&s});return(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:(0,pt.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100",children:(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("h2",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"\ud83d\udc65 \u5229\u7528\u8005\u4e00\u89a7"}),(0,pt.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,pt.jsx)("span",{className:"text-lg",children:"\ud83d\udccd"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("p",{className:"font-medium",children:"\u6307\u5c0e\u54e1\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9"}),(0,pt.jsx)("p",{className:"text-sm text-gray-500",children:"\u203b\u5229\u7528\u8005\u306e\u7ba1\u7406\u3068\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u3092\u884c\u3044\u307e\u3059"})]})]})]}),(0,pt.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,pt.jsx)("button",{className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 flex items-center gap-2",onClick:()=>te.setShowTagModal(!0),children:"\ud83c\udff7\ufe0f \u30bf\u30b0\u4e00\u62ec\u8ffd\u52a0"}),(0,pt.jsx)("button",{className:"px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 flex items-center gap-2",onClick:()=>T(!0),children:"\ud83d\udd11 \u672c\u65e5\u6709\u52b9"}),(0,pt.jsx)("button",{className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 flex items-center gap-2",onClick:()=>L(!0),children:"\ud83d\udcda \u5b66\u7fd2\u30b3\u30fc\u30b9\u8ffd\u52a0"}),(0,pt.jsx)("button",{className:"px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 flex items-center gap-2",onClick:()=>{ee.setShowAddForm(!0),ee.setBulkInputText(""),ee.setBulkInstructorId("")},children:"+ \u65b0\u3057\u3044\u5229\u7528\u8005\u3092\u8ffd\u52a0"})]})]})}),m&&(0,pt.jsx)(ln,{satelliteId:m,onApprovalClick:e=>{const t=i.find(t=>t.id===parseInt(e));t&&H(t)},onStudentClick:Q}),m&&(0,pt.jsx)(cn,{satelliteId:m,onSubmissionClick:e=>{const t=i.find(t=>t.id===e);t&&W(t)},onStudentClick:Q}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"\u5229\u7528\u8005\u4e00\u89a7"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u203b\u5229\u7528\u8005\u306e\u7ba1\u7406\u3068\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u767a\u884c\u3092\u884c\u3044\u307e\u3059"})]}),(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100",children:(0,pt.jsxs)("div",{className:"space-y-6",children:[(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,pt.jsx)("div",{className:"flex-1",children:(0,pt.jsxs)("div",{className:"relative",children:[(0,pt.jsx)("input",{type:"text",placeholder:"\u5229\u7528\u8005\u540d\u3001\u30ed\u30b0\u30a4\u30f3\u30b3\u30fc\u30c9\u3001\u6307\u5c0e\u54e1\u540d\u3067\u691c\u7d22...",value:v,onChange:e=>j(e.target.value),className:"w-full px-4 py-3 pl-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200"}),(0,pt.jsx)("span",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400",children:"\ud83d\udd0d"})]})}),(0,pt.jsxs)("div",{className:"flex gap-3",children:[(0,pt.jsxs)("select",{value:k,onChange:e=>S(e.target.value),className:"px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200",children:[(0,pt.jsx)("option",{value:"all",children:"\u5168\u3066\u306e\u30b9\u30c6\u30fc\u30bf\u30b9"}),(0,pt.jsx)("option",{value:"1",children:"\u7a3c\u50cd\u4e2d"}),(0,pt.jsx)("option",{value:"0",children:"\u505c\u6b62\u4e2d"})]}),(0,pt.jsx)("button",{className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-all duration-200",onClick:()=>{j(""),w([]),S("all")},children:"\u30af\u30ea\u30a2"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"\u30bf\u30b0\u30d5\u30a3\u30eb\u30bf\u30fc:"}),(0,pt.jsx)("div",{className:"flex flex-wrap gap-2",children:te.getAllTags().map(e=>(0,pt.jsx)("button",{className:"px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 transform hover:scale-105 "+(N.includes(e)?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"),onClick:()=>(e=>{w(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),children:e},e))})]}),(0,pt.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl border border-indigo-100",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("span",{className:"text-lg",children:"\ud83d\udcca"}),(0,pt.jsxs)("span",{className:"font-semibold text-gray-700",children:["\u8868\u793a\u4e2d: ",se.length,"\u540d / \u5168",i.length,"\u540d"]})]}),N.length>0&&(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("span",{className:"text-sm text-gray-600",children:"\u9078\u629e\u4e2d\u306e\u30bf\u30b0:"}),(0,pt.jsx)("div",{className:"flex gap-1",children:N.map(e=>(0,pt.jsx)("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-700 text-xs rounded-full",children:e},e))})]})]})]})}),(0,pt.jsx)("div",{className:"mb-8",children:(0,pt.jsx)(rn,{students:se,onIssueTemporaryPassword:G.issueTemporaryPassword,onEditStudent:e=>{Z.openEditModal(e)},onToggleStatus:async e=>{try{const t=1===i.find(t=>t.id===e).status?0:1;(await fetch(`${ze.JR}/api/users/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})})).ok?(alert(`\u5229\u7528\u8005\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u304c${1===t?"\u7a3c\u50cd\u4e2d":"\u505c\u6b62\u4e2d"}\u306b\u5909\u66f4\u3055\u308c\u307e\u3057\u305f`),Y()):alert("\u30b9\u30c6\u30fc\u30bf\u30b9\u5909\u66f4\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(p){console.error("\u30b9\u30c6\u30fc\u30bf\u30b9\u5909\u66f4\u30a8\u30e9\u30fc:",p),alert("\u30b9\u30c6\u30fc\u30bf\u30b9\u5909\u66f4\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}},onDeleteStudent:async e=>{if(window.confirm("\u3053\u306e\u5229\u7528\u8005\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f"))try{(await fetch(`${ze.JR}/api/users/${e}`,{method:"DELETE"})).ok?(alert("\u5229\u7528\u8005\u304c\u524a\u9664\u3055\u308c\u307e\u3057\u305f"),Y()):alert("\u5229\u7528\u8005\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(p){console.error("\u5229\u7528\u8005\u524a\u9664\u30a8\u30e9\u30fc:",p),alert("\u5229\u7528\u8005\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}},onViewDailyReports:e=>{O(e),$(!0)},onViewTestResults:e=>{o(`/instructor/student-detail/${e.id}`)},onTestApproval:H,onSubmissionApproval:W})}),te.showTagModal&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\ud83c\udff7\ufe0f \u30bf\u30b0\u4e00\u62ec\u8ffd\u52a0"}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all duration-200",onClick:te.resetModal,children:"\xd7"})]})}),(0,pt.jsxs)("div",{className:"flex",children:[(0,pt.jsxs)("div",{className:"w-1/2 p-6 border-r border-gray-200",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\u5229\u7528\u8005\u9078\u629e"}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u691c\u7d22"}),(0,pt.jsx)("input",{type:"text",value:te.searchTerm,onChange:e=>te.setSearchTerm(e.target.value),placeholder:"\u5229\u7528\u8005\u540d\u3001\u30ed\u30b0\u30a4\u30f3\u30b3\u30fc\u30c9\u3001\u6307\u5c0e\u54e1\u540d\u3067\u691c\u7d22...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30bf\u30b0\u30d5\u30a3\u30eb\u30bf\u30fc"}),(0,pt.jsx)("div",{className:"flex flex-wrap gap-2",children:te.getAllTags().map((e,t)=>(0,pt.jsx)("button",{onClick:()=>te.toggleTagFilter(e),className:"px-2 py-1 rounded-full text-xs font-medium transition-all duration-200 "+(te.selectedTags.includes(e)?"bg-green-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e},t))})]}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("button",{onClick:te.toggleAllStudents,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200 text-sm",children:te.selectedStudents.length===te.getFilteredStudents().length?"\u5168\u9078\u629e\u89e3\u9664":"\u5168\u9078\u629e"}),(0,pt.jsxs)("span",{className:"ml-2 text-sm text-gray-600",children:[te.selectedStudents.length," / ",te.getFilteredStudents().length," \u9078\u629e\u4e2d"]})]}),(0,pt.jsx)("div",{className:"max-h-96 overflow-y-auto border border-gray-200 rounded-lg",children:0===te.getFilteredStudents().length?(0,pt.jsx)("div",{className:"p-4 text-center text-gray-500",children:"\u6761\u4ef6\u306b\u4e00\u81f4\u3059\u308b\u5229\u7528\u8005\u304c\u3044\u307e\u305b\u3093"}):(0,pt.jsx)("div",{className:"divide-y divide-gray-200",children:te.getFilteredStudents().map(e=>(0,pt.jsx)("div",{className:"p-3 hover:bg-gray-50 cursor-pointer transition-colors "+(te.selectedStudents.includes(e.id)?"bg-blue-50":""),onClick:()=>te.toggleStudentSelection(e.id),children:(0,pt.jsxs)("div",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"checkbox",checked:te.selectedStudents.includes(e.id),onChange:()=>te.toggleStudentSelection(e.id),className:"mr-3 rounded border-gray-300"}),(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,pt.jsx)("div",{className:"text-sm text-gray-500",children:e.login_code}),e.instructor_name&&(0,pt.jsxs)("div",{className:"text-xs text-gray-400",children:["\u6307\u5c0e\u54e1: ",e.instructor_name]})]}),(0,pt.jsxs)("div",{className:"flex flex-wrap gap-1 max-w-32",children:[e.tags&&e.tags.slice(0,2).map((e,t)=>(0,pt.jsx)("span",{className:"px-1 py-0.5 bg-gray-100 text-gray-600 text-xs rounded truncate",title:e,children:e},t)),e.tags&&e.tags.length>2&&(0,pt.jsxs)("span",{className:"text-xs text-gray-400",children:["+",e.tags.length-2]})]})]})},e.id))})})]}),(0,pt.jsxs)("div",{className:"w-1/2 p-6",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\u8ffd\u52a0\u3059\u308b\u30bf\u30b0"}),(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30bf\u30b0\u4f8b"}),(0,pt.jsx)("div",{className:"flex flex-wrap gap-2 mb-4",children:te.customTags.map((e,t)=>(0,pt.jsx)("button",{onClick:()=>te.toggleTag(e),className:"px-3 py-1 rounded-full text-sm font-medium transition-all duration-200 "+(te.tagsToAdd.includes(e)?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:e},t))}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("input",{type:"text",value:te.newTagName,onChange:e=>te.setNewTagName(e.target.value),placeholder:"\u65b0\u3057\u3044\u30bf\u30b0\u540d\u3092\u5165\u529b",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,pt.jsx)("button",{onClick:te.addNewTag,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all duration-200",children:"\u8ffd\u52a0"})]})]}),te.tagsToAdd.length>0&&(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u8ffd\u52a0\u4e88\u5b9a\u306e\u30bf\u30b0 (",te.tagsToAdd.length,"\u500b)"]}),(0,pt.jsx)("div",{className:"flex flex-wrap gap-2",children:te.tagsToAdd.map((e,t)=>(0,pt.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:e},t))})]}),te.selectedStudents.length>0&&(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u9078\u629e\u3055\u308c\u305f\u5229\u7528\u8005 (",te.selectedStudents.length,"\u540d)"]}),(0,pt.jsx)("div",{className:"max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-2",children:te.selectedStudents.map(e=>{const t=i.find(t=>t.id===e);return t?(0,pt.jsxs)("div",{className:"text-sm text-gray-700 py-1",children:[t.name," (",t.login_code,")"]},e):null})})]})]})]}),(0,pt.jsx)("div",{className:"p-6 border-t border-gray-200 bg-gray-50",children:(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("div",{className:"text-sm text-gray-600",children:te.selectedStudents.length>0&&te.tagsToAdd.length>0&&(0,pt.jsxs)("span",{children:[te.selectedStudents.length,"\u540d\u306e\u5229\u7528\u8005\u306b",te.tagsToAdd.length,"\u500b\u306e\u30bf\u30b0\u3092\u8ffd\u52a0\u3057\u307e\u3059"]})}),(0,pt.jsxs)("div",{className:"flex gap-4",children:[(0,pt.jsx)("button",{onClick:te.resetModal,className:"px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsxs)("button",{onClick:te.handleBulkAddTags,disabled:0===te.selectedStudents.length||0===te.tagsToAdd.length,className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all duration-200",children:["\u30bf\u30b0\u3092\u8ffd\u52a0 (",te.selectedStudents.length,"\u540d)"]})]})]})})]})}),(0,pt.jsx)(dn,{isOpen:I,onClose:()=>T(!1),students:i,selectedStudents:_,onStudentsUpdate:Y,onSelectStudents:C}),(0,pt.jsx)(nn,{isOpen:P,onClose:()=>L(!1),students:i,instructors:b,onCoursesUpdated:()=>{console.log("=== \u30b3\u30fc\u30b9\u66f4\u65b0\u51e6\u7406\u958b\u59cb ==="),Y(),console.log("=== \u30b3\u30fc\u30b9\u66f4\u65b0\u51e6\u7406\u5b8c\u4e86 ===")}}),ee.showAddForm&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\u65b0\u3057\u3044\u5229\u7528\u8005\u3092\u8ffd\u52a0"}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all duration-200",onClick:()=>{ee.setShowAddForm(!1),ee.setBulkInputMode(!1),ee.setBulkInputText(""),ee.setBulkInstructorId(""),ee.setModalError(null)},children:"\xd7"})]})}),(0,pt.jsxs)("div",{className:"p-6",children:[(0,pt.jsx)(Lt,{error:ee.modalError,onClose:()=>ee.setModalError(null)}),(0,pt.jsxs)("div",{className:"flex gap-2 mb-6 p-1 bg-gray-100 rounded-xl",children:[(0,pt.jsx)("button",{className:"flex-1 py-3 px-4 rounded-lg font-medium transition-all duration-200 "+(ee.bulkInputMode?"text-gray-600 hover:text-gray-800":"bg-white text-indigo-600 shadow-md"),onClick:()=>ee.setBulkInputMode(!1),children:"\u500b\u5225\u5165\u529b"}),(0,pt.jsx)("button",{className:"flex-1 py-3 px-4 rounded-lg font-medium transition-all duration-200 "+(ee.bulkInputMode?"bg-white text-indigo-600 shadow-md":"text-gray-600 hover:text-gray-800"),onClick:()=>ee.setBulkInputMode(!0),children:"\u4e00\u62ec\u5165\u529b"})]}),ee.bulkInputMode?(0,pt.jsxs)("div",{className:"space-y-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u5229\u7528\u8005\u60c5\u5831\uff081\u884c1\u4eba\u3001\u30ab\u30f3\u30de\u533a\u5207\u308a\uff09"}),(0,pt.jsx)("p",{className:"text-xs text-gray-500 mb-2",children:"\u203b\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306f\u4efb\u610f\u3067\u3059\u3002\u7a7a\u6b04\u306e\u5834\u5408\u306fnull\u3068\u3057\u3066\u767b\u9332\u3055\u308c\u307e\u3059\u3002"}),(0,pt.jsx)("textarea",{value:ee.bulkInputText,onChange:e=>ee.setBulkInputText(e.target.value),placeholder:"\u5229\u7528\u8005\u540d,\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\uff08\u4efb\u610f\uff09\n\u4f8b\uff1a\u7530\u4e2d\u592a\u90ce,tanaka@example.com\n\u4f8b\uff1a\u4f50\u85e4\u82b1\u5b50,\n\u4f8b\uff1a\u5c71\u7530\u6b21\u90ce,\n\u4f8b\uff1a\u9234\u6728\u4e00\u90ce,suzuki@example.com\n\u4f8b\uff1a\u9ad8\u6a4b\u7f8e\u54b2,",rows:8,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u62c5\u5f53\u6307\u5c0e\u54e1\uff08\u5168\u54e1\u5171\u901a\uff09"}),(0,pt.jsxs)("select",{value:ee.bulkInstructorId,onChange:e=>ee.setBulkInstructorId(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,pt.jsx)("option",{value:"",children:"\u6307\u5c0e\u54e1\u3092\u9078\u629e"}),b.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,pt.jsx)("div",{children:(0,pt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\u9078\u629e\u4e2d\u306e\u62e0\u70b9\u306e\u4f01\u696d\u30fb\u62e0\u70b9\u306b\u6240\u5c5e\u3059\u308b\u5229\u7528\u8005\u3068\u3057\u3066\u8ffd\u52a0\u3055\u308c\u307e\u3059"})}),(0,pt.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,pt.jsx)("button",{onClick:()=>ee.setShowAddForm(!1),className:"px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{onClick:ee.handleBulkAddStudents,className:"px-6 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-all duration-200",children:"\u4e00\u62ec\u8ffd\u52a0"})]})]}):(0,pt.jsxs)("form",{onSubmit:ee.handleAddStudent,className:"space-y-6",children:[(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{htmlFor:"name",className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u5229\u7528\u8005\u540d"}),(0,pt.jsx)("input",{type:"text",id:"name",name:"name",value:ee.newStudent.name,onChange:ee.handleInputChange,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{htmlFor:"email",className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\uff08\u4efb\u610f\uff09"}),(0,pt.jsx)("input",{type:"email",id:"email",name:"email",value:ee.newStudent.email,onChange:ee.handleInputChange,placeholder:"example@example.com",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{htmlFor:"instructor_id",className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u62c5\u5f53\u6307\u5c0e\u54e1"}),(0,pt.jsxs)("select",{id:"instructor_id",name:"instructor_id",value:ee.newStudent.instructor_id,onChange:ee.handleInputChange,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,pt.jsx)("option",{value:"",children:"\u6307\u5c0e\u54e1\u3092\u9078\u629e"}),b.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{htmlFor:"tags",className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u30bf\u30b0\uff08\u30ab\u30f3\u30de\u533a\u5207\u308a\uff09"}),(0,pt.jsx)("input",{type:"text",id:"tags",name:"tags",value:ee.newStudent.tags.join(", "),onChange:ee.handleTagChange,placeholder:"\u512a\u79c0, \u8981\u30d5\u30a9\u30ed\u30fc",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,pt.jsx)("button",{type:"button",onClick:()=>ee.setShowAddForm(!1),className:"px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{type:"submit",className:"px-6 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-all duration-200",children:"\u8ffd\u52a0"})]})]})]})]})}),Z.showEditModal&&Z.editingStudent&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\u270f\ufe0f \u5229\u7528\u8005\u60c5\u5831\u7de8\u96c6"}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all duration-200",onClick:()=>Z.setShowEditModal(!1),children:"\xd7"})]})}),(0,pt.jsx)("div",{className:"p-6",children:(0,pt.jsxs)("form",{onSubmit:e=>{e.preventDefault(),Z.handleUpdateStudent()},className:"space-y-6",children:[(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{htmlFor:"edit_name",className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u5229\u7528\u8005\u540d"}),(0,pt.jsx)("input",{type:"text",id:"edit_name",name:"name",value:Z.editFormData.name,onChange:Z.handleInputChange,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{htmlFor:"edit_instructor_id",className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u62c5\u5f53\u6307\u5c0e\u54e1"}),(0,pt.jsxs)("select",{id:"edit_instructor_id",name:"instructor_id",value:Z.editFormData.instructor_id,onChange:Z.handleInputChange,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[(0,pt.jsx)("option",{value:"",children:"\u6307\u5c0e\u54e1\u3092\u9078\u629e"}),b.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{htmlFor:"edit_tags",className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u30bf\u30b0\uff08\u30ab\u30f3\u30de\u533a\u5207\u308a\uff09"}),(0,pt.jsx)("input",{type:"text",id:"edit_tags",name:"tags",value:Z.editFormData.tags.join(", "),onChange:Z.handleTagChange,placeholder:"\u512a\u79c0, \u8981\u30d5\u30a9\u30ed\u30fc",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsxs)("div",{className:"border-t pt-6",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\u500b\u5225\u652f\u63f4\u8a08\u753b"}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{htmlFor:"long_term_goal",className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u9577\u671f\u76ee\u6a19"}),(0,pt.jsx)("textarea",{id:"long_term_goal",name:"long_term_goal",value:Z.supportPlanData.long_term_goal,onChange:Z.handleSupportPlanChange,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{htmlFor:"short_term_goal",className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u77ed\u671f\u76ee\u6a19"}),(0,pt.jsx)("textarea",{id:"short_term_goal",name:"short_term_goal",value:Z.supportPlanData.short_term_goal,onChange:Z.handleSupportPlanChange,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{htmlFor:"needs",className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u30cb\u30fc\u30ba"}),(0,pt.jsx)("textarea",{id:"needs",name:"needs",value:Z.supportPlanData.needs,onChange:Z.handleSupportPlanChange,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{htmlFor:"support_content",className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u652f\u63f4\u5185\u5bb9"}),(0,pt.jsx)("textarea",{id:"support_content",name:"support_content",value:Z.supportPlanData.support_content,onChange:Z.handleSupportPlanChange,rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{htmlFor:"goal_date",className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u76ee\u6a19\u9054\u6210\u4e88\u5b9a\u65e5"}),(0,pt.jsx)("input",{type:"date",id:"goal_date",name:"goal_date",value:Z.supportPlanData.goal_date,onChange:Z.handleSupportPlanChange,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]})]}),(0,pt.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,pt.jsx)("button",{type:"button",onClick:()=>Z.setShowEditModal(!1),className:"px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{type:"submit",className:"px-6 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-all duration-200",children:"\u66f4\u65b0"})]})]})})]})}),E&&X&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\ud83c\udfaf \u30b3\u30fc\u30b9\u7ba1\u7406"}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all duration-200",onClick:()=>D(!1),children:"\xd7"})]})}),(0,pt.jsx)("div",{className:"p-6",children:(0,pt.jsx)(Xt,{students:i,onStudentsUpdate:c,satelliteId:m})})]})}),A&&z&&(0,pt.jsx)(un,{student:z,onClose:()=>{$(!1),O(null)}}),R&&F&&(0,pt.jsx)(an,{isOpen:R,onClose:()=>{M(!1),U(null)},student:F,satelliteId:m,onApprovalSuccess:K}),B&&q&&(0,pt.jsx)(on,{isOpen:B,onClose:()=>{J(!1),V(null)},student:q,onApprovalSuccess:K})]})})},xn=e=>{let{locationInfo:t}=e;const n=t.currentStudents>t.maxStudents,s=t.maxStudents>0?t.currentStudents/t.maxStudents*100:0;return(0,pt.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\u62e0\u70b9\u7d71\u8a08"}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,pt.jsx)("div",{className:"bg-blue-50 rounded-lg p-4",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("p",{className:"text-sm font-medium text-blue-600",children:"\u73fe\u5728\u306e\u53d7\u8b1b\u751f\u6570"}),(0,pt.jsx)("p",{className:"text-2xl font-bold text-blue-800",children:t.currentStudents})]}),(0,pt.jsx)("div",{className:"text-blue-400",children:(0,pt.jsx)("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20",children:(0,pt.jsx)("path",{d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})]})}),(0,pt.jsx)("div",{className:"bg-green-50 rounded-lg p-4",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("p",{className:"text-sm font-medium text-green-600",children:"\u6700\u5927\u53d7\u8b1b\u751f\u6570"}),(0,pt.jsx)("p",{className:"text-2xl font-bold text-green-800",children:t.maxStudents})]}),(0,pt.jsx)("div",{className:"text-green-400",children:(0,pt.jsx)("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20",children:(0,pt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})})})]})}),(0,pt.jsx)("div",{className:"bg-purple-50 rounded-lg p-4",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("p",{className:"text-sm font-medium text-purple-600",children:"\u6307\u5c0e\u8005\u6570"}),(0,pt.jsx)("p",{className:"text-2xl font-bold text-purple-800",children:t.instructorCount})]}),(0,pt.jsx)("div",{className:"text-purple-400",children:(0,pt.jsx)("svg",{className:"w-8 h-8",fill:"currentColor",viewBox:"0 0 20 20",children:(0,pt.jsx)("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"})})})]})})]}),(0,pt.jsxs)("div",{className:"mt-6",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,pt.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"\u5bb9\u91cf\u4f7f\u7528\u7387"}),(0,pt.jsxs)("span",{className:"text-sm font-medium "+(n?"text-red-600":"text-gray-600"),children:[s.toFixed(1),"%"]})]}),(0,pt.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,pt.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 "+(n?"bg-red-500":s>80?"bg-yellow-500":"bg-green-500"),style:{width:`${Math.min(s,100)}%`}})}),n&&(0,pt.jsx)("p",{className:"text-sm text-red-600 mt-1",children:"\u5bb9\u91cf\u3092\u8d85\u904e\u3057\u3066\u3044\u307e\u3059\u3002\u53d7\u8b1b\u751f\u6570\u306e\u8abf\u6574\u3092\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})]})]})},gn=e=>{let{locationInfo:t,onEditClick:n,hasPermission:s}=e;return(0,pt.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"\u62e0\u70b9\u60c5\u5831"}),s&&(0,pt.jsx)("button",{onClick:n,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",children:"\u7de8\u96c6"})]}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h4",{className:"text-md font-medium text-gray-700 mb-3",children:"\u57fa\u672c\u60c5\u5831"}),(0,pt.jsxs)("div",{className:"space-y-3",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"\u62e0\u70b9\u540d"}),(0,pt.jsx)("p",{className:"text-gray-900",children:t.name||"\u672a\u8a2d\u5b9a"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"\u65bd\u8a2d\u540d"}),(0,pt.jsx)("p",{className:"text-gray-900",children:t.facilityName||"\u672a\u8a2d\u5b9a"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"\u7ba1\u7406\u8005"}),(0,pt.jsx)("p",{className:"text-gray-900",children:t.managers&&t.managers.length>0?t.managers.join(", "):t.manager||"\u672a\u8a2d\u5b9a"})]})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h4",{className:"text-md font-medium text-gray-700 mb-3",children:"\u9023\u7d61\u5148\u60c5\u5831"}),(0,pt.jsxs)("div",{className:"space-y-3",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"\u4f4f\u6240"}),(0,pt.jsx)("p",{className:"text-gray-900",children:t.address||"\u672a\u8a2d\u5b9a"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"\u96fb\u8a71\u756a\u53f7"}),(0,pt.jsx)("p",{className:"text-gray-900",children:t.phone||"\u672a\u8a2d\u5b9a"})]})]})]})]})]})},hn=e=>{let{instructor:t,onSave:n,onCancel:s,loading:a}=e;const[l,o]=(0,r.useState)({name:"",email:"",specialization:"",status:1}),[i,c]=(0,r.useState)({});(0,r.useEffect)(()=>{t&&o({name:t.name||"",email:t.email||"",specialization:t.specialization||"",status:t.status||1})},[t]);const d=e=>{const{name:t,value:n}=e.target;o(e=>({...e,[t]:n})),i[t]&&c(e=>({...e,[t]:""}))};return t?(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"\u6307\u5c0e\u54e1\u60c5\u5831\u3092\u7de8\u96c6"}),(0,pt.jsx)("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",disabled:a,children:"\xd7"})]}),(0,pt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return l.name.trim()||(e.name="\u540d\u524d\u306f\u5fc5\u9808\u3067\u3059"),l.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l.email)&&(e.email="\u6709\u52b9\u306a\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),c(e),0===Object.keys(e).length})())try{await n(l)}catch(t){console.error("\u6307\u5c0e\u54e1\u66f4\u65b0\u30a8\u30e9\u30fc:",t)}},className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u540d\u524d ",(0,pt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,pt.jsx)("input",{type:"text",name:"name",value:l.name,onChange:d,className:"w-full px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(i.name?"border-red-500":"border-gray-300"),disabled:a}),i.name&&(0,pt.jsx)("p",{className:"text-red-500 text-xs mt-1",children:i.name})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9"}),(0,pt.jsx)("input",{type:"email",name:"email",value:l.email,onChange:d,className:"w-full px-3 py-2 border rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(i.email?"border-red-500":"border-gray-300"),placeholder:"\u4f8b: instructor@example.com",disabled:a}),i.email&&(0,pt.jsx)("p",{className:"text-red-500 text-xs mt-1",children:i.email})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u5c02\u9580\u5206\u91ce"}),(0,pt.jsx)("input",{type:"text",name:"specialization",value:l.specialization,onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"\u4f8b: \u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0, \u30c7\u30b6\u30a4\u30f3, \u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0\uff08\u30ab\u30f3\u30de\u533a\u5207\u308a\u3067\u8907\u6570\u5165\u529b\u53ef\u80fd\uff09",disabled:a}),(0,pt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\u8907\u6570\u306e\u5c02\u9580\u5206\u91ce\u304c\u3042\u308b\u5834\u5408\u306f\u3001\u30ab\u30f3\u30de\uff08,\uff09\u3067\u533a\u5207\u3063\u3066\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u30b9\u30c6\u30fc\u30bf\u30b9"}),(0,pt.jsxs)("select",{name:"status",value:l.status,onChange:d,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:a,children:[(0,pt.jsx)("option",{value:1,children:"\u6709\u52b9"}),(0,pt.jsx)("option",{value:0,children:"\u7121\u52b9"})]})]}),(0,pt.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,pt.jsx)("button",{type:"button",onClick:s,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",disabled:a,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",disabled:a,children:a?"\u66f4\u65b0\u4e2d...":"\u66f4\u65b0"})]})]})]})}):null},pn=e=>{let{instructors:t,locationInfo:n,onAddInstructor:s,onToggleManager:a,onDeleteInstructor:l,onEditInstructor:o,hasPermission:i,loading:c}=e;const[d,u]=(0,r.useState)(null);return(0,pt.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"\u6307\u5c0e\u54e1\u4e00\u89a7"}),i&&(0,pt.jsx)("button",{onClick:s,className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",children:"\u6307\u5c0e\u54e1\u3092\u8ffd\u52a0"})]}),0===t.length?(0,pt.jsx)("div",{className:"text-center py-8",children:(0,pt.jsx)("p",{className:"text-gray-500",children:"\u6307\u5c0e\u54e1\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093"})}):(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,pt.jsx)("thead",{className:"bg-gray-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u540d\u524d"}),(0,pt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u30e6\u30fc\u30b6\u30fc\u540d"}),(0,pt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9"}),(0,pt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u5c02\u9580\u5206\u91ce"}),(0,pt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u7ba1\u7406\u8005"}),(0,pt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u30b9\u30c6\u30fc\u30bf\u30b9"}),i&&(0,pt.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"\u64cd\u4f5c"})]})}),(0,pt.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map((e,s)=>{const r=Kt(e.id,t,n);return(0,pt.jsxs)("tr",{className:"hover:bg-gray-50 "+(s%2===0?"bg-white":"bg-gray-50"),children:[(0,pt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,pt.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name})}),(0,pt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,pt.jsx)("div",{className:"text-sm text-gray-900",children:e.username})}),(0,pt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,pt.jsx)("div",{className:"text-sm text-gray-900",children:e.email})}),(0,pt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,pt.jsx)("div",{className:"text-sm text-gray-900",children:e.specialization||"\u672a\u8a2d\u5b9a"})}),(0,pt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,pt.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+(r?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:r?"\u7ba1\u7406\u8005":"\u4e00\u822c"})}),(0,pt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,pt.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+(1===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:1===e.status?"\u6709\u52b9":"\u7121\u52b9"})}),i&&(0,pt.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,pt.jsxs)("div",{className:"flex space-x-2",children:[(0,pt.jsx)("button",{onClick:()=>u(e),className:"text-white text-sm px-3 py-1 rounded bg-blue-600 hover:bg-blue-700 transition-colors duration-200",children:"\u7de8\u96c6"}),(0,pt.jsx)("button",{onClick:()=>a(e.id,!r),className:"text-sm px-3 py-1 rounded text-white transition-colors duration-200 "+(r?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:r?"\u7ba1\u7406\u8005\u89e3\u9664":"\u7ba1\u7406\u8005\u8a2d\u5b9a"}),(0,pt.jsx)("button",{onClick:()=>l(e.id),className:"text-white text-sm px-3 py-1 rounded bg-red-600 hover:bg-red-700 transition-colors duration-200",children:"\u524a\u9664"})]})})]},e.id)})})]})}),d&&(0,pt.jsx)(hn,{instructor:d,onSave:async e=>{await o(d.id,e),u(null)},onCancel:()=>u(null),loading:c})]})},fn=e=>{let{onSubmit:t,onCancel:n,loading:s}=e;const[a,l]=(0,r.useState)({name:"",username:"",email:"",specialization:"",password:""}),[o,i]=(0,r.useState)({}),c=(e,t)=>{l(n=>({...n,[e]:t})),o[e]&&i(t=>({...t,[e]:""}))};return(0,pt.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,pt.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,pt.jsxs)("div",{className:"mt-3",children:[(0,pt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"\u6307\u5c0e\u54e1\u3092\u8ffd\u52a0"}),(0,pt.jsxs)("form",{onSubmit:e=>{e.preventDefault(),(()=>{const e={};return a.name.trim()||(e.name="\u540d\u524d\u306f\u5fc5\u9808\u3067\u3059"),a.username.trim()||(e.username="\u30e6\u30fc\u30b6\u30fc\u540d\u306f\u5fc5\u9808\u3067\u3059"),a.email.trim()&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)&&(e.email="\u6709\u52b9\u306a\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),a.password.trim()?a.password.length<6&&(e.password="\u30d1\u30b9\u30ef\u30fc\u30c9\u306f6\u6587\u5b57\u4ee5\u4e0a\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"):e.password="\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u5fc5\u9808\u3067\u3059",i(e),0===Object.keys(e).length})()&&t(a)},className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u540d\u524d *"}),(0,pt.jsx)(Ct,{type:"text",value:a.name,onChange:e=>c("name",e),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(o.name?"border-red-500":"border-gray-300"),placeholder:"\u6307\u5c0e\u54e1\u306e\u540d\u524d"}),o.name&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:o.name})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u30e6\u30fc\u30b6\u30fc\u540d *"}),(0,pt.jsx)(Ct,{type:"text",value:a.username,onChange:e=>c("username",e),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(o.username?"border-red-500":"border-gray-300"),placeholder:"\u30ed\u30b0\u30a4\u30f3\u7528\u30e6\u30fc\u30b6\u30fc\u540d"}),o.username&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:o.username})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9"}),(0,pt.jsx)(Ct,{type:"email",value:a.email,onChange:e=>c("email",e),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(o.email?"border-red-500":"border-gray-300"),placeholder:"\u4f8b: instructor@example.com"}),o.email&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:o.email})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u5c02\u9580\u5206\u91ce"}),(0,pt.jsx)(Ct,{type:"text",value:a.specialization,onChange:e=>c("specialization",e),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"\u5c02\u9580\u5206\u91ce"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u30d1\u30b9\u30ef\u30fc\u30c9 *"}),(0,pt.jsx)("input",{type:"password",value:a.password,onChange:e=>c("password",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(o.password?"border-red-500":"border-gray-300"),placeholder:"6\u6587\u5b57\u4ee5\u4e0a"}),o.password&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:o.password})]}),(0,pt.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,pt.jsx)("button",{type:"button",onClick:n,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",disabled:s,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",disabled:s,children:s?"\u8ffd\u52a0\u4e2d...":"\u8ffd\u52a0"})]})]})]})})})},bn=e=>{let{locationInfo:t,onSubmit:n,onCancel:s,loading:a}=e;const[l,o]=(0,r.useState)({name:"",address:"",phone:""}),[i,c]=(0,r.useState)({});(0,r.useEffect)(()=>{t&&o({name:t.name||"",address:t.address||"",phone:t.phone||""})},[t]);const d=(e,t)=>{o(n=>({...n,[e]:t})),i[e]&&c(t=>({...t,[e]:""}))};return(0,pt.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,pt.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,pt.jsxs)("div",{className:"mt-3",children:[(0,pt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"\u62e0\u70b9\u60c5\u5831\u3092\u7de8\u96c6"}),(0,pt.jsxs)("form",{onSubmit:e=>{e.preventDefault(),(()=>{const e={};return l.name.trim()||(e.name="\u62e0\u70b9\u540d\u306f\u5fc5\u9808\u3067\u3059"),l.address.trim()||(e.address="\u4f4f\u6240\u306f\u5fc5\u9808\u3067\u3059"),l.phone.trim()||(e.phone="\u96fb\u8a71\u756a\u53f7\u306f\u5fc5\u9808\u3067\u3059"),c(e),0===Object.keys(e).length})()&&n(l)},className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u62e0\u70b9\u540d *"}),(0,pt.jsx)(Ct,{type:"text",value:l.name,onChange:e=>d("name",e),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(i.name?"border-red-500":"border-gray-300"),placeholder:"\u62e0\u70b9\u540d"}),i.name&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.name})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u4f4f\u6240 *"}),(0,pt.jsx)(Ct,{type:"text",value:l.address,onChange:e=>d("address",e),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(i.address?"border-red-500":"border-gray-300"),placeholder:"\u4f4f\u6240"}),i.address&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.address})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u96fb\u8a71\u756a\u53f7 *"}),(0,pt.jsx)(Ct,{type:"text",value:l.phone,onChange:e=>d("phone",e),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+(i.phone?"border-red-500":"border-gray-300"),placeholder:"\u96fb\u8a71\u756a\u53f7"}),i.phone&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.phone})]}),(0,pt.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,pt.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",disabled:a,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",disabled:a,children:a?"\u66f4\u65b0\u4e2d...":"\u66f4\u65b0"})]})]})]})})})},yn=e=>{let{instructors:t,locationInfo:n,onUpdateManagerSettings:s,onCancel:a,loading:l}=e;const[o,i]=(0,r.useState)(()=>{const e=[];return t.forEach(s=>{Kt(s.id,t,n)&&e.push(s.id)}),e});return(0,pt.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,pt.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,pt.jsxs)("div",{className:"mt-3",children:[(0,pt.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"\u7ba1\u7406\u8005\u8a2d\u5b9a"}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("p",{className:"text-sm text-gray-600 mb-3",children:"\u7ba1\u7406\u8005\u3068\u3057\u3066\u8a2d\u5b9a\u3059\u308b\u6307\u5c0e\u8005\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),(0,pt.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:t.map(e=>(0,pt.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer",children:[(0,pt.jsx)("input",{type:"checkbox",checked:o.includes(e.id),onChange:()=>{return t=e.id,void i(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.name}),(0,pt.jsx)("span",{className:"text-xs text-gray-500 block",children:e.email})]})]},e.id))}),0===t.length&&(0,pt.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"\u6307\u5c0e\u8005\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093"})]}),(0,pt.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,pt.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 border border-gray-300 rounded-md hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",disabled:l,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{type:"button",onClick:()=>{s(o)},className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",disabled:l,children:l?"\u66f4\u65b0\u4e2d...":"\u66f4\u65b0"})]})]})})})},vn=e=>{let{satelliteId:t,onUpdate:n}=e;const[s,a]=(0,r.useState)([]),[l,o]=(0,r.useState)([]),[i,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(null),[m,x]=(0,r.useState)(!1),[g,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(!1),[b,y]=(0,r.useState)({}),[v,j]=(0,r.useState)([]),[N,w]=(0,r.useState)(""),[k,S]=(0,r.useState)(""),_=async()=>{try{c(!0);const e=await(e=>He(`/api/users/satellite/${e}/instructor-relations`))(t);e.success?a(e.data):(console.error("\u5229\u7528\u8005\u62c5\u5f53\u6307\u5c0e\u54e1\u95a2\u4fc2\u53d6\u5f97\u30a8\u30e9\u30fc:",e.message),u(e.message))}catch(d){console.error("\u5229\u7528\u8005\u62c5\u5f53\u6307\u5c0e\u54e1\u95a2\u4fc2\u53d6\u5f97\u30a8\u30e9\u30fc:",d),u("\u5229\u7528\u8005\u62c5\u5f53\u6307\u5c0e\u54e1\u95a2\u4fc2\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}finally{c(!1)}},C=async()=>{try{const e=await(e=>He(`/api/users/satellite/${e}/available-instructors`))(t);e.success?o(e.data):console.error("\u5229\u7528\u53ef\u80fd\u6307\u5c0e\u54e1\u53d6\u5f97\u30a8\u30e9\u30fc:",e.message)}catch(d){console.error("\u5229\u7528\u53ef\u80fd\u6307\u5c0e\u54e1\u53d6\u5f97\u30a8\u30e9\u30fc:",d)}};(0,r.useEffect)(()=>{t&&Promise.all([_(),C()])},[t]);const I=s.filter(e=>e.user_name.toLowerCase().includes(N.toLowerCase())||e.instructor_name&&e.instructor_name.toLowerCase().includes(N.toLowerCase())),T=async(e,t)=>{try{x(!0);const s=await((e,t)=>Qe(`/api/users/${e}/instructor`,{instructorId:t}))(e,t);s.success?(alert("\u62c5\u5f53\u6307\u5c0e\u54e1\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f"),await _(),n&&n()):alert(s.message||"\u62c5\u5f53\u6307\u5c0e\u54e1\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(d){console.error("\u62c5\u5f53\u6307\u5c0e\u54e1\u66f4\u65b0\u30a8\u30e9\u30fc:",d),alert("\u62c5\u5f53\u6307\u5c0e\u54e1\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}finally{x(!1)}};return i?(0,pt.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,pt.jsx)("p",{className:"text-gray-600 mt-2",children:"\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]})}):d?(0,pt.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}),(0,pt.jsx)("p",{className:"text-red-600",children:d}),(0,pt.jsx)("button",{onClick:_,className:"mt-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg",children:"\u518d\u8a66\u884c"})]})}):(0,pt.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-gray-800",children:"\u5229\u7528\u8005\u62c5\u5f53\u6307\u5c0e\u54e1\u7ba1\u7406"}),(0,pt.jsxs)("div",{className:"space-x-2",children:[(0,pt.jsx)("button",{onClick:()=>{j([]),S(""),w(""),f(!0)},className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",disabled:m,children:"\u4e00\u62ec\u5909\u66f4"}),(0,pt.jsx)("button",{onClick:_,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",disabled:m,children:"\u66f4\u65b0"})]})]}),p?(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("h4",{className:"text-md font-medium text-gray-700",children:"\u4e00\u62ec\u62c5\u5f53\u6307\u5c0e\u54e1\u5909\u66f4"}),(0,pt.jsxs)("div",{className:"space-x-2",children:[(0,pt.jsx)("button",{onClick:async()=>{if(0!==v.length)try{x(!0);const e=v.map(e=>({userId:parseInt(e),instructorId:""===k?null:parseInt(k)})),s=await((e,t)=>Qe(`/api/users/satellite/${e}/bulk-instructor-assignment`,{assignments:t}))(t,e);s.success?(alert(`\u4e00\u62ec\u66f4\u65b0\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\uff08\u6210\u529f: ${s.data.successCount}\u4ef6\u3001\u5931\u6557: ${s.data.errorCount}\u4ef6\uff09`),s.data.errors&&s.data.errors.length>0&&console.error("\u4e00\u62ec\u66f4\u65b0\u30a8\u30e9\u30fc\u8a73\u7d30:",s.data.errors),await _(),j([]),S(""),f(!1),n&&n()):alert(s.message||"\u4e00\u62ec\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(d){console.error("\u4e00\u62ec\u62c5\u5f53\u6307\u5c0e\u54e1\u66f4\u65b0\u30a8\u30e9\u30fc:",d),alert("\u4e00\u62ec\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}finally{x(!1)}else alert("\u5229\u7528\u8005\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044")},className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",disabled:m||0===v.length,children:m?"\u66f4\u65b0\u4e2d...":"\u78ba\u5b9a"}),(0,pt.jsx)("button",{onClick:()=>{f(!1),j([]),S(""),w("")},className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",disabled:m,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]}),(0,pt.jsx)("div",{className:"mb-4",children:(0,pt.jsx)("input",{type:"text",placeholder:"\u5229\u7528\u8005\u540d\u307e\u305f\u306f\u62c5\u5f53\u6307\u5c0e\u54e1\u540d\u3067\u691c\u7d22...",value:N,onChange:e=>w(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u62c5\u5f53\u6307\u5c0e\u54e1\u3092\u9078\u629e\uff08\u672a\u9078\u629e\u3067\u5168\u89e3\u9664\uff09"}),(0,pt.jsxs)("select",{value:k,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:m,children:[(0,pt.jsx)("option",{value:"",children:"\u672a\u8a2d\u5b9a\uff08\u62c5\u5f53\u6307\u5c0e\u54e1\u3092\u89e3\u9664\uff09"}),l.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,pt.jsx)("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:(0,pt.jsxs)("p",{className:"text-sm text-gray-600",children:["\u9078\u629e\u6e08\u307f: ",v.length,"\u4ef6 / \u8868\u793a\u4e2d: ",I.length,"\u4ef6"]})}),(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"min-w-full bg-white border border-gray-200",children:[(0,pt.jsx)("thead",{className:"bg-gray-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:(0,pt.jsx)("input",{type:"checkbox",checked:v.length===I.length&&I.length>0,onChange:()=>{v.length===I.length?j([]):j(I.map(e=>e.user_id))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",disabled:m})}),(0,pt.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"\u5229\u7528\u8005\u540d"}),(0,pt.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"\u73fe\u5728\u306e\u62c5\u5f53\u6307\u5c0e\u54e1"})]})}),(0,pt.jsx)("tbody",{className:"divide-y divide-gray-200",children:I.map(e=>(0,pt.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,pt.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,pt.jsx)("input",{type:"checkbox",checked:v.includes(e.user_id),onChange:()=>{return t=e.user_id,void j(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500",disabled:m})}),(0,pt.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.user_name}),(0,pt.jsx)("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.instructor_name||"\u672a\u8a2d\u5b9a"})]},e.user_id))})]})}),0===I.length&&(0,pt.jsx)("div",{className:"text-center py-8 text-gray-500",children:"\u8a72\u5f53\u3059\u308b\u5229\u7528\u8005\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093"})]}):(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"min-w-full bg-white border border-gray-200",children:[(0,pt.jsx)("thead",{className:"bg-gray-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"\u5229\u7528\u8005\u540d"}),(0,pt.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"\u62c5\u5f53\u6307\u5c0e\u54e1"}),(0,pt.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b",children:"\u64cd\u4f5c"})]})}),(0,pt.jsx)("tbody",{className:"divide-y divide-gray-200",children:s.map(e=>(0,pt.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,pt.jsx)("td",{className:"px-4 py-3 text-sm text-gray-900",children:e.user_name}),(0,pt.jsx)("td",{className:"px-4 py-3 text-sm text-gray-600",children:e.instructor_name||"\u672a\u8a2d\u5b9a"}),(0,pt.jsx)("td",{className:"px-4 py-3 text-sm",children:(0,pt.jsx)("button",{onClick:()=>h(e),className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs font-medium transition-colors",disabled:m,children:"\u5909\u66f4"})})]},e.user_id))})]})}),g&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-lg p-6 w-96 max-w-full mx-4",children:[(0,pt.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:[g.user_name,"\u306e\u62c5\u5f53\u6307\u5c0e\u54e1\u3092\u5909\u66f4"]}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u65b0\u3057\u3044\u62c5\u5f53\u6307\u5c0e\u54e1"}),(0,pt.jsxs)("select",{id:"instructorSelect",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",defaultValue:g.instructor_id||"",children:[(0,pt.jsx)("option",{value:"",children:"\u672a\u8a2d\u5b9a"}),l.map(e=>(0,pt.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,pt.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,pt.jsx)("button",{onClick:()=>h(null),className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",disabled:m,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{onClick:()=>{const e=document.getElementById("instructorSelect").value,t=""===e?null:parseInt(e);T(g.user_id,t),h(null)},className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors",disabled:m,children:m?"\u66f4\u65b0\u4e2d...":"\u78ba\u5b9a"})]})]})})]})},jn=e=>{let{currentUser:t,onLocationChange:n}=e;const{updateAuthForSatellite:s,currentUser:a}=bt(),l=Wt(a)>=5,o=(0,r.useRef)(t);o.current=t;const[i,c]=(0,r.useState)({id:null,name:"",facilityName:"",maxStudents:0,currentStudents:0,instructorCount:0,address:"",phone:"",manager:""}),[d,u]=(0,r.useState)([]),[m,x]=(0,r.useState)(!0),[g,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(!1),[b,y]=(0,r.useState)(!1),[v,j]=(0,r.useState)(!1),[N,w]=(0,r.useState)(!1),[k,S]=(0,r.useState)(!1),_=(0,r.useCallback)(async()=>{let e=Qt(o.current);if(!e)try{if(console.log("\u62e0\u70b9ID\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u305f\u3081\u3001\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u66f4\u65b0\u3057\u3066\u518d\u8a66\u884c..."),o.current&&o.current.role>=9&&o.current.satellite_id)e=o.current.satellite_id,console.log("\u7ba1\u7406\u8005\u7528: \u30ed\u30b0\u30a4\u30f3\u6642\u9078\u629e\u62e0\u70b9ID\u3092\u4f7f\u7528:",e);else{const t=await He("/api/user-info");if(t&&t.satellite_ids&&t.satellite_ids.length>0)e=t.satellite_ids[0],console.log("\u66f4\u65b0\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u304b\u3089\u62e0\u70b9ID\u3092\u53d6\u5f97:",e);else{console.log("\u62e0\u70b9ID\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u305f\u3081\u3001\u62e0\u70b9\u4e00\u89a7\u304b\u3089\u7279\u5b9a\u3092\u8a66\u884c...");const t=await He("/api/satellites");console.log("\u62e0\u70b9\u4e00\u89a7:",t);const n=t.success?t.data:[];if(!(n&&n.length>0))return h("\u5229\u7528\u53ef\u80fd\u306a\u62e0\u70b9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002\u62e0\u70b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),void x(!1);e=n[0].id,console.log("\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u62e0\u70b9ID:",e)}}}catch(g){return console.error("\u62e0\u70b9\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",g),h("\u62e0\u70b9\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u62e0\u70b9\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),void x(!1)}if(e)try{const t=await He(`/api/satellites/${e}`),n=t.success?t.data:null;n&&n.id&&(sessionStorage.setItem("selectedSatellite",JSON.stringify(n)),console.log("selectedSatellite\u3092\u66f4\u65b0:",n))}catch(g){console.error("\u62e0\u70b9\u60c5\u5831\u306e\u53d6\u5f97\u30a8\u30e9\u30fc\uff08selectedSatellite\u66f4\u65b0\u7528\uff09:",g)}try{var t,s,r,a,l;console.log("\u62e0\u70b9\u60c5\u5831\u3092\u53d6\u5f97\u4e2d...",e);const i=await He(`/api/satellites/${e}`);console.log("\u62e0\u70b9\u30c7\u30fc\u30bf:",i);const m=i.success?i.data:null;if(!m||!m.id)throw new Error("\u62e0\u70b9\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f");let x={stats:{current_students:0,instructor_count:0}};try{const t=await He(`/api/satellites/${e}/stats`);console.log("\u7d71\u8a08\u30c7\u30fc\u30bf:",t);const n=t.success?t.data:null;if(console.log("\u7d71\u8a08\u30c7\u30fc\u30bf\uff08\u51e6\u7406\u5f8c\uff09:",n),n&&n.stats)x=n,console.log("\u7d71\u8a08\u30c7\u30fc\u30bf\u8a2d\u5b9a\u5b8c\u4e86:",x);else{console.warn("\u7d71\u8a08\u30c7\u30fc\u30bf\u306e\u5f62\u5f0f\u304c\u4e0d\u6b63\u3067\u3059:",n);try{const t=await He(`/api/satellites/${e}/instructors`),n=t.success?t.data:[];x={stats:{current_students:0,instructor_count:Array.isArray(n)?n.filter(e=>1===e.status).length:0}},console.log("\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u7d71\u8a08\u30c7\u30fc\u30bf:",x)}catch(d){console.warn("\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u7d71\u8a08\u30c7\u30fc\u30bf\u53d6\u5f97\u306b\u3082\u5931\u6557:",d)}}}catch(u){console.warn("\u7d71\u8a08\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",u);try{const t=await He(`/api/satellites/${e}/instructors`),n=t.success?t.data:[];x={stats:{current_students:0,instructor_count:Array.isArray(n)?n.filter(e=>1===e.status).length:0}},console.log("\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u7d71\u8a08\u30c7\u30fc\u30bf:",x)}catch(d){console.warn("\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u7d71\u8a08\u30c7\u30fc\u30bf\u53d6\u5f97\u306b\u3082\u5931\u6557:",d)}}console.log("=== \u62e0\u70b9\u60c5\u5831\u66f4\u65b0\u958b\u59cb ==="),console.log("\u53d6\u5f97\u3057\u305f\u62e0\u70b9\u30c7\u30fc\u30bf:",m),console.log("\u62e0\u70b9\u30c7\u30fc\u30bf\u306emanager_ids:",m.manager_ids,"\u578b:",typeof m.manager_ids);let h=[];if(m.manager_ids)try{let t=m.manager_ids;if("string"===typeof t&&(t=t.includes(",")?t.split(",").map(e=>e.trim()):JSON.parse(t)),Array.isArray(t)){const n=await He(`/api/satellites/${e}/instructors`),s=n.success?n.data:[];t.forEach(e=>{const t=s.find(t=>t.id===Number(e));t&&h.push(t.name)})}}catch(g){console.error("\u7ba1\u7406\u8005\u540d\u53d6\u5f97\u30a8\u30e9\u30fc:",g)}const p={id:m.id,name:m.name||"\u672a\u8a2d\u5b9a",facilityName:m.company_name||"\u672a\u8a2d\u5b9a",maxStudents:m.max_users||10,currentStudents:(null===(t=x.stats)||void 0===t?void 0:t.current_students)||0,instructorCount:(null===(s=x.stats)||void 0===s?void 0:s.instructor_count)||0,address:m.address||"\u672a\u8a2d\u5b9a",phone:m.phone||"\u672a\u8a2d\u5b9a",manager:(null===(r=o.current)||void 0===r?void 0:r.name)||"\u672a\u8a2d\u5b9a",managers:h,manager_ids:m.manager_ids||null};console.log("\u66f4\u65b0\u3055\u308c\u308b\u62e0\u70b9\u60c5\u5831:",p),console.log("\u62e0\u70b9\u60c5\u5831\u306emanager_ids\u8a73\u7d30:",{value:p.manager_ids,type:typeof p.manager_ids,isNull:null===p.manager_ids,isUndefined:void 0===p.manager_ids}),console.log("\u7d71\u8a08\u30c7\u30fc\u30bf\u8a73\u7d30:",{statsData:x,currentStudents:null===(a=x.stats)||void 0===a?void 0:a.current_students,instructorCount:null===(l=x.stats)||void 0===l?void 0:l.instructor_count}),console.log("=== \u62e0\u70b9\u60c5\u5831\u66f4\u65b0\u5b8c\u4e86 ==="),c(p),n&&n({id:m.id,name:m.name,company_name:m.company_name,max_users:m.max_users,address:m.address,phone:m.phone})}catch(g){var i;console.error("\u62e0\u70b9\u60c5\u5831\u53d6\u5f97\u30a8\u30e9\u30fc:",g),console.error("\u30a8\u30e9\u30fc\u8a73\u7d30:",{satelliteId:e,currentUser:null===(i=o.current)||void 0===i?void 0:i.id,errorMessage:g.message,errorStack:g.stack}),h(`\u62e0\u70b9\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${g.message}`)}},[]),C=(0,r.useCallback)(async()=>{let e=Qt(o.current);if(!e)try{const t=await He("/api/satellites"),n=t.success?t.data:t;if(!(n&&n.length>0))return;e=n[0].id}catch(g){return void console.error("\u62e0\u70b9\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",g)}try{console.log("\u6307\u5c0e\u8005\u4e00\u89a7\u3092\u53d6\u5f97\u4e2d...",e);const t=await He(`/api/satellites/${e}/instructors`);let n;console.log("\u6307\u5c0e\u8005\u30c7\u30fc\u30bf:",t),n=t.success&&t.data?t.data:Array.isArray(t)?t:[],console.log("\u51e6\u7406\u5f8c\u306e\u6307\u5c0e\u8005\u30c7\u30fc\u30bf:",n),u(n)}catch(g){console.error("\u6307\u5c0e\u8005\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",g),u([])}},[]);(0,r.useEffect)(()=>{(async()=>{if(!o.current)return h("\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093"),void x(!1);console.log("\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u958b\u59cb - \u73fe\u5728\u306e\u30e6\u30fc\u30b6\u30fc:",o.current),x(!0),h(null);try{await Promise.all([_(),C()])}catch(g){console.error("\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u30a8\u30e9\u30fc:",g),h(g.message)}finally{x(!1)}})()},[null===t||void 0===t?void 0:t.id,null===t||void 0===t?void 0:t.satellite_id]);return l?m?(0,pt.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,pt.jsx)("p",{className:"text-gray-600 mt-4",children:"\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]})}):g?(0,pt.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}),(0,pt.jsx)("p",{className:"text-red-600",children:g}),(0,pt.jsx)("button",{onClick:()=>window.location.reload(),className:"mt-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg",children:"\u518d\u8aad\u307f\u8fbc\u307f"})]})}):(0,pt.jsxs)("div",{className:"space-y-6",children:[(0,pt.jsx)(xn,{locationInfo:i}),(0,pt.jsx)(gn,{locationInfo:i,onEditClick:()=>y(!0),hasPermission:l}),(0,pt.jsx)(pn,{instructors:d,locationInfo:i,onAddInstructor:()=>f(!0),onToggleManager:async(e,t)=>{try{const n=Qt(o.current),s=await Qe(`/api/satellites/${n}/instructors/${e}/manager`,{is_manager:t});s.success?(console.log("\u7ba1\u7406\u8005\u8a2d\u5b9a\u5909\u66f4\u6210\u529f:",s),await C(),await _()):(console.error("\u7ba1\u7406\u8005\u8a2d\u5b9a\u5909\u66f4\u5931\u6557:",s),alert("\u7ba1\u7406\u8005\u8a2d\u5b9a\u306e\u5909\u66f4\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(s.message||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc")))}catch(g){console.error("\u7ba1\u7406\u8005\u8a2d\u5b9a\u5909\u66f4\u30a8\u30e9\u30fc:",g),alert("\u7ba1\u7406\u8005\u8a2d\u5b9a\u306e\u5909\u66f4\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+g.message)}},onDeleteInstructor:async e=>{if(window.confirm("\u3053\u306e\u6307\u5c0e\u8005\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f"))try{const t=Qt(o.current),n=await Ke(`/api/satellites/${t}/instructors/${e}`);n.success?(console.log("\u6307\u5c0e\u8005\u524a\u9664\u6210\u529f:",n),await C(),await _()):(console.error("\u6307\u5c0e\u8005\u524a\u9664\u5931\u6557:",n),alert("\u6307\u5c0e\u8005\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(n.message||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc")))}catch(g){console.error("\u6307\u5c0e\u8005\u524a\u9664\u30a8\u30e9\u30fc:",g),alert("\u6307\u5c0e\u8005\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+g.message)}},onEditInstructor:async(e,t)=>{S(!0);try{const n=await Ge(e,t);n.success?(console.log("\u6307\u5c0e\u8005\u7de8\u96c6\u6210\u529f:",n),alert("\u6307\u5c0e\u8005\u60c5\u5831\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f"),await C()):(console.error("\u6307\u5c0e\u8005\u7de8\u96c6\u5931\u6557:",n),alert("\u6307\u5c0e\u8005\u306e\u7de8\u96c6\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(n.message||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc")))}catch(g){console.error("\u6307\u5c0e\u8005\u7de8\u96c6\u30a8\u30e9\u30fc:",g),alert("\u6307\u5c0e\u8005\u306e\u7de8\u96c6\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+g.message)}finally{S(!1)}},hasPermission:l,loading:k}),l&&(0,pt.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,pt.jsxs)("div",{className:"flex space-x-4",children:[(0,pt.jsx)("button",{onClick:()=>j(!0),className:"bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg text-sm font-medium transition-colors",children:"\u7ba1\u7406\u8005\u8a2d\u5b9a"}),(0,pt.jsx)("button",{onClick:()=>w(!0),className:"bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg text-sm font-medium transition-colors",children:"\u5229\u7528\u8005\u62c5\u5f53\u6307\u5c0e\u54e1\u7ba1\u7406"})]})}),p&&(0,pt.jsx)(fn,{onSubmit:async e=>{S(!0);try{const t=Qt(o.current),n=await We(`/api/satellites/${t}/instructors`,e);n.success?(console.log("\u6307\u5c0e\u8005\u8ffd\u52a0\u6210\u529f:",n),f(!1),await C(),await _()):(console.error("\u6307\u5c0e\u8005\u8ffd\u52a0\u5931\u6557:",n),alert("\u6307\u5c0e\u8005\u306e\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(n.message||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc")))}catch(g){console.error("\u6307\u5c0e\u8005\u8ffd\u52a0\u30a8\u30e9\u30fc:",g),alert("\u6307\u5c0e\u8005\u306e\u8ffd\u52a0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+g.message)}finally{S(!1)}},onCancel:()=>f(!1),loading:k}),b&&(0,pt.jsx)(bn,{locationInfo:i,onSubmit:async e=>{S(!0);try{const t=Qt(o.current),{maxStudents:n,...s}=e,r=await Qe(`/api/satellites/${t}`,s);r.success?(console.log("\u62e0\u70b9\u60c5\u5831\u66f4\u65b0\u6210\u529f:",r),y(!1),await _()):(console.error("\u62e0\u70b9\u60c5\u5831\u66f4\u65b0\u5931\u6557:",r),alert("\u62e0\u70b9\u60c5\u5831\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(r.message||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc")))}catch(g){console.error("\u62e0\u70b9\u60c5\u5831\u66f4\u65b0\u30a8\u30e9\u30fc:",g),alert("\u62e0\u70b9\u60c5\u5831\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+g.message)}finally{S(!1)}},onCancel:()=>y(!1),loading:k}),v&&(0,pt.jsx)(yn,{instructors:d,locationInfo:i,onUpdateManagerSettings:async e=>{S(!0);try{const t=Qt(o.current),n=await Qe(`/api/satellites/${t}/managers`,{manager_ids:e});n.success?(console.log("\u7ba1\u7406\u8005\u8a2d\u5b9a\u66f4\u65b0\u6210\u529f:",n),j(!1),await _(),await C()):(console.error("\u7ba1\u7406\u8005\u8a2d\u5b9a\u66f4\u65b0\u5931\u6557:",n),alert("\u7ba1\u7406\u8005\u8a2d\u5b9a\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(n.message||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc")))}catch(g){console.error("\u7ba1\u7406\u8005\u8a2d\u5b9a\u66f4\u65b0\u30a8\u30e9\u30fc:",g),alert("\u7ba1\u7406\u8005\u8a2d\u5b9a\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+g.message)}finally{S(!1)}},onCancel:()=>j(!1),loading:k}),N&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-lg p-6 w-11/12 max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,pt.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:"\u5229\u7528\u8005\u62c5\u5f53\u6307\u5c0e\u54e1\u7ba1\u7406"}),(0,pt.jsx)("button",{onClick:()=>w(!1),className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"\xd7"})]}),(0,pt.jsx)(vn,{satelliteId:i.id,onUpdate:()=>{_(),C()}})]})})]}):(0,pt.jsx)("div",{className:"bg-white rounded-lg shadow-md p-6",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u304c\u3042\u308a\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u3053\u306e\u6a5f\u80fd\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306b\u306f\u3001\u62e0\u70b9\u7ba1\u7406\u8005\u4ee5\u4e0a\u306e\u6a29\u9650\u304c\u5fc5\u8981\u3067\u3059\u3002"})]})})},Nn=["\u4f50\u85e4\u6307\u5c0e\u54e1","\u7530\u4e2d\u6307\u5c0e\u54e1","\u5c71\u7530\u6307\u5c0e\u54e1","\u9234\u6728\u6307\u5c0e\u54e1"],wn=(new Date).toISOString().split("T")[0],kn=e=>{let{isOpen:t,onClose:n,onSave:s,prevEvalDate:a,defaultPeriod:l,defaultInstructor:o,aiAssist:i}=e;const[c,d]=(0,r.useState)("\u901a\u6240"),[u,m]=(0,r.useState)(""),[x,g]=(0,r.useState)(l||{start:"",end:""}),[h,p]=(0,r.useState)(""),[f,b]=(0,r.useState)(o||Nn[0]);return t?(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[95vh] flex flex-col",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"\u9031\u6b21\u8a55\u4fa1\uff08\u5728\u5b85\u306b\u304a\u3051\u308b\u5c31\u52b4\u652f\u63f4\u8a18\u9332\u30fb\u8a55\u4fa1\uff09"}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all duration-200",onClick:n,children:"\xd7"})]})}),(0,pt.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8a55\u4fa1\u5b9f\u65bd\u65e5"}),(0,pt.jsx)("input",{type:"date",value:wn,disabled:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u524d\u56de\u8a55\u4fa1\u65e5"}),(0,pt.jsx)("input",{type:"date",value:a||"",disabled:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8a55\u4fa1\u65b9\u6cd5"}),(0,pt.jsxs)("div",{className:"flex gap-4",children:[(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"radio",name:"method",value:"\u901a\u6240",checked:"\u901a\u6240"===c,onChange:()=>d("\u901a\u6240"),className:"mr-2 text-green-600 focus:ring-green-500"}),"\u901a\u6240"]}),(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"radio",name:"method",value:"\u8a2a\u554f",checked:"\u8a2a\u554f"===c,onChange:()=>d("\u8a2a\u554f"),className:"mr-2 text-green-600 focus:ring-green-500"}),"\u8a2a\u554f"]}),(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"radio",name:"method",value:"\u305d\u306e\u4ed6",checked:"\u305d\u306e\u4ed6"===c,onChange:()=>d("\u305d\u306e\u4ed6"),className:"mr-2 text-green-600 focus:ring-green-500"}),"\u305d\u306e\u4ed6"]})]}),"\u305d\u306e\u4ed6"===c&&(0,pt.jsx)("input",{type:"text",value:u,onChange:e=>m(e.target.value),placeholder:"\u65b9\u6cd5\u3092\u5165\u529b",className:"mt-2 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u5bfe\u8c61\u671f\u9593"}),(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsx)("input",{type:"date",value:x.start,onChange:e=>g(t=>({...t,start:e.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"}),(0,pt.jsx)("span",{className:"text-gray-500",children:"\uff5e"}),(0,pt.jsx)("input",{type:"date",value:x.end,onChange:e=>g(t=>({...t,end:e.target.value})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8a55\u4fa1\u5185\u5bb9"}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("textarea",{value:h,onChange:e=>p(e.target.value),rows:6,placeholder:"\u8a55\u4fa1\u5185\u5bb9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"}),(0,pt.jsx)("button",{type:"button",className:"px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-all duration-200 text-sm font-medium",onClick:async()=>{if(i){const e=await i({type:"weekly",period:x,prevEvalDate:a,instructor:f});p(e||"")}},children:"AI\u30a2\u30b7\u30b9\u30c8"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8a18\u9332\u8005"}),(0,pt.jsx)("select",{value:f,onChange:e=>b(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:Nn.map(e=>(0,pt.jsx)("option",{value:e,children:e},e))})]})]}),(0,pt.jsxs)("div",{className:"p-6 border-t border-gray-200 flex gap-4",children:[(0,pt.jsx)("button",{className:"flex-1 px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200",onClick:()=>{s&&s({evalDate:wn,prevEvalDate:a,method:"\u305d\u306e\u4ed6"===c?u:c,period:x,content:h,instructor:f})},children:"\u4fdd\u5b58"}),(0,pt.jsx)("button",{className:"flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-all duration-200",onClick:n,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})}):null},Sn=["\u4f50\u85e4\u6307\u5c0e\u54e1","\u7530\u4e2d\u6307\u5c0e\u54e1","\u5c71\u7530\u6307\u5c0e\u54e1","\u9234\u6728\u6307\u5c0e\u54e1"],_n=(new Date).toISOString().split("T")[0],Cn=e=>{let{isOpen:t,onClose:n,onSave:s,prevEvalDate:a,defaultInstructor:l,aiAssist:o}=e;const[i,c]=(0,r.useState)("\u901a\u6240"),[d,u]=(0,r.useState)(""),[m,x]=(0,r.useState)(""),[g,h]=(0,r.useState)(""),[p,f]=(0,r.useState)(""),[b,y]=(0,r.useState)(""),[v,j]=(0,r.useState)(""),[N,w]=(0,r.useState)(""),[k,S]=(0,r.useState)(""),[_,C]=(0,r.useState)(""),[I,T]=(0,r.useState)(l||Sn[0]),P=async(e,t)=>{if(o){t(await o({type:"monthly",field:e,prevEvalDate:a,instructor:I})||"")}};return t?(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[95vh] flex flex-col",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"\u6708\u6b21\u8a55\u4fa1\uff08\u5728\u5b85\u306b\u304a\u3051\u308b\u5c31\u52b4\u9054\u6210\u5ea6\u8a55\u4fa1\u30b7\u30fc\u30c8\uff09"}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all duration-200",onClick:n,children:"\xd7"})]})}),(0,pt.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8a55\u4fa1\u5b9f\u65bd\u65e5"}),(0,pt.jsx)("input",{type:"date",value:_n,disabled:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u524d\u56de\u8a55\u4fa1\u65e5"}),(0,pt.jsx)("input",{type:"date",value:a||"",disabled:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8a55\u4fa1\u65b9\u6cd5"}),(0,pt.jsxs)("div",{className:"flex gap-4",children:[(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"radio",name:"method",value:"\u901a\u6240",checked:"\u901a\u6240"===i,onChange:()=>c("\u901a\u6240"),className:"mr-2 text-green-600 focus:ring-green-500"}),"\u901a\u6240"]}),(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"radio",name:"method",value:"\u8a2a\u554f",checked:"\u8a2a\u554f"===i,onChange:()=>c("\u8a2a\u554f"),className:"mr-2 text-green-600 focus:ring-green-500"}),"\u8a2a\u554f"]}),(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"radio",name:"method",value:"\u305d\u306e\u4ed6",checked:"\u305d\u306e\u4ed6"===i,onChange:()=>c("\u305d\u306e\u4ed6"),className:"mr-2 text-green-600 focus:ring-green-500"}),"\u305d\u306e\u4ed6"]})]}),"\u305d\u306e\u4ed6"===i&&(0,pt.jsx)("input",{type:"text",value:d,onChange:e=>u(e.target.value),placeholder:"\u65b9\u6cd5\u3092\u5165\u529b",className:"mt-2 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4eca\u6708\u306e\u76ee\u6a19"}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("textarea",{value:m,onChange:e=>x(e.target.value),rows:3,placeholder:"\u4eca\u6708\u306e\u76ee\u6a19\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"}),(0,pt.jsx)("button",{type:"button",className:"px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-all duration-200 text-sm font-medium",onClick:()=>P("goal",x),children:"AI\u30a2\u30b7\u30b9\u30c8"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4f5c\u696d\u5185\u5bb9"}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("textarea",{value:g,onChange:e=>h(e.target.value),rows:3,placeholder:"\u4f5c\u696d\u5185\u5bb9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"}),(0,pt.jsx)("button",{type:"button",className:"px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-all duration-200 text-sm font-medium",onClick:()=>P("work",h),children:"AI\u30a2\u30b7\u30b9\u30c8"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u9054\u6210\u5ea6"}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("textarea",{value:p,onChange:e=>f(e.target.value),rows:3,placeholder:"\u9054\u6210\u5ea6\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"}),(0,pt.jsx)("button",{type:"button",className:"px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-all duration-200 text-sm font-medium",onClick:()=>P("achievement",f),children:"AI\u30a2\u30b7\u30b9\u30c8"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8ab2\u984c\u30fb\u554f\u984c\u70b9"}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("textarea",{value:b,onChange:e=>y(e.target.value),rows:3,placeholder:"\u8ab2\u984c\u30fb\u554f\u984c\u70b9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"}),(0,pt.jsx)("button",{type:"button",className:"px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-all duration-200 text-sm font-medium",onClick:()=>P("issue",y),children:"AI\u30a2\u30b7\u30b9\u30c8"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u6539\u5584\u70b9"}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("textarea",{value:v,onChange:e=>j(e.target.value),rows:3,placeholder:"\u6539\u5584\u70b9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"}),(0,pt.jsx)("button",{type:"button",className:"px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-all duration-200 text-sm font-medium",onClick:()=>P("improve",j),children:"AI\u30a2\u30b7\u30b9\u30c8"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u5065\u5eb7\u72b6\u614b"}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("textarea",{value:N,onChange:e=>w(e.target.value),rows:3,placeholder:"\u5065\u5eb7\u72b6\u614b\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"}),(0,pt.jsx)("button",{type:"button",className:"px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-all duration-200 text-sm font-medium",onClick:()=>P("health",w),children:"AI\u30a2\u30b7\u30b9\u30c8"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u7279\u8a18\u4e8b\u9805"}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("textarea",{value:k,onChange:e=>S(e.target.value),rows:3,placeholder:"\u7279\u8a18\u4e8b\u9805\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"}),(0,pt.jsx)("button",{type:"button",className:"px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-all duration-200 text-sm font-medium",onClick:()=>P("note",S),children:"AI\u30a2\u30b7\u30b9\u30c8"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u6709\u52b9\u6027"}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("textarea",{value:_,onChange:e=>C(e.target.value),rows:3,placeholder:"\u6709\u52b9\u6027\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"}),(0,pt.jsx)("button",{type:"button",className:"px-3 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-all duration-200 text-sm font-medium",onClick:()=>P("validity",C),children:"AI\u30a2\u30b7\u30b9\u30c8"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8a18\u9332\u8005"}),(0,pt.jsx)("select",{value:I,onChange:e=>T(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:Sn.map(e=>(0,pt.jsx)("option",{value:e,children:e},e))})]})]}),(0,pt.jsxs)("div",{className:"p-6 border-t border-gray-200 flex gap-4",children:[(0,pt.jsx)("button",{className:"flex-1 px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200",onClick:()=>{s&&s({evalDate:_n,prevEvalDate:a,method:"\u305d\u306e\u4ed6"===i?d:i,goal:m,work:g,achievement:p,issue:b,improve:v,health:N,note:k,validity:_,instructor:I})},children:"\u4fdd\u5b58"}),(0,pt.jsx)("button",{className:"flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-all duration-200",onClick:n,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})}):null},In=e=>{let{isOpen:t,onClose:n,onSuccess:s}=e;const[a,l]=(0,r.useState)([]),[o,i]=(0,r.useState)([]),[c,d]=(0,r.useState)([]),[u,m]=(0,r.useState)([]),[x,g]=(0,r.useState)(!1),[h,p]=(0,r.useState)(""),[f,b]=(0,r.useState)(""),[y,v]=(0,r.useState)(null),[j,N]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(t){try{const e=JSON.parse(localStorage.getItem("currentUser")||"{}");N(e)}catch(n){console.error("\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u306e\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",n)}const t=sessionStorage.getItem("selectedSatellite");if(t)try{const e=JSON.parse(t);v(e)}catch(n){console.error("\u62e0\u70b9\u60c5\u5831\u306e\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",n),p("\u62e0\u70b9\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f"),b("error")}else try{const t=JSON.parse(localStorage.getItem("currentUser")||"{}");var e;if(t.satellite_ids&&t.satellite_ids.length>0)v({id:t.satellite_ids[0],name:(null===(e=t.location)||void 0===e?void 0:e.name)||"\u62e0\u70b9\u540d\u672a\u8a2d\u5b9a"});else p("\u62e0\u70b9\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u62e0\u70b9\u3092\u9078\u629e\u3057\u3066\u304b\u3089\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002"),b("error")}catch(n){console.error("\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u306e\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",n),p("\u62e0\u70b9\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f"),b("error")}}},[t]),(0,r.useEffect)(()=>{null!==y&&void 0!==y&&y.id&&(w(),k())},[y]),(0,r.useEffect)(()=>{null!==y&&void 0!==y&&y.id&&k()},[c,y]);const w=async()=>{try{g(!0);const t=await(e=y.id,He(`/api/users/satellite/${e}/home-support-instructors`));t.success?(i(t.data),d([])):(p("\u6307\u5c0e\u54e1\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f"),b("error"))}catch(t){console.error("\u6307\u5c0e\u54e1\u53d6\u5f97\u30a8\u30e9\u30fc:",t),p("\u6307\u5c0e\u54e1\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f"),b("error")}finally{g(!1)}var e},k=async()=>{try{g(!0);const e=c.length>0?c:[null===j||void 0===j?void 0:j.id].filter(Boolean),t=await function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=t?`?instructorIds=${t.join(",")}`:"";return He(`/api/users/satellite/${e}/home-support-users${n}`)}(y.id,e);t.success?(console.log("\u53d6\u5f97\u3057\u305f\u5229\u7528\u8005\u30c7\u30fc\u30bf:",t.data),l(t.data),m([])):(p("\u5229\u7528\u8005\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f"),b("error"))}catch(e){console.error("\u5229\u7528\u8005\u53d6\u5f97\u30a8\u30e9\u30fc:",e),p("\u5229\u7528\u8005\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f"),b("error")}finally{g(!1)}},S=async e=>{if(0===u.length)return p("\u5229\u7528\u8005\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"),void b("error");try{g(!0);const t=await((e,t)=>We("/api/users/bulk-update-home-support",{userIds:e,isRemoteUser:t}))(u,e);t.success?(p(t.message),b("success"),m([]),k(),s&&s(t.data)):(p(t.message||"\u5728\u5b85\u652f\u63f4\u30d5\u30e9\u30b0\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f"),b("error"))}catch(t){console.error("\u5728\u5b85\u652f\u63f4\u30d5\u30e9\u30b0\u66f4\u65b0\u30a8\u30e9\u30fc:",t),p("\u5728\u5b85\u652f\u63f4\u30d5\u30e9\u30b0\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f"),b("error")}finally{g(!1)}},_=()=>a,C=()=>{m([]),d([]),p(""),b(""),n()};return t?(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[95vh] flex flex-col",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\ud83d\udc65 \u5728\u5b85\u652f\u63f4\u5229\u7528\u8005\u8ffd\u52a0"}),(0,pt.jsxs)("div",{className:"flex items-center gap-2 text-gray-600 mt-2",children:[(0,pt.jsx)("span",{className:"text-lg",children:"\ud83d\udccd"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("p",{className:"font-medium",children:"\u901a\u6240\u5229\u7528\u8005\u3092\u5728\u5b85\u652f\u63f4\u5bfe\u8c61\u306b\u8ffd\u52a0"}),(0,pt.jsxs)("p",{className:"text-sm text-gray-500",children:["\u9078\u629e\u4e2d\u306e\u62e0\u70b9: ",(null===y||void 0===y?void 0:y.name)||"\u62e0\u70b9\u540d\u672a\u8a2d\u5b9a"]})]})]})]}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all duration-200",onClick:C,children:"\xd7"})]})}),h&&(0,pt.jsx)("div",{className:"success"===f?"bg-green-50 border-l-4 border-green-400 p-4":"bg-red-50 border-l-4 border-red-400 p-4",children:(0,pt.jsxs)("div",{className:"flex",children:[(0,pt.jsx)("div",{className:"flex-shrink-0",children:"success"===f?(0,pt.jsx)("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,pt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):(0,pt.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,pt.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,pt.jsx)("div",{className:"ml-3",children:(0,pt.jsx)("p",{className:"success"===f?"text-sm text-green-700":"text-sm text-red-700",children:h})})]})}),(0,pt.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[(0,pt.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-4",children:"\ud83d\udc68\u200d\ud83c\udfeb \u6307\u5c0e\u54e1\u9078\u629e"}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsx)("div",{className:"flex flex-wrap gap-3",children:o.map(e=>(0,pt.jsxs)("button",{onClick:()=>{return t=e.id,void d(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"px-4 py-2 rounded-xl font-medium transition-all duration-200 transform hover:scale-105 "+(c.includes(e.id)?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-lg":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-200"),children:[e.name," (",e.student_count,"\u540d)"]},e.id))}),(0,pt.jsxs)("p",{className:"text-sm text-gray-600",children:["\u9078\u629e\u4e2d\u306e\u6307\u5c0e\u54e1: ",c.length,"\u540d"]})]})]}),(0,pt.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6",children:[(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800",children:"\ud83d\udc64 \u5229\u7528\u8005\u4e00\u89a7"}),(0,pt.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,pt.jsx)("button",{onClick:()=>{const e=a.map(e=>e.id);m(e)},className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-xl font-medium transition-all duration-200",children:"\u5168\u9078\u629e"}),(0,pt.jsx)("button",{onClick:()=>{m([])},className:"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-xl font-medium transition-all duration-200",children:"\u9078\u629e\u89e3\u9664"}),(0,pt.jsx)("button",{onClick:()=>S(!0),disabled:0===u.length||x,className:"px-6 py-2 bg-green-500 hover:bg-green-600 disabled:bg-gray-300 text-white rounded-xl font-semibold transition-all duration-200",children:x?"\u51e6\u7406\u4e2d...":`${u.length}\u540d\u3092\u5728\u5b85\u652f\u63f4\u5bfe\u8c61\u306b\u8ffd\u52a0`})]})]}),x?(0,pt.jsxs)("div",{className:"text-center py-8",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,pt.jsx)("p",{className:"mt-4 text-gray-600",children:"\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]}):(0,pt.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:0===_().length?(0,pt.jsxs)("div",{className:"text-center py-8 text-gray-600",children:[(0,pt.jsx)("p",{children:"\u8868\u793a\u3059\u308b\u5229\u7528\u8005\u304c\u3044\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-sm mt-2",children:"\u6307\u5c0e\u54e1\u3092\u9078\u629e\u3059\u308b\u304b\u3001\u62e0\u70b9\u306b\u5229\u7528\u8005\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044"})]}):_().map(e=>(0,pt.jsx)("div",{className:"p-4 border rounded-xl transition-all duration-200 bg-white "+(u.includes(e.id)?"border-green-500 bg-green-50":"border-gray-200 hover:border-green-300"),children:(0,pt.jsxs)("div",{className:"flex items-start gap-4",children:[(0,pt.jsx)("input",{type:"checkbox",checked:u.includes(e.id),onChange:()=>{return t=e.id,void m(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"mt-1 w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsx)("h5",{className:"font-semibold text-gray-800",children:e.name}),(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[e.is_remote_user?(0,pt.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium",children:"\u5728\u5b85\u652f\u63f4\u5bfe\u8c61"}):null,(0,pt.jsx)("span",{className:"text-sm text-gray-500",children:e.login_code})]})]}),(0,pt.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-600",children:[(0,pt.jsxs)("span",{children:["\u62c5\u5f53\u6307\u5c0e\u54e1: ",e.instructor_name||"\u672a\u8a2d\u5b9a"]}),(0,pt.jsxs)("span",{children:["\u4f01\u696d: ",e.company_name||"\u672a\u8a2d\u5b9a"]})]})]})]})},e.id))}),(0,pt.jsxs)("div",{className:"mt-6 text-sm text-gray-600",children:[(0,pt.jsxs)("p",{children:["\u8868\u793a\u4e2d: ",_().length,"\u540d"]}),(0,pt.jsxs)("p",{children:["\u9078\u629e\u4e2d: ",u.length,"\u540d"]})]})]})]}),(0,pt.jsx)("div",{className:"p-6 border-t border-gray-200",children:(0,pt.jsx)("div",{className:"flex justify-end gap-4",children:(0,pt.jsx)("button",{className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-all duration-200",onClick:C,children:"\u9589\u3058\u308b"})})})]})}):null},Tn=()=>{const e=ne(),[t,n]=(0,r.useState)([]),[s,a]=(0,r.useState)(!1),[l,o]=(0,r.useState)(""),[i,c]=(0,r.useState)([]),[d,u]=(0,r.useState)("all"),[m,x]=(0,r.useState)(null),[g,h]=(0,r.useState)(!1),[p,f]=(0,r.useState)(!1),[b,y]=(0,r.useState)(!0),[v,j]=(0,r.useState)(null),[N,w]=(0,r.useState)(null);(0,r.useEffect)(()=>{const e=Ue();w(e);const t=sessionStorage.getItem("selectedSatellite");t?j(JSON.parse(t)):null!==e&&void 0!==e&&e.satellite_ids&&e.satellite_ids.length>0&&j({id:e.satellite_ids[0],name:"\u73fe\u5728\u306e\u62e0\u70b9"})},[]),(0,r.useEffect)(()=>{null!==v&&void 0!==v&&v.id&&k()},[v]),(0,r.useEffect)(()=>{const e=()=>{k()};return window.addEventListener("homeSupportUserAdded",e),()=>{window.removeEventListener("homeSupportUserAdded",e)}},[]);const k=async()=>{try{y(!0);const e=[null===N||void 0===N?void 0:N.id].filter(Boolean),t=await function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=t?`?instructorIds=${t.join(",")}`:"";return He(`/api/users/satellite/${e}/home-support-users-list${n}`)}(v.id,e);if(t.success){const e=t.data.map(e=>({id:e.id,name:e.name,instructorName:e.instructor_name||"\u672a\u8a2d\u5b9a",email:e.login_code||"\u672a\u8a2d\u5b9a",status:"active",progress:Math.floor(100*Math.random()),tags:["\u5728\u5b85\u652f\u63f4"],canStudyAtHome:!0}));n(e)}}catch(e){console.error("\u5728\u5b85\u652f\u63f4\u5229\u7528\u8005\u53d6\u5f97\u30a8\u30e9\u30fc:",e)}finally{y(!1)}},S=()=>{let e=t.filter(e=>e.canStudyAtHome);return l&&(e=e.filter(e=>e.name.toLowerCase().includes(l.toLowerCase())||e.email.toLowerCase().includes(l.toLowerCase())||e.class.toLowerCase().includes(l.toLowerCase())||e.instructorName.toLowerCase().includes(l.toLowerCase()))),i.length>0&&(e=e.filter(e=>i.every(t=>{var n;return null===(n=e.tags)||void 0===n?void 0:n.includes(t)}))),"all"!==d&&(e=e.filter(e=>e.status===d)),e},_=async e=>{var t;const{type:n,field:s,period:r}=e,a={weekly:{content:`${null===m||void 0===m?void 0:m.name}\u3055\u3093\u306e\u9031\u6b21\u8a55\u4fa1\u306b\u3064\u3044\u3066\n\n\u671f\u9593\uff1a${null===r||void 0===r?void 0:r.start} \uff5e ${null===r||void 0===r?void 0:r.end}\n\n\u5b66\u7fd2\u9032\u6357\uff1a\n\u30fb${null===m||void 0===m?void 0:m.class}\u306e\u5185\u5bb9\u3092\u7740\u5b9f\u306b\u7fd2\u5f97\n\u30fb\u57fa\u790e\u77e5\u8b58\u306e\u7406\u89e3\u304c\u6df1\u307e\u3063\u3066\u3044\u308b\n\u30fb\u5b9f\u8df5\u7684\u306a\u4f5c\u696d\u3082\u9806\u8abf\u306b\u9032\u3093\u3067\u3044\u308b\n\n\u4f53\u8abf\u7ba1\u7406\uff1a\n\u30fb\u826f\u597d\u306a\u72b6\u614b\u3092\u7dad\u6301\n\u30fb\u9069\u5207\u306a\u4f11\u61a9\u3092\u53d6\u3063\u3066\u3044\u308b\n\u30fb\u5b66\u7fd2\u610f\u6b32\u304c\u9ad8\u3044\n\n\u6b21\u56de\u76ee\u6a19\uff1a\n\u30fb\u3088\u308a\u9ad8\u5ea6\u306a\u5185\u5bb9\u3078\u306e\u6311\u6226\n\u30fb\u5b9f\u8df5\u7684\u306a\u30b9\u30ad\u30eb\u306e\u5411\u4e0a\n\u30fb\u7d99\u7d9a\u7684\u306a\u5b66\u7fd2\u7fd2\u6163\u306e\u7dad\u6301\n\n\u6307\u5c0e\u54e1\u304b\u3089\u306e\u30b3\u30e1\u30f3\u30c8\uff1a\n\u5b66\u7fd2\u614b\u5ea6\u304c\u975e\u5e38\u306b\u826f\u597d\u3067\u3001\u7740\u5b9f\u306b\u30b9\u30ad\u30eb\u30a2\u30c3\u30d7\u3057\u3066\u3044\u307e\u3059\u3002\u4eca\u5f8c\u3082\u7d99\u7d9a\u7684\u306a\u30b5\u30dd\u30fc\u30c8\u3092\u884c\u3044\u3001\u3055\u3089\u306a\u308b\u6210\u9577\u3092\u652f\u63f4\u3057\u3066\u3044\u304d\u307e\u3059\u3002`},monthly:{goal:`${null===m||void 0===m?void 0:m.class}\u306e\u7fd2\u5f97\u3068\u5b9f\u8df5\u7684\u306a\u30b9\u30ad\u30eb\u30a2\u30c3\u30d7`,work:`${null===m||void 0===m?void 0:m.class}\u306e\u5b66\u7fd2\u3068\u5b9f\u7fd2\u3001\u8ab2\u984c\u3078\u306e\u53d6\u308a\u7d44\u307f`,achievement:"\u57fa\u790e\u77e5\u8b58\u306e\u7fd2\u5f97\u304c\u3067\u304d\u3001\u5b9f\u8df5\u7684\u306a\u4f5c\u696d\u3082\u53ef\u80fd\u306b\u306a\u3063\u305f",issue:"\u3088\u308a\u9ad8\u5ea6\u306a\u5185\u5bb9\u3078\u306e\u7406\u89e3\u3092\u6df1\u3081\u308b\u5fc5\u8981\u304c\u3042\u308b",improve:"\u6bb5\u968e\u7684\u306a\u5b66\u7fd2\u3068\u5b9f\u8df5\u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u6307\u5c0e\u3092\u7d99\u7d9a",health:"\u4f53\u8abf\u7ba1\u7406\u3092\u9069\u5207\u306b\u884c\u3044\u3001\u7121\u7406\u306e\u306a\u3044\u5b66\u7fd2\u3092\u7d99\u7d9a",note:"\u5b66\u7fd2\u610f\u6b32\u304c\u9ad8\u304f\u3001\u7740\u5b9f\u306b\u30b9\u30ad\u30eb\u30a2\u30c3\u30d7\u3057\u3066\u3044\u308b",validity:"\u5728\u5b85\u5c31\u52b4\u306e\u7d99\u7d9a\u306f\u59a5\u5f53\u3002\u9069\u5207\u306a\u30b5\u30dd\u30fc\u30c8\u4f53\u5236\u3092\u7dad\u6301"}};return await new Promise(e=>setTimeout(e,500)),(null===(t=a[n])||void 0===t?void 0:t[s])||""},C=async e=>{var t;if(window.confirm(`${e.name}\u3055\u3093\u306e\u5728\u5b85\u652f\u63f4\u3092\u89e3\u9664\u3057\u307e\u3059\u304b\uff1f`))try{const n=await(t=e.id,Qe(`/api/users/${t}/remove-home-support`));n.success?(k(),window.dispatchEvent(new CustomEvent("homeSupportUserRemoved")),alert("\u5728\u5b85\u652f\u63f4\u3092\u89e3\u9664\u3057\u307e\u3057\u305f")):alert(`\u5728\u5b85\u652f\u63f4\u89e3\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${n.message}`)}catch(n){console.error("\u5728\u5b85\u652f\u63f4\u89e3\u9664\u30a8\u30e9\u30fc:",n),alert("\u5728\u5b85\u652f\u63f4\u89e3\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}};return(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-indigo-50 p-6",children:[(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100",children:(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("h2",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"\ud83d\udc65 \u5728\u5b85\u652f\u63f4\u5229\u7528\u8005\u4e00\u89a7"}),(0,pt.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,pt.jsx)("span",{className:"text-lg",children:"\ud83d\udccd"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("p",{className:"font-medium",children:"\u5728\u5b85\u652f\u63f4\u7ba1\u7406"}),(0,pt.jsx)("p",{className:"text-sm text-gray-500",children:"\u203b\u540c\u4e00\u62e0\u70b9\u306e\u4ed6\u306e\u6307\u5c0e\u54e1\u306e\u5229\u7528\u8005\u3082\u7ba1\u7406\u3067\u304d\u307e\u3059"})]})]})]}),(0,pt.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,pt.jsx)("button",{className:"px-6 py-3 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 flex items-center gap-2",onClick:()=>e("/instructor/daily-records"),children:"\ud83d\udcdd \u65e5\u6b21\u8a18\u9332\u4e00\u62ec"}),(0,pt.jsx)("button",{className:"px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 flex items-center gap-2",onClick:()=>a(!0),children:"+ \u5728\u5b85\u652f\u63f4\u5229\u7528\u8005\u3092\u8ffd\u52a0"})]})]})}),(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100",children:(0,pt.jsxs)("div",{className:"space-y-6",children:[(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,pt.jsx)("div",{className:"flex-1",children:(0,pt.jsxs)("div",{className:"relative",children:[(0,pt.jsx)("input",{type:"text",placeholder:"\u5229\u7528\u8005\u540d\u3001\u30e1\u30fc\u30eb\u3001\u30af\u30e9\u30b9\u3001\u6307\u5c0e\u54e1\u540d\u3067\u691c\u7d22...",value:l,onChange:e=>o(e.target.value),className:"w-full px-4 py-3 pl-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200"}),(0,pt.jsx)("span",{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400",children:"\ud83d\udd0d"})]})}),(0,pt.jsxs)("div",{className:"flex gap-3",children:[(0,pt.jsxs)("select",{value:d,onChange:e=>u(e.target.value),className:"px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all duration-200",children:[(0,pt.jsx)("option",{value:"all",children:"\u5168\u3066\u306e\u30b9\u30c6\u30fc\u30bf\u30b9"}),(0,pt.jsx)("option",{value:"active",children:"\u7a3c\u50cd\u4e2d"}),(0,pt.jsx)("option",{value:"inactive",children:"\u505c\u6b62\u4e2d"})]}),(0,pt.jsx)("button",{className:"px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-all duration-200",onClick:()=>{o(""),c([]),u("all")},children:"\u30af\u30ea\u30a2"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"\u30bf\u30b0\u30d5\u30a3\u30eb\u30bf\u30fc:"}),(0,pt.jsx)("div",{className:"flex flex-wrap gap-2",children:(()=>{const e=new Set;return t.forEach(t=>{var n;null===(n=t.tags)||void 0===n||n.forEach(t=>e.add(t))}),Array.from(e).sort()})().map(e=>(0,pt.jsx)("button",{className:"px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 transform hover:scale-105 "+(i.includes(e)?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-lg":"bg-gray-100 text-gray-700 hover:bg-gray-200"),onClick:()=>(e=>{c(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])})(e),children:e},e))})]})]})}),(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100",children:b?(0,pt.jsxs)("div",{className:"flex justify-center items-center p-12",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),(0,pt.jsx)("span",{className:"ml-2 text-gray-600",children:"\u5728\u5b85\u652f\u63f4\u5229\u7528\u8005\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]}):(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"w-full",children:[(0,pt.jsx)("thead",{className:"bg-gradient-to-r from-green-50 to-emerald-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-green-800 border-b border-green-200",children:"\u5229\u7528\u8005\u540d"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-green-800 border-b border-green-200",children:"\u30bf\u30b0"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-green-800 border-b border-green-200",children:"\u72b6\u614b"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-green-800 border-b border-green-200",children:"\u9032\u884c\u5ea6"}),(0,pt.jsx)("th",{className:"px-6 py-4 text-left text-sm font-semibold text-green-800 border-b border-green-200",children:"\u30a2\u30af\u30b7\u30e7\u30f3"})]})}),(0,pt.jsx)("tbody",{className:"divide-y divide-gray-100",children:0===S().length?(0,pt.jsx)("tr",{children:(0,pt.jsxs)("td",{colSpan:"5",className:"px-6 py-12 text-center text-gray-500",children:[(0,pt.jsx)("div",{className:"text-gray-400 text-6xl mb-4",children:"\ud83c\udfe0"}),(0,pt.jsx)("p",{className:"text-lg font-medium text-gray-600 mb-2",children:"\u5728\u5b85\u652f\u63f4\u5229\u7528\u8005\u304c\u3044\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-gray-500",children:"\u5728\u5b85\u652f\u63f4\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5229\u7528\u8005\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002"})]})}):S().map((t,n)=>{var s;return(0,pt.jsxs)("tr",{className:"hover:bg-gradient-to-r hover:from-green-50 hover:to-emerald-50 transition-all duration-200 "+(n%2===0?"bg-white":"bg-gray-50"),children:[(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsxs)("div",{className:"flex flex-col",children:[(0,pt.jsx)("span",{className:"font-semibold text-green-600",children:t.name}),(0,pt.jsxs)("span",{className:"text-sm text-gray-500",children:["\u62c5\u5f53: ",t.instructorName]})]})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsx)("div",{className:"flex flex-wrap gap-1",children:null===(s=t.tags)||void 0===s?void 0:s.map(e=>(0,pt.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full font-medium",children:e},e))})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold "+("active"===t.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"active"===t.status?"\u7a3c\u50cd\u4e2d":"\u505c\u6b62\u4e2d"})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsxs)("div",{className:"space-y-2",children:[(0,pt.jsx)("div",{className:"flex items-center justify-between text-sm",children:(0,pt.jsxs)("span",{className:"font-medium",children:[t.progress,"%"]})}),(0,pt.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,pt.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 "+(t.progress>=75?"bg-gradient-to-r from-green-400 to-green-600":t.progress>=50?"bg-gradient-to-r from-yellow-400 to-yellow-600":"bg-gradient-to-r from-red-400 to-red-600"),style:{width:`${t.progress}%`}})})]})}),(0,pt.jsx)("td",{className:"px-6 py-4",children:(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("button",{className:"px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-all duration-200 text-sm",onClick:()=>(e=>{x(e),h(!0)})(t),children:"\ud83d\udcca \u9031\u6b21\u8a55\u4fa1"}),(0,pt.jsx)("button",{className:"px-3 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-all duration-200 text-sm",onClick:()=>(e=>{x(e),f(!0)})(t),children:"\ud83d\udcc8 \u6708\u6b21\u8a55\u4fa1"}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>e(`/instructor/student-detail/${t.id}`),children:"\ud83d\udc64 \u5229\u7528\u8005\u8a73\u7d30"}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>e(`/instructor/student/${t.id}/daily-records`),children:"\ud83d\udcdd \u65e5\u6b21\u8a18\u9332"}),(0,pt.jsx)("button",{className:"px-3 py-2 bg-red-100 text-red-700 rounded-lg text-sm font-medium hover:bg-red-200 transition-all duration-200",onClick:()=>C(t),children:"\u89e3\u9664"})]})})]},t.id)})})]})})}),g&&m&&(0,pt.jsx)(kn,{isOpen:g,onClose:()=>{h(!1),x(null)},onSave:e=>{console.log("\u9031\u6b21\u8a55\u4fa1\u3092\u4fdd\u5b58:",e),h(!1),x(null)},prevEvalDate:new Date(Date.now()-6048e5).toISOString().split("T")[0],defaultInstructor:null===m||void 0===m?void 0:m.instructorName,aiAssist:_}),p&&m&&(0,pt.jsx)(Cn,{isOpen:p,onClose:()=>{f(!1),x(null)},onSave:e=>{console.log("\u6708\u6b21\u8a55\u4fa1\u3092\u4fdd\u5b58:",e),f(!1),x(null)},prevEvalDate:new Date(Date.now()-2592e6).toISOString().split("T")[0],defaultInstructor:null===m||void 0===m?void 0:m.instructorName,aiAssist:_}),(0,pt.jsx)(In,{isOpen:s,onClose:()=>a(!1),onSuccess:e=>{console.log("\u5728\u5b85\u652f\u63f4\u5229\u7528\u8005\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f:",e),k(),window.dispatchEvent(new CustomEvent("homeSupportUserAdded"))}})]})},Pn=()=>(0,pt.jsx)(Tn,{}),Ln=e=>{let{isOpen:t,onClose:n,onPasswordChange:s,user:a}=e;const[l,o]=(0,r.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),[i,c]=(0,r.useState)({}),[d,u]=(0,r.useState)(!1),m=e=>{const{name:t,value:n}=e.target;o(e=>({...e,[t]:n})),i[t]&&c(e=>({...e,[t]:""}))};return t?(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e=>e.stopPropagation(),children:(0,pt.jsxs)("div",{className:"bg-white rounded-lg p-8 max-w-md w-full mx-4 shadow-xl",children:[(0,pt.jsx)("div",{className:"mb-6",children:(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"\ud83d\udd10 \u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4"})}),(0,pt.jsxs)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,pt.jsxs)("div",{className:"flex items-center",children:[(0,pt.jsx)("span",{className:"text-red-600 mr-2",children:"\ud83d\udea8"}),(0,pt.jsx)("span",{className:"text-red-800 font-medium",children:"\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u5909\u66f4\u304c\u5fc5\u9808\u3067\u3059"})]}),(0,pt.jsx)("p",{className:"text-red-700 text-sm mt-2",children:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u305f\u3081\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4\u3059\u308b\u307e\u3067\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\u3002"})]}),(0,pt.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),c({}),u(!0);const t={};if(l.currentPassword||(t.currentPassword="\u73fe\u5728\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),l.newPassword){const e=(e=>{const t=[];return e.length<8&&t.push("8\u6587\u5b57\u4ee5\u4e0a\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),/[A-Z]/.test(e)||t.push("\u5927\u6587\u5b57\u3092\u542b\u3081\u3066\u304f\u3060\u3055\u3044"),/[a-z]/.test(e)||t.push("\u5c0f\u6587\u5b57\u3092\u542b\u3081\u3066\u304f\u3060\u3055\u3044"),/[0-9]/.test(e)||t.push("\u6570\u5b57\u3092\u542b\u3081\u3066\u304f\u3060\u3055\u3044"),t})(l.newPassword);e.length>0&&(t.newPassword=e.join(", "))}else t.newPassword="\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044";if(l.confirmPassword?l.newPassword!==l.confirmPassword&&(t.confirmPassword="\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u4e00\u81f4\u3057\u307e\u305b\u3093"):t.confirmPassword="\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u78ba\u8a8d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",Object.keys(t).length>0)return c(t),void u(!1);try{await s(l.currentPassword,l.newPassword),o({currentPassword:"",newPassword:"",confirmPassword:""}),c({}),n()}catch(r){console.error("\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u306b\u5931\u6557:",r)}finally{u(!1)}},className:"space-y-4",children:[(0,pt.jsxs)("div",{className:"flex flex-col",children:[(0,pt.jsxs)("label",{htmlFor:"currentPassword",className:"text-gray-700 font-medium mb-1",children:["\u73fe\u5728\u306e\u30d1\u30b9\u30ef\u30fc\u30c9 ",(0,pt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,pt.jsx)(Ct,{type:"password",id:"currentPassword",name:"currentPassword",value:l.currentPassword,onChange:m,sanitizeMode:_t.NONE,className:"px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 "+(i.currentPassword?"border-red-500 focus:ring-red-500":"")}),i.currentPassword&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.currentPassword})]}),(0,pt.jsxs)("div",{className:"flex flex-col",children:[(0,pt.jsxs)("label",{htmlFor:"newPassword",className:"text-gray-700 font-medium mb-1",children:["\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9 ",(0,pt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,pt.jsx)(Ct,{type:"password",id:"newPassword",name:"newPassword",value:l.newPassword,onChange:m,sanitizeMode:_t.NONE,className:"px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 "+(i.newPassword?"border-red-500 focus:ring-red-500":"")}),i.newPassword&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.newPassword}),(0,pt.jsx)("div",{className:"text-gray-500 text-sm mt-1",children:"\u30d1\u30b9\u30ef\u30fc\u30c9\u8981\u4ef6: 8\u6587\u5b57\u4ee5\u4e0a\u3001\u5927\u6587\u5b57\u30fb\u5c0f\u6587\u5b57\u30fb\u6570\u5b57\u3092\u542b\u3080"})]}),(0,pt.jsxs)("div",{className:"flex flex-col",children:[(0,pt.jsxs)("label",{htmlFor:"confirmPassword",className:"text-gray-700 font-medium mb-1",children:["\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9\uff08\u78ba\u8a8d\uff09 ",(0,pt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,pt.jsx)(Ct,{type:"password",id:"confirmPassword",name:"confirmPassword",value:l.confirmPassword,onChange:m,sanitizeMode:_t.NONE,className:"px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 "+(i.confirmPassword?"border-red-500 focus:ring-red-500":"")}),i.confirmPassword&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:i.confirmPassword})]}),(0,pt.jsx)("div",{className:"flex justify-end gap-3 pt-4",children:(0,pt.jsx)("button",{type:"submit",disabled:d,className:"px-6 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed",children:d?"\u5909\u66f4\u4e2d...":"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4"})})]})]})}):null},En=()=>{const{currentUser:e}=bt(),[t,n]=(0,r.useState)([]),[s,a]=(0,r.useState)(null),[l,o]=(0,r.useState)([]),[i,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)(0),g=async()=>{try{u(!0);const e=await He("/api/messages/conversations");if(e.success&&e.data){const t=Array.isArray(e.data)?e.data:[];n(t)}else n([])}catch(e){console.error("\u4f1a\u8a71\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",e),n([])}finally{u(!1)}},h=async()=>{try{const e=await He("/api/messages/unread-count");e.success&&x(e.data.unread_count)}catch(e){console.error("\u672a\u8aad\u30e1\u30c3\u30bb\u30fc\u30b8\u6570\u53d6\u5f97\u30a8\u30e9\u30fc:",e)}},p=async e=>{try{u(!0);const t=await He(`/api/messages/conversation/${e}`);if(t.success&&t.data){const e=Array.isArray(t.data)?t.data:[];o(e)}else o([])}catch(t){console.error("\u30e1\u30c3\u30bb\u30fc\u30b8\u5c65\u6b74\u53d6\u5f97\u30a8\u30e9\u30fc:",t),o([])}finally{u(!1)}};(0,r.useEffect)(()=>{e&&(g(),h())},[e]);return console.log("PersonalMessageList - user object:",e),console.log("PersonalMessageList - user type:",typeof e),console.log("PersonalMessageList - user keys:",e?Object.keys(e):"user is null/undefined"),e?(0,pt.jsxs)("div",{className:"space-y-4",children:[m>0&&(0,pt.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,pt.jsxs)("span",{className:"text-blue-800 text-sm",children:["\ud83d\udcec \u672a\u8aad\u30e1\u30c3\u30bb\u30fc\u30b8 ",m,"\u4ef6"]})}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,pt.jsx)("div",{className:"lg:col-span-1",children:(0,pt.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,pt.jsx)("h3",{className:"font-semibold text-gray-800 mb-3",children:"\u4f1a\u8a71\u4e00\u89a7"}),(0,pt.jsx)("div",{className:"max-h-64 overflow-y-auto space-y-2",children:d?(0,pt.jsx)("div",{className:"text-center text-gray-500 text-sm",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."}):0===t.length?(0,pt.jsx)("div",{className:"text-center text-gray-500 text-sm",children:"\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u3042\u308a\u307e\u305b\u3093"}):t.filter(e=>e&&e.other_user_id).map(e=>{return(0,pt.jsx)("div",{className:"p-3 rounded-lg cursor-pointer transition-colors "+((null===s||void 0===s?void 0:s.other_user_id)===e.other_user_id?"bg-blue-100 border border-blue-300":"bg-white hover:bg-gray-100"),onClick:()=>(e=>{a(e),p(e.other_user_id)})(e),children:(0,pt.jsxs)("div",{className:"flex justify-between items-start",children:[(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("p",{className:"font-medium text-sm text-gray-800",children:e.other_user_name}),(0,pt.jsx)("p",{className:"text-xs text-gray-500",children:4===e.other_user_role?"\u6307\u5c0e\u54e1":"\u5229\u7528\u8005"}),(0,pt.jsx)("p",{className:"text-xs text-gray-400",children:(t=e.last_message_at,(0,Pt.yJ)(t,{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}))})]}),e.unread_count>0&&(0,pt.jsx)("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full",children:e.unread_count})]})},e.other_user_id);var t})})]})}),(0,pt.jsx)("div",{className:"lg:col-span-2",children:s?(0,pt.jsxs)("div",{className:"bg-gray-50 rounded-lg h-80 flex flex-col",children:[(0,pt.jsx)("div",{className:"p-3 border-b bg-white rounded-t-lg",children:(0,pt.jsxs)("h4",{className:"font-semibold text-gray-800",children:[s.other_user_name,(0,pt.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["(",4===s.other_user_role?"\u6307\u5c0e\u54e1":"\u5229\u7528\u8005",")"]})]})}),(0,pt.jsx)("div",{className:"flex-1 overflow-y-auto p-3 space-y-3",children:d?(0,pt.jsx)("div",{className:"text-center text-gray-500 text-sm",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."}):0===l.length?(0,pt.jsx)("div",{className:"text-center text-gray-500 text-sm",children:"\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u3042\u308a\u307e\u305b\u3093"}):l.filter(e=>e&&e.id).map(t=>{return(0,pt.jsx)("div",{className:"flex "+(t.sender_id===(null===e||void 0===e?void 0:e.id)?"justify-end":"justify-start"),children:(0,pt.jsxs)("div",{className:"max-w-xs px-3 py-2 rounded-lg text-sm "+(t.sender_id===(null===e||void 0===e?void 0:e.id)?"bg-blue-500 text-white":"bg-white text-gray-800 border"),children:[(0,pt.jsx)("p",{children:t.message}),(0,pt.jsx)("p",{className:"text-xs mt-1 "+(t.sender_id===(null===e||void 0===e?void 0:e.id)?"text-blue-100":"text-gray-500"),children:(n=t.created_at,(0,Pt.yJ)(n,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}))})]})},t.id);var n})}),(0,pt.jsx)("form",{onSubmit:async t=>{if(t.preventDefault(),i.trim()&&s&&e)try{(await We("/api/messages/send",{receiver_id:s.other_user_id,message:wt(i.trim())})).success&&(c(""),p(s.other_user_id),g(),h())}catch(n){console.error("\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u30a8\u30e9\u30fc:",n)}},className:"p-3 border-t bg-white rounded-b-lg",children:(0,pt.jsxs)("div",{className:"flex space-x-2",children:[(0,pt.jsx)("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"}),(0,pt.jsx)("button",{type:"submit",disabled:!i.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-sm",children:"\u9001\u4fe1"})]})})]}):(0,pt.jsx)("div",{className:"bg-gray-50 rounded-lg h-80 flex items-center justify-center",children:(0,pt.jsx)("div",{className:"text-center text-gray-500",children:(0,pt.jsx)("p",{className:"text-sm",children:"\u4f1a\u8a71\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"})})})})]})]}):(0,pt.jsx)("div",{className:"space-y-4",children:(0,pt.jsx)("div",{className:"text-center text-gray-500 text-sm py-4",children:"\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})})},Dn=e=>{let{onFilterChange:t,onUsersLoad:n,apiEndpoint:s,showInstructorFilter:a=!0,showTagFilter:l=!0,showNameFilter:o=!0,className:i=""}=e;const{currentUser:c}=bt(),[d,u]=(0,r.useState)({instructor_filter:"all",name_filter:"",tag_filter:""}),[m,x]=(0,r.useState)(!1),[g,h]=(0,r.useState)([]),[p,f]=(0,r.useState)([]),[b,y]=(0,r.useState)([]),v=(e,n)=>{const s={...d,[e]:n};u(s),t&&t(s),"instructor_filter"===e&&"specific"!==n&&y([])};return(0,r.useEffect)(()=>{a&&(async()=>{try{const e=s.includes("/announcements/")?"/api/announcements/admin/instructors-for-filter":"/api/messages/instructors-for-filter",t=Qt(c),n=new URLSearchParams;t&&n.append("satellite_id",t);const r=n.toString()?`${e}?${n.toString()}`:e,a=await He(r);a.success&&f(a.data)}catch(e){console.error("\u6307\u5c0e\u54e1\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",e),f([])}})()},[a]),(0,r.useEffect)(()=>{(async()=>{try{x(!0);const e=new URLSearchParams,t=Qt(c);t&&e.append("satellite_id",t),"all"!==d.instructor_filter&&(e.append("instructor_filter",d.instructor_filter),"specific"===d.instructor_filter&&b.length>0&&e.append("instructor_ids",b.map(e=>e.id).join(","))),d.name_filter&&e.append("name_filter",d.name_filter),d.tag_filter&&e.append("tag_filter",d.tag_filter);const r=await He(`${s}?${e.toString()}`);r.success&&(h(r.data),n&&n(r.data))}catch(e){console.error("\u5229\u7528\u8005\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",e),h([]),n&&n([])}finally{x(!1)}})()},[d,b,s]),(0,pt.jsxs)("div",{className:`space-y-3 ${i}`,children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("h4",{className:"text-sm font-medium text-gray-700",children:"\u30d5\u30a3\u30eb\u30bf\u30fc"}),(0,pt.jsx)("button",{type:"button",onClick:()=>{const e={instructor_filter:"all",name_filter:"",tag_filter:""};u(e),y([]),t&&t(e)},className:"text-xs text-blue-600 hover:text-blue-800",children:"\u30ea\u30bb\u30c3\u30c8"})]}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[a&&(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"\u62c5\u5f53\u6307\u5c0e\u54e1"}),(0,pt.jsxs)("select",{value:d.instructor_filter,onChange:e=>v("instructor_filter",e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,pt.jsx)("option",{value:"all",children:"\u3059\u3079\u3066"}),(0,pt.jsx)("option",{value:"my",children:"\u81ea\u5206\u306e\u62c5\u5f53"}),(0,pt.jsx)("option",{value:"other",children:"\u4ed6\u6307\u5c0e\u54e1\u306e\u62c5\u5f53"}),(0,pt.jsx)("option",{value:"specific",children:"\u7279\u5b9a\u306e\u6307\u5c0e\u54e1\u306e\u62c5\u5f53"}),(0,pt.jsx)("option",{value:"none",children:"\u62c5\u5f53\u306a\u3057"})]})]}),o&&(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"\u540d\u524d\u691c\u7d22"}),(0,pt.jsx)("input",{type:"text",value:d.name_filter,onChange:e=>v("name_filter",e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"\u540d\u524d\u3067\u691c\u7d22"})]}),l&&(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"\u30bf\u30b0\u691c\u7d22"}),(0,pt.jsx)("input",{type:"text",value:d.tag_filter,onChange:e=>v("tag_filter",e.target.value),className:"w-full px-2 py-1 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"\u30bf\u30b0\u3067\u691c\u7d22"})]})]}),a&&"specific"===d.instructor_filter&&(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"\u9078\u629e\u3059\u308b\u6307\u5c0e\u54e1"}),0===p.length?(0,pt.jsx)("p",{className:"text-xs text-gray-500",children:"\u540c\u3058\u62e0\u70b9\u306e\u6307\u5c0e\u54e1\u304c\u3044\u307e\u305b\u3093"}):(0,pt.jsx)("div",{className:"grid grid-cols-1 gap-1 max-h-32 overflow-y-auto border border-gray-200 rounded-lg p-2",children:p.map(e=>(0,pt.jsxs)("label",{className:"flex items-center space-x-2 text-xs",children:[(0,pt.jsx)("input",{type:"checkbox",checked:b.some(t=>t.id===e.id),onChange:()=>(e=>{y(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])})(e),className:"h-3 w-3 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,pt.jsxs)("span",{className:"flex-1",children:[e.name,e.satellite_name&&` (${e.satellite_name})`]})]},e.id))}),b.length>0&&(0,pt.jsxs)("div",{className:"mt-2 text-xs text-blue-600",children:["\u9078\u629e\u4e2d: ",b.map(e=>e.name).join(", ")]})]}),(0,pt.jsx)("div",{className:"text-xs text-gray-600",children:m?(0,pt.jsx)("span",{children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."}):(0,pt.jsxs)("span",{children:[g.length,"\u540d\u306e\u5229\u7528\u8005\u304c\u898b\u3064\u304b\u308a\u307e\u3057\u305f",g.some(e=>e.is_my_assigned)&&(0,pt.jsxs)("span",{className:"text-blue-600 ml-1",children:["\uff08",g.filter(e=>e.is_my_assigned).length,"\u540d\u304c\u81ea\u5206\u306e\u62c5\u5f53\uff09"]})]})})]})},An=()=>{const{currentUser:e}=bt(),[t,n]=(0,r.useState)([]),[s,a]=(0,r.useState)(null),[l,o]=(0,r.useState)(""),[i,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)(!1);return(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),s&&l.trim())try{u(!0);(await We("/api/messages/send",{receiver_id:s.id,message:wt(l.trim())})).success?(alert("\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3057\u307e\u3057\u305f\u3002"),o(""),a(null)):alert("\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}catch(t){console.error("\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u30a8\u30e9\u30fc:",t),alert("\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}finally{u(!1)}else alert("\u5229\u7528\u8005\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002")},className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u9001\u4fe1\u5148\u5229\u7528\u8005 *"}),(0,pt.jsx)("button",{type:"button",onClick:()=>x(!m),className:"px-3 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm",children:m?"\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u9589\u3058\u308b":"\u30d5\u30a3\u30eb\u30bf\u30fc"})]}),m&&(0,pt.jsx)("div",{className:"mb-3 p-3 border border-gray-300 rounded-lg bg-gray-50",children:(0,pt.jsx)(Dn,{onFilterChange:e=>{},onUsersLoad:e=>{n(e)},apiEndpoint:"/api/messages/students",showInstructorFilter:!0,showTagFilter:!0,showNameFilter:!0})}),(0,pt.jsxs)("select",{value:(null===s||void 0===s?void 0:s.id)||"",onChange:e=>{const n=parseInt(e.target.value),s=t.find(e=>e.id===n);a(s||null)},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[(0,pt.jsx)("option",{value:"",children:"\u5229\u7528\u8005\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),t.map(e=>(0,pt.jsxs)("option",{value:e.id,children:[e.name,e.is_my_assigned&&" \u2605",e.satellite_name&&` (${e.satellite_name})`,e.company_name&&` - ${e.company_name}`,e.instructor_name&&` [\u62c5\u5f53: ${e.instructor_name}]`]},e.id))]})]}),s&&(0,pt.jsxs)("div",{className:"p-3 bg-blue-50 rounded-lg",children:[(0,pt.jsx)("h4",{className:"font-medium text-blue-800 mb-2 text-sm",children:"\u9001\u4fe1\u5148\u60c5\u5831"}),(0,pt.jsxs)("div",{className:"text-sm text-blue-700",children:[(0,pt.jsxs)("p",{children:[(0,pt.jsx)("strong",{children:"\u540d\u524d:"})," ",s.name]}),s.email&&(0,pt.jsxs)("p",{children:[(0,pt.jsx)("strong",{children:"\u30e1\u30fc\u30eb:"})," ",s.email]}),(0,pt.jsxs)("p",{children:[(0,pt.jsx)("strong",{children:"\u30ed\u30b0\u30a4\u30f3\u30b3\u30fc\u30c9:"})," ",s.login_code]}),s.satellite_name&&(0,pt.jsxs)("p",{children:[(0,pt.jsx)("strong",{children:"\u62e0\u70b9:"})," ",s.satellite_name]}),s.company_name&&(0,pt.jsxs)("p",{children:[(0,pt.jsx)("strong",{children:"\u4f01\u696d:"})," ",s.company_name]}),s.instructor_name&&(0,pt.jsxs)("p",{children:[(0,pt.jsx)("strong",{children:"\u62c5\u5f53\u6307\u5c0e\u54e1:"})," ",s.instructor_name]}),s.tags&&(0,pt.jsxs)("p",{children:[(0,pt.jsx)("strong",{children:"\u30bf\u30b0:"})," ","string"===typeof s.tags?s.tags:s.tags.join(", ")]})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30e1\u30c3\u30bb\u30fc\u30b8 *"}),(0,pt.jsx)("textarea",{value:l,onChange:e=>o(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"}),(0,pt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"\u203b \u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u5f53\u65e5\u306e24:30\u306b\u81ea\u52d5\u524a\u9664\u3055\u308c\u307e\u3059"})]}),(0,pt.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,pt.jsx)("button",{type:"button",onClick:()=>{o(""),a(null)},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm",children:"\u30ea\u30bb\u30c3\u30c8"}),(0,pt.jsx)("button",{type:"submit",disabled:d||!s||!l.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-sm",children:d?"\u9001\u4fe1\u4e2d...":"\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1"})]})]}),t.length>0&&(0,pt.jsxs)("div",{className:"mt-4",children:[(0,pt.jsxs)("h4",{className:"text-sm font-medium mb-2 text-gray-700",children:["\u5229\u7528\u8005\u4e00\u89a7 (",t.length,"\u540d)"]}),(0,pt.jsx)("div",{className:"grid grid-cols-1 gap-2 max-h-32 overflow-y-auto",children:t.map(e=>(0,pt.jsx)("div",{className:"p-2 border rounded-lg cursor-pointer transition-colors text-sm "+((null===s||void 0===s?void 0:s.id)===e.id?"border-blue-500 bg-blue-50":e.is_my_assigned?"border-green-300 bg-green-50":"border-gray-200 hover:bg-gray-50"),onClick:()=>a(e),children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("p",{className:"font-medium",children:[e.name,e.is_my_assigned&&" \u2605"]}),(0,pt.jsxs)("p",{className:"text-xs text-gray-500",children:[e.satellite_name&&`${e.satellite_name} | `,e.company_name,e.instructor_name&&` | \u62c5\u5f53: ${e.instructor_name}`]})]}),e.tags&&(0,pt.jsx)("div",{className:"flex flex-wrap gap-1 ml-2",children:("string"===typeof e.tags?e.tags.split(","):e.tags).slice(0,2).map((e,t)=>(0,pt.jsx)("span",{className:"px-1 py-0.5 bg-gray-200 text-xs rounded",children:e.trim()},t))})]})},e.id))})]})]})},$n=()=>{const{currentUser:e}=bt(),[t,n]=(0,r.useState)(""),[s,a]=(0,r.useState)(""),[l,o]=(0,r.useState)([]),[i,c]=(0,r.useState)([]),[d,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)(!1),[g,h]=(0,r.useState)(!1),p=e=>{o(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])};return(0,pt.jsx)("div",{className:"space-y-4",children:(0,pt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),t.trim()&&s.trim()&&0!==l.length)try{x(!0);const e=await We("/api/announcements/admin/create",{title:wt(t.trim()),message:wt(s.trim()),recipient_ids:l.map(e=>e.id)});e.success?(alert("\u30a2\u30ca\u30a6\u30f3\u30b9\u3092\u9001\u4fe1\u3057\u307e\u3057\u305f\u3002"),n(""),a(""),o([])):alert("\u30a2\u30ca\u30a6\u30f3\u30b9\u306e\u9001\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}catch(r){console.error("\u30a2\u30ca\u30a6\u30f3\u30b9\u9001\u4fe1\u30a8\u30e9\u30fc:",r),alert("\u30a2\u30ca\u30a6\u30f3\u30b9\u306e\u9001\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}finally{x(!1)}else alert("\u30bf\u30a4\u30c8\u30eb\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u3001\u53d7\u4fe1\u8005\u3092\u3059\u3079\u3066\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002")},className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30bf\u30a4\u30c8\u30eb *"}),(0,pt.jsx)("input",{type:"text",value:t,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"\u30a2\u30ca\u30a6\u30f3\u30b9\u306e\u30bf\u30a4\u30c8\u30eb\u3092\u5165\u529b",maxLength:255})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30e1\u30c3\u30bb\u30fc\u30b8 *"}),(0,pt.jsx)("textarea",{value:s,onChange:e=>a(e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",placeholder:"\u30a2\u30ca\u30a6\u30f3\u30b9\u306e\u5185\u5bb9\u3092\u5165\u529b"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\u53d7\u4fe1\u8005\u9078\u629e *"}),(0,pt.jsx)("button",{type:"button",onClick:()=>h(!g),className:"px-3 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm",children:g?"\u9589\u3058\u308b":"\u53d7\u4fe1\u8005\u3092\u9078\u629e"})]}),l.length>0&&(0,pt.jsxs)("div",{className:"mb-3 p-3 bg-blue-50 rounded-lg",children:[(0,pt.jsxs)("p",{className:"text-sm text-blue-800 mb-2",children:["\u9078\u629e\u6e08\u307f: ",l.length,"\u540d"]}),(0,pt.jsx)("div",{className:"flex flex-wrap gap-2",children:l.map(e=>(0,pt.jsxs)("span",{className:"inline-flex items-center px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs",children:[e.name,(0,pt.jsx)("button",{type:"button",onClick:()=>p(e),className:"ml-1 text-blue-600 hover:text-blue-800",children:"\xd7"})]},e.id))})]}),g&&(0,pt.jsxs)("div",{className:"border border-gray-300 rounded-lg p-3",children:[(0,pt.jsx)("div",{className:"mb-3 p-3 border border-gray-300 rounded-lg bg-gray-50",children:(0,pt.jsx)(Dn,{onFilterChange:e=>{},onUsersLoad:e=>{c(e)},apiEndpoint:"/api/announcements/admin/users",showInstructorFilter:4===(null===e||void 0===e?void 0:e.role),showTagFilter:!0,showNameFilter:!0})}),(0,pt.jsx)("div",{className:"mb-3",children:(0,pt.jsx)("button",{type:"button",onClick:()=>{l.length===i.length?o([]):o([...i])},className:"px-3 py-1 bg-gray-500 text-white rounded-lg hover:bg-gray-600 text-sm",children:l.length===i.length?"\u5168\u89e3\u9664":"\u5168\u9078\u629e"})}),(0,pt.jsx)("div",{className:"max-h-48 overflow-y-auto border border-gray-200 rounded-lg",children:d?(0,pt.jsx)("div",{className:"p-3 text-center text-gray-500 text-sm",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."}):0===i.length?(0,pt.jsx)("div",{className:"p-3 text-center text-gray-500 text-sm",children:"\u5229\u7528\u8005\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093"}):(0,pt.jsx)("div",{className:"divide-y divide-gray-200",children:i.map(e=>(0,pt.jsx)("div",{className:"p-2 cursor-pointer hover:bg-gray-50 text-sm "+(l.some(t=>t.id===e.id)?"bg-blue-50":e.is_my_assigned?"bg-green-50":""),onClick:()=>p(e),children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("p",{className:"font-medium",children:[e.name,e.is_my_assigned&&" \u2605"]}),(0,pt.jsxs)("p",{className:"text-xs text-gray-500",children:[1===e.role?"\u5229\u7528\u8005":"\u6307\u5c0e\u54e1"," |",e.company_name&&` ${e.company_name}`,e.satellite_name&&` | ${e.satellite_name}`,e.instructor_name&&` | \u62c5\u5f53: ${e.instructor_name}`]}),e.tags&&(0,pt.jsx)("div",{className:"flex flex-wrap gap-1 mt-1",children:("string"===typeof e.tags?e.tags.split(","):e.tags).slice(0,3).map((e,t)=>(0,pt.jsx)("span",{className:"px-1 py-0.5 bg-gray-200 text-xs rounded",children:e.trim()},t))})]}),(0,pt.jsx)("input",{type:"checkbox",checked:l.some(t=>t.id===e.id),onChange:()=>p(e),className:"h-3 w-3 text-blue-600 focus:ring-blue-500 border-gray-300 rounded ml-2"})]})},e.id))})})]})]}),(0,pt.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,pt.jsx)("button",{type:"button",onClick:()=>{n(""),a(""),o([])},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm",children:"\u30ea\u30bb\u30c3\u30c8"}),(0,pt.jsx)("button",{type:"submit",disabled:m||!t.trim()||!s.trim()||0===l.length,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed text-sm",children:m?"\u9001\u4fe1\u4e2d...":"\u30a2\u30ca\u30a6\u30f3\u30b9\u9001\u4fe1"})]})]})})},zn=()=>{const{currentUser:e}=bt(),[t,n]=(0,r.useState)([]),[s,a]=(0,r.useState)(!1),[l,o]=(0,r.useState)(null),[i,c]=(0,r.useState)(!1),d=async()=>{try{a(!0);const t=sessionStorage.getItem("selectedSatellite");let s=null;if(t)try{s=JSON.parse(t).id}catch(e){console.error("\u62e0\u70b9\u60c5\u5831\u306e\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",e)}const r=new URLSearchParams;s&&r.append("selected_satellite_id",s);const l="/api/announcements/admin"+(r.toString()?"?"+r.toString():"");console.log("\u30a2\u30ca\u30a6\u30f3\u30b9\u53d6\u5f97URL:",l);const o=await He(l);if(o.success&&o.data){const e=Array.isArray(o.data.announcements)?o.data.announcements:[];n(e)}else n([])}catch(e){console.error("\u30a2\u30ca\u30a6\u30f3\u30b9\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",e),n([])}finally{a(!1)}},u=e=>(0,Pt.yJ)(e,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return(0,r.useEffect)(()=>{d();const e=()=>{console.log("\u62e0\u70b9\u5207\u308a\u66ff\u3048\u3092\u691c\u77e5\u3001\u30a2\u30ca\u30a6\u30f3\u30b9\u4e00\u89a7\u3092\u518d\u53d6\u5f97\u3057\u307e\u3059"),d()};return window.addEventListener("satelliteChanged",e),()=>{window.removeEventListener("satelliteChanged",e)}},[]),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800",children:"\u9001\u4fe1\u6e08\u307f\u30a2\u30ca\u30a6\u30f3\u30b9"}),(0,pt.jsx)("button",{onClick:d,className:"px-3 py-1 bg-blue-500 text-white rounded-lg hover:bg-blue-600 text-sm",children:"\u66f4\u65b0"})]}),s?(0,pt.jsx)("div",{className:"text-center text-gray-500 text-sm py-4",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."}):0===t.length?(0,pt.jsx)("div",{className:"text-center text-gray-500 text-sm py-4",children:"\u9001\u4fe1\u6e08\u307f\u306e\u30a2\u30ca\u30a6\u30f3\u30b9\u306f\u3042\u308a\u307e\u305b\u3093"}):(0,pt.jsx)("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:t.filter(e=>e&&e.id).map(e=>(0,pt.jsxs)("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-4 border border-gray-200 hover:shadow-md transition-all duration-200",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,pt.jsx)("h5",{className:"font-semibold text-gray-800 text-sm",children:e.title}),(0,pt.jsx)("span",{className:"text-xs text-gray-500",children:u(e.created_at)})]}),(0,pt.jsx)("p",{className:"text-gray-700 text-sm mb-2 line-clamp-2",children:e.message}),(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsxs)("div",{className:"flex gap-4 text-xs text-gray-600",children:[(0,pt.jsxs)("span",{children:["\u53d7\u4fe1\u8005: ",e.recipient_count,"\u540d"]}),(0,pt.jsxs)("span",{children:["\u65e2\u8aad: ",e.read_count,"\u540d"]})]}),(0,pt.jsx)("button",{onClick:()=>(async e=>{try{const t=await He(`/api/announcements/admin/${e}`);t.success&&(o(t.data),c(!0))}catch(t){console.error("\u30a2\u30ca\u30a6\u30f3\u30b9\u8a73\u7d30\u53d6\u5f97\u30a8\u30e9\u30fc:",t)}})(e.id),className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-3 py-1 rounded-lg font-medium shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 text-sm",children:"\u8a73\u7d30\u3092\u898b\u308b"})]})]},e.id))}),i&&l&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u30a2\u30ca\u30a6\u30f3\u30b9\u8a73\u7d30"}),(0,pt.jsx)("button",{onClick:()=>c(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\xd7"})]}),(0,pt.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 rounded-lg",children:[(0,pt.jsx)("h4",{className:"font-semibold text-blue-800 mb-2",children:l.announcement.title}),(0,pt.jsx)("p",{className:"text-gray-800 mb-2",children:l.announcement.message}),(0,pt.jsxs)("p",{className:"text-sm text-gray-600",children:["\u9001\u4fe1\u65e5\u6642: ",u(l.announcement.created_at)]}),(0,pt.jsxs)("p",{className:"text-sm text-gray-600",children:["\u4f5c\u6210\u8005: ",l.announcement.created_by_name]})]}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsxs)("h4",{className:"font-semibold text-gray-800 mb-2",children:["\u53d7\u4fe1\u8005\u4e00\u89a7 (",l.recipients.length,"\u540d)"]}),(0,pt.jsx)("div",{className:"max-h-48 overflow-y-auto border border-gray-200 rounded-lg",children:l.recipients.filter(e=>e&&e.id).map(e=>(0,pt.jsx)("div",{className:"p-3 border-b border-gray-100 last:border-b-0",children:(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("p",{className:"font-medium text-sm text-gray-800",children:e.name}),(0,pt.jsxs)("p",{className:"text-xs text-gray-500",children:[e.company_name&&`${e.company_name} | `,e.satellite_name]})]}),(0,pt.jsxs)("div",{className:"text-right",children:[(0,pt.jsx)("span",{className:"text-xs px-2 py-1 rounded "+(e.is_read?"bg-green-100 text-green-600":"bg-orange-100 text-orange-600"),children:e.is_read?"\u65e2\u8aad":"\u672a\u8aad"}),e.read_at&&(0,pt.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:u(e.read_at)})]})]})},e.id))})]})]})})]})},On=()=>{console.log("=== InstructorDashboard Component Mounted ==="),console.log("Current location:",window.location.href),console.log("Current pathname:",window.location.pathname),console.log("Current hash:",window.location.hash);const[e,t]=(0,r.useState)(()=>{const e=sessionStorage.getItem("instructorDashboardActiveTab");return e&&["overview","students","location","home-support","learning-preview","settings"].includes(e)?e:"overview"}),[n,s]=(0,r.useState)(!1),[a,l]=(0,r.useState)(!1),[o,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null),[u,m]=(0,r.useState)(!1),[x,g]=(0,r.useState)(!1),[h,p]=(0,r.useState)(null),[f,b]=(0,r.useState)(null),[y,v]=(0,r.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),[j,N]=(0,r.useState)({}),[w,k]=(0,r.useState)(!1),[S,_]=(0,r.useState)([]),[C,I]=(0,r.useState)(null),[T,P]=(0,r.useState)(""),[L,E]=(0,r.useState)(!1),[D,A]=(0,r.useState)(!1),[$,z]=(0,r.useState)({name:"",email:"",specializations:[]}),O=(ne(),ee()),{currentUser:R,logout:M}=(()=>{const{isAuthenticated:e,isLoading:t,currentUser:n}=bt(),s=ne();return(0,r.useEffect)(()=>{if(console.log("=== useInstructorGuard Debug ==="),console.log("isLoading:",t),console.log("isAuthenticated:",e),console.log("currentUser:",n),console.log("currentUser.role:",null===n||void 0===n?void 0:n.role),"true"!==sessionStorage.getItem("instructorDashboardSelection"))if(t)console.log("Still loading, skipping guard check");else{if(!e)return console.log("Not authenticated, redirecting to homepage"),void s("/homepage");if(n&&n.role<4)return console.log("User role not authorized for instructor pages, redirecting to homepage"),console.log("User role:",n.role,"Expected: 4+ (instructor or admin)"),void s("/homepage");console.log("InstructorGuard: User authorized"),console.log("User role:",n.role,"is authorized for instructor pages")}else console.log("\u6307\u5c0e\u54e1\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u9078\u629e\u4e2d - InstructorGuard\u51e6\u7406\u3092\u30b9\u30ad\u30c3\u30d7")},[e,t,null===n||void 0===n?void 0:n.id,s]),{isAuthenticated:e,isLoading:t,currentUser:n}})(),[F,U]=(0,r.useState)(null),[B,J]=(0,r.useState)(null),[q,V]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!R)return;const e={id:"office001",name:"\u6771\u4eac\u6559\u80b2\u6e0b\u8c37\u6821",type:"\u5c31\u52b4\u79fb\u884c\u652f\u63f4\u4e8b\u696d\u6240",organization:"\u30b9\u30bf\u30c7\u30a3\u30b9\u30d5\u30a3\u30a2\u682a\u5f0f\u4f1a\u793e"};if(F&&F.id===R.id||U({...R,location:R.location||e}),!F){const e=O.search.split("tab=")[1];e&&["overview","students","location","home-support","learning-preview","settings"].includes(e)&&(t(e),sessionStorage.setItem("instructorDashboardActiveTab",e))}R.passwordResetRequired&&l(!0)},[null===R||void 0===R?void 0:R.id]),(0,r.useEffect)(()=>{R&&"settings"===e&&H()},[R,e]),(0,r.useEffect)(()=>("overview"===e?Q():K(),()=>{K()}),[e]);const H=async()=>{try{const e=await Ze(R.id);e.success&&_(e.data||[])}catch(e){console.error("\u5c02\u9580\u5206\u91ce\u306e\u53d6\u5f97\u306b\u5931\u6557:",e)}},W=async()=>{try{const e=await He("/api/messages/unread-count");e.success&&e.data.unread_count>0&&(V({count:e.data.unread_count,timestamp:new Date}),setTimeout(()=>{V(null)},3e3))}catch(e){console.error("\u65b0\u7740\u30e1\u30c3\u30bb\u30fc\u30b8\u78ba\u8a8d\u30a8\u30e9\u30fc:",e)}},Q=()=>{B&&clearInterval(B),W();const e=setInterval(W,3e5);J(e)},K=()=>{B&&(clearInterval(B),J(null))},Y=async e=>{try{const t=await Ze(R.id),n=(t.success?t.data:[]).filter(t=>!e.some(e=>e.id===t.id));for(const e of n)await tt(R.id,e.id);for(const s of e)s.id?await et(R.id,s.id,s.specialization):await Xe(R.id,s.specialization)}catch(t){throw console.error("\u5c02\u9580\u5206\u91ce\u306e\u66f4\u65b0\u306b\u5931\u6557:",t),t}},G=async(e,t)=>{try{const n=localStorage.getItem("accessToken"),r=await fetch(`${ze.JR}/api/users/${R.id}/change-password`,{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({currentPassword:e,newPassword:t})}),a=await r.json();if(!a.success)throw new Error(a.message||"\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u306b\u5931\u6557\u3057\u307e\u3057\u305f");{alert("\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u6b63\u5e38\u306b\u5909\u66f4\u3055\u308c\u307e\u3057\u305f\u3002"),s(!1),F&&U(e=>({...e,passwordResetRequired:!1}));const e={...R,passwordResetRequired:!1};localStorage.setItem("currentUser",JSON.stringify(e))}}catch(n){throw console.error("\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u306b\u5931\u6557:",n),alert(`\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${n.message}`),n}},Z=e=>{const{name:t,value:n}=e.target;v(e=>({...e,[t]:n})),j[t]&&N(e=>({...e,[t]:""}))},X=e=>{console.log("\u62e0\u70b9\u60c5\u5831\u304c\u5909\u66f4\u3055\u308c\u307e\u3057\u305f:",e),sessionStorage.setItem("selectedSatellite",JSON.stringify(e));const t={...F,satellite_id:e.id,satellite_name:e.name,company_id:e.company_id,company_name:e.company_name};U(t),localStorage.setItem("currentUser",JSON.stringify(t)),window.dispatchEvent(new CustomEvent("satelliteChanged",{detail:{newLocation:e}})),console.log("\u62e0\u70b9\u5909\u66f4\u306b\u3088\u308a\u72b6\u614b\u3092\u66f4\u65b0\u3057\u307e\u3057\u305f")},te=()=>{window.dispatchEvent(new CustomEvent("studentListUpdated"))};return(0,r.useEffect)(()=>(window.openHomeSupportModal=()=>{i(!0)},()=>{delete window.openHomeSupportModal}),[]),(0,r.useEffect)(()=>()=>{K()},[]),R&&F?(0,pt.jsxs)("div",{className:"flex flex-col min-h-screen bg-gray-50",children:[(0,pt.jsx)("div",{className:a?"pointer-events-none opacity-50":"",children:(0,pt.jsx)(Ht,{user:F,onLocationChange:X})}),(0,pt.jsxs)("div",{className:"flex flex-col flex-1 h-[calc(100vh-80px)] overflow-hidden",children:[(0,pt.jsx)("aside",{className:"w-full bg-white text-gray-800 flex-shrink-0 overflow-y-auto border-b border-gray-200",children:(0,pt.jsxs)("nav",{className:"p-4 flex flex-row gap-2 overflow-x-auto "+(a?"pointer-events-none opacity-50":""),children:[(0,pt.jsx)("button",{className:"flex items-center gap-3 px-6 py-4 bg-transparent border-none text-gray-800 cursor-pointer transition-all duration-300 text-center text-sm min-w-[150px] flex-shrink-0 rounded-lg hover:bg-indigo-50 hover:-translate-y-0.5 "+("overview"===e?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white":""),onClick:()=>{t("overview"),sessionStorage.setItem("instructorDashboardActiveTab","overview")},children:"\ud83d\udcac \u58f0\u304b\u3051"}),(0,pt.jsx)("button",{className:"flex items-center gap-3 px-6 py-4 bg-transparent border-none text-gray-800 cursor-pointer transition-all duration-300 text-center text-sm min-w-[150px] flex-shrink-0 rounded-lg hover:bg-indigo-50 hover:-translate-y-0.5 "+("students"===e?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white":""),onClick:()=>{t("students"),sessionStorage.setItem("instructorDashboardActiveTab","students")},children:"\ud83d\udc65 \u5229\u7528\u8005\u4e00\u89a7"}),(0,pt.jsx)("button",{className:"flex items-center gap-3 px-6 py-4 bg-transparent border-none text-gray-800 cursor-pointer transition-all duration-300 text-center text-sm min-w-[150px] flex-shrink-0 rounded-lg hover:bg-indigo-50 hover:-translate-y-0.5 "+("location"===e?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white":""),onClick:()=>{t("location"),sessionStorage.setItem("instructorDashboardActiveTab","location")},children:"\ud83c\udfe2 \u62e0\u70b9\u7ba1\u7406"}),(0,pt.jsx)("button",{className:"flex items-center gap-3 px-6 py-4 bg-transparent border-none text-gray-800 cursor-pointer transition-all duration-300 text-center text-sm min-w-[150px] flex-shrink-0 rounded-lg hover:bg-indigo-50 hover:-translate-y-0.5 "+("home-support"===e?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white":""),onClick:()=>{t("home-support"),sessionStorage.setItem("instructorDashboardActiveTab","home-support")},children:"\ud83c\udfe0 \u5728\u5b85\u652f\u63f4"}),(0,pt.jsx)("button",{className:"flex items-center gap-3 px-6 py-4 bg-transparent border-none text-gray-800 cursor-pointer transition-all duration-300 text-center text-sm min-w-[150px] flex-shrink-0 rounded-lg hover:bg-indigo-50 hover:-translate-y-0.5 "+("learning-preview"===e?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white":""),onClick:()=>{t("learning-preview"),sessionStorage.setItem("instructorDashboardActiveTab","learning-preview")},children:"\ud83c\udf93 \u5b66\u7fd2\u753b\u9762\u30d7\u30ec\u30d3\u30e5\u30fc"}),(0,pt.jsxs)("button",{className:"relative flex items-center gap-3 px-6 py-4 bg-transparent border-none text-gray-800 cursor-pointer transition-all duration-300 text-center text-sm min-w-[150px] flex-shrink-0 rounded-lg hover:bg-indigo-50 hover:-translate-y-0.5\n                "+(F.passwordResetRequired?"bg-gradient-to-r from-red-500 to-red-600 text-white animate-pulse":"settings"===e?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white":""),onClick:()=>{t("settings"),sessionStorage.setItem("instructorDashboardActiveTab","settings")},children:["\u2699\ufe0f \u8a2d\u5b9a",F.passwordResetRequired&&(0,pt.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-5 h-5 text-xs font-bold flex items-center justify-center shadow-lg",children:"!"})]})]})}),(0,pt.jsxs)("main",{className:"flex-1 p-8 overflow-y-auto bg-white",children:[q&&(0,pt.jsx)("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg animate-pulse",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("div",{className:"flex items-center",children:[(0,pt.jsx)("span",{className:"text-blue-500 mr-2",children:"\ud83d\udcec"}),(0,pt.jsxs)("span",{className:"text-blue-700 font-medium",children:["\u65b0\u7740\u30e1\u30c3\u30bb\u30fc\u30b8 ",q.count,"\u4ef6\u304c\u3042\u308a\u307e\u3059"]})]}),(0,pt.jsx)("button",{onClick:()=>V(null),className:"text-blue-500 hover:text-blue-700",children:"\u2715"})]})}),c&&(0,pt.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("div",{className:"flex items-center",children:[(0,pt.jsx)("span",{className:"text-red-500 mr-2",children:"\u26a0\ufe0f"}),(0,pt.jsx)("span",{className:"text-red-700 font-medium",children:c})]}),(0,pt.jsx)("button",{onClick:()=>d(null),className:"text-red-500 hover:text-red-700",children:"\u2715"})]})}),"overview"===e&&(0,pt.jsx)("div",{className:"space-y-8",children:(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 p-6",children:[(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100",children:[(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("h2",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"\ud83d\udcac \u58f0\u304b\u3051\u30fb\u30e1\u30c3\u30bb\u30fc\u30b8\u7ba1\u7406"}),(0,pt.jsx)("p",{className:"text-lg text-gray-600",children:"\u5229\u7528\u8005\u3068\u306e\u30b3\u30df\u30e5\u30cb\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u7ba1\u7406\u3067\u304d\u307e\u3059"})]}),(0,pt.jsx)("div",{className:"flex gap-3",children:(0,pt.jsxs)("a",{href:"https://discord.gg/9N5wpBUmDQ",target:"_blank",rel:"noopener noreferrer",className:"px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 flex items-center gap-2",children:[(0,pt.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:(0,pt.jsx)("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"})}),"Discord \u3067\u76f8\u8ac7"]})})]}),(0,pt.jsxs)("div",{className:"mt-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,pt.jsx)("span",{className:"text-blue-600 text-lg",children:"\ud83d\udca1"}),(0,pt.jsx)("h3",{className:"font-semibold text-blue-800",children:"\u5916\u90e8\u30b5\u30dd\u30fc\u30c8\u306b\u3064\u3044\u3066"})]}),(0,pt.jsx)("p",{className:"text-blue-700 text-sm",children:"\u753b\u9762\u5171\u6709\u3084AI\u4ee5\u5916\u306e\u6280\u8853\u7684\u306a\u8cea\u554f\u306b\u3064\u3044\u3066\u306f\u3001Discord\u30b5\u30fc\u30d0\u30fc\u3067\u76f4\u63a5\u30b5\u30dd\u30fc\u30c8\u3092\u53d7\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002"})]})]}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent mb-4 flex items-center gap-2",children:"\ud83d\udce2 \u30a2\u30ca\u30a6\u30f3\u30b9\u30e1\u30c3\u30bb\u30fc\u30b8"}),(0,pt.jsx)($n,{}),(0,pt.jsx)("div",{className:"mt-6 pt-6 border-t border-gray-200",children:(0,pt.jsx)(zn,{})})]}),(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold bg-gradient-to-r from-green-600 to-green-800 bg-clip-text text-transparent mb-4 flex items-center gap-2",children:"\ud83d\udcac 1\u5bfe1\u30e1\u30c3\u30bb\u30fc\u30b8"}),(0,pt.jsx)(An,{})]})]}),(0,pt.jsxs)("div",{className:"mt-6 bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold bg-gradient-to-r from-purple-600 to-purple-800 bg-clip-text text-transparent mb-4 flex items-center gap-2",children:"\ud83d\udce5 \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u30fb\u4f1a\u8a71"}),(0,pt.jsx)(En,{})]})]})}),"students"===e&&(0,pt.jsx)(mn,{instructorId:F.id,onTestApproval:e=>{p(e);const t=sessionStorage.getItem("selectedSatellite");let n=null;if(t)try{n=JSON.parse(t).id}catch(s){console.error("\u62e0\u70b9\u60c5\u5831\u306e\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",s)}b(e.satellite_id||n||1),m(!0)},onSubmissionApproval:e=>{p(e),g(!0)}}),"location"===e&&(0,pt.jsx)(jn,{currentUser:F,onLocationChange:X}),"home-support"===e&&(0,pt.jsxs)("div",{className:"p-8 bg-white rounded-lg shadow-lg",children:[(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"\ud83c\udfe0 \u5728\u5b85\u652f\u63f4"}),(0,pt.jsx)("p",{className:"text-lg text-gray-600",children:"\u5728\u5b85\u652f\u63f4\u3092\u7ba1\u7406\u3057\u3001\u8a55\u4fa1\u3068\u5728\u5b85\u5229\u7528\u8005\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002"})]}),(0,pt.jsx)("div",{className:"mb-8",children:(0,pt.jsx)(Pn,{})})]}),"learning-preview"===e&&(0,pt.jsxs)("div",{className:"p-8 bg-white rounded-lg shadow-lg text-center text-gray-600",children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"\ud83c\udf93 \u5b66\u7fd2\u753b\u9762\u30d7\u30ec\u30d3\u30e5\u30fc"}),(0,pt.jsx)("p",{className:"mb-6",children:"\u5229\u7528\u8005\u304c\u5b9f\u969b\u306b\u898b\u308b\u5b66\u7fd2\u753b\u9762\u306e\u30d7\u30ec\u30d3\u30e5\u30fc\u3067\u3059\u3002"}),(0,pt.jsxs)("div",{className:"text-left max-w-2xl mx-auto p-6 bg-gray-50 rounded-lg border-l-4 border-indigo-500",children:[(0,pt.jsx)("p",{className:"mb-4",children:(0,pt.jsx)("strong",{children:"\ud83d\udcdd \u5b9f\u88c5\u4e88\u5b9a:"})}),(0,pt.jsxs)("ul",{className:"list-disc pl-6 space-y-2",children:[(0,pt.jsx)("li",{children:"\u5229\u7528\u8005\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306e\u30d7\u30ec\u30d3\u30e5\u30fc"}),(0,pt.jsx)("li",{children:"\u30b3\u30fc\u30b9\u4e00\u89a7\u30fb\u5b66\u7fd2\u753b\u9762\u306e\u78ba\u8a8d"}),(0,pt.jsx)("li",{children:"\u9032\u6357\u7ba1\u7406\u30fb\u8ab2\u984c\u63d0\u51fa\u753b\u9762\u306e\u78ba\u8a8d"}),(0,pt.jsx)("li",{children:"\u5229\u7528\u8005\u306e\u8996\u70b9\u3067\u306e\u64cd\u4f5c\u78ba\u8a8d"})]}),(0,pt.jsx)("p",{className:"mt-4 text-gray-600",children:"\u5229\u7528\u8005\u753b\u9762\u306e\u30e2\u30c3\u30af\u30a2\u30c3\u30d7\u304c\u5b8c\u6210\u6b21\u7b2c\u3001\u3053\u3053\u306b\u7d71\u5408\u4e88\u5b9a\u3067\u3059\u3002"})]})]}),"settings"===e&&(0,pt.jsxs)("div",{className:"p-8 bg-white rounded-lg shadow-lg",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"\u500b\u4eba\u8a2d\u5b9a"}),(0,pt.jsx)("p",{className:"text-lg text-gray-600",children:"\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u3068\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u3092\u7ba1\u7406\u3067\u304d\u307e\u3059\u3002"})]}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,pt.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,pt.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:"\ud83c\udff7\ufe0f \u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831"}),(0,pt.jsx)("button",{onClick:L?()=>E(!1):()=>{z({name:F.name||"",email:F.email||"",specializations:[...S]}),E(!0)},className:"px-3 py-1 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 text-sm",children:L?"\u30ad\u30e3\u30f3\u30bb\u30eb":"\u7de8\u96c6"})]}),L?(0,pt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),$.name.trim()){A(!0);try{const e=await Ge(R.id,{name:$.name.trim(),email:$.email.trim()||null});if(e.success){await Y($.specializations),U(e=>({...e,name:$.name.trim(),email:$.email.trim()||null}));const e={...R,name:$.name.trim(),email:$.email.trim()||null};localStorage.setItem("currentUser",JSON.stringify(e)),await H(),E(!1),alert("\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u304c\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\u3002")}else alert("\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+e.message)}catch(t){console.error("\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u306e\u66f4\u65b0\u306b\u5931\u6557:",t),alert("\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}finally{A(!1)}}else alert("\u540d\u524d\u306f\u5fc5\u9808\u3067\u3059\u3002")},className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u540d\u524d ",(0,pt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,pt.jsx)(Ct,{type:"text",value:$.name,onChange:e=>z(t=>({...t,name:e.target.value})),sanitizeMode:_t.TEXT,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9"}),(0,pt.jsx)(Ct,{type:"email",value:$.email,onChange:e=>z(t=>({...t,email:e.target.value})),sanitizeMode:_t.TEXT,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u5c02\u9580\u5206\u91ce"}),(0,pt.jsxs)("div",{className:"space-y-2",children:[$.specializations.map((e,t)=>(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)(Ct,{type:"text",value:e.specialization,onChange:e=>{const n=[...$.specializations];n[t].specialization=e.target.value,z(e=>({...e,specializations:n}))},sanitizeMode:_t.TEXT,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"}),(0,pt.jsx)("button",{type:"button",onClick:()=>(e=>{z(t=>({...t,specializations:t.specializations.filter((t,n)=>n!==e)}))})(t),className:"px-3 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"\u524a\u9664"})]},t)),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)(Ct,{type:"text",value:$.newSpecialization||"",onChange:e=>z(t=>({...t,newSpecialization:e.target.value})),placeholder:"\u65b0\u3057\u3044\u5c02\u9580\u5206\u91ce\u3092\u5165\u529b",sanitizeMode:_t.TEXT,className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"}),(0,pt.jsx)("button",{type:"button",onClick:()=>{$.newSpecialization&&$.newSpecialization.trim()&&z(e=>({...e,specializations:[...e.specializations,{specialization:e.newSpecialization.trim()}],newSpecialization:""}))},disabled:!$.newSpecialization||!$.newSpecialization.trim(),className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50",children:"\u8ffd\u52a0"})]})]})]}),(0,pt.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,pt.jsx)("button",{type:"submit",disabled:D,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50",children:D?"\u66f4\u65b0\u4e2d...":"\u66f4\u65b0"}),(0,pt.jsx)("button",{type:"button",onClick:()=>E(!1),className:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]}):(0,pt.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-gray-700",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u500b\u4eba\u30c8\u30fc\u30af\u30f3:"}),(0,pt.jsx)("span",{children:F.login_code||F.id||"\u672a\u8a2d\u5b9a"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u540d\u524d:"}),(0,pt.jsx)("span",{children:F.name})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9:"}),(0,pt.jsx)("span",{children:F.email})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u6700\u7d42\u30ed\u30b0\u30a4\u30f3:"}),(0,pt.jsx)("span",{children:(new Date).toLocaleDateString()})]}),(0,pt.jsxs)("div",{className:"col-span-2",children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u5c02\u9580\u5206\u91ce:"}),(0,pt.jsx)("div",{className:"mt-2",children:S.length>0?(0,pt.jsx)("div",{className:"space-y-1",children:S.map(e=>(0,pt.jsx)("div",{className:"p-2 bg-white rounded border border-gray-200",children:(0,pt.jsx)("span",{className:"text-gray-700",children:e.specialization})},e.id))}):(0,pt.jsx)("p",{className:"text-gray-500 text-sm",children:"\u5c02\u9580\u5206\u91ce\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093"})})]})]})]}),(0,pt.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,pt.jsx)("h3",{className:"text-xl font-semibold text-gray-800",children:"\ud83d\udd10 \u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4"}),F.passwordResetRequired&&(0,pt.jsxs)("div",{className:"flex items-center gap-2 text-red-500 text-sm font-medium",children:[(0,pt.jsx)("span",{className:"text-red-500",children:"\u26a0\ufe0f"}),"\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u5909\u66f4\u304c\u5fc5\u8981\u3067\u3059"]})]}),n?(0,pt.jsxs)("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[(0,pt.jsx)("h4",{className:"text-lg font-medium text-gray-800 mb-4",children:"\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4"}),(0,pt.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),N({}),k(!0);const t={};if(y.currentPassword||(t.currentPassword="\u73fe\u5728\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),y.newPassword){const e=(e=>{const t=[];return e.length<8&&t.push("8\u6587\u5b57\u4ee5\u4e0a\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"),/[A-Z]/.test(e)||t.push("\u5927\u6587\u5b57\u3092\u542b\u3081\u3066\u304f\u3060\u3055\u3044"),/[a-z]/.test(e)||t.push("\u5c0f\u6587\u5b57\u3092\u542b\u3081\u3066\u304f\u3060\u3055\u3044"),/[0-9]/.test(e)||t.push("\u6570\u5b57\u3092\u542b\u3081\u3066\u304f\u3060\u3055\u3044"),t})(y.newPassword);e.length>0&&(t.newPassword=e.join(", "))}else t.newPassword="\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044";if(y.confirmPassword?y.newPassword!==y.confirmPassword&&(t.confirmPassword="\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u4e00\u81f4\u3057\u307e\u305b\u3093"):t.confirmPassword="\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u78ba\u8a8d\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",Object.keys(t).length>0)return N(t),void k(!1);try{await G(y.currentPassword,y.newPassword),v({currentPassword:"",newPassword:"",confirmPassword:""}),N({}),s(!1)}catch(n){console.error("\u30d1\u30b9\u30ef\u30fc\u30c9\u5909\u66f4\u306b\u5931\u6557:",n)}finally{k(!1)}},className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u73fe\u5728\u306e\u30d1\u30b9\u30ef\u30fc\u30c9 ",(0,pt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,pt.jsx)(Ct,{type:"password",name:"currentPassword",value:y.currentPassword,onChange:Z,sanitizeMode:_t.NONE,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 "+(j.currentPassword?"border-red-500 focus:ring-red-500":"border-gray-300")}),j.currentPassword&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:j.currentPassword})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9 ",(0,pt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,pt.jsx)(Ct,{type:"password",name:"newPassword",value:y.newPassword,onChange:Z,sanitizeMode:_t.NONE,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 "+(j.newPassword?"border-red-500 focus:ring-red-500":"border-gray-300")}),j.newPassword&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:j.newPassword}),(0,pt.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:"\u30d1\u30b9\u30ef\u30fc\u30c9\u8981\u4ef6: 8\u6587\u5b57\u4ee5\u4e0a\u3001\u5927\u6587\u5b57\u30fb\u5c0f\u6587\u5b57\u30fb\u6570\u5b57\u3092\u542b\u3080"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u65b0\u3057\u3044\u30d1\u30b9\u30ef\u30fc\u30c9\uff08\u78ba\u8a8d\uff09 ",(0,pt.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,pt.jsx)(Ct,{type:"password",name:"confirmPassword",value:y.confirmPassword,onChange:Z,sanitizeMode:_t.NONE,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 "+(j.confirmPassword?"border-red-500 focus:ring-red-500":"border-gray-300")}),j.confirmPassword&&(0,pt.jsx)("p",{className:"text-red-500 text-sm mt-1",children:j.confirmPassword})]}),(0,pt.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,pt.jsx)("button",{type:"submit",disabled:w,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 disabled:opacity-50 transition-colors duration-300",children:w?"\u5909\u66f4\u4e2d...":"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4"}),(0,pt.jsx)("button",{type:"button",onClick:()=>s(!1),className:"px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition-colors duration-300",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]})]})]}):(0,pt.jsxs)("div",{className:"text-gray-700 mb-4",children:[(0,pt.jsx)("p",{children:"\u6307\u5c0e\u54e1\u306f\u81ea\u8eab\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u3044\u3064\u3067\u3082\u5909\u66f4\u3067\u304d\u307e\u3059\u3002"}),(0,pt.jsx)("button",{className:"mt-4 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors duration-300",onClick:()=>s(!0),children:"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4\u3059\u308b"})]})]}),(0,pt.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg border border-gray-200",children:[(0,pt.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"\ud83d\udee1\ufe0f \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u60c5\u5831"}),(0,pt.jsxs)("div",{className:"text-gray-700",children:[(0,pt.jsx)("h4",{className:"text-lg font-medium text-gray-800 mb-3",children:"\u30d1\u30b9\u30ef\u30fc\u30c9\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u30d2\u30f3\u30c8:"}),(0,pt.jsxs)("ul",{className:"list-disc pl-5 space-y-2",children:[(0,pt.jsx)("li",{children:"\u5b9a\u671f\u7684\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044"}),(0,pt.jsx)("li",{children:"\u4ed6\u306e\u30b5\u30fc\u30d3\u30b9\u3068\u540c\u3058\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4f7f\u7528\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044"}),(0,pt.jsx)("li",{children:"\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4ed6\u4eba\u3068\u5171\u6709\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044"}),(0,pt.jsx)("li",{children:"\u30bb\u30c3\u30b7\u30e7\u30f3\u7d42\u4e86\u6642\u306f\u5fc5\u305a\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u3066\u304f\u3060\u3055\u3044"})]})]})]})]})]})]})]}),(0,pt.jsx)(Ln,{isOpen:a,onClose:()=>l(!1),onPasswordChange:G,user:R}),(0,pt.jsx)(In,{isOpen:o,onClose:()=>i(!1),onSuccess:e=>{console.log("\u5728\u5b85\u652f\u63f4\u5229\u7528\u8005\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f:",e),window.dispatchEvent(new CustomEvent("homeSupportUserAdded"))}}),(0,pt.jsx)(an,{isOpen:u,onClose:()=>m(!1),student:h,satelliteId:f,onApprovalSuccess:te}),(0,pt.jsx)(on,{isOpen:x,onClose:()=>g(!1),student:h,onApprovalSuccess:te})]}):(0,pt.jsx)("div",{children:"Loading..."})},Rn=()=>{const{token:e}=se(),t=ne(),[s]=De(),{login:a,isAuthenticated:l,currentUser:o}=bt(),[i,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(""),[m,x]=(0,r.useState)(""),[g,h]=(0,r.useState)(""),[p,f]=(0,r.useState)(!1),[b,y]=(0,r.useState)(null),[v,j]=(0,r.useState)(!1);(0,r.useEffect)(()=>{console.log("StudentLogin: \u73fe\u5728\u306eURL:",window.location.href),console.log("StudentLogin: searchParams:",s.toString()),console.log("StudentLogin: PUBLIC_URL:","");const e=s.get("code")||s.get("loginCode")||s.get("login_code"),t=new URLSearchParams(window.location.search),n=t.get("code")||t.get("loginCode")||t.get("login_code"),r=e||n;console.log("StudentLogin: URL\u30d1\u30e9\u30e1\u30fc\u30bf\u78ba\u8a8d:",{codeFromUrl:e,urlCodeFromUrl:n,finalCodeFromUrl:r,allParams:Object.fromEntries(s.entries())}),r&&x(r)},[s]),(0,r.useEffect)(()=>{(async()=>{if(m)try{j(!0);const e=await(async e=>{const t=await Ve(`/api/temp-passwords/status/${e}`,{method:"GET"});if(t.success&&t.data&&t.data.expiresAt){const{isExpired:e}=await Promise.resolve().then(n.bind(n,291)),s=e(t.data.expiresAt);return{...t,data:{...t.data,hasValidPassword:!s,message:s?"\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u304c\u5207\u308c\u3066\u3044\u307e\u3059":"\u6709\u52b9\u306a\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u3042\u308a\u307e\u3059"}}}return t})(m);e.success&&(y(e.data),e.data.hasValidPassword&&e.data.tempPassword&&h(e.data.tempPassword))}catch(d){console.error("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u72b6\u614b\u78ba\u8a8d\u30a8\u30e9\u30fc:",d),y({hasValidPassword:!1,message:"\u72b6\u614b\u78ba\u8a8d\u306b\u5931\u6557\u3057\u307e\u3057\u305f"})}finally{j(!1)}})()},[m]),(0,r.useEffect)(()=>{if(l&&o)switch(o.role){case"admin":t("/admin/dashboard");break;case"instructor":t("/instructor/dashboard");break;case"student":t("/student/dashboard")}},[l,o,t]);return(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-400 via-cyan-400 to-blue-500 flex items-center justify-center p-5",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl shadow-xl p-8 max-w-md w-full",children:[(0,pt.jsxs)("div",{className:"text-center mb-8",children:[(0,pt.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-2",children:"\u5229\u7528\u8005\u30ed\u30b0\u30a4\u30f3"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u30ed\u30b0\u30a4\u30f3\u30b3\u30fc\u30c9\u3068\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"}),v&&(0,pt.jsx)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,pt.jsxs)("div",{className:"flex items-center justify-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),(0,pt.jsx)("span",{className:"text-blue-700",children:"\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u72b6\u614b\u3092\u78ba\u8a8d\u4e2d..."})]})}),b&&!v&&(0,pt.jsxs)("div",{className:"mt-4 p-3 rounded-lg border "+(b.hasValidPassword?"bg-green-50 border-green-200 text-green-700":"bg-yellow-50 border-yellow-200 text-yellow-700"),children:[(0,pt.jsx)("p",{className:"text-sm",children:b.message}),b.hasValidPassword&&b.expiresAt&&(0,pt.jsxs)("p",{className:"text-xs mt-1",children:["\u6709\u52b9\u671f\u9650: ",(0,Pt.Nx)(b.expiresAt)]})]})]}),(0,pt.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),m&&g){f(!0),u("");try{console.log("StudentLogin: \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u3092\u958b\u59cb:",{loginCode:m,tempPassword:"***"});const e=await it(m,g);if(e.success){console.log("StudentLogin: \u8a8d\u8a3c\u6210\u529f"),console.log("StudentLogin: \u30ec\u30b9\u30dd\u30f3\u30b9\u30c7\u30fc\u30bf:",e.data),console.log("StudentLogin: \u6307\u5c0e\u54e1\u540d\u30c7\u30d0\u30c3\u30b0:",{instructorName:e.data.instructorName,type:typeof e.data.instructorName,isTruthy:!!e.data.instructorName,fullData:e.data});const n=e.data.role||1,s={id:e.data.userId,name:e.data.userName,role:n,login_code:m,instructorName:e.data.instructorName};console.log("StudentLogin: \u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58:",s);const r=e.data.access_token&&e.data.access_token.trim().length>0,l=e.data.refresh_token&&e.data.refresh_token.trim().length>0;console.log("StudentLogin: \u30c8\u30fc\u30af\u30f3\u60c5\u5831:",{hasAccessToken:r,hasRefreshToken:l,accessTokenLength:r?e.data.access_token.length:0,refreshTokenLength:l?e.data.refresh_token.length:0}),r&&l?(console.log("StudentLogin: JWT\u30c8\u30fc\u30af\u30f3\u3092\u53d7\u4fe1 - \u6a19\u6e96\u8a8d\u8a3c\u3068\u3057\u3066\u51e6\u7406"),localStorage.setItem("loginCode",m),localStorage.setItem("tempPassword",g),e.data.expiresAt&&localStorage.setItem("tempPasswordExpiry",e.data.expiresAt),a(s,e.data.access_token,e.data.refresh_token)):(console.log("StudentLogin: JWT\u30c8\u30fc\u30af\u30f3\u306a\u3057 - \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u3068\u3057\u3066\u51e6\u7406"),localStorage.setItem("autoLoginCode",m),localStorage.setItem("tempPassword",g),localStorage.setItem("loginCode",m),localStorage.setItem("temp_password",g),e.data.expiresAt&&localStorage.setItem("tempPasswordExpiry",e.data.expiresAt),a(s)),console.log("StudentLogin: \u30ed\u30b0\u30a4\u30f3\u51e6\u7406\u5b8c\u4e86\u3001\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u307e\u3059"),t("/student/dashboard")}else u(e.message||"\u30ed\u30b0\u30a4\u30f3\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}catch(d){console.error("\u30ed\u30b0\u30a4\u30f3\u30a8\u30e9\u30fc:",d),u("\u30ed\u30b0\u30a4\u30f3\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002")}finally{f(!1)}}else u("\u30ed\u30b0\u30a4\u30f3\u30b3\u30fc\u30c9\u3068\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002")},className:"space-y-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{htmlFor:"loginCode",className:"block text-sm font-medium text-gray-700 mb-2",children:"\u30ed\u30b0\u30a4\u30f3\u30b3\u30fc\u30c9"}),(0,pt.jsx)("input",{type:"text",id:"loginCode",value:m,onChange:e=>x(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"\u30ed\u30b0\u30a4\u30f3\u30b3\u30fc\u30c9\u3092\u5165\u529b",required:!0})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{htmlFor:"tempPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:["\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9",(null===b||void 0===b?void 0:b.hasValidPassword)&&(0,pt.jsx)("span",{className:"ml-2 text-xs text-green-600",children:"(\u81ea\u52d5\u5165\u529b\u6e08\u307f)"})]}),(0,pt.jsx)("input",{type:"password",id:"tempPassword",value:g,onChange:e=>h(e.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent "+(null!==b&&void 0!==b&&b.hasValidPassword?"border-green-300 bg-green-50":"border-gray-300"),placeholder:"\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b",required:!0})]}),d&&(0,pt.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:d}),(0,pt.jsx)("button",{type:"submit",disabled:p,className:"w-full bg-gradient-to-r from-blue-500 to-cyan-500 text-white py-3 px-6 rounded-lg font-medium transition-all duration-200 hover:from-blue-600 hover:to-cyan-600 hover:shadow-lg hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed",children:p?(0,pt.jsxs)("div",{className:"flex items-center justify-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"\u30ed\u30b0\u30a4\u30f3\u4e2d..."]}):"\u30ed\u30b0\u30a4\u30f3"})]}),(0,pt.jsx)("div",{className:"mt-6 text-center",children:(0,pt.jsx)("p",{className:"text-sm text-gray-600",children:"\u652f\u63f4\u30a2\u30d7\u30ea\u304b\u3089\u9001\u3089\u308c\u3066\u304d\u305f\u30ed\u30b0\u30a4\u30f3\u30b3\u30fc\u30c9\u3068\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u3054\u5229\u7528\u304f\u3060\u3055\u3044"})})]})})},Mn=e=>{let{studentId:t,studentName:n}=e;const{currentUser:s}=bt(),[a,l]=(0,r.useState)([]),[o,i]=(0,r.useState)(null),[c,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(""),[x,g]=(0,r.useState)(""),[h,p]=(0,r.useState)(!1),[f,b]=(0,r.useState)(!1),[y,v]=(0,r.useState)([]),[j,N]=(0,r.useState)(null),[w,k]=(0,r.useState)(!1),[S,_]=(0,r.useState)(!1);(0,r.useEffect)(()=>{C()},[t]);const C=async()=>{try{k(!0);const[t,n]=await Promise.all([He("/api/announcements/user?page=1&limit=10"),He("/api/messages/conversations")]),r=[];if(n.success&&n.data)for(const a of n.data)try{const e=await He(`/api/messages/conversation/${a.other_user_id}`);if(e.success&&e.data&&e.data.length>0){const t=e.data,n=t[t.length-1],l=n.sender_id===s.id,o=t.filter(e=>e.sender_id!==s.id).length,i=l?s.name:a.other_user_name;r.push({id:`conversation_${a.other_user_id}`,type:"conversation",title:`${a.other_user_name}\u6307\u5c0e\u54e1\u3068\u306e\u4f1a\u8a71`,message:n.message,sentDate:new Date(n.created_at).toLocaleString("ja-JP",{timeZone:"UTC"}),instructorName:a.other_user_name,senderName:i,hasReplied:n.is_read,myReply:"",replyDate:n.read_at?new Date(n.read_at).toLocaleString("ja-JP",{timeZone:"UTC"}):"",canReply:!0,fromStudent:l,conversationId:a.other_user_id,messageCount:t.length,replyCount:o,allMessages:t})}}catch(e){console.error("\u500b\u4eba\u30e1\u30c3\u30bb\u30fc\u30b8\u53d6\u5f97\u30a8\u30e9\u30fc:",e)}if(t.success&&t.data.announcements){const e=t.data.announcements.map(e=>({id:`announce_${e.id}`,type:"announcement",title:e.title,message:e.message,sentDate:new Date(e.created_at).toLocaleString("ja-JP",{timeZone:"UTC"}),instructorName:e.created_by_name||"\u6307\u5c0e\u54e1",hasReplied:e.is_read,myReply:"",replyDate:e.read_at?new Date(e.read_at).toLocaleString("ja-JP",{timeZone:"UTC"}):"",canReply:!0}));r.push(...e)}r.sort((e,t)=>"announcement"===e.type&&"announcement"!==t.type?-1:"announcement"!==e.type&&"announcement"===t.type?1:new Date(t.sentDate)-new Date(e.sentDate)),l(r)}catch(e){console.error("\u30e1\u30c3\u30bb\u30fc\u30b8\u53d6\u5f97\u30a8\u30e9\u30fc:",e),l([])}finally{k(!1)}},I=async()=>{if(u.trim()&&o)try{"announcement"===o.type?await Qe(`/api/announcements/user/${o.id.replace("announce_","")}/read`):"conversation"===o.type&&await We("/api/messages/send",{receiver_id:o.conversationId,message:u.trim()}),await C(),m(""),d(!1)}catch(e){console.error("\u8fd4\u4fe1\u51e6\u7406\u30a8\u30e9\u30fc:",e),alert("\u8fd4\u4fe1\u306e\u9001\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}};return(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100 mb-6",children:[(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2",children:"\ud83d\udcac \u6307\u5c0e\u54e1\u304b\u3089\u306e\u58f0\u304b\u3051"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u6307\u5c0e\u54e1\u304b\u3089\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3059"})]}),(0,pt.jsxs)("div",{className:"flex gap-3",children:[(0,pt.jsx)("button",{onClick:()=>{b(!0),(async()=>{try{_(!0);const e=await He("/api/messages/instructors");e.success?(v(e.data.instructors),N(null)):alert("\u6307\u5c0e\u54e1\u30ea\u30b9\u30c8\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}catch(e){console.error("\u6307\u5c0e\u54e1\u30ea\u30b9\u30c8\u53d6\u5f97\u30a8\u30e9\u30fc:",e),alert("\u6307\u5c0e\u54e1\u30ea\u30b9\u30c8\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}finally{_(!1)}})()},className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200",children:"\u2709\ufe0f \u6307\u5c0e\u54e1\u306b\u76f8\u8ac7"}),(0,pt.jsxs)("a",{href:"https://discord.gg/9N5wpBUmDQ",target:"_blank",rel:"noopener noreferrer",className:"px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 flex items-center gap-2",children:[(0,pt.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:(0,pt.jsx)("path",{d:"M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.956-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.096 2.157 2.42c0 1.333-.946 2.418-2.157 2.418z"})}),"Discord \u3067\u76f8\u8ac7"]})]})]}),(0,pt.jsx)("div",{className:"mb-6 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl border border-indigo-200",children:(0,pt.jsxs)("div",{className:"flex items-start gap-3",children:[(0,pt.jsx)("span",{className:"text-indigo-600 text-lg flex-shrink-0",children:"\ud83d\udca1"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h4",{className:"font-semibold text-indigo-800 mb-2",children:"\u5916\u90e8\u5c02\u9580\u30b5\u30dd\u30fc\u30c8\u306b\u3064\u3044\u3066"}),(0,pt.jsxs)("p",{className:"text-indigo-700 text-sm leading-relaxed",children:["\u5b66\u7fd2\u3067\u308f\u304b\u3089\u306a\u3044\u3053\u3068\u304c\u3042\u308c\u3070\u3001\u307e\u305a",(0,pt.jsx)("strong",{children:"AI\u6a5f\u80fd"}),"\u306b\u3054\u8cea\u554f\u304f\u3060\u3055\u3044\u3002 AI \u3067\u89e3\u6c7a\u3067\u304d\u306a\u3044\u5834\u5408\u306f",(0,pt.jsx)("strong",{children:"\u62c5\u5f53\u6307\u5c0e\u54e1"}),"\u306b\u3054\u76f8\u8ac7\u3044\u305f\u3060\u3051\u307e\u3059\u3002 \u3055\u3089\u306b\u3001\u6307\u5c0e\u54e1\u3060\u3051\u3067\u306f\u5bfe\u5fdc\u304c\u96e3\u3057\u3044\u5c02\u9580\u7684\u306a\u5185\u5bb9\u306b\u3064\u3044\u3066\u306f\u3001",(0,pt.jsx)("strong",{children:"Discord\u30b5\u30fc\u30d0\u30fc"}),"\u3067\u5916\u90e8\u306e\u5c02\u9580\u6307\u5c0e\u54e1\u306b\u76f4\u63a5\u8cea\u554f\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002"]}),(0,pt.jsx)("div",{className:"mt-2 text-xs text-indigo-600 bg-white bg-opacity-50 rounded px-2 py-1 inline-block",children:"AI \u2192 \u62c5\u5f53\u6307\u5c0e\u54e1 \u2192 \u5916\u90e8\u5c02\u9580\u6307\u5c0e\u54e1 \u306e\u9806\u3067\u30b5\u30dd\u30fc\u30c8\u3092\u53d7\u3051\u3089\u308c\u307e\u3059"})]})]})}),(0,pt.jsx)("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:w?(0,pt.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,pt.jsx)("p",{children:"\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})}):a.length>0?a.map(e=>(0,pt.jsxs)("div",{className:"rounded-xl p-4 border transition-all duration-200 hover:shadow-md "+("announcement"===e.type?"bg-gradient-to-br from-blue-50 to-blue-100 border-blue-200":"conversation"===e.type?"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200":e.fromStudent?"bg-gradient-to-br from-green-50 to-green-100 border-green-200":"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200"),children:[(0,pt.jsx)("div",{className:"flex justify-between items-start mb-3",children:(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,pt.jsx)("span",{className:"text-xs px-2 py-1 rounded-full font-medium "+("announcement"===e.type?"bg-blue-200 text-blue-800":"conversation"===e.type?"bg-purple-200 text-purple-800":e.fromStudent?"bg-green-200 text-green-800":"bg-purple-200 text-purple-800"),children:"announcement"===e.type?"\ud83d\udce2 \u30a2\u30ca\u30a6\u30f3\u30b9":"conversation"===e.type?"\ud83d\udcac \u500b\u4eba\u30e1\u30c3\u30bb\u30fc\u30b8":e.fromStudent?"\ud83d\udce4 \u9001\u4fe1\u6e08\u307f":"\ud83d\udcac \u500b\u4eba\u30e1\u30c3\u30bb\u30fc\u30b8"}),"conversation"===e.type&&e.messageCount>0&&(0,pt.jsxs)("span",{className:"text-xs px-2 py-1 rounded-full bg-purple-100 text-purple-700 font-medium",children:[e.messageCount,"\u901a"]}),(0,pt.jsx)("span",{className:"text-xs px-2 py-1 rounded-full bg-green-200 text-green-800 font-medium "+(e.hasReplied&&"conversation"!==e.type?"":"hidden"),children:"\u2705 \u8fd4\u4fe1\u6e08\u307f"})]}),(0,pt.jsx)("h4",{className:"font-semibold text-gray-800 mb-1",children:e.title}),(0,pt.jsx)("p",{className:"text-gray-700 text-sm mb-2 line-clamp-2",children:e.message})]})}),(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,pt.jsx)("div",{children:"conversation"===e.type?e.senderName===s.name?"\u3042\u306a\u305f":e.senderName:e.instructorName}),(0,pt.jsx)("div",{children:e.sentDate})]}),(0,pt.jsx)("button",{onClick:()=>(e=>{i(e),d(!0)})(e),className:"px-4 py-2 rounded-lg font-medium shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 "+("announcement"===e.type?"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white":"conversation"===e.type?"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white":e.fromStudent?"bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white":"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white"),children:"\u8a73\u7d30\u3092\u898b\u308b"})]})]},e.id)):(0,pt.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,pt.jsx)("p",{children:"\u30e1\u30c3\u30bb\u30fc\u30b8\u306f\u3042\u308a\u307e\u305b\u3093"})})}),c&&o&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:o.title}),(0,pt.jsx)("button",{onClick:()=>d(!1),className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\xd7"})]}),"conversation"===o.type&&o.allMessages?(0,pt.jsxs)("div",{className:"space-y-4 mb-4",children:[(0,pt.jsxs)("div",{className:"text-sm text-gray-600 mb-3",children:[o.messageCount,"\u901a\u306e\u30e1\u30c3\u30bb\u30fc\u30b8"]}),o.allMessages.map((e,t)=>(0,pt.jsxs)("div",{className:"p-3 rounded-lg "+(e.sender_id===s.id?"bg-blue-50 border-l-4 border-blue-500 ml-8":"bg-gray-50 border-l-4 border-gray-400 mr-8"),children:[(0,pt.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[(0,pt.jsx)("span",{className:"text-xs font-medium "+(e.sender_id===s.id?"text-blue-700":"text-gray-700"),children:e.sender_id===s.id?"\u3042\u306a\u305f":o.instructorName}),(0,pt.jsx)("span",{className:"text-xs text-gray-500",children:new Date(e.created_at).toLocaleString("ja-JP",{timeZone:"UTC"})})]}),(0,pt.jsx)("p",{className:"text-gray-800 text-sm",children:e.message})]},e.id))]}):(0,pt.jsxs)("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg",children:[(0,pt.jsx)("p",{className:"text-gray-800 mb-2",children:o.message}),(0,pt.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,pt.jsxs)("div",{children:["\u9001\u4fe1\u8005: ",o.instructorName]}),(0,pt.jsxs)("div",{children:["\u9001\u4fe1\u65e5\u6642: ",o.sentDate]})]})]}),(0,pt.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500 "+(o.hasReplied&&"conversation"!==o.type?"":"hidden"),children:[(0,pt.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[(0,pt.jsx)("span",{className:"font-medium text-blue-700",children:"\u3042\u306a\u305f\u306e\u8fd4\u4fe1"}),(0,pt.jsx)("span",{className:"text-xs text-gray-500",children:o.replyDate})]}),(0,pt.jsx)("p",{className:"text-gray-800 text-sm",children:o.myReply})]}),"conversation"===o.type&&(0,pt.jsxs)("div",{className:"border-t pt-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8fd4\u4fe1\u3059\u308b:"}),(0,pt.jsxs)("div",{className:"flex gap-3",children:[(0,pt.jsx)("textarea",{value:u,onChange:e=>m(e.target.value),placeholder:"\u8fd4\u4fe1\u3092\u5165\u529b...",className:"flex-1 p-3 border border-gray-300 rounded-lg resize-none h-20 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,pt.jsx)("button",{onClick:I,disabled:!u.trim(),className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white px-4 py-2 rounded-lg transition-colors self-end",children:"\u8fd4\u4fe1"})]})]}),(0,pt.jsxs)("div",{className:"border-t pt-4 "+(o.hasReplied||o.fromStudent||"conversation"===o.type?"hidden":""),children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8fd4\u4fe1\u3059\u308b:"}),(0,pt.jsxs)("div",{className:"flex gap-3",children:[(0,pt.jsx)("textarea",{value:u,onChange:e=>m(e.target.value),placeholder:"\u8fd4\u4fe1\u3092\u5165\u529b...",className:"flex-1 p-3 border border-gray-300 rounded-lg resize-none h-20 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,pt.jsx)("button",{onClick:I,disabled:!u.trim(),className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white px-4 py-2 rounded-lg transition-colors self-end",children:"\u8fd4\u4fe1"})]})]}),(0,pt.jsx)("div",{className:"border-t pt-4 text-center text-gray-500 text-sm "+(o.fromStudent&&"conversation"!==o.type?"":"hidden"),children:"\u9001\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3067\u3059\u3002\u6307\u5c0e\u54e1\u304b\u3089\u306e\u8fd4\u4fe1\u3092\u304a\u5f85\u3061\u3057\u3066\u3044\u307e\u3059\u3002"})]})}),f&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u6307\u5c0e\u54e1\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),(0,pt.jsx)("button",{onClick:()=>{b(!1),N(null)},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\xd7"})]}),S?(0,pt.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,pt.jsx)("p",{children:"\u6307\u5c0e\u54e1\u30ea\u30b9\u30c8\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})}):(0,pt.jsx)("div",{className:"space-y-3 mb-6",children:y.map(e=>(0,pt.jsx)("div",{onClick:()=>N(e),className:"p-4 border-2 rounded-lg cursor-pointer transition-all duration-200 "+((null===j||void 0===j?void 0:j.id)===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),children:(0,pt.jsx)("div",{className:"flex items-center justify-between",children:(0,pt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,pt.jsx)("div",{className:"w-3 h-3 rounded-full "+((null===j||void 0===j?void 0:j.id)===e.id?"bg-blue-500":"bg-gray-300")}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("span",{className:"font-semibold text-gray-800",children:e.name}),1===e.is_assigned?(0,pt.jsx)("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full font-medium",children:"\ud83c\udfaf \u62c5\u5f53\u6307\u5c0e\u54e1"}):(0,pt.jsx)("span",{style:{display:"none"}})]}),(0,pt.jsxs)("div",{className:"text-sm text-gray-600",children:[e.satellite_name&&`${e.satellite_name} `,e.company_name&&`${e.company_name}`]})]})]})})},e.id))}),(0,pt.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,pt.jsx)("button",{onClick:()=>{b(!1),N(null)},className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{onClick:()=>{j&&(b(!1),p(!0))},disabled:!j,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white px-6 py-2 rounded-lg transition-colors",children:"\u9078\u629e\u3057\u3066\u76f8\u8ac7"})]})]})}),h&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-lg w-full mx-4",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:j?`${j.name} \u6307\u5c0e\u54e1\u306b\u76f8\u8ac7`:"\u6307\u5c0e\u54e1\u306b\u76f8\u8ac7"}),(0,pt.jsx)("button",{onClick:()=>{p(!1),N(null)},className:"text-gray-500 hover:text-gray-700 text-2xl",children:"\xd7"})]}),j&&(0,pt.jsx)("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:(0,pt.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,pt.jsx)("strong",{children:"\u9001\u4fe1\u5148:"})," ",j.name," \u6307\u5c0e\u54e1",j.is_assigned&&(0,pt.jsx)("span",{className:"ml-2 px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full",children:"\ud83c\udfaf \u62c5\u5f53\u6307\u5c0e\u54e1"})]})}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u76f8\u8ac7\u5185\u5bb9:"}),(0,pt.jsx)("textarea",{value:x,onChange:e=>g(e.target.value),placeholder:"\u76f8\u8ac7\u3057\u305f\u3044\u3053\u3068\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044...",className:"w-full p-3 border border-gray-300 rounded-lg resize-none h-32 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,pt.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,pt.jsx)("button",{onClick:()=>{p(!1),N(null)},className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{onClick:async()=>{if(x.trim()&&j)try{await We("/api/messages/send",{receiver_id:j.id,message:x.trim()}),await C(),g(""),p(!1),b(!1),N(null)}catch(e){console.error("\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u30a8\u30e9\u30fc:",e),alert("\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u9001\u4fe1\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}},disabled:!x.trim()||!j,className:"bg-blue-500 hover:bg-blue-600 disabled:bg-gray-300 text-white px-6 py-2 rounded-lg transition-colors",children:"\u9001\u4fe1"})]})]})})]})},Fn=e=>{const t=window.open("","_blank");t.document.write(`\n    <!DOCTYPE html>\n    <html>\n    <head>\n      <meta charset="UTF-8">\n      <title>\u4fee\u4e86\u8a3c\u660e\u66f8</title>\n      <style>\n        @page {\n          size: A4;\n          margin: 20mm;\n        }\n        body {\n          font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;\n          margin: 0;\n          padding: 0;\n          background: white;\n        }\n        .certificate-print {\n          width: 100%;\n          max-width: 100%;\n          height: auto;\n          page-break-inside: avoid;\n          background: white;\n          border: 8px solid #3B82F6;\n          border-radius: 16px;\n          padding: 32px;\n          box-sizing: border-box;\n          position: relative;\n          overflow: hidden;\n        }\n        .certificate-print::before {\n          content: '';\n          position: absolute;\n          top: 16px;\n          left: 16px;\n          width: 64px;\n          height: 64px;\n          border: 4px solid #93C5FD;\n          border-radius: 50%;\n        }\n        .certificate-print::after {\n          content: '';\n          position: absolute;\n          top: 16px;\n          right: 16px;\n          width: 64px;\n          height: 64px;\n          border: 4px solid #67E8F9;\n          border-radius: 50%;\n        }\n        .certificate-header {\n          text-align: center;\n          margin-bottom: 32px;\n        }\n        .certificate-logo {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: 24px;\n          margin-bottom: 24px;\n        }\n        .certificate-logo-icon {\n          width: 80px;\n          height: 80px;\n          background: linear-gradient(135deg, #3B82F6, #06B6D4);\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: white;\n          font-size: 32px;\n          font-weight: bold;\n        }\n        .certificate-company {\n          text-align: left;\n        }\n        .certificate-company h3 {\n          font-size: 24px;\n          font-weight: bold;\n          color: #1F2937;\n          margin: 0 0 8px 0;\n        }\n        .certificate-company p {\n          color: #6B7280;\n          margin: 0 0 4px 0;\n          font-size: 14px;\n        }\n        .certificate-title {\n          text-align: center;\n          margin-bottom: 48px;\n        }\n        .certificate-title h1 {\n          font-size: 36px;\n          font-weight: bold;\n          background: linear-gradient(135deg, #2563EB, #0891B2);\n          -webkit-background-clip: text;\n          -webkit-text-fill-color: transparent;\n          background-clip: text;\n          margin: 0 0 8px 0;\n        }\n        .certificate-title p {\n          color: #6B7280;\n          font-size: 18px;\n          margin: 0;\n        }\n        .certificate-body {\n          margin-bottom: 48px;\n        }\n        .certificate-description {\n          font-size: 18px;\n          color: #374151;\n          text-align: center;\n          margin-bottom: 32px;\n          line-height: 1.6;\n        }\n        .certificate-description .lesson-title {\n          font-weight: bold;\n          color: #2563EB;\n          margin: 0 8px;\n        }\n        .certificate-details {\n          background: #F9FAFB;\n          border-radius: 12px;\n          padding: 24px;\n          margin-bottom: 32px;\n        }\n        .certificate-details-grid {\n          display: grid;\n          grid-template-columns: 1fr 1fr;\n          gap: 16px;\n        }\n        .certificate-detail-item {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n        }\n        .certificate-detail-label {\n          font-weight: 600;\n          color: #374151;\n        }\n        .certificate-detail-value {\n          color: #1F2937;\n        }\n        .certificate-detail-value.score {\n          color: #2563EB;\n          font-weight: bold;\n        }\n        .certificate-detail-value.percentage {\n          color: #059669;\n          font-weight: bold;\n        }\n        .certificate-detail-value.cert-id {\n          color: #6B7280;\n          font-family: monospace;\n          font-size: 14px;\n        }\n        .certificate-signatures {\n          text-align: center;\n        }\n        .certificate-date {\n          color: #6B7280;\n          margin-bottom: 16px;\n        }\n        .certificate-signature-row {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          gap: 32px;\n        }\n        .certificate-signature {\n          text-align: center;\n        }\n        .certificate-signature-line {\n          width: 96px;\n          height: 64px;\n          border-bottom: 2px solid #9CA3AF;\n          margin-bottom: 8px;\n        }\n        .certificate-signature-label {\n          font-size: 14px;\n          color: #6B7280;\n        }\n        .certificate-signature-name {\n          font-size: 14px;\n          font-weight: 600;\n          color: #1F2937;\n        }\n        .certificate-manager-names {\n          font-size: 14px;\n          font-weight: 600;\n          color: #1F2937;\n        }\n        .certificate-manager-names div {\n          margin-bottom: 2px;\n        }\n        @media print {\n          body { -webkit-print-color-adjust: exact; }\n          .certificate-print { \n            border: 8px solid #3B82F6 !important;\n            background: white !important;\n          }\n        }\n      </style>\n    </head>\n    <body>\n      <div class="certificate-print">\n        <div class="certificate-header">\n          <div class="certificate-logo">\n            <div class="certificate-logo-icon">\n              ${e.officeName?e.officeName.charAt(0):"S"}\n            </div>\n            <div class="certificate-company">\n              <h3>${e.officeName}</h3>\n              <p>${e.companyName}</p>\n              <p>${e.officeAddress||""}</p>\n              ${e.officePhone?`<p>TEL: ${e.officePhone}</p>`:""}\n            </div>\n          </div>\n        </div>\n\n        <div class="certificate-title">\n          <h1>\u4fee\u4e86\u8a3c\u660e\u66f8</h1>\n          <p>Certificate of Completion</p>\n        </div>\n\n        <div class="certificate-body">\n          <p class="certificate-description">\n            \u3053\u306e\u8a3c\u660e\u66f8\u306f\u3001\u4e0b\u8a18\u306e\u65b9\u304c\n            <span class="lesson-title">${e.lessonTitle}</span>\n            \u306e\u5b66\u7fd2\u3092\u4fee\u4e86\u3057\u305f\u3053\u3068\u3092\u8a3c\u660e\u3057\u307e\u3059\u3002\n          </p>\n\n          <div class="certificate-details">\n            <div class="certificate-details-grid">\n              <div class="certificate-detail-item">\n                <span class="certificate-detail-label">\u6c0f\u540d</span>\n                <span class="certificate-detail-value">${e.studentName}</span>\n              </div>\n              <div class="certificate-detail-item">\n                <span class="certificate-detail-label">\u5229\u7528\u8005ID</span>\n                <span class="certificate-detail-value">${e.studentId}</span>\n              </div>\n              <div class="certificate-detail-item">\n                <span class="certificate-detail-label">\u4fee\u4e86\u65e5</span>\n                <span class="certificate-detail-value">${e.completionDate}</span>\n              </div>\n              <div class="certificate-detail-item">\n                <span class="certificate-detail-label">\u30c6\u30b9\u30c8\u7d50\u679c</span>\n                <span class="certificate-detail-value score">${e.score}\u70b9</span>\n              </div>\n              <div class="certificate-detail-item">\n                <span class="certificate-detail-label">\u6b63\u7b54\u7387</span>\n                <span class="certificate-detail-value percentage">${e.percentage}%</span>\n              </div>\n              <div class="certificate-detail-item">\n                <span class="certificate-detail-label">\u8a3c\u660e\u66f8ID</span>\n                <span class="certificate-detail-value cert-id">${e.certificateId}</span>\n              </div>\n            </div>\n          </div>\n\n          <div class="certificate-signatures">\n            <p class="certificate-date">${e.completionDate}</p>\n            <div class="certificate-signature-row">\n              ${e.instructorName?`\n                <div class="certificate-signature">\n                  <div class="certificate-signature-line"></div>\n                  <p class="certificate-signature-label">\u6307\u5c0e\u54e1</p>\n                  <p class="certificate-signature-name">${e.instructorName}</p>\n                </div>\n              `:""}\n              ${e.managerNames&&e.managerNames.length>0?`\n                <div class="certificate-signature">\n                  <div class="certificate-signature-line"></div>\n                  <p class="certificate-signature-label">\u62e0\u70b9\u7ba1\u7406\u8005</p>\n                  <div class="certificate-manager-names">\n                    ${e.managerNames.map(e=>`<div>${e}</div>`).join("")}\n                  </div>\n                </div>\n              `:""}\n            </div>\n          </div>\n        </div>\n      </div>\n    </body>\n    </html>\n  `),t.document.close(),t.focus(),setTimeout(()=>{t.print(),t.close()},500)},Un=()=>{const{currentUser:e}=bt(),[t,n]=(0,r.useState)([]),[s,a]=(0,r.useState)(!0),[l,o]=(0,r.useState)(null),[i,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{if(console.log("fetchCertificates called, currentUser:",e),console.log("currentUser.id:",null===e||void 0===e?void 0:e.id),null!==e&&void 0!==e&&e.id)try{a(!0),o(null);const s=await fetch(`${ze.JR}/api/learning/certificates/${e.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(s.ok){var t;const e=await s.json();console.log("\u7d42\u4e86\u8a3cAPI\u30ec\u30b9\u30dd\u30f3\u30b9:",e),console.log("\u7d42\u4e86\u8a3c\u30c7\u30fc\u30bf:",e.data),console.log("\u7d42\u4e86\u8a3c\u30c7\u30fc\u30bf\u306e\u9577\u3055:",null===(t=e.data)||void 0===t?void 0:t.length),e.success?(n(e.data),console.log("\u7d42\u4e86\u8a3c\u3092\u30bb\u30c3\u30c8\u3057\u307e\u3057\u305f:",e.data)):o(e.message||"\u7d42\u4e86\u8a3c\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}else o("\u7d42\u4e86\u8a3c\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(l){console.error("\u7d42\u4e86\u8a3c\u53d6\u5f97\u30a8\u30e9\u30fc:",l),o("\u7d42\u4e86\u8a3c\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}finally{a(!1)}else console.log("currentUser.id \u304c\u5b58\u5728\u3057\u306a\u3044\u305f\u3081\u3001API\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059")})()},[null===e||void 0===e?void 0:e.id]);const m=()=>{u(!1),c(null)};return s?(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:"\ud83c\udfc6 \u7d42\u4e86\u8a3c\u306e\u78ba\u8a8d"}),(0,pt.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,pt.jsx)("div",{className:"text-blue-600 text-lg",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."})})]}):l?(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:"\ud83c\udfc6 \u7d42\u4e86\u8a3c\u306e\u78ba\u8a8d"}),(0,pt.jsxs)("div",{className:"text-center py-8",children:[(0,pt.jsx)("div",{className:"text-red-600 text-lg mb-4",children:l}),(0,pt.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors",children:"\u518d\u8a66\u884c"})]})]}):(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:"\ud83c\udfc6 \u7d42\u4e86\u8a3c\u306e\u78ba\u8a8d"}),(console.log("CertificateList render - certificates:",t),console.log("CertificateList render - certificates.length:",t.length),console.log("CertificateList render - loading:",s),console.log("CertificateList render - error:",l),null),0===t.length?(0,pt.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,pt.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udcdc"}),(0,pt.jsx)("p",{className:"text-lg mb-2",children:"\u307e\u3060\u7d42\u4e86\u8a3c\u304c\u3042\u308a\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-sm",children:"\u30ec\u30c3\u30b9\u30f3\u3092\u5b8c\u4e86\u3057\u3066\u7d42\u4e86\u8a3c\u3092\u7372\u5f97\u3057\u307e\u3057\u3087\u3046\uff01"})]}):(0,pt.jsx)("div",{className:"space-y-4",children:t.map(e=>{return(0,pt.jsxs)("div",{className:"border border-gray-200 rounded-xl p-4 hover:shadow-lg transition-all duration-200",children:[(0,pt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("h4",{className:"font-semibold text-gray-800 mb-1",children:e.lessonTitle}),(0,pt.jsx)("p",{className:"text-sm text-blue-600 font-medium",children:e.courseTitle})]}),(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium",children:"\u2705 \u5408\u683c"}),(0,pt.jsxs)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:[e.percentage,"%"]})]})]}),(0,pt.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm text-gray-600",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u5f97\u70b9:"})," ",e.score,"/",e.totalQuestions,"\u70b9"]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u5b8c\u4e86\u65e5:"})," ",(t=e.examDate,new Date(t).toLocaleDateString("ja-JP",{year:"numeric",month:"long",day:"numeric"}))]})]}),(0,pt.jsx)("button",{className:"w-full px-4 py-2 bg-gradient-to-r from-blue-500 to-cyan-600 hover:from-blue-600 hover:to-cyan-700 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>(e=>{c(e),u(!0)})(e),children:"\ud83d\udcc4 \u7d42\u4e86\u8a3c\u3092\u78ba\u8a8d"})]},e.certificateId);var t})})]}),d&&i&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[95vh] overflow-y-auto",children:(0,pt.jsxs)("div",{className:"p-8",children:[(0,pt.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,pt.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"\u5408\u683c\u8a3c\u660e\u66f8"}),(0,pt.jsx)("button",{onClick:m,className:"text-gray-500 hover:text-gray-700 text-3xl font-bold",children:"\xd7"})]}),(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 border-8 border-gradient-to-r from-blue-500 to-cyan-600 relative overflow-hidden",children:[(0,pt.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,pt.jsx)("div",{className:"absolute top-4 left-4 w-16 h-16 border-4 border-blue-200 rounded-full"}),(0,pt.jsx)("div",{className:"absolute top-4 right-4 w-16 h-16 border-4 border-cyan-200 rounded-full"}),(0,pt.jsx)("div",{className:"absolute bottom-4 left-4 w-16 h-16 border-4 border-blue-200 rounded-full"}),(0,pt.jsx)("div",{className:"absolute bottom-4 right-4 w-16 h-16 border-4 border-cyan-200 rounded-full"})]}),(0,pt.jsxs)("div",{className:"relative z-10",children:[(0,pt.jsx)("div",{className:"text-center mb-8",children:(0,pt.jsxs)("div",{className:"flex items-center justify-center gap-6 mb-6",children:[(0,pt.jsx)("div",{className:"w-20 h-20 bg-gradient-to-r from-blue-500 to-cyan-600 rounded-full flex items-center justify-center text-white text-2xl font-bold",children:i.officeName?i.officeName.charAt(0):"S"}),(0,pt.jsxs)("div",{className:"text-left",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:i.officeName}),(0,pt.jsx)("p",{className:"text-gray-600",children:i.companyName}),(0,pt.jsxs)("p",{className:"text-sm text-gray-500",children:[i.officeAddress||"",i.officePhone&&(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsx)("br",{}),"TEL: ",i.officePhone]})]})]})]})}),(0,pt.jsxs)("div",{className:"text-center mb-12",children:[(0,pt.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent mb-2",children:"\u4fee\u4e86\u8a3c\u660e\u66f8"}),(0,pt.jsx)("p",{className:"text-gray-600 text-lg",children:"Certificate of Completion"})]}),(0,pt.jsxs)("div",{className:"mb-12",children:[(0,pt.jsxs)("p",{className:"text-lg text-gray-700 text-center mb-8 leading-relaxed",children:["\u3053\u306e\u8a3c\u660e\u66f8\u306f\u3001\u4e0b\u8a18\u306e\u65b9\u304c",(0,pt.jsx)("span",{className:"font-bold text-blue-600 mx-2",children:i.lessonTitle}),"\u306e\u5b66\u7fd2\u3092\u4fee\u4e86\u3057\u305f\u3053\u3068\u3092\u8a3c\u660e\u3057\u307e\u3059\u3002"]}),(0,pt.jsx)("div",{className:"bg-gray-50 rounded-xl p-6 mb-8",children:(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("span",{className:"font-semibold text-gray-700",children:"\u6c0f\u540d"}),(0,pt.jsx)("span",{className:"text-gray-800",children:i.studentName})]}),(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("span",{className:"font-semibold text-gray-700",children:"\u5229\u7528\u8005ID"}),(0,pt.jsx)("span",{className:"text-gray-800",children:i.studentId})]}),(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("span",{className:"font-semibold text-gray-700",children:"\u4fee\u4e86\u65e5"}),(0,pt.jsx)("span",{className:"text-gray-800",children:i.completionDate})]}),(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("span",{className:"font-semibold text-gray-700",children:"\u30c6\u30b9\u30c8\u7d50\u679c"}),(0,pt.jsxs)("span",{className:"text-blue-600 font-bold",children:[i.score,"\u70b9"]})]}),(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("span",{className:"font-semibold text-gray-700",children:"\u6b63\u7b54\u7387"}),(0,pt.jsxs)("span",{className:"text-green-600 font-bold",children:[i.percentage,"%"]})]}),(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("span",{className:"font-semibold text-gray-700",children:"\u8a3c\u660e\u66f8ID"}),(0,pt.jsx)("span",{className:"text-gray-600 font-mono text-sm",children:i.certificateId})]})]})}),(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("p",{className:"text-gray-600 mb-4",children:i.completionDate}),(0,pt.jsxs)("div",{className:"flex items-center justify-center gap-8",children:[i.instructorName&&(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"w-24 h-16 border-b-2 border-gray-400 mb-2"}),(0,pt.jsx)("p",{className:"text-sm text-gray-600",children:"\u6307\u5c0e\u54e1"}),(0,pt.jsx)("p",{className:"text-sm font-semibold text-gray-800",children:i.instructorName})]}),i.managerNames&&i.managerNames.length>0&&(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"w-24 h-16 border-b-2 border-gray-400 mb-2"}),(0,pt.jsx)("p",{className:"text-sm text-gray-600",children:"\u62e0\u70b9\u7ba1\u7406\u8005"}),(0,pt.jsx)("div",{className:"text-sm font-semibold text-gray-800",children:i.managerNames.map((e,t)=>(0,pt.jsx)("div",{children:e},t))})]})]})]})]})]})]}),(0,pt.jsxs)("div",{className:"flex gap-3 mt-8",children:[(0,pt.jsx)("button",{onClick:m,className:"flex-1 px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-medium transition-colors",children:"\u9589\u3058\u308b"}),(0,pt.jsx)("button",{onClick:()=>{Fn(i)},className:"flex-1 px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors",children:"\ud83d\udda8\ufe0f \u5370\u5237"})]})]})})})]})},Bn=async()=>{try{const e=Date.now();return await He(`/api/student/courses?_t=${e}`)}catch(e){throw console.error("\u5229\u7528\u8005\u30b3\u30fc\u30b9\u53d6\u5f97\u30a8\u30e9\u30fc:",e),e}},Jn=e=>{let{onTabChange:t}=e;const{currentUser:n}=bt(),s=ne(),[a,l]=(0,r.useState)([]),[o,i]=(0,r.useState)(!0),[c,d]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{if(i(!0),d(null),!n)return console.log("Dashboard: \u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u304c\u306a\u3044\u305f\u3081\u3001\u30c7\u30fc\u30bf\u53d6\u5f97\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),d("\u8a8d\u8a3c\u60c5\u5831\u304c\u7121\u52b9\u3067\u3059\u3002\u30ed\u30b0\u30a4\u30f3\u3057\u76f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),void i(!1);const e=localStorage.getItem("accessToken"),t=localStorage.getItem("loginCode")&&localStorage.getItem("tempPassword");if(!e&&!t)return console.warn("Dashboard: \u8a8d\u8a3c\u60c5\u5831\u304c\u306a\u3044\u305f\u3081\u3001\u30c7\u30fc\u30bf\u53d6\u5f97\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),d("\u8a8d\u8a3c\u60c5\u5831\u304c\u7121\u52b9\u3067\u3059\u3002\u30ed\u30b0\u30a4\u30f3\u3057\u76f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),void i(!1);console.log("Dashboard: \u53d7\u8b1b\u30b3\u30fc\u30b9\u3092\u53d6\u5f97\u3057\u307e\u3059");const s=await Bn();s.success&&(l(s.data),console.log("Dashboard: \u53d7\u8b1b\u30b3\u30fc\u30b9\u53d6\u5f97\u6210\u529f",{courseCount:s.data.length}))}catch(c){if("Authentication failed"===c.message||"Authentication error handling in progress"===c.message)return console.log("Dashboard: \u8a8d\u8a3c\u30a8\u30e9\u30fc\u306e\u305f\u3081\u3001\u30c7\u30fc\u30bf\u53d6\u5f97\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),void d("\u8a8d\u8a3c\u304c\u5fc5\u8981\u3067\u3059\u3002\u30ed\u30b0\u30a4\u30f3\u3057\u76f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002");console.error("Dashboard: \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",c),d("\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u30da\u30fc\u30b8\u3092\u518d\u8aad\u307f\u8fbc\u307f\u3057\u3066\u304f\u3060\u3055\u3044\u3002")}finally{i(!1)}})()},[n]);const u=async e=>{try{const a=localStorage.getItem("accessToken"),l=localStorage.getItem("loginCode")&&localStorage.getItem("tempPassword");if(!a&&!l)return console.warn("Dashboard: \u8a8d\u8a3c\u60c5\u5831\u304c\u306a\u3044\u305f\u3081\u3001\u30b3\u30fc\u30b9\u958b\u59cb\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),void alert("\u8a8d\u8a3c\u60c5\u5831\u304c\u7121\u52b9\u3067\u3059\u3002\u30ed\u30b0\u30a4\u30f3\u3057\u76f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002");const o=await fetch(`${ze.JR}/api/learning/current-lesson?courseId=${e}`,{headers:{...a&&{Authorization:`Bearer ${a}`},"Content-Type":"application/json"}});if(o.ok){const t=await o.json();if(t.success&&t.data.length>0){const n=t.data[0];return console.log(`\ud83c\udfaf \u73fe\u5728\u53d7\u8b1b\u4e2d\u30ec\u30c3\u30b9\u30f3: \u30ec\u30c3\u30b9\u30f3ID ${n.lesson_id}, \u30b3\u30fc\u30b9ID ${e}`),void s(`/student/enhanced-learning?course=${e}&lesson=${n.lesson_id}`)}}const i=await fetch(`${ze.JR}/api/learning/progress/${n.id}`,{headers:{...a&&{Authorization:`Bearer ${a}`},"Content-Type":"application/json"}});if(i.ok){const t=await i.json();if(t.success&&t.data.length>0){const r=t.data.find(t=>t.course_id===e);if(r&&r.lessons&&r.lessons.length>0){const t=r.lessons.find(e=>"completed"!==e.status)||r.lessons[0];try{await fetch(`${ze.JR}/api/learning/progress/lesson`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify({userId:parseInt(n.id),lessonId:parseInt(t.id),status:"in_progress"})})}catch(c){console.error("\u5b66\u7fd2\u9032\u6357\u66f4\u65b0\u30a8\u30e9\u30fc:",c)}return void s(`/student/enhanced-learning?course=${e}&lesson=${t.id}`)}}}try{const t=await fetch(`${ze.JR}/api/learning/assign-course`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify({userId:parseInt(n.id),courseId:parseInt(e)})});if(t.ok){if((await t.json()).success){const t=await fetch(`${ze.JR}/api/learning/progress/${n.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(t.ok){const r=await t.json();if(r.success&&r.data.length>0){const t=r.data.find(t=>t.course_id===e);if(t&&t.lessons&&t.lessons.length>0){const r=t.lessons[0];return await fetch(`${ze.JR}/api/learning/progress/lesson`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify({userId:parseInt(n.id),lessonId:parseInt(r.id),status:"in_progress"})}),void s(`/student/enhanced-learning?course=${e}&lesson=${r.id}`)}}}}}}catch(r){console.error("\u5b66\u7fd2\u30c7\u30fc\u30bf\u4f5c\u6210\u30a8\u30e9\u30fc:",r)}alert("\u5b66\u7fd2\u30c7\u30fc\u30bf\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u5b66\u7fd2\u9032\u6357\u753b\u9762\u3067\u30b3\u30fc\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),t&&t("learning")}catch(c){console.error("\u5b66\u7fd2\u958b\u59cb\u30a8\u30e9\u30fc:",c),alert("\u5b66\u7fd2\u958b\u59cb\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\u5b66\u7fd2\u9032\u6357\u753b\u9762\u3067\u30b3\u30fc\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),t&&t("learning")}};return n?o?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsx)("div",{className:"text-blue-600 text-xl font-semibold",children:"\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})}):c?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"text-red-600 text-xl font-semibold mb-4",children:c}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-all duration-200 mr-4",children:"\u30da\u30fc\u30b8\u3092\u518d\u8aad\u307f\u8fbc\u307f"}),(0,pt.jsx)("button",{onClick:()=>window.location.href="/student-login",className:"px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-all duration-200",children:"\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u3078"})]})]})}):(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 p-6",children:(0,pt.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100",children:[(0,pt.jsx)("h2",{className:"text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent mb-2",children:"\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9"}),(0,pt.jsxs)("p",{className:"text-lg text-gray-600",children:["\u304a\u304b\u3048\u308a\u306a\u3055\u3044\u3001",n.name,"\u3055\u3093\uff01\u5b66\u7fd2\u3092\u7d9a\u3051\u307e\u3057\u3087\u3046\u3002"]})]}),(0,pt.jsx)(Mn,{studentId:n.id,studentName:n.name}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,pt.jsxs)("section",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:"\ud83d\udcda \u53d7\u8b1b\u53ef\u80fd\u30b3\u30fc\u30b9"}),(0,pt.jsx)("div",{className:"space-y-4",children:0===a.length?(0,pt.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,pt.jsx)("p",{className:"text-lg mb-2",children:"\u53d7\u8b1b\u53ef\u80fd\u306a\u30b3\u30fc\u30b9\u304c\u3042\u308a\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-sm",children:"\u7ba1\u7406\u8005\u306b\u304a\u554f\u3044\u5408\u308f\u305b\u304f\u3060\u3055\u3044"})]}):a.map(e=>(0,pt.jsxs)("div",{className:"border border-gray-200 rounded-xl p-4 hover:shadow-lg transition-all duration-200",children:[(0,pt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,pt.jsx)("h4",{className:"font-semibold text-gray-800",children:e.title}),(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium",children:e.category||"\u672a\u5206\u985e"}),100===Number(e.progress_percentage||0)&&(0,pt.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium",children:"\u2705 \u4fee\u4e86"})]})]}),(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 mb-2",children:[(0,pt.jsxs)("span",{children:["\u9032\u6357: ",e.progress_percentage||0,"%"]}),(0,pt.jsxs)("span",{children:[e.completed_lessons||0,"/",e.total_lessons||0," \u30ec\u30c3\u30b9\u30f3\u5b8c\u4e86"]})]}),(0,pt.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,pt.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 "+(100===Number(e.progress_percentage||0)?"bg-gradient-to-r from-green-400 to-green-600":"bg-gradient-to-r from-blue-400 to-cyan-600"),style:{width:`${Number(e.progress_percentage||0)}%`}})})]}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("button",{className:"flex-1 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>{return n=e.id,void(t&&t("lessons",n));var n},children:"\u8a73\u7d30\u3092\u898b\u308b"}),0===Number(e.progress_percentage||0)?(0,pt.jsx)("button",{className:"flex-1 px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>u(e.id),children:"\u5b66\u7fd2\u958b\u59cb"}):(0,pt.jsx)("button",{className:"flex-1 px-4 py-2 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>u(e.id),children:"\u7d9a\u304d\u304b\u3089"})]})]},e.id))})]}),(0,pt.jsx)(Un,{})]})]})}):(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsx)("div",{className:"text-blue-600 text-xl font-semibold",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."})})},qn=e=>{let{course:t}=e;return t?(0,pt.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,pt.jsxs)("div",{className:"flex flex-col gap-4 mb-6",children:[t.curriculum_path_name&&(0,pt.jsx)("div",{className:"bg-gradient-to-r from-purple-50 to-purple-100 border border-purple-200 rounded-xl p-6 shadow-sm",children:(0,pt.jsxs)("div",{className:"flex items-start gap-4",children:[(0,pt.jsx)("div",{className:"flex-shrink-0",children:(0,pt.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg flex items-center justify-center",children:(0,pt.jsx)("span",{className:"text-white text-xl",children:"\ud83d\udcda"})})}),(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("h2",{className:"text-xl font-bold text-purple-800 mb-2",children:["\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u30d1\u30b9: ",t.curriculum_path_name]}),t.curriculum_path_description&&(0,pt.jsx)("p",{className:"text-purple-700 leading-relaxed",children:t.curriculum_path_description})]})]})}),(0,pt.jsxs)("div",{className:"bg-white border border-gray-200 rounded-xl p-6 shadow-sm",children:[(0,pt.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent mb-4",children:t.title}),(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsx)("span",{className:"px-4 py-2 rounded-full text-sm font-semibold "+("\u5fc5\u4fee\u79d1\u76ee"===t.category?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:t.category}),(0,pt.jsxs)("span",{className:"text-gray-500 text-sm",children:[t.total_lessons||0,"\u30ec\u30c3\u30b9\u30f3"]}),null!==t.progress_percentage&&(0,pt.jsxs)("span",{className:"text-gray-500 text-sm",children:["\u9032\u6357: ",Math.round(t.progress_percentage),"%"]})]})]})]})}):(0,pt.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,pt.jsxs)("div",{className:"flex flex-col gap-2 mb-6",children:[(0,pt.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent",children:"\u30b3\u30fc\u30b9\u540d\u4e0d\u660e"}),(0,pt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,pt.jsx)("span",{className:"px-4 py-2 rounded-full text-sm font-semibold bg-gray-100 text-gray-800",children:"\u30ab\u30c6\u30b4\u30ea\u4e0d\u660e"}),(0,pt.jsx)("span",{className:"text-gray-500 text-sm",children:"0\u30ec\u30c3\u30b9\u30f3"})]})]})})},Vn=e=>{let{courses:t,selectedCourse:n,onCourseSelect:s}=e;return(0,pt.jsx)("div",{className:"mb-6",children:(0,pt.jsx)("div",{className:"flex flex-wrap gap-4",children:t.map(e=>(0,pt.jsxs)("div",{className:"flex flex-col",children:[e.curriculum_path_name&&(0,pt.jsx)("div",{className:"mb-2",children:(0,pt.jsx)("div",{className:"inline-flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-purple-100 to-purple-200 rounded-lg border border-purple-300",children:(0,pt.jsxs)("span",{className:"text-purple-700 text-sm font-semibold",children:["\ud83d\udcda ",e.curriculum_path_name]})})}),(0,pt.jsxs)("button",{className:`px-6 py-3 ${e.curriculum_path_name?"rounded-b-lg rounded-tr-lg":"rounded-t-lg"} font-semibold text-lg border-b-4 transition-all duration-200 focus:outline-none ${(null===n||void 0===n?void 0:n.id)===e.id?"bg-gradient-to-r from-blue-500 to-cyan-600 text-white border-blue-600 shadow-lg":"bg-gray-100 text-gray-700 border-transparent hover:bg-blue-50"}`,onClick:()=>s(e),children:[e.title,(0,pt.jsx)("span",{className:"ml-2 text-xs font-normal px-2 py-1 rounded-full bg-blue-100 text-blue-800",children:e.category})]})]},e.id))})})},Hn=e=>{let{lessons:t,onStartLesson:n,onViewExamResults:s,onSubmitAssignment:r,currentLessonId:a,testResults:l}=e;return(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100 w-full overflow-x-auto",children:(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"min-w-full text-sm",children:[(0,pt.jsx)("thead",{className:"bg-blue-50",children:(0,pt.jsxs)("tr",{children:[(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u30ec\u30c3\u30b9\u30f3\u540d"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u8aac\u660e"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u6240\u8981\u6642\u9593"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u9032\u6357"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u30c6\u30b9\u30c8"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u8ab2\u984c"}),(0,pt.jsx)("th",{className:"px-4 py-3 text-left font-semibold text-blue-800",children:"\u64cd\u4f5c"})]})}),(0,pt.jsx)("tbody",{children:t&&t.map((e,t)=>{const o=(e=>{switch(e.progress_status||"not_started"){case"completed":return{label:"\u5b8c\u4e86",class:"completed",icon:"\u2705"};case"in_progress":return{label:"\u9032\u884c\u4e2d",class:"in-progress",icon:"\ud83d\udd04"};default:return{label:"\u672a\u958b\u59cb",class:"not-started",icon:"\u23f3"}}})(e),i=a===e.id;return(0,pt.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-blue-50 transition-colors duration-200 "+(i?"bg-gradient-to-r from-blue-50 to-cyan-50 border-l-4 border-l-blue-500":""),children:[(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsxs)("div",{children:[(0,pt.jsx)("div",{className:"font-semibold text-gray-800",children:e.title}),i&&(0,pt.jsx)("div",{className:"mt-1",children:(0,pt.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full",children:"\ud83c\udfaf \u73fe\u5728\u53d7\u8b1b\u4e2d"})})]})}),(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-600",children:e.description}),(0,pt.jsx)("td",{className:"px-4 py-3 text-gray-500",children:e.duration}),(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsxs)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold whitespace-nowrap "+("completed"===e.progress_status?"bg-green-100 text-green-800":"in_progress"===e.progress_status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-600"),children:[o.icon," ",o.label]})}),(0,pt.jsx)("td",{className:"px-4 py-3 text-center",children:(()=>{const t=l[e.id];if(console.log(`\ud83d\udd0d \u30ec\u30c3\u30b9\u30f3${e.id}\u306e\u30c6\u30b9\u30c8\u7d50\u679c:`,{lessonId:e.id,testResult:t,testResults:l}),t){const e=Math.round(t.score/t.totalQuestions*100);return(0,pt.jsxs)("div",{className:"flex flex-col items-center",children:[(0,pt.jsxs)("span",{className:"font-medium "+(t.passed?"text-green-600":"text-red-600"),children:[t.score,"/",t.totalQuestions,"\u70b9"]}),(0,pt.jsxs)("span",{className:"text-xs text-gray-500",children:["(",e,"%)"]}),(0,pt.jsx)("span",{className:"text-xs px-2 py-1 rounded-full "+(t.passed?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t.passed?"\u5408\u683c":"\u4e0d\u5408\u683c"})]})}return null!==e.test_score?(0,pt.jsxs)("span",{className:"text-green-600 font-medium",children:[e.test_score,"\u70b9"]}):(0,pt.jsx)("span",{className:"text-gray-400",children:"-"})})()}),(0,pt.jsx)("td",{className:"px-4 py-3 text-center",children:1===e.has_assignment||!0===e.has_assignment?1===e.assignment_submitted||!0===e.assignment_submitted?(0,pt.jsx)("span",{className:"text-green-600 font-medium",children:"\u63d0\u51fa\u6e08\u307f"}):(0,pt.jsx)("span",{className:"text-yellow-600 font-medium",children:"\u672a\u63d0\u51fa"}):(0,pt.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,pt.jsx)("td",{className:"px-4 py-3",children:(0,pt.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,pt.jsx)("button",{className:"px-3 py-1 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg font-medium hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",onClick:()=>n(e),children:"\ud83c\udf93 \u5b66\u7fd2"}),(0,pt.jsx)("button",{className:"px-3 py-1 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-medium hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",onClick:()=>s(e),children:"\ud83d\udcdd \u8a66\u9a13\u7d50\u679c\u4e00\u89a7"}),(1===e.has_assignment||!0===e.has_assignment)&&!(1===e.assignment_submitted||!0===e.assignment_submitted)&&(0,pt.jsx)("button",{className:"px-3 py-1 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white rounded-lg font-medium hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",onClick:()=>r(e),children:"\ud83d\udcc4 \u8ab2\u984c\u63d0\u51fa"})]})})]},e.id)})})]})})})},Wn=e=>{let{isOpen:t,onClose:n,lesson:s,onViewDetail:a}=e;const[l,o]=(0,r.useState)([]),[i,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&s&&m()},[t,s]);const m=async()=>{try{c(!0),u(null);const e=await fetch(`${ze.JR}/api/learning/exam-results/${s.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!e.ok)throw new Error("\u8a66\u9a13\u7d50\u679c\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f");const t=await e.json();if(!t.success)throw new Error(t.message||"\u8a66\u9a13\u7d50\u679c\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f");o(t.data||[])}catch(e){console.error("\u8a66\u9a13\u7d50\u679c\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",e),u(e.message)}finally{c(!1)}};return t?(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[(0,pt.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-600 text-white p-6",children:(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"\ud83d\udcdd \u8a66\u9a13\u7d50\u679c\u4e00\u89a7"}),(0,pt.jsx)("p",{className:"text-blue-100",children:null===s||void 0===s?void 0:s.title})]}),(0,pt.jsx)("button",{onClick:n,className:"text-white hover:text-gray-200 text-3xl font-bold transition-colors",children:"\xd7"})]})}),(0,pt.jsxs)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[i&&(0,pt.jsxs)("div",{className:"text-center py-12",children:[(0,pt.jsx)("div",{className:"text-blue-600 text-xl font-semibold mb-2",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."}),(0,pt.jsx)("div",{className:"text-gray-500",children:"\u8a66\u9a13\u7d50\u679c\u3092\u53d6\u5f97\u3057\u3066\u3044\u307e\u3059"})]}),d&&(0,pt.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-lg p-4 mb-4",children:[(0,pt.jsx)("div",{className:"font-semibold mb-1",children:"\u30a8\u30e9\u30fc"}),(0,pt.jsx)("div",{children:d})]}),!i&&!d&&0===l.length&&(0,pt.jsxs)("div",{className:"text-center py-12",children:[(0,pt.jsx)("div",{className:"text-gray-400 text-6xl mb-4",children:"\ud83d\udcc4"}),(0,pt.jsx)("div",{className:"text-gray-600 text-lg font-semibold mb-2",children:"\u8a66\u9a13\u7d50\u679c\u304c\u3042\u308a\u307e\u305b\u3093"}),(0,pt.jsx)("div",{className:"text-gray-500",children:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u306e\u8a66\u9a13\u7d50\u679c\u306f\u307e\u3060\u4fdd\u5b58\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002"})]}),!i&&!d&&l.length>0&&(0,pt.jsx)("div",{className:"space-y-4",children:l.map((e,t)=>(0,pt.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl p-5 border border-blue-200 hover:shadow-lg transition-all duration-200",children:(0,pt.jsxs)("div",{className:"flex justify-between items-start",children:[(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,pt.jsx)("span",{className:"px-3 py-1 bg-blue-500 text-white rounded-full text-sm font-medium",children:"lesson"===e.testType?"\ud83d\udcdd \u7dcf\u5408\u30c6\u30b9\u30c8":"\ud83d\udccb \u30bb\u30af\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8"}),(0,pt.jsxs)("span",{className:"text-gray-600 text-sm",children:["\u53d7\u9a13\u65e5\u6642: ",e.displayTime]})]}),(0,pt.jsxs)("div",{className:"text-gray-700 mb-2",children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u30d5\u30a1\u30a4\u30eb\u540d:"})," ",e.fileName]}),(0,pt.jsxs)("div",{className:"text-gray-600 text-sm",children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u30b5\u30a4\u30ba:"})," ",(e.size/1024).toFixed(2)," KB"]})]}),(0,pt.jsx)("button",{onClick:()=>(e=>{a(e)})(e),className:"px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-medium hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",children:"\u8a73\u7d30\u3092\u898b\u308b"})]})},t))})]}),(0,pt.jsx)("div",{className:"bg-gray-50 p-4 flex justify-end border-t border-gray-200",children:(0,pt.jsx)("button",{onClick:n,className:"px-6 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg font-medium transition-colors",children:"\u9589\u3058\u308b"})})]})}):null};function Qn(){}function Kn(){}const Yn=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Gn=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Zn={};function Xn(e,t){return((t||Zn).jsx?Gn:Yn).test(e)}const es=/[ \t\n\f\r]/g;function ts(e){return""===e.replace(es,"")}class ns{constructor(e,t,n){this.normal=t,this.property=e,n&&(this.space=n)}}function ss(e,t){const n={},s={};for(const r of e)Object.assign(n,r.property),Object.assign(s,r.normal);return new ns(n,s,t)}function rs(e){return e.toLowerCase()}ns.prototype.normal={},ns.prototype.property={},ns.prototype.space=void 0;class as{constructor(e,t){this.attribute=t,this.property=e}}as.prototype.attribute="",as.prototype.booleanish=!1,as.prototype.boolean=!1,as.prototype.commaOrSpaceSeparated=!1,as.prototype.commaSeparated=!1,as.prototype.defined=!1,as.prototype.mustUseProperty=!1,as.prototype.number=!1,as.prototype.overloadedBoolean=!1,as.prototype.property="",as.prototype.spaceSeparated=!1,as.prototype.space=void 0;let ls=0;const os=gs(),is=gs(),cs=gs(),ds=gs(),us=gs(),ms=gs(),xs=gs();function gs(){return 2**++ls}const hs=Object.keys(e);class ps extends as{constructor(t,n,s,r){let a=-1;if(super(t,n),fs(this,"space",r),"number"===typeof s)for(;++a<hs.length;){const t=hs[a];fs(this,hs[a],(s&e[t])===e[t])}}}function fs(e,t,n){n&&(e[t]=n)}function bs(e){const t={},n={};for(const[s,r]of Object.entries(e.properties)){const a=new ps(s,e.transform(e.attributes||{},s),r,e.space);e.mustUseProperty&&e.mustUseProperty.includes(s)&&(a.mustUseProperty=!0),t[s]=a,n[rs(s)]=s,n[rs(a.attribute)]=s}return new ns(t,n,e.space)}ps.prototype.defined=!0;const ys=bs({properties:{ariaActiveDescendant:null,ariaAtomic:is,ariaAutoComplete:null,ariaBusy:is,ariaChecked:is,ariaColCount:ds,ariaColIndex:ds,ariaColSpan:ds,ariaControls:us,ariaCurrent:null,ariaDescribedBy:us,ariaDetails:null,ariaDisabled:is,ariaDropEffect:us,ariaErrorMessage:null,ariaExpanded:is,ariaFlowTo:us,ariaGrabbed:is,ariaHasPopup:null,ariaHidden:is,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:us,ariaLevel:ds,ariaLive:null,ariaModal:is,ariaMultiLine:is,ariaMultiSelectable:is,ariaOrientation:null,ariaOwns:us,ariaPlaceholder:null,ariaPosInSet:ds,ariaPressed:is,ariaReadOnly:is,ariaRelevant:null,ariaRequired:is,ariaRoleDescription:us,ariaRowCount:ds,ariaRowIndex:ds,ariaRowSpan:ds,ariaSelected:is,ariaSetSize:ds,ariaSort:null,ariaValueMax:ds,ariaValueMin:ds,ariaValueNow:ds,ariaValueText:null,role:null},transform:(e,t)=>"role"===t?t:"aria-"+t.slice(4).toLowerCase()});function vs(e,t){return t in e?e[t]:t}function js(e,t){return vs(e,t.toLowerCase())}const Ns=bs({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:ms,acceptCharset:us,accessKey:us,action:null,allow:null,allowFullScreen:os,allowPaymentRequest:os,allowUserMedia:os,alt:null,as:null,async:os,autoCapitalize:null,autoComplete:us,autoFocus:os,autoPlay:os,blocking:us,capture:null,charSet:null,checked:os,cite:null,className:us,cols:ds,colSpan:null,content:null,contentEditable:is,controls:os,controlsList:us,coords:ds|ms,crossOrigin:null,data:null,dateTime:null,decoding:null,default:os,defer:os,dir:null,dirName:null,disabled:os,download:cs,draggable:is,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:os,formTarget:null,headers:us,height:ds,hidden:cs,high:ds,href:null,hrefLang:null,htmlFor:us,httpEquiv:us,id:null,imageSizes:null,imageSrcSet:null,inert:os,inputMode:null,integrity:null,is:null,isMap:os,itemId:null,itemProp:us,itemRef:us,itemScope:os,itemType:us,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:os,low:ds,manifest:null,max:null,maxLength:ds,media:null,method:null,min:null,minLength:ds,multiple:os,muted:os,name:null,nonce:null,noModule:os,noValidate:os,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:os,optimum:ds,pattern:null,ping:us,placeholder:null,playsInline:os,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:os,referrerPolicy:null,rel:us,required:os,reversed:os,rows:ds,rowSpan:ds,sandbox:us,scope:null,scoped:os,seamless:os,selected:os,shadowRootClonable:os,shadowRootDelegatesFocus:os,shadowRootMode:null,shape:null,size:ds,sizes:null,slot:null,span:ds,spellCheck:is,src:null,srcDoc:null,srcLang:null,srcSet:null,start:ds,step:null,style:null,tabIndex:ds,target:null,title:null,translate:null,type:null,typeMustMatch:os,useMap:null,value:is,width:ds,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:us,axis:null,background:null,bgColor:null,border:ds,borderColor:null,bottomMargin:ds,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:os,declare:os,event:null,face:null,frame:null,frameBorder:null,hSpace:ds,leftMargin:ds,link:null,longDesc:null,lowSrc:null,marginHeight:ds,marginWidth:ds,noResize:os,noHref:os,noShade:os,noWrap:os,object:null,profile:null,prompt:null,rev:null,rightMargin:ds,rules:null,scheme:null,scrolling:is,standby:null,summary:null,text:null,topMargin:ds,valueType:null,version:null,vAlign:null,vLink:null,vSpace:ds,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:os,disableRemotePlayback:os,prefix:null,property:null,results:ds,security:null,unselectable:null},space:"html",transform:js}),ws=bs({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:xs,accentHeight:ds,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:ds,amplitude:ds,arabicForm:null,ascent:ds,attributeName:null,attributeType:null,azimuth:ds,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:ds,by:null,calcMode:null,capHeight:ds,className:us,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:ds,diffuseConstant:ds,direction:null,display:null,dur:null,divisor:ds,dominantBaseline:null,download:os,dx:null,dy:null,edgeMode:null,editable:null,elevation:ds,enableBackground:null,end:null,event:null,exponent:ds,externalResourcesRequired:null,fill:null,fillOpacity:ds,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:ms,g2:ms,glyphName:ms,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:ds,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:ds,horizOriginX:ds,horizOriginY:ds,id:null,ideographic:ds,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:ds,k:ds,k1:ds,k2:ds,k3:ds,k4:ds,kernelMatrix:xs,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:ds,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:ds,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:ds,overlineThickness:ds,paintOrder:null,panose1:null,path:null,pathLength:ds,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:us,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:ds,pointsAtY:ds,pointsAtZ:ds,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:xs,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:xs,rev:xs,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:xs,requiredFeatures:xs,requiredFonts:xs,requiredFormats:xs,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:ds,specularExponent:ds,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:ds,strikethroughThickness:ds,string:null,stroke:null,strokeDashArray:xs,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:ds,strokeOpacity:ds,strokeWidth:null,style:null,surfaceScale:ds,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:xs,tabIndex:ds,tableValues:null,target:null,targetX:ds,targetY:ds,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:xs,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:ds,underlineThickness:ds,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:ds,values:null,vAlphabetic:ds,vMathematical:ds,vectorEffect:null,vHanging:ds,vIdeographic:ds,version:null,vertAdvY:ds,vertOriginX:ds,vertOriginY:ds,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:ds,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:vs}),ks=bs({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform:(e,t)=>"xlink:"+t.slice(5).toLowerCase()}),Ss=bs({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:js}),_s=bs({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform:(e,t)=>"xml:"+t.slice(3).toLowerCase()}),Cs=ss([ys,Ns,ks,Ss,_s],"html"),Is=ss([ys,ws,ks,Ss,_s],"svg"),Ts=/[A-Z]/g,Ps=/-[a-z]/g,Ls=/^data[-\w.:]+$/i;function Es(e){return"-"+e.toLowerCase()}function Ds(e){return e.charAt(1).toUpperCase()}const As={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"};var $s=n(294);const zs=Rs("end"),Os=Rs("start");function Rs(e){return function(t){const n=t&&t.position&&t.position[e]||{};if("number"===typeof n.line&&n.line>0&&"number"===typeof n.column&&n.column>0)return{line:n.line,column:n.column,offset:"number"===typeof n.offset&&n.offset>-1?n.offset:void 0}}}function Ms(e){return e&&"object"===typeof e?"position"in e||"type"in e?Us(e.position):"start"in e||"end"in e?Us(e):"line"in e||"column"in e?Fs(e):"":""}function Fs(e){return Bs(e&&e.line)+":"+Bs(e&&e.column)}function Us(e){return Fs(e&&e.start)+"-"+Fs(e&&e.end)}function Bs(e){return e&&"number"===typeof e?e:1}class Js extends Error{constructor(e,t,n){super(),"string"===typeof t&&(n=t,t=void 0);let s="",r={},a=!1;if(t&&(r="line"in t&&"column"in t||"start"in t&&"end"in t?{place:t}:"type"in t?{ancestors:[t],place:t.position}:{...t}),"string"===typeof e?s=e:!r.cause&&e&&(a=!0,s=e.message,r.cause=e),!r.ruleId&&!r.source&&"string"===typeof n){const e=n.indexOf(":");-1===e?r.ruleId=n:(r.source=n.slice(0,e),r.ruleId=n.slice(e+1))}if(!r.place&&r.ancestors&&r.ancestors){const e=r.ancestors[r.ancestors.length-1];e&&(r.place=e.position)}const l=r.place&&"start"in r.place?r.place.start:r.place;this.ancestors=r.ancestors||void 0,this.cause=r.cause||void 0,this.column=l?l.column:void 0,this.fatal=void 0,this.file,this.message=s,this.line=l?l.line:void 0,this.name=Ms(r.place)||"1:1",this.place=r.place||void 0,this.reason=this.message,this.ruleId=r.ruleId||void 0,this.source=r.source||void 0,this.stack=a&&r.cause&&"string"===typeof r.cause.stack?r.cause.stack:"",this.actual,this.expected,this.note,this.url}}Js.prototype.file="",Js.prototype.name="",Js.prototype.reason="",Js.prototype.message="",Js.prototype.stack="",Js.prototype.column=void 0,Js.prototype.line=void 0,Js.prototype.ancestors=void 0,Js.prototype.cause=void 0,Js.prototype.fatal=void 0,Js.prototype.place=void 0,Js.prototype.ruleId=void 0,Js.prototype.source=void 0;const qs={}.hasOwnProperty,Vs=new Map,Hs=/[A-Z]/g,Ws=new Set(["table","tbody","thead","tfoot","tr"]),Qs=new Set(["td","th"]),Ks="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function Ys(e,t){if(!t||void 0===t.Fragment)throw new TypeError("Expected `Fragment` in options");const n=t.filePath||void 0;let s;if(t.development){if("function"!==typeof t.jsxDEV)throw new TypeError("Expected `jsxDEV` in options when `development: true`");s=function(e,t){return n;function n(n,s,r,a){const l=Array.isArray(r.children),o=Os(n);return t(s,r,a,l,{columnNumber:o?o.column-1:void 0,fileName:e,lineNumber:o?o.line:void 0},void 0)}}(n,t.jsxDEV)}else{if("function"!==typeof t.jsx)throw new TypeError("Expected `jsx` in production options");if("function"!==typeof t.jsxs)throw new TypeError("Expected `jsxs` in production options");s=function(e,t,n){return s;function s(e,s,r,a){const l=Array.isArray(r.children)?n:t;return a?l(s,r,a):l(s,r)}}(0,t.jsx,t.jsxs)}const r={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:s,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:!1!==t.passKeys,passNode:t.passNode||!1,schema:"svg"===t.space?Is:Cs,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:!1!==t.tableCellAlignToStyle},a=Gs(r,e,void 0);return a&&"string"!==typeof a?a:r.create(e,r.Fragment,{children:a||void 0},void 0)}function Gs(e,t,n){return"element"===t.type?function(e,t,n){const s=e.schema;let r=s;"svg"===t.tagName.toLowerCase()&&"html"===s.space&&(r=Is,e.schema=r);e.ancestors.push(t);const a=nr(e,t.tagName,!1),l=function(e,t){const n={};let s,r;for(r in t.properties)if("children"!==r&&qs.call(t.properties,r)){const a=tr(e,r,t.properties[r]);if(a){const[r,l]=a;e.tableCellAlignToStyle&&"align"===r&&"string"===typeof l&&Qs.has(t.tagName)?s=l:n[r]=l}}if(s){(n.style||(n.style={}))["css"===e.stylePropertyNameCase?"text-align":"textAlign"]=s}return n}(e,t);let o=er(e,t);Ws.has(t.tagName)&&(o=o.filter(function(e){return"string"!==typeof e||!("object"===typeof(t=e)?"text"===t.type&&ts(t.value):ts(t));var t}));return Zs(e,l,a,t),Xs(l,o),e.ancestors.pop(),e.schema=s,e.create(t,a,l,n)}(e,t,n):"mdxFlowExpression"===t.type||"mdxTextExpression"===t.type?function(e,t){if(t.data&&t.data.estree&&e.evaluater){const n=t.data.estree.body[0];return n.type,e.evaluater.evaluateExpression(n.expression)}sr(e,t.position)}(e,t):"mdxJsxFlowElement"===t.type||"mdxJsxTextElement"===t.type?function(e,t,n){const s=e.schema;let r=s;"svg"===t.name&&"html"===s.space&&(r=Is,e.schema=r);e.ancestors.push(t);const a=null===t.name?e.Fragment:nr(e,t.name,!0),l=function(e,t){const n={};for(const s of t.attributes)if("mdxJsxExpressionAttribute"===s.type)if(s.data&&s.data.estree&&e.evaluater){const t=s.data.estree.body[0];Qn(t.type);const r=t.expression;Qn(r.type);const a=r.properties[0];Qn(a.type),Object.assign(n,e.evaluater.evaluateExpression(a.argument))}else sr(e,t.position);else{const r=s.name;let a;if(s.value&&"object"===typeof s.value)if(s.value.data&&s.value.data.estree&&e.evaluater){const t=s.value.data.estree.body[0];Qn(t.type),a=e.evaluater.evaluateExpression(t.expression)}else sr(e,t.position);else a=null===s.value||s.value;n[r]=a}return n}(e,t),o=er(e,t);return Zs(e,l,a,t),Xs(l,o),e.ancestors.pop(),e.schema=s,e.create(t,a,l,n)}(e,t,n):"mdxjsEsm"===t.type?function(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree);sr(e,t.position)}(e,t):"root"===t.type?function(e,t,n){const s={};return Xs(s,er(e,t)),e.create(t,e.Fragment,s,n)}(e,t,n):"text"===t.type?function(e,t){return t.value}(0,t):void 0}function Zs(e,t,n,s){"string"!==typeof n&&n!==e.Fragment&&e.passNode&&(t.node=s)}function Xs(e,t){if(t.length>0){const n=t.length>1?t:t[0];n&&(e.children=n)}}function er(e,t){const n=[];let s=-1;const r=e.passKeys?new Map:Vs;for(;++s<t.children.length;){const a=t.children[s];let l;if(e.passKeys){const e="element"===a.type?a.tagName:"mdxJsxFlowElement"===a.type||"mdxJsxTextElement"===a.type?a.name:void 0;if(e){const t=r.get(e)||0;l=e+"-"+t,r.set(e,t+1)}}const o=Gs(e,a,l);void 0!==o&&n.push(o)}return n}function tr(e,t,n){const s=function(e,t){const n=rs(t);let s=t,r=as;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&"data"===n.slice(0,4)&&Ls.test(t)){if("-"===t.charAt(4)){const e=t.slice(5).replace(Ps,Ds);s="data"+e.charAt(0).toUpperCase()+e.slice(1)}else{const e=t.slice(4);if(!Ps.test(e)){let n=e.replace(Ts,Es);"-"!==n.charAt(0)&&(n="-"+n),t="data"+n}}r=ps}return new r(s,t)}(e.schema,t);if(!(null===n||void 0===n||"number"===typeof n&&Number.isNaN(n))){if(Array.isArray(n)&&(n=s.commaSeparated?function(e,t){const n=t||{};return(""===e[e.length-1]?[...e,""]:e).join((n.padRight?" ":"")+","+(!1===n.padLeft?"":" ")).trim()}(n):n.join(" ").trim()),"style"===s.property){let t="object"===typeof n?n:function(e,t){try{return $s(t,{reactCompat:!0})}catch(n){if(e.ignoreInvalidStyle)return{};const t=n,s=new Js("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:t,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw s.file=e.filePath||void 0,s.url=Ks+"#cannot-parse-style-attribute",s}}(e,String(n));return"css"===e.stylePropertyNameCase&&(t=function(e){const t={};let n;for(n in e)qs.call(e,n)&&(t[rr(n)]=e[n]);return t}(t)),["style",t]}return["react"===e.elementAttributeNameCase&&s.space?As[s.property]||s.property:s.attribute,n]}}function nr(e,t,n){let s;if(n)if(t.includes(".")){const e=t.split(".");let n,r=-1;for(;++r<e.length;){const t=Xn(e[r])?{type:"Identifier",name:e[r]}:{type:"Literal",value:e[r]};n=n?{type:"MemberExpression",object:n,property:t,computed:Boolean(r&&"Literal"===t.type),optional:!1}:t}s=n}else s=Xn(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};else s={type:"Literal",value:t};if("Literal"===s.type){const t=s.value;return qs.call(e.components,t)?e.components[t]:t}if(e.evaluater)return e.evaluater.evaluateExpression(s);sr(e)}function sr(e,t){const n=new Js("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=e.filePath||void 0,n.url=Ks+"#cannot-handle-mdx-estrees-without-createevaluater",n}function rr(e){let t=e.replace(Hs,ar);return"ms-"===t.slice(0,3)&&(t="-"+t),t}function ar(e){return"-"+e.toLowerCase()}const lr={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},or={};function ir(e,t){const n=t||or;return cr(e,"boolean"!==typeof n.includeImageAlt||n.includeImageAlt,"boolean"!==typeof n.includeHtml||n.includeHtml)}function cr(e,t,n){if(function(e){return Boolean(e&&"object"===typeof e)}(e)){if("value"in e)return"html"!==e.type||n?e.value:"";if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return dr(e.children,t,n)}return Array.isArray(e)?dr(e,t,n):""}function dr(e,t,n){const s=[];let r=-1;for(;++r<e.length;)s[r]=cr(e[r],t,n);return s.join("")}function ur(e,t,n,s){const r=e.length;let a,l=0;if(t=t<0?-t>r?0:r+t:t>r?r:t,n=n>0?n:0,s.length<1e4)a=Array.from(s),a.unshift(t,n),e.splice(...a);else for(n&&e.splice(t,n);l<s.length;)a=s.slice(l,l+1e4),a.unshift(t,0),e.splice(...a),l+=1e4,t+=1e4}function mr(e,t){return e.length>0?(ur(e,e.length,0,t),e):t}class xr{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){const n=null===t||void 0===t?Number.POSITIVE_INFINITY:t;return n<this.left.length?this.left.slice(e,n):e>this.left.length?this.right.slice(this.right.length-n+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-n+this.left.length).reverse())}splice(e,t,n){const s=t||0;this.setCursor(Math.trunc(e));const r=this.right.splice(this.right.length-s,Number.POSITIVE_INFINITY);return n&&gr(this.left,n),r.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),gr(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),gr(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&0===this.right.length||e<0&&0===this.left.length))if(e<this.left.length){const t=this.left.splice(e,Number.POSITIVE_INFINITY);gr(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);gr(this.left,t.reverse())}}}function gr(e,t){let n=0;if(t.length<1e4)e.push(...t);else for(;n<t.length;)e.push(...t.slice(n,n+1e4)),n+=1e4}function hr(e){const t={};let n,s,r,a,l,o,i,c=-1;const d=new xr(e);for(;++c<d.length;){for(;c in t;)c=t[c];if(n=d.get(c),c&&"chunkFlow"===n[1].type&&"listItemPrefix"===d.get(c-1)[1].type&&(o=n[1]._tokenizer.events,r=0,r<o.length&&"lineEndingBlank"===o[r][1].type&&(r+=2),r<o.length&&"content"===o[r][1].type))for(;++r<o.length&&"content"!==o[r][1].type;)"chunkText"===o[r][1].type&&(o[r][1]._isInFirstContentOfListItem=!0,r++);if("enter"===n[0])n[1].contentType&&(Object.assign(t,pr(d,c)),c=t[c],i=!0);else if(n[1]._container){for(r=c,s=void 0;r--;)if(a=d.get(r),"lineEnding"===a[1].type||"lineEndingBlank"===a[1].type)"enter"===a[0]&&(s&&(d.get(s)[1].type="lineEndingBlank"),a[1].type="lineEnding",s=r);else if("linePrefix"!==a[1].type&&"listItemIndent"!==a[1].type)break;s&&(n[1].end={...d.get(s)[1].start},l=d.slice(s,c),l.unshift(n),d.splice(s,c-s+1,l))}}return ur(e,0,Number.POSITIVE_INFINITY,d.slice(0)),!i}function pr(e,t){const n=e.get(t)[1],s=e.get(t)[2];let r=t-1;const a=[];let l=n._tokenizer;l||(l=s.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(l._contentTypeTextTrailing=!0));const o=l.events,i=[],c={};let d,u,m=-1,x=n,g=0,h=0;const p=[h];for(;x;){for(;e.get(++r)[1]!==x;);a.push(r),x._tokenizer||(d=s.sliceStream(x),x.next||d.push(null),u&&l.defineSkip(x.start),x._isInFirstContentOfListItem&&(l._gfmTasklistFirstContentOfListItem=!0),l.write(d),x._isInFirstContentOfListItem&&(l._gfmTasklistFirstContentOfListItem=void 0)),u=x,x=x.next}for(x=n;++m<o.length;)"exit"===o[m][0]&&"enter"===o[m-1][0]&&o[m][1].type===o[m-1][1].type&&o[m][1].start.line!==o[m][1].end.line&&(h=m+1,p.push(h),x._tokenizer=void 0,x.previous=void 0,x=x.next);for(l.events=[],x?(x._tokenizer=void 0,x.previous=void 0):p.pop(),m=p.length;m--;){const t=o.slice(p[m],p[m+1]),n=a.pop();i.push([n,n+t.length-1]),e.splice(n,2,t)}for(i.reverse(),m=-1;++m<i.length;)c[g+i[m][0]]=g+i[m][1],g+=i[m][1]-i[m][0]-1;return c}const fr={}.hasOwnProperty;function br(e){const t={};let n=-1;for(;++n<e.length;)yr(t,e[n]);return t}function yr(e,t){let n;for(n in t){const s=(fr.call(e,n)?e[n]:void 0)||(e[n]={}),r=t[n];let a;if(r)for(a in r){fr.call(s,a)||(s[a]=[]);const e=r[a];vr(s[a],Array.isArray(e)?e:e?[e]:[])}}}function vr(e,t){let n=-1;const s=[];for(;++n<t.length;)("after"===t[n].add?e:s).push(t[n]);ur(e,0,0,s)}const jr=Dr(/[A-Za-z]/),Nr=Dr(/[\dA-Za-z]/),wr=Dr(/[#-'*+\--9=?A-Z^-~]/);function kr(e){return null!==e&&(e<32||127===e)}const Sr=Dr(/\d/),_r=Dr(/[\dA-Fa-f]/),Cr=Dr(/[!-/:-@[-`{-~]/);function Ir(e){return null!==e&&e<-2}function Tr(e){return null!==e&&(e<0||32===e)}function Pr(e){return-2===e||-1===e||32===e}const Lr=Dr(/\p{P}|\p{S}/u),Er=Dr(/\s/);function Dr(e){return function(t){return null!==t&&t>-1&&e.test(String.fromCharCode(t))}}function Ar(e,t,n,s){const r=s?s-1:Number.POSITIVE_INFINITY;let a=0;return function(s){if(Pr(s))return e.enter(n),l(s);return t(s)};function l(s){return Pr(s)&&a++<r?(e.consume(s),l):(e.exit(n),t(s))}}const $r={tokenize:function(e){const t=e.attempt(this.parser.constructs.contentInitial,function(n){if(null===n)return void e.consume(n);return e.enter("lineEnding"),e.consume(n),e.exit("lineEnding"),Ar(e,t,"linePrefix")},function(t){return e.enter("paragraph"),s(t)});let n;return t;function s(t){const s=e.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=s),n=s,r(t)}function r(t){return null===t?(e.exit("chunkText"),e.exit("paragraph"),void e.consume(t)):Ir(t)?(e.consume(t),e.exit("chunkText"),s):(e.consume(t),r)}}};const zr={tokenize:function(e){const t=this,n=[];let s,r,a,l=0;return o;function o(s){if(l<n.length){const r=n[l];return t.containerState=r[1],e.attempt(r[0].continuation,i,c)(s)}return c(s)}function i(e){if(l++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,s&&b();const n=t.events.length;let r,a=n;for(;a--;)if("exit"===t.events[a][0]&&"chunkFlow"===t.events[a][1].type){r=t.events[a][1].end;break}f(l);let o=n;for(;o<t.events.length;)t.events[o][1].end={...r},o++;return ur(t.events,a+1,0,t.events.slice(n)),t.events.length=o,c(e)}return o(e)}function c(r){if(l===n.length){if(!s)return m(r);if(s.currentConstruct&&s.currentConstruct.concrete)return g(r);t.interrupt=Boolean(s.currentConstruct&&!s._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(Or,d,u)(r)}function d(e){return s&&b(),f(l),m(e)}function u(e){return t.parser.lazy[t.now().line]=l!==n.length,a=t.now().offset,g(e)}function m(n){return t.containerState={},e.attempt(Or,x,g)(n)}function x(e){return l++,n.push([t.currentConstruct,t.containerState]),m(e)}function g(n){return null===n?(s&&b(),f(0),void e.consume(n)):(s=s||t.parser.flow(t.now()),e.enter("chunkFlow",{_tokenizer:s,contentType:"flow",previous:r}),h(n))}function h(n){return null===n?(p(e.exit("chunkFlow"),!0),f(0),void e.consume(n)):Ir(n)?(e.consume(n),p(e.exit("chunkFlow")),l=0,t.interrupt=void 0,o):(e.consume(n),h)}function p(e,n){const o=t.sliceStream(e);if(n&&o.push(null),e.previous=r,r&&(r.next=e),r=e,s.defineSkip(e.start),s.write(o),t.parser.lazy[e.start.line]){let e=s.events.length;for(;e--;)if(s.events[e][1].start.offset<a&&(!s.events[e][1].end||s.events[e][1].end.offset>a))return;const n=t.events.length;let r,o,i=n;for(;i--;)if("exit"===t.events[i][0]&&"chunkFlow"===t.events[i][1].type){if(r){o=t.events[i][1].end;break}r=!0}for(f(l),e=n;e<t.events.length;)t.events[e][1].end={...o},e++;ur(t.events,i+1,0,t.events.slice(n)),t.events.length=e}}function f(s){let r=n.length;for(;r-- >s;){const s=n[r];t.containerState=s[1],s[0].exit.call(t,e)}n.length=s}function b(){s.write([null]),r=void 0,s=void 0,t.containerState._closeFlow=void 0}}},Or={tokenize:function(e,t,n){return Ar(e,e.attempt(this.parser.constructs.document,t,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}};const Rr={partial:!0,tokenize:function(e,t,n){return function(t){return Pr(t)?Ar(e,s,"linePrefix")(t):s(t)};function s(e){return null===e||Ir(e)?t(e):n(e)}}};const Mr={resolve:function(e){return hr(e),e},tokenize:function(e,t){let n;return function(t){return e.enter("content"),n=e.enter("chunkContent",{contentType:"content"}),s(t)};function s(t){return null===t?r(t):Ir(t)?e.check(Fr,a,r)(t):(e.consume(t),s)}function r(n){return e.exit("chunkContent"),e.exit("content"),t(n)}function a(t){return e.consume(t),e.exit("chunkContent"),n.next=e.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,s}}},Fr={partial:!0,tokenize:function(e,t,n){const s=this;return function(t){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),Ar(e,r,"linePrefix")};function r(r){if(null===r||Ir(r))return n(r);const a=s.events[s.events.length-1];return!s.parser.constructs.disable.null.includes("codeIndented")&&a&&"linePrefix"===a[1].type&&a[2].sliceSerialize(a[1],!0).length>=4?t(r):e.interrupt(s.parser.constructs.flow,n,t)(r)}}};const Ur={tokenize:function(e){const t=this,n=e.attempt(Rr,function(s){if(null===s)return void e.consume(s);return e.enter("lineEndingBlank"),e.consume(s),e.exit("lineEndingBlank"),t.currentConstruct=void 0,n},e.attempt(this.parser.constructs.flowInitial,s,Ar(e,e.attempt(this.parser.constructs.flow,s,e.attempt(Mr,s)),"linePrefix")));return n;function s(s){if(null!==s)return e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),t.currentConstruct=void 0,n;e.consume(s)}}};const Br={resolveAll:Hr()},Jr=Vr("string"),qr=Vr("text");function Vr(e){return{resolveAll:Hr("text"===e?Wr:void 0),tokenize:function(t){const n=this,s=this.parser.constructs[e],r=t.attempt(s,a,l);return a;function a(e){return i(e)?r(e):l(e)}function l(e){if(null!==e)return t.enter("data"),t.consume(e),o;t.consume(e)}function o(e){return i(e)?(t.exit("data"),r(e)):(t.consume(e),o)}function i(e){if(null===e)return!0;const t=s[e];let r=-1;if(t)for(;++r<t.length;){const e=t[r];if(!e.previous||e.previous.call(n,n.previous))return!0}return!1}}}}function Hr(e){return function(t,n){let s,r=-1;for(;++r<=t.length;)void 0===s?t[r]&&"data"===t[r][1].type&&(s=r,r++):t[r]&&"data"===t[r][1].type||(r!==s+2&&(t[s][1].end=t[r-1][1].end,t.splice(s+2,r-s-2),r=s+2),s=void 0);return e?e(t,n):t}}function Wr(e,t){let n=0;for(;++n<=e.length;)if((n===e.length||"lineEnding"===e[n][1].type)&&"data"===e[n-1][1].type){const s=e[n-1][1],r=t.sliceStream(s);let a,l=r.length,o=-1,i=0;for(;l--;){const e=r[l];if("string"===typeof e){for(o=e.length;32===e.charCodeAt(o-1);)i++,o--;if(o)break;o=-1}else if(-2===e)a=!0,i++;else if(-1!==e){l++;break}}if(t._contentTypeTextTrailing&&n===e.length&&(i=0),i){const r={type:n===e.length||a||i<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:l?o:s.start._bufferIndex+o,_index:s.start._index+l,line:s.end.line,column:s.end.column-i,offset:s.end.offset-i},end:{...s.end}};s.end={...r.start},s.start.offset===s.end.offset?Object.assign(s,r):(e.splice(n,0,["enter",r,t],["exit",r,t]),n+=2)}n++}return e}const Qr={name:"thematicBreak",tokenize:function(e,t,n){let s,r=0;return function(t){return e.enter("thematicBreak"),function(e){return s=e,a(e)}(t)};function a(a){return a===s?(e.enter("thematicBreakSequence"),l(a)):r>=3&&(null===a||Ir(a))?(e.exit("thematicBreak"),t(a)):n(a)}function l(t){return t===s?(e.consume(t),r++,l):(e.exit("thematicBreakSequence"),Pr(t)?Ar(e,a,"whitespace")(t):a(t))}}};const Kr={continuation:{tokenize:function(e,t,n){const s=this;return s.containerState._closeFlow=void 0,e.check(Rr,r,a);function r(n){return s.containerState.furtherBlankLines=s.containerState.furtherBlankLines||s.containerState.initialBlankLine,Ar(e,t,"listItemIndent",s.containerState.size+1)(n)}function a(n){return s.containerState.furtherBlankLines||!Pr(n)?(s.containerState.furtherBlankLines=void 0,s.containerState.initialBlankLine=void 0,l(n)):(s.containerState.furtherBlankLines=void 0,s.containerState.initialBlankLine=void 0,e.attempt(Gr,t,l)(n))}function l(r){return s.containerState._closeFlow=!0,s.interrupt=void 0,Ar(e,e.attempt(Kr,t,n),"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(r)}}},exit:function(e){e.exit(this.containerState.type)},name:"list",tokenize:function(e,t,n){const s=this,r=s.events[s.events.length-1];let a=r&&"linePrefix"===r[1].type?r[2].sliceSerialize(r[1],!0).length:0,l=0;return function(t){const r=s.containerState.type||(42===t||43===t||45===t?"listUnordered":"listOrdered");if("listUnordered"===r?!s.containerState.marker||t===s.containerState.marker:Sr(t)){if(s.containerState.type||(s.containerState.type=r,e.enter(r,{_container:!0})),"listUnordered"===r)return e.enter("listItemPrefix"),42===t||45===t?e.check(Qr,n,i)(t):i(t);if(!s.interrupt||49===t)return e.enter("listItemPrefix"),e.enter("listItemValue"),o(t)}return n(t)};function o(t){return Sr(t)&&++l<10?(e.consume(t),o):(!s.interrupt||l<2)&&(s.containerState.marker?t===s.containerState.marker:41===t||46===t)?(e.exit("listItemValue"),i(t)):n(t)}function i(t){return e.enter("listItemMarker"),e.consume(t),e.exit("listItemMarker"),s.containerState.marker=s.containerState.marker||t,e.check(Rr,s.interrupt?n:c,e.attempt(Yr,u,d))}function c(e){return s.containerState.initialBlankLine=!0,a++,u(e)}function d(t){return Pr(t)?(e.enter("listItemPrefixWhitespace"),e.consume(t),e.exit("listItemPrefixWhitespace"),u):n(t)}function u(n){return s.containerState.size=a+s.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(n)}}},Yr={partial:!0,tokenize:function(e,t,n){const s=this;return Ar(e,function(e){const r=s.events[s.events.length-1];return!Pr(e)&&r&&"listItemPrefixWhitespace"===r[1].type?t(e):n(e)},"listItemPrefixWhitespace",s.parser.constructs.disable.null.includes("codeIndented")?void 0:5)}},Gr={partial:!0,tokenize:function(e,t,n){const s=this;return Ar(e,function(e){const r=s.events[s.events.length-1];return r&&"listItemIndent"===r[1].type&&r[2].sliceSerialize(r[1],!0).length===s.containerState.size?t(e):n(e)},"listItemIndent",s.containerState.size+1)}};const Zr={continuation:{tokenize:function(e,t,n){const s=this;return function(t){if(Pr(t))return Ar(e,r,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t);return r(t)};function r(s){return e.attempt(Zr,t,n)(s)}}},exit:function(e){e.exit("blockQuote")},name:"blockQuote",tokenize:function(e,t,n){const s=this;return function(t){if(62===t){const n=s.containerState;return n.open||(e.enter("blockQuote",{_container:!0}),n.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(t),e.exit("blockQuoteMarker"),r}return n(t)};function r(n){return Pr(n)?(e.enter("blockQuotePrefixWhitespace"),e.consume(n),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(n))}}};function Xr(e,t,n,s,r,a,l,o,i){const c=i||Number.POSITIVE_INFINITY;let d=0;return function(t){if(60===t)return e.enter(s),e.enter(r),e.enter(a),e.consume(t),e.exit(a),u;if(null===t||32===t||41===t||kr(t))return n(t);return e.enter(s),e.enter(l),e.enter(o),e.enter("chunkString",{contentType:"string"}),g(t)};function u(n){return 62===n?(e.enter(a),e.consume(n),e.exit(a),e.exit(r),e.exit(s),t):(e.enter(o),e.enter("chunkString",{contentType:"string"}),m(n))}function m(t){return 62===t?(e.exit("chunkString"),e.exit(o),u(t)):null===t||60===t||Ir(t)?n(t):(e.consume(t),92===t?x:m)}function x(t){return 60===t||62===t||92===t?(e.consume(t),m):m(t)}function g(r){return d||null!==r&&41!==r&&!Tr(r)?d<c&&40===r?(e.consume(r),d++,g):41===r?(e.consume(r),d--,g):null===r||32===r||40===r||kr(r)?n(r):(e.consume(r),92===r?h:g):(e.exit("chunkString"),e.exit(o),e.exit(l),e.exit(s),t(r))}function h(t){return 40===t||41===t||92===t?(e.consume(t),g):g(t)}}function ea(e,t,n,s,r,a){const l=this;let o,i=0;return function(t){return e.enter(s),e.enter(r),e.consume(t),e.exit(r),e.enter(a),c};function c(u){return i>999||null===u||91===u||93===u&&!o||94===u&&!i&&"_hiddenFootnoteSupport"in l.parser.constructs?n(u):93===u?(e.exit(a),e.enter(r),e.consume(u),e.exit(r),e.exit(s),t):Ir(u)?(e.enter("lineEnding"),e.consume(u),e.exit("lineEnding"),c):(e.enter("chunkString",{contentType:"string"}),d(u))}function d(t){return null===t||91===t||93===t||Ir(t)||i++>999?(e.exit("chunkString"),c(t)):(e.consume(t),o||(o=!Pr(t)),92===t?u:d)}function u(t){return 91===t||92===t||93===t?(e.consume(t),i++,d):d(t)}}function ta(e,t,n,s,r,a){let l;return function(t){if(34===t||39===t||40===t)return e.enter(s),e.enter(r),e.consume(t),e.exit(r),l=40===t?41:t,o;return n(t)};function o(n){return n===l?(e.enter(r),e.consume(n),e.exit(r),e.exit(s),t):(e.enter(a),i(n))}function i(t){return t===l?(e.exit(a),o(l)):null===t?n(t):Ir(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),Ar(e,i,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),c(t))}function c(t){return t===l||null===t||Ir(t)?(e.exit("chunkString"),i(t)):(e.consume(t),92===t?d:c)}function d(t){return t===l||92===t?(e.consume(t),c):c(t)}}function na(e,t){let n;return function s(r){if(Ir(r))return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),n=!0,s;if(Pr(r))return Ar(e,s,n?"linePrefix":"lineSuffix")(r);return t(r)}}function sa(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const ra={name:"definition",tokenize:function(e,t,n){const s=this;let r;return function(t){return e.enter("definition"),function(t){return ea.call(s,e,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(t)}(t)};function a(t){return r=sa(s.sliceSerialize(s.events[s.events.length-1][1]).slice(1,-1)),58===t?(e.enter("definitionMarker"),e.consume(t),e.exit("definitionMarker"),l):n(t)}function l(t){return Tr(t)?na(e,o)(t):o(t)}function o(t){return Xr(e,i,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(t)}function i(t){return e.attempt(aa,c,c)(t)}function c(t){return Pr(t)?Ar(e,d,"whitespace")(t):d(t)}function d(a){return null===a||Ir(a)?(e.exit("definition"),s.parser.defined.push(r),t(a)):n(a)}}},aa={partial:!0,tokenize:function(e,t,n){return function(t){return Tr(t)?na(e,s)(t):n(t)};function s(t){return ta(e,r,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(t)}function r(t){return Pr(t)?Ar(e,a,"whitespace")(t):a(t)}function a(e){return null===e||Ir(e)?t(e):n(e)}}};const la={name:"codeIndented",tokenize:function(e,t,n){const s=this;return function(t){return e.enter("codeIndented"),Ar(e,r,"linePrefix",5)(t)};function r(e){const t=s.events[s.events.length-1];return t&&"linePrefix"===t[1].type&&t[2].sliceSerialize(t[1],!0).length>=4?a(e):n(e)}function a(t){return null===t?o(t):Ir(t)?e.attempt(oa,a,o)(t):(e.enter("codeFlowValue"),l(t))}function l(t){return null===t||Ir(t)?(e.exit("codeFlowValue"),a(t)):(e.consume(t),l)}function o(n){return e.exit("codeIndented"),t(n)}}},oa={partial:!0,tokenize:function(e,t,n){const s=this;return r;function r(t){return s.parser.lazy[s.now().line]?n(t):Ir(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),r):Ar(e,a,"linePrefix",5)(t)}function a(e){const a=s.events[s.events.length-1];return a&&"linePrefix"===a[1].type&&a[2].sliceSerialize(a[1],!0).length>=4?t(e):Ir(e)?r(e):n(e)}}};const ia={name:"headingAtx",resolve:function(e,t){let n,s,r=e.length-2,a=3;"whitespace"===e[a][1].type&&(a+=2);r-2>a&&"whitespace"===e[r][1].type&&(r-=2);"atxHeadingSequence"===e[r][1].type&&(a===r-1||r-4>a&&"whitespace"===e[r-2][1].type)&&(r-=a+1===r?2:4);r>a&&(n={type:"atxHeadingText",start:e[a][1].start,end:e[r][1].end},s={type:"chunkText",start:e[a][1].start,end:e[r][1].end,contentType:"text"},ur(e,a,r-a+1,[["enter",n,t],["enter",s,t],["exit",s,t],["exit",n,t]]));return e},tokenize:function(e,t,n){let s=0;return function(t){return e.enter("atxHeading"),function(t){return e.enter("atxHeadingSequence"),r(t)}(t)};function r(t){return 35===t&&s++<6?(e.consume(t),r):null===t||Tr(t)?(e.exit("atxHeadingSequence"),a(t)):n(t)}function a(n){return 35===n?(e.enter("atxHeadingSequence"),l(n)):null===n||Ir(n)?(e.exit("atxHeading"),t(n)):Pr(n)?Ar(e,a,"whitespace")(n):(e.enter("atxHeadingText"),o(n))}function l(t){return 35===t?(e.consume(t),l):(e.exit("atxHeadingSequence"),a(t))}function o(t){return null===t||35===t||Tr(t)?(e.exit("atxHeadingText"),a(t)):(e.consume(t),o)}}};const ca={name:"setextUnderline",resolveTo:function(e,t){let n,s,r,a=e.length;for(;a--;)if("enter"===e[a][0]){if("content"===e[a][1].type){n=a;break}"paragraph"===e[a][1].type&&(s=a)}else"content"===e[a][1].type&&e.splice(a,1),r||"definition"!==e[a][1].type||(r=a);const l={type:"setextHeading",start:{...e[n][1].start},end:{...e[e.length-1][1].end}};e[s][1].type="setextHeadingText",r?(e.splice(s,0,["enter",l,t]),e.splice(r+1,0,["exit",e[n][1],t]),e[n][1].end={...e[r][1].end}):e[n][1]=l;return e.push(["exit",l,t]),e},tokenize:function(e,t,n){const s=this;let r;return function(t){let l,o=s.events.length;for(;o--;)if("lineEnding"!==s.events[o][1].type&&"linePrefix"!==s.events[o][1].type&&"content"!==s.events[o][1].type){l="paragraph"===s.events[o][1].type;break}if(!s.parser.lazy[s.now().line]&&(s.interrupt||l))return e.enter("setextHeadingLine"),r=t,function(t){return e.enter("setextHeadingLineSequence"),a(t)}(t);return n(t)};function a(t){return t===r?(e.consume(t),a):(e.exit("setextHeadingLineSequence"),Pr(t)?Ar(e,l,"lineSuffix")(t):l(t))}function l(s){return null===s||Ir(s)?(e.exit("setextHeadingLine"),t(s)):n(s)}}};const da=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],ua=["pre","script","style","textarea"],ma={concrete:!0,name:"htmlFlow",resolveTo:function(e){let t=e.length;for(;t--&&("enter"!==e[t][0]||"htmlFlow"!==e[t][1].type););t>1&&"linePrefix"===e[t-2][1].type&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2));return e},tokenize:function(e,t,n){const s=this;let r,a,l,o,i;return function(t){return function(t){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(t),c}(t)};function c(o){return 33===o?(e.consume(o),d):47===o?(e.consume(o),a=!0,x):63===o?(e.consume(o),r=3,s.interrupt?t:A):jr(o)?(e.consume(o),l=String.fromCharCode(o),g):n(o)}function d(a){return 45===a?(e.consume(a),r=2,u):91===a?(e.consume(a),r=5,o=0,m):jr(a)?(e.consume(a),r=4,s.interrupt?t:A):n(a)}function u(r){return 45===r?(e.consume(r),s.interrupt?t:A):n(r)}function m(r){const a="CDATA[";return r===a.charCodeAt(o++)?(e.consume(r),6===o?s.interrupt?t:_:m):n(r)}function x(t){return jr(t)?(e.consume(t),l=String.fromCharCode(t),g):n(t)}function g(o){if(null===o||47===o||62===o||Tr(o)){const i=47===o,c=l.toLowerCase();return i||a||!ua.includes(c)?da.includes(l.toLowerCase())?(r=6,i?(e.consume(o),h):s.interrupt?t(o):_(o)):(r=7,s.interrupt&&!s.parser.lazy[s.now().line]?n(o):a?p(o):f(o)):(r=1,s.interrupt?t(o):_(o))}return 45===o||Nr(o)?(e.consume(o),l+=String.fromCharCode(o),g):n(o)}function h(r){return 62===r?(e.consume(r),s.interrupt?t:_):n(r)}function p(t){return Pr(t)?(e.consume(t),p):k(t)}function f(t){return 47===t?(e.consume(t),k):58===t||95===t||jr(t)?(e.consume(t),b):Pr(t)?(e.consume(t),f):k(t)}function b(t){return 45===t||46===t||58===t||95===t||Nr(t)?(e.consume(t),b):y(t)}function y(t){return 61===t?(e.consume(t),v):Pr(t)?(e.consume(t),y):f(t)}function v(t){return null===t||60===t||61===t||62===t||96===t?n(t):34===t||39===t?(e.consume(t),i=t,j):Pr(t)?(e.consume(t),v):N(t)}function j(t){return t===i?(e.consume(t),i=null,w):null===t||Ir(t)?n(t):(e.consume(t),j)}function N(t){return null===t||34===t||39===t||47===t||60===t||61===t||62===t||96===t||Tr(t)?y(t):(e.consume(t),N)}function w(e){return 47===e||62===e||Pr(e)?f(e):n(e)}function k(t){return 62===t?(e.consume(t),S):n(t)}function S(t){return null===t||Ir(t)?_(t):Pr(t)?(e.consume(t),S):n(t)}function _(t){return 45===t&&2===r?(e.consume(t),P):60===t&&1===r?(e.consume(t),L):62===t&&4===r?(e.consume(t),$):63===t&&3===r?(e.consume(t),A):93===t&&5===r?(e.consume(t),D):!Ir(t)||6!==r&&7!==r?null===t||Ir(t)?(e.exit("htmlFlowData"),C(t)):(e.consume(t),_):(e.exit("htmlFlowData"),e.check(xa,z,C)(t))}function C(t){return e.check(ga,I,z)(t)}function I(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),T}function T(t){return null===t||Ir(t)?C(t):(e.enter("htmlFlowData"),_(t))}function P(t){return 45===t?(e.consume(t),A):_(t)}function L(t){return 47===t?(e.consume(t),l="",E):_(t)}function E(t){if(62===t){const n=l.toLowerCase();return ua.includes(n)?(e.consume(t),$):_(t)}return jr(t)&&l.length<8?(e.consume(t),l+=String.fromCharCode(t),E):_(t)}function D(t){return 93===t?(e.consume(t),A):_(t)}function A(t){return 62===t?(e.consume(t),$):45===t&&2===r?(e.consume(t),A):_(t)}function $(t){return null===t||Ir(t)?(e.exit("htmlFlowData"),z(t)):(e.consume(t),$)}function z(n){return e.exit("htmlFlow"),t(n)}}},xa={partial:!0,tokenize:function(e,t,n){return function(s){return e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),e.attempt(Rr,t,n)}}},ga={partial:!0,tokenize:function(e,t,n){const s=this;return function(t){if(Ir(t))return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),r;return n(t)};function r(e){return s.parser.lazy[s.now().line]?n(e):t(e)}}};const ha={partial:!0,tokenize:function(e,t,n){const s=this;return function(t){if(null===t)return n(t);return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),r};function r(e){return s.parser.lazy[s.now().line]?n(e):t(e)}}},pa={concrete:!0,name:"codeFenced",tokenize:function(e,t,n){const s=this,r={partial:!0,tokenize:function(e,t,n){let r=0;return l;function l(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),i}function i(t){return e.enter("codeFencedFence"),Pr(t)?Ar(e,c,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):c(t)}function c(t){return t===a?(e.enter("codeFencedFenceSequence"),d(t)):n(t)}function d(t){return t===a?(r++,e.consume(t),d):r>=o?(e.exit("codeFencedFenceSequence"),Pr(t)?Ar(e,u,"whitespace")(t):u(t)):n(t)}function u(s){return null===s||Ir(s)?(e.exit("codeFencedFence"),t(s)):n(s)}}};let a,l=0,o=0;return function(t){return function(t){const n=s.events[s.events.length-1];return l=n&&"linePrefix"===n[1].type?n[2].sliceSerialize(n[1],!0).length:0,a=t,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),i(t)}(t)};function i(t){return t===a?(o++,e.consume(t),i):o<3?n(t):(e.exit("codeFencedFenceSequence"),Pr(t)?Ar(e,c,"whitespace")(t):c(t))}function c(n){return null===n||Ir(n)?(e.exit("codeFencedFence"),s.interrupt?t(n):e.check(ha,x,b)(n)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),d(n))}function d(t){return null===t||Ir(t)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),c(t)):Pr(t)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),Ar(e,u,"whitespace")(t)):96===t&&t===a?n(t):(e.consume(t),d)}function u(t){return null===t||Ir(t)?c(t):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),m(t))}function m(t){return null===t||Ir(t)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),c(t)):96===t&&t===a?n(t):(e.consume(t),m)}function x(t){return e.attempt(r,b,g)(t)}function g(t){return e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),h}function h(t){return l>0&&Pr(t)?Ar(e,p,"linePrefix",l+1)(t):p(t)}function p(t){return null===t||Ir(t)?e.check(ha,x,b)(t):(e.enter("codeFlowValue"),f(t))}function f(t){return null===t||Ir(t)?(e.exit("codeFlowValue"),p(t)):(e.consume(t),f)}function b(n){return e.exit("codeFenced"),t(n)}}};const fa=document.createElement("i");function ba(e){const t="&"+e+";";fa.innerHTML=t;const n=fa.textContent;return(59!==n.charCodeAt(n.length-1)||"semi"===e)&&(n!==t&&n)}const ya={name:"characterReference",tokenize:function(e,t,n){const s=this;let r,a,l=0;return function(t){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(t),e.exit("characterReferenceMarker"),o};function o(t){return 35===t?(e.enter("characterReferenceMarkerNumeric"),e.consume(t),e.exit("characterReferenceMarkerNumeric"),i):(e.enter("characterReferenceValue"),r=31,a=Nr,c(t))}function i(t){return 88===t||120===t?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(t),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),r=6,a=_r,c):(e.enter("characterReferenceValue"),r=7,a=Sr,c(t))}function c(o){if(59===o&&l){const r=e.exit("characterReferenceValue");return a!==Nr||ba(s.sliceSerialize(r))?(e.enter("characterReferenceMarker"),e.consume(o),e.exit("characterReferenceMarker"),e.exit("characterReference"),t):n(o)}return a(o)&&l++<r?(e.consume(o),c):n(o)}}};const va={name:"characterEscape",tokenize:function(e,t,n){return function(t){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(t),e.exit("escapeMarker"),s};function s(s){return Cr(s)?(e.enter("characterEscapeValue"),e.consume(s),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):n(s)}}};const ja={name:"lineEnding",tokenize:function(e,t){return function(n){return e.enter("lineEnding"),e.consume(n),e.exit("lineEnding"),Ar(e,t,"linePrefix")}}};function Na(e,t,n){const s=[];let r=-1;for(;++r<e.length;){const a=e[r].resolveAll;a&&!s.includes(a)&&(t=a(t,n),s.push(a))}return t}const wa={name:"labelEnd",resolveAll:function(e){let t=-1;const n=[];for(;++t<e.length;){const s=e[t][1];if(n.push(e[t]),"labelImage"===s.type||"labelLink"===s.type||"labelEnd"===s.type){const e="labelImage"===s.type?4:2;s.type="data",t+=e}}e.length!==n.length&&ur(e,0,e.length,n);return e},resolveTo:function(e,t){let n,s,r,a,l=e.length,o=0;for(;l--;)if(n=e[l][1],s){if("link"===n.type||"labelLink"===n.type&&n._inactive)break;"enter"===e[l][0]&&"labelLink"===n.type&&(n._inactive=!0)}else if(r){if("enter"===e[l][0]&&("labelImage"===n.type||"labelLink"===n.type)&&!n._balanced&&(s=l,"labelLink"!==n.type)){o=2;break}}else"labelEnd"===n.type&&(r=l);const i={type:"labelLink"===e[s][1].type?"link":"image",start:{...e[s][1].start},end:{...e[e.length-1][1].end}},c={type:"label",start:{...e[s][1].start},end:{...e[r][1].end}},d={type:"labelText",start:{...e[s+o+2][1].end},end:{...e[r-2][1].start}};return a=[["enter",i,t],["enter",c,t]],a=mr(a,e.slice(s+1,s+o+3)),a=mr(a,[["enter",d,t]]),a=mr(a,Na(t.parser.constructs.insideSpan.null,e.slice(s+o+4,r-3),t)),a=mr(a,[["exit",d,t],e[r-2],e[r-1],["exit",c,t]]),a=mr(a,e.slice(r+1)),a=mr(a,[["exit",i,t]]),ur(e,s,e.length,a),e},tokenize:function(e,t,n){const s=this;let r,a,l=s.events.length;for(;l--;)if(("labelImage"===s.events[l][1].type||"labelLink"===s.events[l][1].type)&&!s.events[l][1]._balanced){r=s.events[l][1];break}return function(t){if(!r)return n(t);if(r._inactive)return d(t);return a=s.parser.defined.includes(sa(s.sliceSerialize({start:r.end,end:s.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelEnd"),o};function o(t){return 40===t?e.attempt(ka,c,a?c:d)(t):91===t?e.attempt(Sa,c,a?i:d)(t):a?c(t):d(t)}function i(t){return e.attempt(_a,c,d)(t)}function c(e){return t(e)}function d(e){return r._balanced=!0,n(e)}}},ka={tokenize:function(e,t,n){return function(t){return e.enter("resource"),e.enter("resourceMarker"),e.consume(t),e.exit("resourceMarker"),s};function s(t){return Tr(t)?na(e,r)(t):r(t)}function r(t){return 41===t?c(t):Xr(e,a,l,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(t)}function a(t){return Tr(t)?na(e,o)(t):c(t)}function l(e){return n(e)}function o(t){return 34===t||39===t||40===t?ta(e,i,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(t):c(t)}function i(t){return Tr(t)?na(e,c)(t):c(t)}function c(s){return 41===s?(e.enter("resourceMarker"),e.consume(s),e.exit("resourceMarker"),e.exit("resource"),t):n(s)}}},Sa={tokenize:function(e,t,n){const s=this;return function(t){return ea.call(s,e,r,a,"reference","referenceMarker","referenceString")(t)};function r(e){return s.parser.defined.includes(sa(s.sliceSerialize(s.events[s.events.length-1][1]).slice(1,-1)))?t(e):n(e)}function a(e){return n(e)}}},_a={tokenize:function(e,t,n){return function(t){return e.enter("reference"),e.enter("referenceMarker"),e.consume(t),e.exit("referenceMarker"),s};function s(s){return 93===s?(e.enter("referenceMarker"),e.consume(s),e.exit("referenceMarker"),e.exit("reference"),t):n(s)}}};const Ca={name:"labelStartImage",resolveAll:wa.resolveAll,tokenize:function(e,t,n){const s=this;return function(t){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(t),e.exit("labelImageMarker"),r};function r(t){return 91===t?(e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelImage"),a):n(t)}function a(e){return 94===e&&"_hiddenFootnoteSupport"in s.parser.constructs?n(e):t(e)}}};function Ia(e){return null===e||Tr(e)||Er(e)?1:Lr(e)?2:void 0}const Ta={name:"attention",resolveAll:function(e,t){let n,s,r,a,l,o,i,c,d=-1;for(;++d<e.length;)if("enter"===e[d][0]&&"attentionSequence"===e[d][1].type&&e[d][1]._close)for(n=d;n--;)if("exit"===e[n][0]&&"attentionSequence"===e[n][1].type&&e[n][1]._open&&t.sliceSerialize(e[n][1]).charCodeAt(0)===t.sliceSerialize(e[d][1]).charCodeAt(0)){if((e[n][1]._close||e[d][1]._open)&&(e[d][1].end.offset-e[d][1].start.offset)%3&&!((e[n][1].end.offset-e[n][1].start.offset+e[d][1].end.offset-e[d][1].start.offset)%3))continue;o=e[n][1].end.offset-e[n][1].start.offset>1&&e[d][1].end.offset-e[d][1].start.offset>1?2:1;const u={...e[n][1].end},m={...e[d][1].start};Pa(u,-o),Pa(m,o),a={type:o>1?"strongSequence":"emphasisSequence",start:u,end:{...e[n][1].end}},l={type:o>1?"strongSequence":"emphasisSequence",start:{...e[d][1].start},end:m},r={type:o>1?"strongText":"emphasisText",start:{...e[n][1].end},end:{...e[d][1].start}},s={type:o>1?"strong":"emphasis",start:{...a.start},end:{...l.end}},e[n][1].end={...a.start},e[d][1].start={...l.end},i=[],e[n][1].end.offset-e[n][1].start.offset&&(i=mr(i,[["enter",e[n][1],t],["exit",e[n][1],t]])),i=mr(i,[["enter",s,t],["enter",a,t],["exit",a,t],["enter",r,t]]),i=mr(i,Na(t.parser.constructs.insideSpan.null,e.slice(n+1,d),t)),i=mr(i,[["exit",r,t],["enter",l,t],["exit",l,t],["exit",s,t]]),e[d][1].end.offset-e[d][1].start.offset?(c=2,i=mr(i,[["enter",e[d][1],t],["exit",e[d][1],t]])):c=0,ur(e,n-1,d-n+3,i),d=n+i.length-c-2;break}d=-1;for(;++d<e.length;)"attentionSequence"===e[d][1].type&&(e[d][1].type="data");return e},tokenize:function(e,t){const n=this.parser.constructs.attentionMarkers.null,s=this.previous,r=Ia(s);let a;return function(t){return a=t,e.enter("attentionSequence"),l(t)};function l(o){if(o===a)return e.consume(o),l;const i=e.exit("attentionSequence"),c=Ia(o),d=!c||2===c&&r||n.includes(o),u=!r||2===r&&c||n.includes(s);return i._open=Boolean(42===a?d:d&&(r||!u)),i._close=Boolean(42===a?u:u&&(c||!d)),t(o)}}};function Pa(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const La={name:"autolink",tokenize:function(e,t,n){let s=0;return function(t){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(t),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),r};function r(t){return jr(t)?(e.consume(t),a):64===t?n(t):i(t)}function a(e){return 43===e||45===e||46===e||Nr(e)?(s=1,l(e)):i(e)}function l(t){return 58===t?(e.consume(t),s=0,o):(43===t||45===t||46===t||Nr(t))&&s++<32?(e.consume(t),l):(s=0,i(t))}function o(s){return 62===s?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(s),e.exit("autolinkMarker"),e.exit("autolink"),t):null===s||32===s||60===s||kr(s)?n(s):(e.consume(s),o)}function i(t){return 64===t?(e.consume(t),c):wr(t)?(e.consume(t),i):n(t)}function c(e){return Nr(e)?d(e):n(e)}function d(n){return 46===n?(e.consume(n),s=0,c):62===n?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(n),e.exit("autolinkMarker"),e.exit("autolink"),t):u(n)}function u(t){if((45===t||Nr(t))&&s++<63){const n=45===t?u:d;return e.consume(t),n}return n(t)}}};const Ea={name:"htmlText",tokenize:function(e,t,n){const s=this;let r,a,l;return function(t){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(t),o};function o(t){return 33===t?(e.consume(t),i):47===t?(e.consume(t),v):63===t?(e.consume(t),b):jr(t)?(e.consume(t),w):n(t)}function i(t){return 45===t?(e.consume(t),c):91===t?(e.consume(t),a=0,x):jr(t)?(e.consume(t),f):n(t)}function c(t){return 45===t?(e.consume(t),m):n(t)}function d(t){return null===t?n(t):45===t?(e.consume(t),u):Ir(t)?(l=d,E(t)):(e.consume(t),d)}function u(t){return 45===t?(e.consume(t),m):d(t)}function m(e){return 62===e?L(e):45===e?u(e):d(e)}function x(t){const s="CDATA[";return t===s.charCodeAt(a++)?(e.consume(t),6===a?g:x):n(t)}function g(t){return null===t?n(t):93===t?(e.consume(t),h):Ir(t)?(l=g,E(t)):(e.consume(t),g)}function h(t){return 93===t?(e.consume(t),p):g(t)}function p(t){return 62===t?L(t):93===t?(e.consume(t),p):g(t)}function f(t){return null===t||62===t?L(t):Ir(t)?(l=f,E(t)):(e.consume(t),f)}function b(t){return null===t?n(t):63===t?(e.consume(t),y):Ir(t)?(l=b,E(t)):(e.consume(t),b)}function y(e){return 62===e?L(e):b(e)}function v(t){return jr(t)?(e.consume(t),j):n(t)}function j(t){return 45===t||Nr(t)?(e.consume(t),j):N(t)}function N(t){return Ir(t)?(l=N,E(t)):Pr(t)?(e.consume(t),N):L(t)}function w(t){return 45===t||Nr(t)?(e.consume(t),w):47===t||62===t||Tr(t)?k(t):n(t)}function k(t){return 47===t?(e.consume(t),L):58===t||95===t||jr(t)?(e.consume(t),S):Ir(t)?(l=k,E(t)):Pr(t)?(e.consume(t),k):L(t)}function S(t){return 45===t||46===t||58===t||95===t||Nr(t)?(e.consume(t),S):_(t)}function _(t){return 61===t?(e.consume(t),C):Ir(t)?(l=_,E(t)):Pr(t)?(e.consume(t),_):k(t)}function C(t){return null===t||60===t||61===t||62===t||96===t?n(t):34===t||39===t?(e.consume(t),r=t,I):Ir(t)?(l=C,E(t)):Pr(t)?(e.consume(t),C):(e.consume(t),T)}function I(t){return t===r?(e.consume(t),r=void 0,P):null===t?n(t):Ir(t)?(l=I,E(t)):(e.consume(t),I)}function T(t){return null===t||34===t||39===t||60===t||61===t||96===t?n(t):47===t||62===t||Tr(t)?k(t):(e.consume(t),T)}function P(e){return 47===e||62===e||Tr(e)?k(e):n(e)}function L(s){return 62===s?(e.consume(s),e.exit("htmlTextData"),e.exit("htmlText"),t):n(s)}function E(t){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),D}function D(t){return Pr(t)?Ar(e,A,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):A(t)}function A(t){return e.enter("htmlTextData"),l(t)}}};const Da={name:"labelStartLink",resolveAll:wa.resolveAll,tokenize:function(e,t,n){const s=this;return function(t){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(t),e.exit("labelMarker"),e.exit("labelLink"),r};function r(e){return 94===e&&"_hiddenFootnoteSupport"in s.parser.constructs?n(e):t(e)}}};const Aa={name:"hardBreakEscape",tokenize:function(e,t,n){return function(t){return e.enter("hardBreakEscape"),e.consume(t),s};function s(s){return Ir(s)?(e.exit("hardBreakEscape"),t(s)):n(s)}}};const $a={name:"codeText",previous:function(e){return 96!==e||"characterEscape"===this.events[this.events.length-1][1].type},resolve:function(e){let t,n,s=e.length-4,r=3;if(("lineEnding"===e[r][1].type||"space"===e[r][1].type)&&("lineEnding"===e[s][1].type||"space"===e[s][1].type))for(t=r;++t<s;)if("codeTextData"===e[t][1].type){e[r][1].type="codeTextPadding",e[s][1].type="codeTextPadding",r+=2,s-=2;break}t=r-1,s++;for(;++t<=s;)void 0===n?t!==s&&"lineEnding"!==e[t][1].type&&(n=t):t!==s&&"lineEnding"!==e[t][1].type||(e[n][1].type="codeTextData",t!==n+2&&(e[n][1].end=e[t-1][1].end,e.splice(n+2,t-n-2),s-=t-n-2,t=n+2),n=void 0);return e},tokenize:function(e,t,n){let s,r,a=0;return function(t){return e.enter("codeText"),e.enter("codeTextSequence"),l(t)};function l(t){return 96===t?(e.consume(t),a++,l):(e.exit("codeTextSequence"),o(t))}function o(t){return null===t?n(t):32===t?(e.enter("space"),e.consume(t),e.exit("space"),o):96===t?(r=e.enter("codeTextSequence"),s=0,c(t)):Ir(t)?(e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),o):(e.enter("codeTextData"),i(t))}function i(t){return null===t||32===t||96===t||Ir(t)?(e.exit("codeTextData"),o(t)):(e.consume(t),i)}function c(n){return 96===n?(e.consume(n),s++,c):s===a?(e.exit("codeTextSequence"),e.exit("codeText"),t(n)):(r.type="codeTextData",i(n))}}};const za={42:Kr,43:Kr,45:Kr,48:Kr,49:Kr,50:Kr,51:Kr,52:Kr,53:Kr,54:Kr,55:Kr,56:Kr,57:Kr,62:Zr},Oa={91:ra},Ra={[-2]:la,[-1]:la,32:la},Ma={35:ia,42:Qr,45:[ca,Qr],60:ma,61:ca,95:Qr,96:pa,126:pa},Fa={38:ya,92:va},Ua={[-5]:ja,[-4]:ja,[-3]:ja,33:Ca,38:ya,42:Ta,60:[La,Ea],91:Da,92:[Aa,va],93:wa,95:Ta,96:$a},Ba={null:[Ta,Br]},Ja={null:[42,95]},qa={null:[]};function Va(e,t,n){let s={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const r={},a=[];let l=[],o=[],i=!0;const c={attempt:b(function(e,t){y(e,t.from)}),check:b(f),consume:function(e){Ir(e)?(s.line++,s.column=1,s.offset+=-3===e?2:1,v()):-1!==e&&(s.column++,s.offset++);s._bufferIndex<0?s._index++:(s._bufferIndex++,s._bufferIndex===l[s._index].length&&(s._bufferIndex=-1,s._index++));d.previous=e,i=!0},enter:function(e,t){const n=t||{};return n.type=e,n.start=g(),d.events.push(["enter",n,d]),o.push(n),n},exit:function(e){const t=o.pop();return t.end=g(),d.events.push(["exit",t,d]),t},interrupt:b(f,{interrupt:!0})},d={code:null,containerState:{},defineSkip:function(e){r[e.line]=e.column,v()},events:[],now:g,parser:e,previous:null,sliceSerialize:function(e,t){return function(e,t){let n=-1;const s=[];let r;for(;++n<e.length;){const a=e[n];let l;if("string"===typeof a)l=a;else switch(a){case-5:l="\r";break;case-4:l="\n";break;case-3:l="\r\n";break;case-2:l=t?" ":"\t";break;case-1:if(!t&&r)continue;l=" ";break;default:l=String.fromCharCode(a)}r=-2===a,s.push(l)}return s.join("")}(x(e),t)},sliceStream:x,write:function(e){if(l=mr(l,e),h(),null!==l[l.length-1])return[];return y(t,0),d.events=Na(a,d.events,d),d.events}};let u,m=t.tokenize.call(d,c);return t.resolveAll&&a.push(t),d;function x(e){return function(e,t){const n=t.start._index,s=t.start._bufferIndex,r=t.end._index,a=t.end._bufferIndex;let l;if(n===r)l=[e[n].slice(s,a)];else{if(l=e.slice(n,r),s>-1){const e=l[0];"string"===typeof e?l[0]=e.slice(s):l.shift()}a>0&&l.push(e[r].slice(0,a))}return l}(l,e)}function g(){const{_bufferIndex:e,_index:t,line:n,column:r,offset:a}=s;return{_bufferIndex:e,_index:t,line:n,column:r,offset:a}}function h(){let e;for(;s._index<l.length;){const t=l[s._index];if("string"===typeof t)for(e=s._index,s._bufferIndex<0&&(s._bufferIndex=0);s._index===e&&s._bufferIndex<t.length;)p(t.charCodeAt(s._bufferIndex));else p(t)}}function p(e){i=void 0,u=e,m=m(e)}function f(e,t){t.restore()}function b(e,t){return function(n,r,a){let l,u,m,x;return Array.isArray(n)?h(n):"tokenize"in n?h([n]):function(e){return t;function t(t){const n=null!==t&&e[t],s=null!==t&&e.null;return h([...Array.isArray(n)?n:n?[n]:[],...Array.isArray(s)?s:s?[s]:[]])(t)}}(n);function h(e){return l=e,u=0,0===e.length?a:p(e[u])}function p(e){return function(n){x=function(){const e=g(),t=d.previous,n=d.currentConstruct,r=d.events.length,a=Array.from(o);return{from:r,restore:l};function l(){s=e,d.previous=t,d.currentConstruct=n,d.events.length=r,o=a,v()}}(),m=e,e.partial||(d.currentConstruct=e);if(e.name&&d.parser.constructs.disable.null.includes(e.name))return b(n);return e.tokenize.call(t?Object.assign(Object.create(d),t):d,c,f,b)(n)}}function f(t){return i=!0,e(m,x),r}function b(e){return i=!0,x.restore(),++u<l.length?p(l[u]):a}}}function y(e,t){e.resolveAll&&!a.includes(e)&&a.push(e),e.resolve&&ur(d.events,t,d.events.length-t,e.resolve(d.events.slice(t),d)),e.resolveTo&&(d.events=e.resolveTo(d.events,d))}function v(){s.line in r&&s.column<2&&(s.column=r[s.line],s.offset+=r[s.line]-1)}}const Ha=/[\0\t\n\r]/g;function Wa(e,t){const n=Number.parseInt(e,t);return n<9||11===n||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||65535===(65535&n)||65534===(65535&n)||n>1114111?"\ufffd":String.fromCodePoint(n)}const Qa=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function Ka(e,t,n){if(t)return t;if(35===n.charCodeAt(0)){const e=n.charCodeAt(1),t=120===e||88===e;return Wa(n.slice(t?2:1),t?16:10)}return ba(n)||e}const Ya={}.hasOwnProperty;function Ga(e,n,s){return"string"!==typeof n&&(s=n,n=void 0),function(e){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:a(te),autolinkProtocol:S,autolinkEmail:S,atxHeading:a(G),blockQuote:a(H),characterEscape:S,characterReference:S,codeFenced:a(W),codeFencedFenceInfo:l,codeFencedFenceMeta:l,codeIndented:a(W,l),codeText:a(Q,l),codeTextData:S,data:S,codeFlowValue:S,definition:a(K),definitionDestinationString:l,definitionLabelString:l,definitionTitleString:l,emphasis:a(Y),hardBreakEscape:a(Z),hardBreakTrailing:a(Z),htmlFlow:a(X,l),htmlFlowData:S,htmlText:a(X,l),htmlTextData:S,image:a(ee),label:l,link:a(te),listItem:a(se),listItemValue:m,listOrdered:a(ne,u),listUnordered:a(ne),paragraph:a(re),reference:M,referenceString:l,resourceDestinationString:l,resourceTitleString:l,setextHeading:a(G),strong:a(ae),thematicBreak:a(oe)},exit:{atxHeading:i(),atxHeadingSequence:j,autolink:i(),autolinkEmail:V,autolinkProtocol:q,blockQuote:i(),characterEscapeValue:_,characterReferenceMarkerHexadecimal:U,characterReferenceMarkerNumeric:U,characterReferenceValue:B,characterReference:J,codeFenced:i(p),codeFencedFence:h,codeFencedFenceInfo:x,codeFencedFenceMeta:g,codeFlowValue:_,codeIndented:i(f),codeText:i(L),codeTextData:_,data:_,definition:i(),definitionDestinationString:v,definitionLabelString:b,definitionTitleString:y,emphasis:i(),hardBreakEscape:i(I),hardBreakTrailing:i(I),htmlFlow:i(T),htmlFlowData:_,htmlText:i(P),htmlTextData:_,image:i(D),label:$,labelText:A,lineEnding:C,link:i(E),listItem:i(),listOrdered:i(),listUnordered:i(),paragraph:i(),referenceString:F,resourceDestinationString:z,resourceTitleString:O,resource:R,setextHeading:i(k),setextHeadingLineSequence:w,setextHeadingText:N,strong:i(),thematicBreak:i()}};Xa(t,(e||{}).mdastExtensions||[]);const n={};return s;function s(e){let s={type:"root",children:[]};const a={stack:[s],tokenStack:[],config:t,enter:o,exit:c,buffer:l,resume:d,data:n},i=[];let u=-1;for(;++u<e.length;)if("listOrdered"===e[u][1].type||"listUnordered"===e[u][1].type)if("enter"===e[u][0])i.push(u);else{u=r(e,i.pop(),u)}for(u=-1;++u<e.length;){const n=t[e[u][0]];Ya.call(n,e[u][1].type)&&n[e[u][1].type].call(Object.assign({sliceSerialize:e[u][2].sliceSerialize},a),e[u][1])}if(a.tokenStack.length>0){const e=a.tokenStack[a.tokenStack.length-1];(e[1]||tl).call(a,void 0,e[0])}for(s.position={start:Za(e.length>0?e[0][1].start:{line:1,column:1,offset:0}),end:Za(e.length>0?e[e.length-2][1].end:{line:1,column:1,offset:0})},u=-1;++u<t.transforms.length;)s=t.transforms[u](s)||s;return s}function r(e,t,n){let s,r,a,l,o=t-1,i=-1,c=!1;for(;++o<=n;){const t=e[o];switch(t[1].type){case"listUnordered":case"listOrdered":case"blockQuote":"enter"===t[0]?i++:i--,l=void 0;break;case"lineEndingBlank":"enter"===t[0]&&(!s||l||i||a||(a=o),l=void 0);break;case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:l=void 0}if(!i&&"enter"===t[0]&&"listItemPrefix"===t[1].type||-1===i&&"exit"===t[0]&&("listUnordered"===t[1].type||"listOrdered"===t[1].type)){if(s){let l=o;for(r=void 0;l--;){const t=e[l];if("lineEnding"===t[1].type||"lineEndingBlank"===t[1].type){if("exit"===t[0])continue;r&&(e[r][1].type="lineEndingBlank",c=!0),t[1].type="lineEnding",r=l}else if("linePrefix"!==t[1].type&&"blockQuotePrefix"!==t[1].type&&"blockQuotePrefixWhitespace"!==t[1].type&&"blockQuoteMarker"!==t[1].type&&"listItemIndent"!==t[1].type)break}a&&(!r||a<r)&&(s._spread=!0),s.end=Object.assign({},r?e[r][1].start:t[1].end),e.splice(r||o,0,["exit",s,t[2]]),o++,n++}if("listItemPrefix"===t[1].type){const r={type:"listItem",_spread:!1,start:Object.assign({},t[1].start),end:void 0};s=r,e.splice(o,0,["enter",r,t[2]]),o++,n++,a=void 0,l=!0}}}return e[t][1]._spread=c,n}function a(e,t){return n;function n(n){o.call(this,e(n),n),t&&t.call(this,n)}}function l(){this.stack.push({type:"fragment",children:[]})}function o(e,t,n){this.stack[this.stack.length-1].children.push(e),this.stack.push(e),this.tokenStack.push([t,n||void 0]),e.position={start:Za(t.start),end:void 0}}function i(e){return t;function t(t){e&&e.call(this,t),c.call(this,t)}}function c(e,t){const n=this.stack.pop(),s=this.tokenStack.pop();if(!s)throw new Error("Cannot close `"+e.type+"` ("+Ms({start:e.start,end:e.end})+"): it\u2019s not open");if(s[0].type!==e.type)if(t)t.call(this,e,s[0]);else{(s[1]||tl).call(this,e,s[0])}n.position.end=Za(e.end)}function d(){return ir(this.stack.pop())}function u(){this.data.expectingFirstListItemValue=!0}function m(e){if(this.data.expectingFirstListItemValue){this.stack[this.stack.length-2].start=Number.parseInt(this.sliceSerialize(e),10),this.data.expectingFirstListItemValue=void 0}}function x(){const e=this.resume();this.stack[this.stack.length-1].lang=e}function g(){const e=this.resume();this.stack[this.stack.length-1].meta=e}function h(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function p(){const e=this.resume();this.stack[this.stack.length-1].value=e.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function f(){const e=this.resume();this.stack[this.stack.length-1].value=e.replace(/(\r?\n|\r)$/g,"")}function b(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.label=t,n.identifier=sa(this.sliceSerialize(e)).toLowerCase()}function y(){const e=this.resume();this.stack[this.stack.length-1].title=e}function v(){const e=this.resume();this.stack[this.stack.length-1].url=e}function j(e){const t=this.stack[this.stack.length-1];if(!t.depth){const n=this.sliceSerialize(e).length;t.depth=n}}function N(){this.data.setextHeadingSlurpLineEnding=!0}function w(e){this.stack[this.stack.length-1].depth=61===this.sliceSerialize(e).codePointAt(0)?1:2}function k(){this.data.setextHeadingSlurpLineEnding=void 0}function S(e){const t=this.stack[this.stack.length-1].children;let n=t[t.length-1];n&&"text"===n.type||(n=le(),n.position={start:Za(e.start),end:void 0},t.push(n)),this.stack.push(n)}function _(e){const t=this.stack.pop();t.value+=this.sliceSerialize(e),t.position.end=Za(e.end)}function C(e){const n=this.stack[this.stack.length-1];if(this.data.atHardBreak){return n.children[n.children.length-1].position.end=Za(e.end),void(this.data.atHardBreak=void 0)}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(n.type)&&(S.call(this,e),_.call(this,e))}function I(){this.data.atHardBreak=!0}function T(){const e=this.resume();this.stack[this.stack.length-1].value=e}function P(){const e=this.resume();this.stack[this.stack.length-1].value=e}function L(){const e=this.resume();this.stack[this.stack.length-1].value=e}function E(){const e=this.stack[this.stack.length-1];if(this.data.inReference){const t=this.data.referenceType||"shortcut";e.type+="Reference",e.referenceType=t,delete e.url,delete e.title}else delete e.identifier,delete e.label;this.data.referenceType=void 0}function D(){const e=this.stack[this.stack.length-1];if(this.data.inReference){const t=this.data.referenceType||"shortcut";e.type+="Reference",e.referenceType=t,delete e.url,delete e.title}else delete e.identifier,delete e.label;this.data.referenceType=void 0}function A(e){const t=this.sliceSerialize(e),n=this.stack[this.stack.length-2];n.label=function(e){return e.replace(Qa,Ka)}(t),n.identifier=sa(t).toLowerCase()}function $(){const e=this.stack[this.stack.length-1],t=this.resume(),n=this.stack[this.stack.length-1];if(this.data.inReference=!0,"link"===n.type){const t=e.children;n.children=t}else n.alt=t}function z(){const e=this.resume();this.stack[this.stack.length-1].url=e}function O(){const e=this.resume();this.stack[this.stack.length-1].title=e}function R(){this.data.inReference=void 0}function M(){this.data.referenceType="collapsed"}function F(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.label=t,n.identifier=sa(this.sliceSerialize(e)).toLowerCase(),this.data.referenceType="full"}function U(e){this.data.characterReferenceType=e.type}function B(e){const t=this.sliceSerialize(e),n=this.data.characterReferenceType;let s;if(n)s=Wa(t,"characterReferenceMarkerNumeric"===n?10:16),this.data.characterReferenceType=void 0;else{s=ba(t)}this.stack[this.stack.length-1].value+=s}function J(e){this.stack.pop().position.end=Za(e.end)}function q(e){_.call(this,e);this.stack[this.stack.length-1].url=this.sliceSerialize(e)}function V(e){_.call(this,e);this.stack[this.stack.length-1].url="mailto:"+this.sliceSerialize(e)}function H(){return{type:"blockquote",children:[]}}function W(){return{type:"code",lang:null,meta:null,value:""}}function Q(){return{type:"inlineCode",value:""}}function K(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Y(){return{type:"emphasis",children:[]}}function G(){return{type:"heading",depth:0,children:[]}}function Z(){return{type:"break"}}function X(){return{type:"html",value:""}}function ee(){return{type:"image",title:null,url:"",alt:null}}function te(){return{type:"link",title:null,url:"",children:[]}}function ne(e){return{type:"list",ordered:"listOrdered"===e.type,start:null,spread:e._spread,children:[]}}function se(e){return{type:"listItem",spread:e._spread,checked:null,children:[]}}function re(){return{type:"paragraph",children:[]}}function ae(){return{type:"strong",children:[]}}function le(){return{type:"text",value:""}}function oe(){return{type:"thematicBreak"}}}(s)(function(e){for(;!hr(e););return e}(function(e){const n={constructs:br([t,...(e||{}).extensions||[]]),content:s($r),defined:[],document:s(zr),flow:s(Ur),lazy:{},string:s(Jr),text:s(qr)};return n;function s(e){return function(t){return Va(n,e,t)}}}(s).document().write(function(){let e,t=1,n="",s=!0;return function(r,a,l){const o=[];let i,c,d,u,m;for(r=n+("string"===typeof r?r.toString():new TextDecoder(a||void 0).decode(r)),d=0,n="",s&&(65279===r.charCodeAt(0)&&d++,s=void 0);d<r.length;){if(Ha.lastIndex=d,i=Ha.exec(r),u=i&&void 0!==i.index?i.index:r.length,m=r.charCodeAt(u),!i){n=r.slice(d);break}if(10===m&&d===u&&e)o.push(-3),e=void 0;else switch(e&&(o.push(-5),e=void 0),d<u&&(o.push(r.slice(d,u)),t+=u-d),m){case 0:o.push(65533),t++;break;case 9:for(c=4*Math.ceil(t/4),o.push(-2);t++<c;)o.push(-1);break;case 10:o.push(-4),t=1;break;default:e=!0,t=1}d=u+1}return l&&(e&&o.push(-5),n&&o.push(n),o.push(null)),o}}()(e,n,!0))))}function Za(e){return{line:e.line,column:e.column,offset:e.offset}}function Xa(e,t){let n=-1;for(;++n<t.length;){const s=t[n];Array.isArray(s)?Xa(e,s):el(e,s)}}function el(e,t){let n;for(n in t)if(Ya.call(t,n))switch(n){case"canContainEols":{const s=t[n];s&&e[n].push(...s);break}case"transforms":{const s=t[n];s&&e[n].push(...s);break}case"enter":case"exit":{const s=t[n];s&&Object.assign(e[n],s);break}}}function tl(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+Ms({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+Ms({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+Ms({start:t.start,end:t.end})+") is still open")}function nl(e){const t=this;t.parser=function(n){return Ga(n,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}const sl="object"===typeof self?self:globalThis,rl=e=>((e,t)=>{const n=(t,n)=>(e.set(n,t),t),s=r=>{if(e.has(r))return e.get(r);const[a,l]=t[r];switch(a){case 0:case-1:return n(l,r);case 1:{const e=n([],r);for(const t of l)e.push(s(t));return e}case 2:{const e=n({},r);for(const[t,n]of l)e[s(t)]=s(n);return e}case 3:return n(new Date(l),r);case 4:{const{source:e,flags:t}=l;return n(new RegExp(e,t),r)}case 5:{const e=n(new Map,r);for(const[t,n]of l)e.set(s(t),s(n));return e}case 6:{const e=n(new Set,r);for(const t of l)e.add(s(t));return e}case 7:{const{name:e,message:t}=l;return n(new sl[e](t),r)}case 8:return n(BigInt(l),r);case"BigInt":return n(Object(BigInt(l)),r);case"ArrayBuffer":return n(new Uint8Array(l).buffer,l);case"DataView":{const{buffer:e}=new Uint8Array(l);return n(new DataView(e),l)}}return n(new sl[a](l),r)};return s})(new Map,e)(0),al="",{toString:ll}={},{keys:ol}=Object,il=e=>{const t=typeof e;if("object"!==t||!e)return[0,t];const n=ll.call(e).slice(8,-1);switch(n){case"Array":return[1,al];case"Object":return[2,al];case"Date":return[3,al];case"RegExp":return[4,al];case"Map":return[5,al];case"Set":return[6,al];case"DataView":return[1,n]}return n.includes("Array")?[1,n]:n.includes("Error")?[7,n]:[2,n]},cl=e=>{let[t,n]=e;return 0===t&&("function"===n||"symbol"===n)},dl=function(e){let{json:t,lossy:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=[];return((e,t,n,s)=>{const r=(e,t)=>{const r=s.push(e)-1;return n.set(t,r),r},a=s=>{if(n.has(s))return n.get(s);let[l,o]=il(s);switch(l){case 0:{let t=s;switch(o){case"bigint":l=8,t=s.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+o);t=null;break;case"undefined":return r([-1],s)}return r([l,t],s)}case 1:{if(o){let e=s;return"DataView"===o?e=new Uint8Array(s.buffer):"ArrayBuffer"===o&&(e=new Uint8Array(s)),r([o,[...e]],s)}const e=[],t=r([l,e],s);for(const n of s)e.push(a(n));return t}case 2:{if(o)switch(o){case"BigInt":return r([o,s.toString()],s);case"Boolean":case"Number":case"String":return r([o,s.valueOf()],s)}if(t&&"toJSON"in s)return a(s.toJSON());const n=[],i=r([l,n],s);for(const t of ol(s))!e&&cl(il(s[t]))||n.push([a(t),a(s[t])]);return i}case 3:return r([l,s.toISOString()],s);case 4:{const{source:e,flags:t}=s;return r([l,{source:e,flags:t}],s)}case 5:{const t=[],n=r([l,t],s);for(const[r,l]of s)(e||!cl(il(r))&&!cl(il(l)))&&t.push([a(r),a(l)]);return n}case 6:{const t=[],n=r([l,t],s);for(const r of s)!e&&cl(il(r))||t.push(a(r));return n}}const{message:i}=s;return r([l,{name:o,message:i}],s)};return a})(!(t||n),!!t,new Map,s)(e),s},ul="function"===typeof structuredClone?(e,t)=>t&&("json"in t||"lossy"in t)?rl(dl(e,t)):structuredClone(e):(e,t)=>rl(dl(e,t));function ml(e){const t=[];let n=-1,s=0,r=0;for(;++n<e.length;){const a=e.charCodeAt(n);let l="";if(37===a&&Nr(e.charCodeAt(n+1))&&Nr(e.charCodeAt(n+2)))r=2;else if(a<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(a))||(l=String.fromCharCode(a));else if(a>55295&&a<57344){const t=e.charCodeAt(n+1);a<56320&&t>56319&&t<57344?(l=String.fromCharCode(a,t),r=1):l="\ufffd"}else l=String.fromCharCode(a);l&&(t.push(e.slice(s,n),encodeURIComponent(l)),s=n+r+1,l=""),r&&(n+=r,r=0)}return t.join("")+e.slice(s)}function xl(e,t){const n=[{type:"text",value:"\u21a9"}];return t>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),n}function gl(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}const hl=function(e){if(null===e||void 0===e)return fl;if("function"===typeof e)return pl(e);if("object"===typeof e)return Array.isArray(e)?function(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=hl(e[n]);return pl(s);function s(){let e=-1;for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];for(;++e<t.length;)if(t[e].apply(this,s))return!0;return!1}}(e):function(e){const t=e;return pl(n);function n(n){const s=n;let r;for(r in e)if(s[r]!==t[r])return!1;return!0}}(e);if("string"===typeof e)return function(e){return pl(t);function t(t){return t&&t.type===e}}(e);throw new Error("Expected function, string, or object as test")};function pl(e){return function(t,n,s){return Boolean(bl(t)&&e.call(this,t,"number"===typeof n?n:void 0,s||void 0))}}function fl(){return!0}function bl(e){return null!==e&&"object"===typeof e&&"type"in e}const yl=[],vl=!0,jl=!1;function Nl(e,t,n,s){let r;"function"===typeof t&&"function"!==typeof n?(s=n,n=t):r=t;const a=hl(r),l=s?-1:1;!function e(r,o,i){const c=r&&"object"===typeof r?r:{};if("string"===typeof c.type){const e="string"===typeof c.tagName?c.tagName:"string"===typeof c.name?c.name:void 0;Object.defineProperty(d,"name",{value:"node ("+r.type+(e?"<"+e+">":"")+")"})}return d;function d(){let c,d,u,m=yl;if((!t||a(r,o,i[i.length-1]||void 0))&&(m=function(e){if(Array.isArray(e))return e;if("number"===typeof e)return[vl,e];return null===e||void 0===e?yl:[e]}(n(r,i)),m[0]===jl))return m;if("children"in r&&r.children){const t=r;if(t.children&&"skip"!==m[0])for(d=(s?t.children.length:-1)+l,u=i.concat(t);d>-1&&d<t.children.length;){const n=t.children[d];if(c=e(n,d,u)(),c[0]===jl)return c;d="number"===typeof c[1]?c[1]:d+l}}return m}}(e,void 0,[])()}function wl(e,t,n,s){let r,a,l;"function"===typeof t&&"function"!==typeof n?(a=void 0,l=t,r=n):(a=t,l=n,r=s),Nl(e,a,function(e,t){const n=t[t.length-1],s=n?n.children.indexOf(e):void 0;return l(e,s,n)},r)}function kl(e,t){const n=t.referenceType;let s="]";if("collapsed"===n?s+="[]":"full"===n&&(s+="["+(t.label||t.identifier)+"]"),"imageReference"===t.type)return[{type:"text",value:"!["+t.alt+s}];const r=e.all(t),a=r[0];a&&"text"===a.type?a.value="["+a.value:r.unshift({type:"text",value:"["});const l=r[r.length-1];return l&&"text"===l.type?l.value+=s:r.push({type:"text",value:s}),r}function Sl(e){const t=e.spread;return null===t||void 0===t?e.children.length>1:t}function _l(e){const t=String(e),n=/\r?\n|\r/g;let s=n.exec(t),r=0;const a=[];for(;s;)a.push(Cl(t.slice(r,s.index),r>0,!0),s[0]),r=s.index+s[0].length,s=n.exec(t);return a.push(Cl(t.slice(r),r>0,!1)),a.join("")}function Cl(e,t,n){let s=0,r=e.length;if(t){let t=e.codePointAt(s);for(;9===t||32===t;)s++,t=e.codePointAt(s)}if(n){let t=e.codePointAt(r-1);for(;9===t||32===t;)r--,t=e.codePointAt(r-1)}return r>s?e.slice(s,r):""}const Il={blockquote:function(e,t){const n={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,n),e.applyData(t,n)},break:function(e,t){const n={type:"element",tagName:"br",properties:{},children:[]};return e.patch(t,n),[e.applyData(t,n),{type:"text",value:"\n"}]},code:function(e,t){const n=t.value?t.value+"\n":"",s={};t.lang&&(s.className=["language-"+t.lang]);let r={type:"element",tagName:"code",properties:s,children:[{type:"text",value:n}]};return t.meta&&(r.data={meta:t.meta}),e.patch(t,r),r=e.applyData(t,r),r={type:"element",tagName:"pre",properties:{},children:[r]},e.patch(t,r),r},delete:function(e,t){const n={type:"element",tagName:"del",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},emphasis:function(e,t){const n={type:"element",tagName:"em",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},footnoteReference:function(e,t){const n="string"===typeof e.options.clobberPrefix?e.options.clobberPrefix:"user-content-",s=String(t.identifier).toUpperCase(),r=ml(s.toLowerCase()),a=e.footnoteOrder.indexOf(s);let l,o=e.footnoteCounts.get(s);void 0===o?(o=0,e.footnoteOrder.push(s),l=e.footnoteOrder.length):l=a+1,o+=1,e.footnoteCounts.set(s,o);const i={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+r,id:n+"fnref-"+r+(o>1?"-"+o:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(l)}]};e.patch(t,i);const c={type:"element",tagName:"sup",properties:{},children:[i]};return e.patch(t,c),e.applyData(t,c)},heading:function(e,t){const n={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},html:function(e,t){if(e.options.allowDangerousHtml){const n={type:"raw",value:t.value};return e.patch(t,n),e.applyData(t,n)}},imageReference:function(e,t){const n=String(t.identifier).toUpperCase(),s=e.definitionById.get(n);if(!s)return kl(e,t);const r={src:ml(s.url||""),alt:t.alt};null!==s.title&&void 0!==s.title&&(r.title=s.title);const a={type:"element",tagName:"img",properties:r,children:[]};return e.patch(t,a),e.applyData(t,a)},image:function(e,t){const n={src:ml(t.url)};null!==t.alt&&void 0!==t.alt&&(n.alt=t.alt),null!==t.title&&void 0!==t.title&&(n.title=t.title);const s={type:"element",tagName:"img",properties:n,children:[]};return e.patch(t,s),e.applyData(t,s)},inlineCode:function(e,t){const n={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};e.patch(t,n);const s={type:"element",tagName:"code",properties:{},children:[n]};return e.patch(t,s),e.applyData(t,s)},linkReference:function(e,t){const n=String(t.identifier).toUpperCase(),s=e.definitionById.get(n);if(!s)return kl(e,t);const r={href:ml(s.url||"")};null!==s.title&&void 0!==s.title&&(r.title=s.title);const a={type:"element",tagName:"a",properties:r,children:e.all(t)};return e.patch(t,a),e.applyData(t,a)},link:function(e,t){const n={href:ml(t.url)};null!==t.title&&void 0!==t.title&&(n.title=t.title);const s={type:"element",tagName:"a",properties:n,children:e.all(t)};return e.patch(t,s),e.applyData(t,s)},listItem:function(e,t,n){const s=e.all(t),r=n?function(e){let t=!1;if("list"===e.type){t=e.spread||!1;const n=e.children;let s=-1;for(;!t&&++s<n.length;)t=Sl(n[s])}return t}(n):Sl(t),a={},l=[];if("boolean"===typeof t.checked){const e=s[0];let n;e&&"element"===e.type&&"p"===e.tagName?n=e:(n={type:"element",tagName:"p",properties:{},children:[]},s.unshift(n)),n.children.length>0&&n.children.unshift({type:"text",value:" "}),n.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),a.className=["task-list-item"]}let o=-1;for(;++o<s.length;){const e=s[o];(r||0!==o||"element"!==e.type||"p"!==e.tagName)&&l.push({type:"text",value:"\n"}),"element"!==e.type||"p"!==e.tagName||r?l.push(e):l.push(...e.children)}const i=s[s.length-1];i&&(r||"element"!==i.type||"p"!==i.tagName)&&l.push({type:"text",value:"\n"});const c={type:"element",tagName:"li",properties:a,children:l};return e.patch(t,c),e.applyData(t,c)},list:function(e,t){const n={},s=e.all(t);let r=-1;for("number"===typeof t.start&&1!==t.start&&(n.start=t.start);++r<s.length;){const e=s[r];if("element"===e.type&&"li"===e.tagName&&e.properties&&Array.isArray(e.properties.className)&&e.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const a={type:"element",tagName:t.ordered?"ol":"ul",properties:n,children:e.wrap(s,!0)};return e.patch(t,a),e.applyData(t,a)},paragraph:function(e,t){const n={type:"element",tagName:"p",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},root:function(e,t){const n={type:"root",children:e.wrap(e.all(t))};return e.patch(t,n),e.applyData(t,n)},strong:function(e,t){const n={type:"element",tagName:"strong",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},table:function(e,t){const n=e.all(t),s=n.shift(),r=[];if(s){const n={type:"element",tagName:"thead",properties:{},children:e.wrap([s],!0)};e.patch(t.children[0],n),r.push(n)}if(n.length>0){const s={type:"element",tagName:"tbody",properties:{},children:e.wrap(n,!0)},a=Os(t.children[1]),l=zs(t.children[t.children.length-1]);a&&l&&(s.position={start:a,end:l}),r.push(s)}const a={type:"element",tagName:"table",properties:{},children:e.wrap(r,!0)};return e.patch(t,a),e.applyData(t,a)},tableCell:function(e,t){const n={type:"element",tagName:"td",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},tableRow:function(e,t,n){const s=n?n.children:void 0,r=0===(s?s.indexOf(t):1)?"th":"td",a=n&&"table"===n.type?n.align:void 0,l=a?a.length:t.children.length;let o=-1;const i=[];for(;++o<l;){const n=t.children[o],s={},l=a?a[o]:void 0;l&&(s.align=l);let c={type:"element",tagName:r,properties:s,children:[]};n&&(c.children=e.all(n),e.patch(n,c),c=e.applyData(n,c)),i.push(c)}const c={type:"element",tagName:"tr",properties:{},children:e.wrap(i,!0)};return e.patch(t,c),e.applyData(t,c)},text:function(e,t){const n={type:"text",value:_l(String(t.value))};return e.patch(t,n),e.applyData(t,n)},thematicBreak:function(e,t){const n={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(t,n),e.applyData(t,n)},toml:Tl,yaml:Tl,definition:Tl,footnoteDefinition:Tl};function Tl(){}const Pl={}.hasOwnProperty,Ll={};function El(e,t){e.position&&(t.position=function(e){const t=Os(e),n=zs(e);if(t&&n)return{start:t,end:n}}(e))}function Dl(e,t){let n=t;if(e&&e.data){const t=e.data.hName,s=e.data.hChildren,r=e.data.hProperties;if("string"===typeof t)if("element"===n.type)n.tagName=t;else{n={type:"element",tagName:t,properties:{},children:"children"in n?n.children:[n]}}"element"===n.type&&r&&Object.assign(n.properties,ul(r)),"children"in n&&n.children&&null!==s&&void 0!==s&&(n.children=s)}return n}function Al(e,t){const n=t.data||{},s=!("value"in t)||Pl.call(n,"hProperties")||Pl.call(n,"hChildren")?{type:"element",tagName:"div",properties:{},children:e.all(t)}:{type:"text",value:t.value};return e.patch(t,s),e.applyData(t,s)}function $l(e,t){const n=[];let s=-1;for(t&&n.push({type:"text",value:"\n"});++s<e.length;)s&&n.push({type:"text",value:"\n"}),n.push(e[s]);return t&&e.length>0&&n.push({type:"text",value:"\n"}),n}function zl(e){let t=0,n=e.charCodeAt(t);for(;9===n||32===n;)t++,n=e.charCodeAt(t);return e.slice(t)}function Ol(e,t){const n=function(e,t){const n=t||Ll,s=new Map,r=new Map,a=new Map,l={...Il,...n.handlers},o={all:function(e){const t=[];if("children"in e){const n=e.children;let s=-1;for(;++s<n.length;){const r=o.one(n[s],e);if(r){if(s&&"break"===n[s-1].type&&(Array.isArray(r)||"text"!==r.type||(r.value=zl(r.value)),!Array.isArray(r)&&"element"===r.type)){const e=r.children[0];e&&"text"===e.type&&(e.value=zl(e.value))}Array.isArray(r)?t.push(...r):t.push(r)}}}return t},applyData:Dl,definitionById:s,footnoteById:r,footnoteCounts:a,footnoteOrder:[],handlers:l,one:function(e,t){const n=e.type,s=o.handlers[n];if(Pl.call(o.handlers,n)&&s)return s(o,e,t);if(o.options.passThrough&&o.options.passThrough.includes(n)){if("children"in e){const{children:t,...n}=e,s=ul(n);return s.children=o.all(e),s}return ul(e)}return(o.options.unknownHandler||Al)(o,e,t)},options:n,patch:El,wrap:$l};return wl(e,function(e){if("definition"===e.type||"footnoteDefinition"===e.type){const t="definition"===e.type?s:r,n=String(e.identifier).toUpperCase();t.has(n)||t.set(n,e)}}),o}(e,t),s=n.one(e,void 0),r=function(e){const t="string"===typeof e.options.clobberPrefix?e.options.clobberPrefix:"user-content-",n=e.options.footnoteBackContent||xl,s=e.options.footnoteBackLabel||gl,r=e.options.footnoteLabel||"Footnotes",a=e.options.footnoteLabelTagName||"h2",l=e.options.footnoteLabelProperties||{className:["sr-only"]},o=[];let i=-1;for(;++i<e.footnoteOrder.length;){const r=e.footnoteById.get(e.footnoteOrder[i]);if(!r)continue;const a=e.all(r),l=String(r.identifier).toUpperCase(),c=ml(l.toLowerCase());let d=0;const u=[],m=e.footnoteCounts.get(l);for(;void 0!==m&&++d<=m;){u.length>0&&u.push({type:"text",value:" "});let e="string"===typeof n?n:n(i,d);"string"===typeof e&&(e={type:"text",value:e}),u.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+c+(d>1?"-"+d:""),dataFootnoteBackref:"",ariaLabel:"string"===typeof s?s:s(i,d),className:["data-footnote-backref"]},children:Array.isArray(e)?e:[e]})}const x=a[a.length-1];if(x&&"element"===x.type&&"p"===x.tagName){const e=x.children[x.children.length-1];e&&"text"===e.type?e.value+=" ":x.children.push({type:"text",value:" "}),x.children.push(...u)}else a.push(...u);const g={type:"element",tagName:"li",properties:{id:t+"fn-"+c},children:e.wrap(a,!0)};e.patch(r,g),o.push(g)}if(0!==o.length)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:a,properties:{...ul(l),id:"footnote-label"},children:[{type:"text",value:r}]},{type:"text",value:"\n"},{type:"element",tagName:"ol",properties:{},children:e.wrap(o,!0)},{type:"text",value:"\n"}]}}(n),a=Array.isArray(s)?{type:"root",children:s}:s||{type:"root",children:[]};return r&&a.children.push({type:"text",value:"\n"},r),a}function Rl(e,t){return e&&"run"in e?async function(n,s){const r=Ol(n,{file:s,...t});await e.run(r,s)}:function(n,s){return Ol(n,{file:s,...e||t})}}function Ml(e){if(e)throw e}var Fl=n(240);function Ul(e){if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function Bl(){const e=[],t={run:function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];let r=-1;const a=n.pop();if("function"!==typeof a)throw new TypeError("Expected function as last argument, not "+a);!function t(s){const l=e[++r];let o=-1;if(s)a(s);else{for(var i=arguments.length,c=new Array(i>1?i-1:0),d=1;d<i;d++)c[d-1]=arguments[d];for(;++o<n.length;)null!==c[o]&&void 0!==c[o]||(c[o]=n[o]);n=c,l?function(e,t){let n;return r;function r(){for(var t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];const i=e.length>r.length;let c;i&&r.push(a);try{c=e.apply(this,r)}catch(s){if(i&&n)throw s;return a(s)}i||(c&&c.then&&"function"===typeof c.then?c.then(l,a):c instanceof Error?a(c):l(c))}function a(e){if(!n){n=!0;for(var s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];t(e,...r)}}function l(e){a(null,e)}}(l,t)(...c):a(null,...c)}}(null,...n)},use:function(n){if("function"!==typeof n)throw new TypeError("Expected `middelware` to be a function, not "+n);return e.push(n),t}};return t}const Jl={basename:function(e,t){if(void 0!==t&&"string"!==typeof t)throw new TypeError('"ext" argument must be a string');ql(e);let n,s=0,r=-1,a=e.length;if(void 0===t||0===t.length||t.length>e.length){for(;a--;)if(47===e.codePointAt(a)){if(n){s=a+1;break}}else r<0&&(n=!0,r=a+1);return r<0?"":e.slice(s,r)}if(t===e)return"";let l=-1,o=t.length-1;for(;a--;)if(47===e.codePointAt(a)){if(n){s=a+1;break}}else l<0&&(n=!0,l=a+1),o>-1&&(e.codePointAt(a)===t.codePointAt(o--)?o<0&&(r=a):(o=-1,r=l));s===r?r=l:r<0&&(r=e.length);return e.slice(s,r)},dirname:function(e){if(ql(e),0===e.length)return".";let t,n=-1,s=e.length;for(;--s;)if(47===e.codePointAt(s)){if(t){n=s;break}}else t||(t=!0);return n<0?47===e.codePointAt(0)?"/":".":1===n&&47===e.codePointAt(0)?"//":e.slice(0,n)},extname:function(e){ql(e);let t,n=e.length,s=-1,r=0,a=-1,l=0;for(;n--;){const o=e.codePointAt(n);if(47!==o)s<0&&(t=!0,s=n+1),46===o?a<0?a=n:1!==l&&(l=1):a>-1&&(l=-1);else if(t){r=n+1;break}}if(a<0||s<0||0===l||1===l&&a===s-1&&a===r+1)return"";return e.slice(a,s)},join:function(){let e,t=-1;for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];for(;++t<s.length;)ql(s[t]),s[t]&&(e=void 0===e?s[t]:e+"/"+s[t]);return void 0===e?".":function(e){ql(e);const t=47===e.codePointAt(0);let n=function(e,t){let n,s,r="",a=0,l=-1,o=0,i=-1;for(;++i<=e.length;){if(i<e.length)n=e.codePointAt(i);else{if(47===n)break;n=47}if(47===n){if(l===i-1||1===o);else if(l!==i-1&&2===o){if(r.length<2||2!==a||46!==r.codePointAt(r.length-1)||46!==r.codePointAt(r.length-2))if(r.length>2){if(s=r.lastIndexOf("/"),s!==r.length-1){s<0?(r="",a=0):(r=r.slice(0,s),a=r.length-1-r.lastIndexOf("/")),l=i,o=0;continue}}else if(r.length>0){r="",a=0,l=i,o=0;continue}t&&(r=r.length>0?r+"/..":"..",a=2)}else r.length>0?r+="/"+e.slice(l+1,i):r=e.slice(l+1,i),a=i-l-1;l=i,o=0}else 46===n&&o>-1?o++:o=-1}return r}(e,!t);0!==n.length||t||(n=".");n.length>0&&47===e.codePointAt(e.length-1)&&(n+="/");return t?"/"+n:n}(e)},sep:"/"};function ql(e){if("string"!==typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const Vl={cwd:function(){return"/"}};function Hl(e){return Boolean(null!==e&&"object"===typeof e&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&void 0===e.auth)}function Wl(e){if("string"===typeof e)e=new URL(e);else if(!Hl(e)){const t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if("file:"!==e.protocol){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return function(e){if(""!==e.hostname){const e=new TypeError('File URL host must be "localhost" or empty on darwin');throw e.code="ERR_INVALID_FILE_URL_HOST",e}const t=e.pathname;let n=-1;for(;++n<t.length;)if(37===t.codePointAt(n)&&50===t.codePointAt(n+1)){const e=t.codePointAt(n+2);if(70===e||102===e){const e=new TypeError("File URL path must not include encoded / characters");throw e.code="ERR_INVALID_FILE_URL_PATH",e}}return decodeURIComponent(t)}(e)}const Ql=["history","path","basename","stem","extname","dirname"];class Kl{constructor(e){let t;t=e?Hl(e)?{path:e}:"string"===typeof e||function(e){return Boolean(e&&"object"===typeof e&&"byteLength"in e&&"byteOffset"in e)}(e)?{value:e}:e:{},this.cwd="cwd"in t?"":Vl.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let n,s=-1;for(;++s<Ql.length;){const e=Ql[s];e in t&&void 0!==t[e]&&null!==t[e]&&(this[e]="history"===e?[...t[e]]:t[e])}for(n in t)Ql.includes(n)||(this[n]=t[n])}get basename(){return"string"===typeof this.path?Jl.basename(this.path):void 0}set basename(e){Gl(e,"basename"),Yl(e,"basename"),this.path=Jl.join(this.dirname||"",e)}get dirname(){return"string"===typeof this.path?Jl.dirname(this.path):void 0}set dirname(e){Zl(this.basename,"dirname"),this.path=Jl.join(e||"",this.basename)}get extname(){return"string"===typeof this.path?Jl.extname(this.path):void 0}set extname(e){if(Yl(e,"extname"),Zl(this.dirname,"extname"),e){if(46!==e.codePointAt(0))throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Jl.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){Hl(e)&&(e=Wl(e)),Gl(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return"string"===typeof this.path?Jl.basename(this.path,this.extname):void 0}set stem(e){Gl(e,"stem"),Yl(e,"stem"),this.path=Jl.join(this.dirname||"",e+(this.extname||""))}fail(e,t,n){const s=this.message(e,t,n);throw s.fatal=!0,s}info(e,t,n){const s=this.message(e,t,n);return s.fatal=void 0,s}message(e,t,n){const s=new Js(e,t,n);return this.path&&(s.name=this.path+":"+s.name,s.file=this.path),s.fatal=!1,this.messages.push(s),s}toString(e){if(void 0===this.value)return"";if("string"===typeof this.value)return this.value;return new TextDecoder(e||void 0).decode(this.value)}}function Yl(e,t){if(e&&e.includes(Jl.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+Jl.sep+"`")}function Gl(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function Zl(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}const Xl=function(e){const t=this.constructor.prototype,n=t[e],s=function(){return n.apply(s,arguments)};return Object.setPrototypeOf(s,t),s},eo={}.hasOwnProperty;class to extends Xl{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=Bl()}copy(){const e=new to;let t=-1;for(;++t<this.attachers.length;){const n=this.attachers[t];e.use(...n)}return e.data(Fl(!0,{},this.namespace)),e}data(e,t){return"string"===typeof e?2===arguments.length?(ao("data",this.frozen),this.namespace[e]=t,this):eo.call(this.namespace,e)&&this.namespace[e]||void 0:e?(ao("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...n]=this.attachers[this.freezeIndex];if(!1===n[0])continue;!0===n[0]&&(n[0]=void 0);const s=t.call(e,...n);"function"===typeof s&&this.transformers.use(s)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const t=io(e),n=this.parser||this.Parser;return so("parse",n),n(String(t),t)}process(e,t){const n=this;return this.freeze(),so("process",this.parser||this.Parser),ro("process",this.compiler||this.Compiler),t?s(void 0,t):new Promise(s);function s(s,r){const a=io(e),l=n.parse(a);function o(e,n){e||!n?r(e):s?s(n):t(void 0,n)}n.run(l,a,function(e,t,s){if(e||!t||!s)return o(e);const r=t,a=n.stringify(r,s);var l;"string"===typeof(l=a)||function(e){return Boolean(e&&"object"===typeof e&&"byteLength"in e&&"byteOffset"in e)}(l)?s.value=a:s.result=a,o(e,s)})}}processSync(e){let t,n=!1;return this.freeze(),so("processSync",this.parser||this.Parser),ro("processSync",this.compiler||this.Compiler),this.process(e,function(e,s){n=!0,Ml(e),t=s}),oo("processSync","process",n),t}run(e,t,n){lo(e),this.freeze();const s=this.transformers;return n||"function"!==typeof t||(n=t,t=void 0),n?r(void 0,n):new Promise(r);function r(r,a){const l=io(t);s.run(e,l,function(t,s,l){const o=s||e;t?a(t):r?r(o):n(void 0,o,l)})}}runSync(e,t){let n,s=!1;return this.run(e,t,function(e,t){Ml(e),n=t,s=!0}),oo("runSync","run",s),n}stringify(e,t){this.freeze();const n=io(t),s=this.compiler||this.Compiler;return ro("stringify",s),lo(e),s(e,n)}use(e){const t=this.attachers,n=this.namespace;if(ao("use",this.frozen),null===e||void 0===e);else if("function"===typeof e){for(var s=arguments.length,r=new Array(s>1?s-1:0),a=1;a<s;a++)r[a-1]=arguments[a];c(e,r)}else{if("object"!==typeof e)throw new TypeError("Expected usable value, not `"+e+"`");Array.isArray(e)?i(e):o(e)}return this;function l(e){if("function"===typeof e)c(e,[]);else{if("object"!==typeof e)throw new TypeError("Expected usable value, not `"+e+"`");if(Array.isArray(e)){const[t,...n]=e;c(t,n)}else o(e)}}function o(e){if(!("plugins"in e)&&!("settings"in e))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");i(e.plugins),e.settings&&(n.settings=Fl(!0,n.settings,e.settings))}function i(e){let t=-1;if(null===e||void 0===e);else{if(!Array.isArray(e))throw new TypeError("Expected a list of plugins, not `"+e+"`");for(;++t<e.length;){l(e[t])}}}function c(e,n){let s=-1,r=-1;for(;++s<t.length;)if(t[s][0]===e){r=s;break}if(-1===r)t.push([e,...n]);else if(n.length>0){let[s,...a]=n;const l=t[r][1];Ul(l)&&Ul(s)&&(s=Fl(!0,l,s)),t[r]=[e,s,...a]}}}}const no=(new to).freeze();function so(e,t){if("function"!==typeof t)throw new TypeError("Cannot `"+e+"` without `parser`")}function ro(e,t){if("function"!==typeof t)throw new TypeError("Cannot `"+e+"` without `compiler`")}function ao(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function lo(e){if(!Ul(e)||"string"!==typeof e.type)throw new TypeError("Expected node, got `"+e+"`")}function oo(e,t,n){if(!n)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function io(e){return function(e){return Boolean(e&&"object"===typeof e&&"message"in e&&"messages"in e)}(e)?e:new Kl(e)}const co=[],uo={allowDangerousHtml:!0},mo=/^(https?|ircs?|mailto|xmpp)$/i,xo=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function go(e){const t=ho(e),n=po(e);return fo(t.runSync(t.parse(n),n),e)}function ho(e){const t=e.rehypePlugins||co,n=e.remarkPlugins||co,s=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...uo}:uo;return no().use(nl).use(n).use(Rl,s).use(t)}function po(e){const t=e.children||"",n=new Kl;return"string"===typeof t&&(n.value=t),n}function fo(e,t){const n=t.allowedElements,s=t.allowElement,r=t.components,a=t.disallowedElements,l=t.skipHtml,o=t.unwrapDisallowed,i=t.urlTransform||bo;for(const c of xo)Object.hasOwn(t,c.from)&&Kn((c.from,c.to&&c.to,c.id));return wl(e,function(e,t,r){if("raw"===e.type&&r&&"number"===typeof t)return l?r.children.splice(t,1):r.children[t]={type:"text",value:e.value},t;if("element"===e.type){let t;for(t in lr)if(Object.hasOwn(lr,t)&&Object.hasOwn(e.properties,t)){const n=e.properties[t],s=lr[t];(null===s||s.includes(e.tagName))&&(e.properties[t]=i(String(n||""),t,e))}}if("element"===e.type){let l=n?!n.includes(e.tagName):!!a&&a.includes(e.tagName);if(!l&&s&&"number"===typeof t&&(l=!s(e,t,r)),l&&r&&"number"===typeof t)return o&&e.children?r.children.splice(t,1,...e.children):r.children.splice(t,1),t}}),Ys(e,{Fragment:pt.Fragment,components:r,ignoreInvalidStyle:!0,jsx:pt.jsx,jsxs:pt.jsxs,passKeys:!0,passNode:!0})}function bo(e){const t=e.indexOf(":"),n=e.indexOf("?"),s=e.indexOf("#"),r=e.indexOf("/");return-1===t||-1!==r&&t>r||-1!==n&&t>n||-1!==s&&t>s||mo.test(e.slice(0,t))?e:""}const yo=e=>{let{isOpen:t,onClose:n,resultKey:s}=e;const[a,l]=(0,r.useState)(""),[o,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)(null);(0,r.useEffect)(()=>{t&&s&&u()},[t,s]);const u=async()=>{try{i(!0),d(null);const e=await fetch(`${ze.JR}/api/learning/exam-result-detail?key=${encodeURIComponent(s)}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!e.ok)throw new Error("\u8a66\u9a13\u7d50\u679c\u8a73\u7d30\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f");const t=await e.json();if(!t.success)throw new Error(t.message||"\u8a66\u9a13\u7d50\u679c\u8a73\u7d30\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f");l(t.data.content||"")}catch(e){console.error("\u8a66\u9a13\u7d50\u679c\u8a73\u7d30\u53d6\u5f97\u30a8\u30e9\u30fc:",e),d(e.message)}finally{i(!1)}};return t?(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden",children:[(0,pt.jsx)("div",{className:"bg-gradient-to-r from-green-500 to-green-600 text-white p-6",children:(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("div",{children:(0,pt.jsx)("h2",{className:"text-2xl font-bold",children:"\ud83d\udccb \u8a66\u9a13\u7d50\u679c\u8a73\u7d30"})}),(0,pt.jsx)("button",{onClick:n,className:"text-white hover:text-gray-200 text-3xl font-bold transition-colors",children:"\xd7"})]})}),(0,pt.jsxs)("div",{className:"p-6 overflow-y-auto max-h-[calc(90vh-200px)]",children:[o&&(0,pt.jsxs)("div",{className:"text-center py-12",children:[(0,pt.jsx)("div",{className:"text-green-600 text-xl font-semibold mb-2",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."}),(0,pt.jsx)("div",{className:"text-gray-500",children:"\u8a66\u9a13\u7d50\u679c\u8a73\u7d30\u3092\u53d6\u5f97\u3057\u3066\u3044\u307e\u3059"})]}),c&&(0,pt.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-700 rounded-lg p-4 mb-4",children:[(0,pt.jsx)("div",{className:"font-semibold mb-1",children:"\u30a8\u30e9\u30fc"}),(0,pt.jsx)("div",{children:c})]}),!o&&!c&&a&&(0,pt.jsx)("div",{className:"prose prose-lg max-w-none",children:(0,pt.jsx)(go,{components:{h1:e=>{let{node:t,...n}=e;return(0,pt.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-4 pb-2 border-b-2 border-blue-500",...n})},h2:e=>{let{node:t,...n}=e;return(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mt-6 mb-3 pb-2 border-b border-gray-300",...n})},h3:e=>{let{node:t,...n}=e;return(0,pt.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mt-4 mb-2",...n})},p:e=>{let{node:t,...n}=e;return(0,pt.jsx)("p",{className:"text-gray-700 mb-3 leading-relaxed",...n})},ul:e=>{let{node:t,...n}=e;return(0,pt.jsx)("ul",{className:"list-disc list-inside mb-4 space-y-1",...n})},ol:e=>{let{node:t,...n}=e;return(0,pt.jsx)("ol",{className:"list-decimal list-inside mb-4 space-y-1",...n})},li:e=>{let{node:t,...n}=e;return(0,pt.jsx)("li",{className:"text-gray-700 ml-4",...n})},strong:e=>{let{node:t,...n}=e;return(0,pt.jsx)("strong",{className:"font-semibold text-gray-900",...n})},hr:e=>{let{node:t,...n}=e;return(0,pt.jsx)("hr",{className:"my-6 border-t-2 border-gray-300",...n})},blockquote:e=>{let{node:t,...n}=e;return(0,pt.jsx)("blockquote",{className:"border-l-4 border-blue-500 pl-4 italic text-gray-700 my-4",...n})},code:e=>{let{node:t,inline:n,...s}=e;return n?(0,pt.jsx)("code",{className:"bg-gray-100 px-1 py-0.5 rounded text-sm font-mono text-red-600",...s}):(0,pt.jsx)("code",{className:"block bg-gray-100 p-4 rounded-lg text-sm font-mono overflow-x-auto",...s})}},children:a})})]}),(0,pt.jsx)("div",{className:"bg-gray-50 p-4 flex justify-end border-t border-gray-200",children:(0,pt.jsx)("button",{onClick:n,className:"px-6 py-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-lg font-medium transition-colors",children:"\u9589\u3058\u308b"})})]})}):null},vo=e=>{let{selectedCourseId:t}=e;const n=ne(),{currentUser:s}=bt(),[a,l]=(0,r.useState)([]),[o,i]=(0,r.useState)(null),[c,d]=(0,r.useState)([]),[u,m]=(0,r.useState)(null),[x,g]=(0,r.useState)({}),[h,p]=(0,r.useState)(!0),[f,b]=(0,r.useState)(null),[y,v]=(0,r.useState)(!1),[j,N]=(0,r.useState)(!1),[w,k]=(0,r.useState)(null),[S,_]=(0,r.useState)(null),C=e=>{const t=e.filter(e=>"not_started"!==e.progress_status);if(0===t.length)return console.log("\ud83c\udfaf \u672a\u5b66\u7fd2\u4ee5\u5916\u306e\u30ec\u30c3\u30b9\u30f3\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093 - \u73fe\u5728\u53d7\u8b1b\u4e2d\u30bf\u30b0\u306f\u8868\u793a\u3055\u308c\u307e\u305b\u3093"),null;const n=[...t].sort((e,t)=>{const n=e.updated_at?new Date(e.updated_at).getTime():0,s=t.updated_at?new Date(t.updated_at).getTime():0;return s!==n?s-n:t.id-e.id})[0];return console.log(`\ud83c\udfaf \u30ec\u30c3\u30b9\u30f3\u4e00\u89a7\u304b\u3089\u7279\u5b9a\u3057\u305f\u73fe\u5728\u53d7\u8b1b\u4e2d: \u30ec\u30c3\u30b9\u30f3ID ${n.id}, updated_at: ${n.updated_at}`),n.id},I=async e=>{try{p(!0),b(null);const t=await async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const t=e?`?courseId=${e}`:"";return await He(`/api/student/lessons${t}`)}catch(f){throw console.error("\u5229\u7528\u8005\u30ec\u30c3\u30b9\u30f3\u53d6\u5f97\u30a8\u30e9\u30fc:",f),f}}(e);t.success?d(t.data):b("\u30ec\u30c3\u30b9\u30f3\u4e00\u89a7\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(t.message||""))}catch(t){if(console.error("\u30ec\u30c3\u30b9\u30f3\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",t),t.message.includes("\u8a8d\u8a3c")||t.message.includes("Authentication")||t.message.includes("401"))return console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u306e\u305f\u3081\u3001\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u307e\u3059"),void n("/student/login");b("\u30ec\u30c3\u30b9\u30f3\u4e00\u89a7\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+t.message)}finally{p(!1)}},T=async e=>{try{console.log(`\ud83d\udd0d \u73fe\u5728\u53d7\u8b1b\u4e2d\u30ec\u30c3\u30b9\u30f3\u53d6\u5f97\u958b\u59cb: \u30b3\u30fc\u30b9ID ${e}`);const t=await fetch(`${ze.JR}/api/learning/current-lesson?courseId=${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(t.ok){const e=await t.json();console.log("\ud83d\udcca \u73fe\u5728\u53d7\u8b1b\u4e2d\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf:",e),e.success&&e.data.length>0?(m(e.data[0]),console.log(`\u2705 \u73fe\u5728\u53d7\u8b1b\u4e2d\u30ec\u30c3\u30b9\u30f3\u8a2d\u5b9a: \u30ec\u30c3\u30b9\u30f3ID ${e.data[0].lesson_id}`)):(m(null),console.log("\u2139\ufe0f \u73fe\u5728\u53d7\u8b1b\u4e2d\u30ec\u30c3\u30b9\u30f3\u306a\u3057"))}else console.error(`\u274c \u73fe\u5728\u53d7\u8b1b\u4e2d\u30ec\u30c3\u30b9\u30f3\u53d6\u5f97\u5931\u6557: ${t.status}`),m(null)}catch(f){console.error("\u73fe\u5728\u53d7\u8b1b\u4e2d\u30ec\u30c3\u30b9\u30f3\u53d6\u5f97\u30a8\u30e9\u30fc:",f),m(null)}},P=async()=>{try{console.log("\ud83d\udd0d \u30c6\u30b9\u30c8\u7d50\u679c\u53d6\u5f97\u958b\u59cb");const e=await fetch(`${ze.JR}/api/learning/test/results/${s.id}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(e.ok){const t=await e.json();if(console.log("\ud83d\udcca \u30c6\u30b9\u30c8\u7d50\u679c\u30c7\u30fc\u30bf:",t),t.success&&t.data){const e={};console.log("\ud83d\udd0d \u30c6\u30b9\u30c8\u7d50\u679c\u30c7\u30fc\u30bf\u8a73\u7d30:",t.data),console.log("\ud83d\udd0d \u30c6\u30b9\u30c8\u7d50\u679c\u30c7\u30fc\u30bf\u306e\u578b:",typeof t.data,Array.isArray(t.data)),console.log("\ud83d\udd0d \u30c6\u30b9\u30c8\u7d50\u679c\u30c7\u30fc\u30bf\u306e\u9577\u3055:",t.data.length),t.data.forEach((t,n)=>{console.log(`\ud83d\udcca \u30c6\u30b9\u30c8\u7d50\u679c[${n}]:`,t),console.log(`\ud83d\udcca \u30c6\u30b9\u30c8\u7d50\u679c[${n}]\u306e\u5168\u30d5\u30a3\u30fc\u30eb\u30c9:`,Object.keys(t));const s=t.lessonId||t.lesson_id||t.lessonId||t.lessonNumber;console.log("\ud83d\udd0d \u30ec\u30c3\u30b9\u30f3ID\u5019\u88dc:",{lessonId:t.lessonId,lesson_id:t.lesson_id,lessonNumber:t.lessonNumber,selected:s}),s?(e[s]={score:t.score||t.correctAnswers||0,totalQuestions:t.totalQuestions||t.total||0,passed:t.passed||t.isPassed||!1,testType:t.testType||t.type||"unknown",sectionIndex:t.sectionIndex||t.section_index||null,submittedAt:t.submittedAt||t.submitted_at||t.createdAt||t.created_at},console.log(`\u2705 \u30c6\u30b9\u30c8\u7d50\u679c[${s}]\u8a2d\u5b9a:`,e[s])):(console.warn("\u26a0\ufe0f \u30ec\u30c3\u30b9\u30f3ID\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u30c6\u30b9\u30c8\u7d50\u679c:",t),console.warn("\u26a0\ufe0f \u5229\u7528\u53ef\u80fd\u306a\u30d5\u30a3\u30fc\u30eb\u30c9:",Object.keys(t)))}),g(e),console.log("\u2705 \u30c6\u30b9\u30c8\u7d50\u679c\u8a2d\u5b9a\u5b8c\u4e86:",e),console.log("\u2705 \u30c6\u30b9\u30c8\u7d50\u679c\u30de\u30c3\u30d7\u306e\u30ad\u30fc:",Object.keys(e))}else console.log("\u2139\ufe0f \u30c6\u30b9\u30c8\u7d50\u679c\u306a\u3057"),console.log("\u2139\ufe0f \u30ec\u30b9\u30dd\u30f3\u30b9\u30c7\u30fc\u30bf:",t),g({})}else console.error(`\u274c \u30c6\u30b9\u30c8\u7d50\u679c\u53d6\u5f97\u5931\u6557: ${e.status}`),g({})}catch(f){console.error("\u30c6\u30b9\u30c8\u7d50\u679c\u53d6\u5f97\u30a8\u30e9\u30fc:",f),g({})}},L=async e=>{try{console.log(`\ud83c\udf93 \u30ec\u30c3\u30b9\u30f3\u5b66\u7fd2\u958b\u59cb: \u30ec\u30c3\u30b9\u30f3ID ${e.id}, \u30b3\u30fc\u30b9ID ${e.course_id}`);const t=e.progress_status||"not_started";console.log(`\ud83d\udcca \u73fe\u5728\u306e\u30b9\u30c6\u30fc\u30bf\u30b9: ${t}`);const r="not_started"===t||"in_progress"===t?"in_progress":t;console.log(`\ud83d\udd04 \u9032\u6357\u66f4\u65b0\u958b\u59cb: \u30ec\u30c3\u30b9\u30f3ID ${e.id}, \u30b9\u30c6\u30fc\u30bf\u30b9 ${r}`);const a=await fetch(`${ze.JR}/api/learning/progress/lesson`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify({userId:s.id,lessonId:e.id,status:r})});if(a.ok)console.log(`\u2705 \u9032\u6357\u66f4\u65b0\u6210\u529f: \u30ec\u30c3\u30b9\u30f3ID ${e.id}, \u65b0\u30b9\u30c6\u30fc\u30bf\u30b9: ${r}`),await Promise.all([I(e.course_id),T(e.course_id)]),console.log("\u2705 \u30ec\u30c3\u30b9\u30f3\u4e00\u89a7\u3068\u73fe\u5728\u53d7\u8b1b\u4e2d\u30ec\u30c3\u30b9\u30f3\u3092\u518d\u8aad\u307f\u8fbc\u307f\u5b8c\u4e86"),console.log(`\ud83d\udd04 \u5b66\u7fd2\u753b\u9762\u306b\u9077\u79fb: course=${e.course_id}&lesson=${e.id}`),n(`/student/enhanced-learning?course=${e.course_id}&lesson=${e.id}`);else{const t=await a.json();console.error("\u9032\u6357\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",t),n(`/student/enhanced-learning?course=${e.course_id}&lesson=${e.id}`)}}catch(f){console.error("\u5b66\u7fd2\u958b\u59cb\u30a8\u30e9\u30fc:",f),n(`/student/enhanced-learning?course=${e.course_id}&lesson=${e.id}`)}};return(0,r.useEffect)(()=>{if(console.log("=== LessonList \u521d\u671f\u5316 ==="),console.log("currentUser:",s),console.log("isAuthenticated:",s?"\u8a8d\u8a3c\u6e08\u307f":"\u672a\u8a8d\u8a3c"),console.log("selectedCourseId:",t),s)console.log("\u8a8d\u8a3c\u6e08\u307f\u30e6\u30fc\u30b6\u30fc\u3067\u3059\u3002\u30b3\u30fc\u30b9\u4e00\u89a7\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002"),(async()=>{try{p(!0),b(null);const e=await Bn();if(e.success)if(l(e.data),t&&e.data.length>0){const n=e.data.find(e=>e.id===t);i(n||e.data[0])}else e.data.length>0&&i(e.data[0]);else b("\u30b3\u30fc\u30b9\u4e00\u89a7\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(e.message||""))}catch(e){if(console.error("\u30b3\u30fc\u30b9\u4e00\u89a7\u53d6\u5f97\u30a8\u30e9\u30fc:",e),e.message.includes("\u8a8d\u8a3c")||e.message.includes("Authentication")||e.message.includes("401")||e.message.includes("\u8a8d\u8a3c\u60c5\u5831\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093")){console.log("\u8a8d\u8a3c\u30a8\u30e9\u30fc\u306e\u305f\u3081\u3001\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u307e\u3059");try{n("/student/login")}catch(s){console.error("\u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30a8\u30e9\u30fc:",s),window.location.href="/student/login"}return}b("\u30b3\u30fc\u30b9\u4e00\u89a7\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+e.message)}finally{p(!1)}})(),P();else{console.log("\u5229\u7528\u8005\u304c\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u307e\u3059");try{n("/student/login")}catch(e){console.error("\u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30a8\u30e9\u30fc:",e),window.location.href="/student/login"}}},[s,n,t]),(0,r.useEffect)(()=>{o&&(I(o.id),T(o.id),P())},[o]),(0,r.useEffect)(()=>{const e=()=>{!document.hidden&&o&&(console.log("\ud83d\udcf1 \u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u307e\u3057\u305f - \u73fe\u5728\u53d7\u8b1b\u4e2d\u30ec\u30c3\u30b9\u30f3\u3092\u518d\u8aad\u307f\u8fbc\u307f"),T(o.id),P())};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[o]),s?h&&0===a.length?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsx)("div",{className:"text-blue-600 text-xl font-semibold",children:"Loading..."})}):(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 p-6",children:[f&&(0,pt.jsxs)("div",{className:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-start",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("div",{className:"font-semibold mb-2",children:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}),(0,pt.jsx)("div",{children:f})]}),(0,pt.jsx)("button",{onClick:()=>b(null),className:"text-red-500 hover:text-red-700 text-xl",children:"\xd7"})]}),f.includes("\u8a8d\u8a3c")&&(0,pt.jsx)("button",{onClick:()=>n("/student/login"),className:"mt-3 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u79fb\u52d5"})]}),(0,pt.jsx)(qn,{course:o}),a.length>0&&(0,pt.jsx)(Vn,{courses:a,selectedCourse:o,onCourseSelect:e=>{i(e),I(e.id),T(e.id),P()}}),o&&(()=>{const e=C(c),t=e?c.find(t=>t.id===e):null;if(!t){if(u&&"in_progress"!==u.status)return console.log("\ud83c\udfaf API\u304b\u3089\u53d6\u5f97\u3057\u305f\u30ec\u30c3\u30b9\u30f3\u306fin_progress\u30b9\u30c6\u30fc\u30bf\u30b9\u3067\u306f\u3042\u308a\u307e\u305b\u3093 - \u73fe\u5728\u53d7\u8b1b\u4e2d\u30bb\u30af\u30b7\u30e7\u30f3\u306f\u8868\u793a\u3055\u308c\u307e\u305b\u3093"),null;if(!u)return null}const n=t||u;return n?(0,pt.jsxs)("div",{className:"mb-6 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-2xl shadow-lg p-6 border border-blue-200",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-blue-800 mb-4",children:"\ud83c\udfaf \u73fe\u5728\u53d7\u8b1b\u4e2d"}),(0,pt.jsx)("div",{className:"bg-white rounded-xl p-4 shadow-md",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h4",{className:"text-lg font-semibold text-gray-800 mb-2",children:t?t.title:n.lesson_title}),(0,pt.jsx)("p",{className:"text-sm text-blue-600 font-medium mb-2",children:t?t.course_title:n.course_title}),(0,pt.jsxs)("p",{className:"text-sm text-gray-600",children:["\u6700\u7d42\u66f4\u65b0: ",(()=>{const e=t?t.updated_at:n.updated_at;return e?e.replace(/-/g,"/").replace("T"," ").replace(/\.\d{3}Z?$/,"").replace(/\s+/g," "):""})()]})]}),(0,pt.jsx)("div",{className:"flex gap-2",children:(0,pt.jsx)("button",{className:"px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-medium hover:shadow-lg hover:-translate-y-0.5 transition-all duration-200",onClick:()=>{L(t||n)},children:"\ud83c\udf93 \u7d9a\u304d\u304b\u3089\u5b66\u7fd2"})})]})})]}):null})(),o&&(0,pt.jsx)(Hn,{lessons:c,onStartLesson:L,onViewExamResults:e=>{console.log(`\ud83d\udcca \u8a66\u9a13\u7d50\u679c\u4e00\u89a7\u8868\u793a: \u30ec\u30c3\u30b9\u30f3ID ${e.id}`),k(e),v(!0)},onSubmitAssignment:e=>{alert(`${e.title}\u306e\u8ab2\u984c\u63d0\u51fa\u6a5f\u80fd\u306f\u958b\u767a\u4e2d\u3067\u3059\u3002`)},currentLessonId:C(c)||(null===u||void 0===u?void 0:u.lesson_id)||(null===u||void 0===u?void 0:u.id),testResults:x}),(0,pt.jsx)(Wn,{isOpen:y,onClose:()=>v(!1),lesson:w,onViewDetail:e=>{console.log("\ud83d\udccb \u8a66\u9a13\u7d50\u679c\u8a73\u7d30\u8868\u793a:",e),_(e.key),v(!1),N(!0)}}),(0,pt.jsx)(yo,{isOpen:j,onClose:()=>{N(!1),v(!0)},resultKey:S}),0===a.length&&!h&&(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center",children:[(0,pt.jsx)("div",{className:"text-gray-500 text-lg mb-4",children:"\u53d7\u8b1b\u53ef\u80fd\u306a\u30b3\u30fc\u30b9\u304c\u3042\u308a\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-gray-400 mb-4",children:"\u7ba1\u7406\u8005\u306b\u304a\u554f\u3044\u5408\u308f\u305b\u304f\u3060\u3055\u3044"}),(0,pt.jsx)("button",{onClick:()=>n("/student/login"),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u623b\u308b"})]})]}):(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"text-blue-600 text-xl font-semibold mb-4",children:"\u8a8d\u8a3c\u4e2d..."}),(0,pt.jsx)("div",{className:"text-gray-600 text-sm",children:"\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u3066\u3044\u307e\u3059"})]})})},jo=()=>{const{currentUser:e}=bt(),[t,n]=(0,r.useState)(!1);return(0,pt.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsxs)("div",{className:"mb-8",children:[(0,pt.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"\ud83c\udfaf \u9069\u8077\u8a3a\u65ad"}),(0,pt.jsx)("p",{className:"text-lg text-gray-600 mb-6",children:"\u3042\u306a\u305f\u306e\u9069\u6027\u306b\u5408\u3063\u305f\u8077\u696d\u3092\u898b\u3064\u3051\u307e\u3057\u3087\u3046"})]}),(0,pt.jsxs)("div",{className:"bg-gradient-to-br from-blue-50 to-cyan-50 rounded-2xl p-8 shadow-lg mb-8",children:[(0,pt.jsxs)("div",{className:"mb-6",children:[(0,pt.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:"\u9069\u8077\u8a3a\u65ad\u306b\u3064\u3044\u3066"}),(0,pt.jsxs)("div",{className:"text-left space-y-4 text-gray-700",children:[(0,pt.jsx)("p",{children:"\u2022 \u3042\u306a\u305f\u306e\u6027\u683c\u3001\u8208\u5473\u3001\u4fa1\u5024\u89b3\u3092\u5206\u6790\u3057\u3066\u6700\u9069\u306a\u8077\u696d\u3092\u63d0\u6848\u3057\u307e\u3059"}),(0,pt.jsx)("p",{children:"\u2022 \u8cea\u554f\u306b\u7b54\u3048\u308b\u3060\u3051\u3067\u3001\u3042\u306a\u305f\u306b\u5408\u3063\u305f\u8077\u696d\u5206\u91ce\u3092\u8a3a\u65ad\u3067\u304d\u307e\u3059"}),(0,pt.jsx)("p",{children:"\u2022 \u8a3a\u65ad\u7d50\u679c\u306f\u4eca\u5f8c\u306e\u30ad\u30e3\u30ea\u30a2\u9078\u629e\u306e\u53c2\u8003\u306b\u3054\u6d3b\u7528\u304f\u3060\u3055\u3044"})]})]}),(0,pt.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-md mb-6",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-3",children:"\u8a3a\u65ad\u306e\u6d41\u308c"}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 text-lg font-bold",children:"1"}),(0,pt.jsx)("p",{className:"text-gray-700",children:"\u8cea\u554f\u306b\u56de\u7b54"})]}),(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 text-lg font-bold",children:"2"}),(0,pt.jsx)("p",{className:"text-gray-700",children:"\u9069\u6027\u3092\u5206\u6790"})]}),(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 text-lg font-bold",children:"3"}),(0,pt.jsx)("p",{className:"text-gray-700",children:"\u7d50\u679c\u3092\u78ba\u8a8d"})]})]})]}),(0,pt.jsx)("button",{onClick:()=>{n(!0);try{const e=localStorage.getItem("accessToken");if(!e)return alert("\u8a8d\u8a3c\u30c8\u30fc\u30af\u30f3\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),void n(!1);const t=`https://findjob.myou-kou.com/useraccess?token=${encodeURIComponent(e)}`;window.open(t,"_blank")}catch(e){console.error("\u9069\u8077\u8a3a\u65ad\u30da\u30fc\u30b8\u3078\u306e\u9077\u79fb\u30a8\u30e9\u30fc:",e),alert("\u9069\u8077\u8a3a\u65ad\u30da\u30fc\u30b8\u3078\u306e\u9077\u79fb\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}finally{n(!1)}},disabled:t,className:"w-full max-w-md mx-auto px-8 py-4 rounded-xl font-semibold text-lg transition-all duration-200 "+(t?"bg-gray-400 text-gray-200 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-cyan-600 text-white hover:from-blue-600 hover:to-cyan-700 shadow-lg hover:shadow-xl transform hover:-translate-y-1"),children:t?(0,pt.jsxs)("div",{className:"flex items-center justify-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"\u8aad\u307f\u8fbc\u307f\u4e2d..."]}):"\ud83c\udfaf \u9069\u8077\u8a3a\u65ad\u3092\u958b\u59cb\u3059\u308b"})]}),(0,pt.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,pt.jsxs)("div",{className:"flex items-start",children:[(0,pt.jsx)("div",{className:"text-yellow-600 text-xl mr-3",children:"\u26a0\ufe0f"}),(0,pt.jsxs)("div",{className:"text-yellow-800",children:[(0,pt.jsx)("p",{className:"font-semibold mb-1",children:"\u3054\u6ce8\u610f"}),(0,pt.jsx)("p",{className:"text-sm",children:"\u9069\u8077\u8a3a\u65ad\u306f\u5916\u90e8\u30b5\u30a4\u30c8\u3067\u884c\u308f\u308c\u307e\u3059\u3002\u8a3a\u65ad\u3092\u958b\u59cb\u3059\u308b\u3068\u65b0\u3057\u3044\u30bf\u30d6\u304c\u958b\u304d\u307e\u3059\u3002"})]})]})})]})})},No=()=>{const[e,t]=(0,r.useState)("dashboard"),[n,s]=(0,r.useState)(null),a=ne(),[l]=De(),{currentUser:o}=(()=>{const{isAuthenticated:e,isLoading:t,currentUser:n}=bt(),s=ne();return(0,r.useEffect)(()=>{t||(e?n&&(n.role<1||n.role>3)&&s("/homepage"):s("/homepage"))},[e,t,n,s]),{isAuthenticated:e,isLoading:t,currentUser:n}})(),{login:i,logout:c}=bt(),[d,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)(""),[g,h]=(0,r.useState)([]),[p,f]=(0,r.useState)(null),[b,y]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{if(null===o||void 0===o||!o.id)return void console.log("StudentDashboard: \u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u304c\u306a\u3044\u305f\u3081\u3001\u30b3\u30fc\u30b9\u60c5\u5831\u53d6\u5f97\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");const e=localStorage.getItem("accessToken"),t=localStorage.getItem("loginCode")&&localStorage.getItem("tempPassword");if(e||t)try{console.log("StudentDashboard: \u30b3\u30fc\u30b9\u60c5\u5831\u3092\u53d6\u5f97\u3057\u307e\u3059",{userId:o.id});const t=await fetch(`${ze.JR}/api/learning/progress/${o.id}`,{headers:{...e&&{Authorization:`Bearer ${e}`},"Content-Type":"application/json"}});if(t.ok){const e=await t.json();e.success&&(h(e.data),console.log("StudentDashboard: \u30b3\u30fc\u30b9\u60c5\u5831\u53d6\u5f97\u6210\u529f",{courseCount:e.data.length}))}else console.error("StudentDashboard: \u30b3\u30fc\u30b9\u60c5\u5831\u53d6\u5f97\u5931\u6557",{status:t.status})}catch(n){console.error("StudentDashboard: \u30b3\u30fc\u30b9\u60c5\u5831\u53d6\u5f97\u30a8\u30e9\u30fc:",n)}else console.warn("StudentDashboard: \u8a8d\u8a3c\u60c5\u5831\u304c\u306a\u3044\u305f\u3081\u3001\u30b3\u30fc\u30b9\u60c5\u5831\u53d6\u5f97\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059")})()},[null===o||void 0===o?void 0:o.id]),(0,r.useEffect)(()=>("dashboard"===e?j():N(),()=>{N()}),[e]),(0,r.useEffect)(()=>{(async()=>{if(o)return;console.log("StudentDashboard: \u73fe\u5728\u306eURL:",window.location.href),console.log("StudentDashboard: searchParams:",l.toString()),console.log("StudentDashboard: PUBLIC_URL:","");const e=localStorage.getItem("loginCode"),t=localStorage.getItem("tempPassword"),n=localStorage.getItem("currentUser");if(console.log("StudentDashboard: \u65e2\u5b58\u306e\u8a8d\u8a3c\u60c5\u5831\u78ba\u8a8d:",{hasLoginCode:!!e,hasTempPassword:!!t,hasCurrentUser:!!n}),e&&t&&n)try{const s=JSON.parse(n);console.log("StudentDashboard: \u65e2\u5b58\u306e\u8a8d\u8a3c\u60c5\u5831\u304b\u3089\u8a8d\u8a3c\u72b6\u614b\u3092\u5fa9\u5143:",s);const r=localStorage.getItem("tempPasswordExpiry");if(!r){console.log("StudentDashboard: \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u60c5\u5831\u304c\u6709\u52b9\u3067\u3059\uff08\u6709\u52b9\u671f\u9650\u306a\u3057\uff09- \u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\u3057\u3066\u8a8d\u8a3c\u72b6\u614b\u3092\u5fa9\u5143");const n=localStorage.getItem("accessToken"),r=localStorage.getItem("refreshToken");if(n&&r)return console.log("StudentDashboard: \u65e2\u5b58\u306e\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u7528\u3057\u3066\u8a8d\u8a3c"),void i(s,n,r);console.log("StudentDashboard: \u30c8\u30fc\u30af\u30f3\u304c\u306a\u3044\u305f\u3081\u3001\u518d\u8a8d\u8a3c\u3057\u3066\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\u3057\u307e\u3059"),u(!0);try{const n=await it(e,t);n.success&&n.data.access_token&&n.data.refresh_token?(console.log("StudentDashboard: \u518d\u8a8d\u8a3c\u6210\u529f\u3001\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\u3057\u307e\u3057\u305f"),i(s,n.data.access_token,n.data.refresh_token)):(console.log("StudentDashboard: \u518d\u8a8d\u8a3c\u306b\u5931\u6557\u3001\u30c8\u30fc\u30af\u30f3\u306a\u3057\u3067\u30ed\u30b0\u30a4\u30f3"),i(s))}catch(p){console.error("StudentDashboard: \u518d\u8a8d\u8a3c\u30a8\u30e9\u30fc:",p),i(s)}finally{u(!1)}return}{const n=new Date(r);if(n>new Date){console.log("StudentDashboard: \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u60c5\u5831\u304c\u6709\u52b9\u3067\u3059 - \u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\u3057\u3066\u8a8d\u8a3c\u72b6\u614b\u3092\u5fa9\u5143");const n=localStorage.getItem("accessToken"),r=localStorage.getItem("refreshToken");if(n&&r)return console.log("StudentDashboard: \u65e2\u5b58\u306e\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u7528\u3057\u3066\u8a8d\u8a3c"),void i(s,n,r);console.log("StudentDashboard: \u30c8\u30fc\u30af\u30f3\u304c\u306a\u3044\u305f\u3081\u3001\u518d\u8a8d\u8a3c\u3057\u3066\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\u3057\u307e\u3059"),u(!0);try{const n=await it(e,t);n.success&&n.data.access_token&&n.data.refresh_token?(console.log("StudentDashboard: \u518d\u8a8d\u8a3c\u6210\u529f\u3001\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\u3057\u307e\u3057\u305f"),i(s,n.data.access_token,n.data.refresh_token)):(console.log("StudentDashboard: \u518d\u8a8d\u8a3c\u306b\u5931\u6557\u3001\u30c8\u30fc\u30af\u30f3\u306a\u3057\u3067\u30ed\u30b0\u30a4\u30f3"),i(s))}catch(p){console.error("StudentDashboard: \u518d\u8a8d\u8a3c\u30a8\u30e9\u30fc:",p),i(s)}finally{u(!1)}return}console.log("StudentDashboard: \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u6709\u52b9\u671f\u9650\u304c\u5207\u308c\u3066\u3044\u307e\u3059 - \u8a8d\u8a3c\u60c5\u5831\u3092\u30af\u30ea\u30a2"),localStorage.removeItem("loginCode"),localStorage.removeItem("tempPassword"),localStorage.removeItem("tempPasswordExpiry"),localStorage.removeItem("currentUser"),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}}catch(p){console.error("StudentDashboard: \u65e2\u5b58\u306e\u8a8d\u8a3c\u60c5\u5831\u306e\u5fa9\u5143\u306b\u5931\u6557:",p),localStorage.removeItem("loginCode"),localStorage.removeItem("tempPassword"),localStorage.removeItem("tempPasswordExpiry"),localStorage.removeItem("currentUser")}const s=l.get("token"),r=l.get("tempPassword")||l.get("password")||l.get("temp_password"),a=l.get("code")||l.get("loginCode")||l.get("login_code");console.log("StudentDashboard: \u30af\u30a8\u30ea\u30d1\u30e9\u30e1\u30fc\u30bf\u78ba\u8a8d:",{token:s,tempPassword:r?"***":"\u306a\u3057",loginCode:a,allParams:Object.fromEntries(l.entries())});const c=new URLSearchParams(window.location.search),d=c.get("tempPassword")||c.get("password")||c.get("temp_password"),m=c.get("code")||c.get("loginCode")||c.get("login_code");console.log("StudentDashboard: URL\u76f4\u63a5\u53d6\u5f97\u30d1\u30e9\u30e1\u30fc\u30bf:",{urlTempPassword:d?"***":"\u306a\u3057",urlLoginCode:m});const g=r||d,h=a||m;if(console.log("StudentDashboard: \u6700\u7d42\u30d1\u30e9\u30e1\u30fc\u30bf:",{finalTempPassword:g?"***":"\u306a\u3057",finalLoginCode:h}),g&&h){console.log("StudentDashboard: \u30af\u30a8\u30ea\u30d1\u30e9\u30e1\u30fc\u30bf\u304b\u3089\u8a8d\u8a3c\u60c5\u5831\u3092\u691c\u51fa"),u(!0),x("");try{console.log("StudentDashboard: \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u3092\u958b\u59cb:",{loginCode:h,tempPassword:"***"});const e=await it(h,g);if(e.success){console.log("StudentDashboard: \u8a8d\u8a3c\u6210\u529f:",e.data),console.log("StudentDashboard: \u6307\u5c0e\u54e1\u540d\u30c7\u30d0\u30c3\u30b0:",{instructorName:e.data.instructorName,type:typeof e.data.instructorName,isTruthy:!!e.data.instructorName,fullData:e.data});const t={id:e.data.userId,name:e.data.userName,role:"student",login_code:h,instructorName:e.data.instructorName},n=e.data.access_token&&e.data.access_token.trim().length>0,s=e.data.refresh_token&&e.data.refresh_token.trim().length>0;console.log("StudentDashboard: \u30c8\u30fc\u30af\u30f3\u60c5\u5831:",{hasAccessToken:n,hasRefreshToken:s,accessTokenLength:n?e.data.access_token.length:0,refreshTokenLength:s?e.data.refresh_token.length:0}),n&&s?(console.log("StudentDashboard: JWT\u30c8\u30fc\u30af\u30f3\u3092\u53d7\u4fe1 - \u6a19\u6e96\u8a8d\u8a3c\u3068\u3057\u3066\u51e6\u7406"),(0,Ae.PD)(h,g,t,e.data.expiresAt),i(t,e.data.access_token,e.data.refresh_token)):(console.log("StudentDashboard: JWT\u30c8\u30fc\u30af\u30f3\u306a\u3057 - \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u3068\u3057\u3066\u51e6\u7406"),(0,Ae.PD)(h,g,t,e.data.expiresAt),i(t)),console.log("StudentDashboard: \u81ea\u52d5\u30ed\u30b0\u30a4\u30f3\u6210\u529f:",t);const r=new URL(window.location);r.searchParams.delete("token"),r.searchParams.delete("tempPassword"),r.searchParams.delete("password"),r.searchParams.delete("temp_password"),r.searchParams.delete("code"),r.searchParams.delete("loginCode"),r.searchParams.delete("login_code"),window.history.replaceState({},"",r)}else x(e.message||"\u8a8d\u8a3c\u306b\u5931\u6557\u3057\u307e\u3057\u305f"),console.error("StudentDashboard: \u8a8d\u8a3c\u5931\u6557:",e.message)}catch(p){console.error("StudentDashboard: \u81ea\u52d5\u30ed\u30b0\u30a4\u30f3\u30a8\u30e9\u30fc:",p);const e=p.message||"\u8a8d\u8a3c\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f";x(e)}finally{u(!1)}}else{const e=localStorage.getItem("autoLoginCode"),t=localStorage.getItem("tempPassword")||localStorage.getItem("temp_password"),n=localStorage.getItem("currentUser");if(console.log("StudentDashboard: localStorage\u78ba\u8a8d:",{hasAutoLoginCode:!!e,hasTempPassword:!!t,hasCurrentUser:!!n}),e&&t&&!n){console.log("StudentDashboard: \u8a8d\u8a3c\u60c5\u5831\u306f\u5b58\u5728\u3059\u308b\u304c\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002\u5fa9\u65e7\u51e6\u7406\u3092\u958b\u59cb"),u(!0);try{const n=await it(e,t);if(n.success){console.log("StudentDashboard: \u5fa9\u65e7\u8a8d\u8a3c\u6210\u529f");const t={id:n.data.userId,name:n.data.userName,role:"student",login_code:e,instructorName:n.data.instructorName};i(t)}else console.error("StudentDashboard: \u5fa9\u65e7\u8a8d\u8a3c\u5931\u6557"),localStorage.removeItem("autoLoginCode"),localStorage.removeItem("tempPassword"),localStorage.removeItem("loginCode"),localStorage.removeItem("temp_password"),localStorage.removeItem("currentUser")}catch(p){console.error("StudentDashboard: \u5fa9\u65e7\u51e6\u7406\u30a8\u30e9\u30fc:",p)}finally{u(!1)}}const s=localStorage.getItem("autoLoginUser"),r=localStorage.getItem("autoLoginTarget");if(e&&s&&r&&!o)if(console.log("StudentDashboard: RemoteSupport\u81ea\u52d5\u30ed\u30b0\u30a4\u30f3\u60c5\u5831\u3092\u691c\u51fa:",{autoLoginCode:e,autoLoginUser:s,autoLoginTarget:r}),localStorage.removeItem("autoLoginCode"),localStorage.removeItem("autoLoginUser"),localStorage.removeItem("autoLoginTarget"),t){console.log("StudentDashboard: \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u5b58\u5728\u3059\u308b\u305f\u3081\u81ea\u52d5\u30ed\u30b0\u30a4\u30f3\u3092\u8a66\u884c"),u(!0);try{const n=await it(e,t);if(n.success){console.log("StudentDashboard: RemoteSupport\u81ea\u52d5\u30ed\u30b0\u30a4\u30f3\u6210\u529f");const t={id:n.data.userId,name:n.data.userName,role:"student",login_code:e,instructorName:n.data.instructorName};i(t)}else console.log("StudentDashboard: RemoteSupport\u81ea\u52d5\u30ed\u30b0\u30a4\u30f3\u5931\u6557\u3002\u624b\u52d5\u5165\u529b\u304c\u5fc5\u8981\u3067\u3059"),x("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044")}catch(p){console.error("StudentDashboard: RemoteSupport\u81ea\u52d5\u30ed\u30b0\u30a4\u30f3\u30a8\u30e9\u30fc:",p),x("\u81ea\u52d5\u30ed\u30b0\u30a4\u30f3\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}finally{u(!1)}}else console.log("StudentDashboard: \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002\u624b\u52d5\u5165\u529b\u304c\u5fc5\u8981\u3067\u3059"),x("\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044")}})()},[o,i,a,l]),(0,r.useEffect)(()=>()=>{N()},[]);const v=async()=>{if(!o)return void console.log("StudentDashboard: \u8a8d\u8a3c\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u65b0\u7740\u30e1\u30c3\u30bb\u30fc\u30b8\u78ba\u8a8d\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");const e=localStorage.getItem("accessToken"),t=localStorage.getItem("loginCode")&&localStorage.getItem("tempPassword");if(e||t)try{const e=await He("/api/messages/unread-count");e.success&&e.data.unread_count>0&&(y({count:e.data.unread_count,timestamp:new Date}),setTimeout(()=>{y(null)},3e3))}catch(n){if("Authentication failed"===n.message||"Authentication error handling in progress"===n.message)return void console.log("StudentDashboard: \u8a8d\u8a3c\u30a8\u30e9\u30fc\u306e\u305f\u3081\u3001\u65b0\u7740\u30e1\u30c3\u30bb\u30fc\u30b8\u78ba\u8a8d\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");console.error("StudentDashboard: \u65b0\u7740\u30e1\u30c3\u30bb\u30fc\u30b8\u78ba\u8a8d\u30a8\u30e9\u30fc:",n)}else console.warn("StudentDashboard: \u8a8d\u8a3c\u60c5\u5831\u304c\u306a\u3044\u305f\u3081\u3001\u65b0\u7740\u30e1\u30c3\u30bb\u30fc\u30b8\u78ba\u8a8d\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059")},j=()=>{if(!o)return void console.log("\u8a8d\u8a3c\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u5b9a\u671f\u78ba\u8a8d\u3092\u958b\u59cb\u3057\u307e\u305b\u3093");p&&clearInterval(p),v();const e=setInterval(v,3e5);f(e)},N=()=>{p&&(clearInterval(p),f(null))},w=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t(e),n&&s(n)};return o?(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex flex-col",children:[(0,pt.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-600 text-white shadow-lg",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,pt.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,pt.jsx)("div",{className:"flex items-center gap-4",children:(0,pt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,pt.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Study Sphere"}),(0,pt.jsx)("span",{className:"px-3 py-1 bg-white bg-opacity-20 rounded-full text-sm font-semibold",children:"\u5229\u7528\u8005"})]})}),(0,pt.jsx)("div",{className:"flex flex-col md:flex-row items-center gap-4",children:(0,pt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,pt.jsxs)("span",{className:"font-medium text-white",children:[o.name,"\u3055\u3093",(console.log("\u6307\u5c0e\u54e1\u60c5\u5831\u30c7\u30d0\u30c3\u30b0:",{instructorName:o.instructorName,type:typeof o.instructorName,isTruthy:!!o.instructorName,currentUser:o}),o.instructorName&&""!==o.instructorName.trim()?(0,pt.jsxs)("span",{className:"text-blue-100 text-sm ml-2",children:["\uff08\u62c5\u5f53\uff1a",o.instructorName,"\u6307\u5c0e\u54e1\uff09"]}):(0,pt.jsx)("span",{className:"text-blue-100 text-sm ml-2",children:"\uff08\u62c5\u5f53\uff1a\u672a\u8a2d\u5b9a\uff09"}))]}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-red-500 hover:bg-red-600 border border-red-400 rounded-lg transition-all duration-200 font-medium text-white shadow-sm hover:shadow-md",onClick:()=>{window.confirm("\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u307e\u3059\u304b\uff1f")&&(console.log("\u30ed\u30b0\u30a2\u30a6\u30c8\u51e6\u7406\u3092\u958b\u59cb"),localStorage.removeItem("autoLoginCode"),localStorage.removeItem("tempPassword"),localStorage.removeItem("loginCode"),localStorage.removeItem("temp_password"),localStorage.removeItem("autoLoginUser"),localStorage.removeItem("autoLoginTarget"),c(),console.log("\u30ed\u30b0\u30a2\u30a6\u30c8\u5b8c\u4e86"))},title:"\u30ed\u30b0\u30a2\u30a6\u30c8",children:"\ud83d\udeaa \u30ed\u30b0\u30a2\u30a6\u30c8"})]})})]})})}),(0,pt.jsx)("div",{className:"bg-white shadow-md",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,pt.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,pt.jsx)("button",{className:"px-4 py-2 rounded-lg font-medium transition-all duration-200 "+("dashboard"===e?"bg-gradient-to-r from-blue-500 to-cyan-600 text-white shadow-lg":"text-gray-600 hover:bg-blue-50 hover:text-blue-700"),onClick:()=>w("dashboard"),children:"\ud83d\udcca \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9"}),(0,pt.jsx)("button",{className:"px-4 py-2 rounded-lg font-medium transition-all duration-200 "+("lessons"===e?"bg-gradient-to-r from-blue-500 to-cyan-600 text-white shadow-lg":"text-gray-600 hover:bg-blue-50 hover:text-blue-700"),onClick:()=>w("lessons"),children:"\ud83d\udcda \u30ec\u30c3\u30b9\u30f3\u4e00\u89a7"}),(0,pt.jsx)("button",{className:"px-4 py-2 rounded-lg font-medium transition-all duration-200 "+("career-assessment"===e?"bg-gradient-to-r from-blue-500 to-cyan-600 text-white shadow-lg":"text-gray-600 hover:bg-blue-50 hover:text-blue-700"),onClick:()=>w("career-assessment"),children:"\ud83c\udfaf \u9069\u8077\u8a3a\u65ad"})]})})}),(0,pt.jsxs)("main",{className:"flex-1 max-w-7xl mx-auto w-full px-4 sm:px-6 lg:px-8 py-8",children:[b&&(0,pt.jsx)("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg animate-pulse",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("div",{className:"flex items-center",children:[(0,pt.jsx)("span",{className:"text-blue-500 mr-2",children:"\ud83d\udcec"}),(0,pt.jsxs)("span",{className:"text-blue-700 font-medium",children:["\u65b0\u7740\u30e1\u30c3\u30bb\u30fc\u30b8 ",b.count,"\u4ef6\u304c\u3042\u308a\u307e\u3059"]})]}),(0,pt.jsx)("button",{onClick:()=>y(null),className:"text-blue-500 hover:text-blue-700",children:"\u2715"})]})}),(0,pt.jsxs)("div",{className:"space-y-8",children:["dashboard"===e&&(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:(0,pt.jsx)(Jn,{onTabChange:w})}),"lessons"===e&&(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:(0,pt.jsx)(vo,{selectedCourseId:n})}),"career-assessment"===e&&(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:(0,pt.jsx)(jo,{})})]})]})]}):(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"text-blue-600 text-xl font-semibold mb-4",children:d?"\u81ea\u52d5\u30ed\u30b0\u30a4\u30f3\u4e2d...":"\u8a8d\u8a3c\u4e2d..."}),d&&(0,pt.jsx)("div",{className:"text-gray-600 text-sm",children:"\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3092\u5b8c\u4e86\u3057\u3066\u304f\u3060\u3055\u3044"}),m&&(0,pt.jsxs)("div",{className:"mt-4 p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,pt.jsx)("div",{className:"text-red-700 font-medium mb-2",children:"\u8a8d\u8a3c\u30a8\u30e9\u30fc"}),(0,pt.jsx)("div",{className:"text-red-600 text-sm",children:m}),(0,pt.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,pt.jsx)("button",{className:"w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",onClick:()=>a("/student-login"),children:"\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u3078"}),(0,pt.jsx)("button",{className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",onClick:()=>window.location.reload(),children:"\u518d\u8a66\u884c"})]})]})]})})},wo=()=>{const e=ne(),[t]=De(),{login:n,isAuthenticated:s,currentUser:a}=bt(),[l,o]=(0,r.useState)(!0),[i,c]=(0,r.useState)("");return(0,r.useEffect)(()=>{(async()=>{console.log("AutoLoginPage: \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304c\u30de\u30a6\u30f3\u30c8\u3055\u308c\u307e\u3057\u305f"),console.log("AutoLoginPage: \u73fe\u5728\u306eURL:",window.location.href),console.log("AutoLoginPage: searchParams:",t.toString()),console.log("AutoLoginPage: PUBLIC_URL:",""),console.log("AutoLoginPage: basename:","");try{const r=t.get("loginCode")||t.get("code")||t.get("login_code"),l=t.get("tempPassword")||t.get("password")||t.get("temp_password");console.log("AutoLoginPage: \u30af\u30a8\u30ea\u30d1\u30e9\u30e1\u30fc\u30bf\u78ba\u8a8d:",{loginCode:r,tempPassword:l?"***":"\u306a\u3057",allParams:Object.fromEntries(t.entries())});const o=new URLSearchParams(window.location.search),i=o.get("loginCode")||o.get("code")||o.get("login_code"),d=o.get("tempPassword")||o.get("password")||o.get("temp_password");console.log("AutoLoginPage: URL\u76f4\u63a5\u53d6\u5f97\u30d1\u30e9\u30e1\u30fc\u30bf:",{urlLoginCode:i,urlTempPassword:d?"***":"\u306a\u3057"});const u=r||i,m=l||d;if(console.log("AutoLoginPage: \u6700\u7d42\u30d1\u30e9\u30e1\u30fc\u30bf:",{finalLoginCode:u,finalTempPassword:m?"***":"\u306a\u3057"}),!u||!m)return console.error("AutoLoginPage: \u5fc5\u8981\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059"),console.error("AutoLoginPage: \u5229\u7528\u53ef\u80fd\u306a\u30d1\u30e9\u30e1\u30fc\u30bf:",Object.fromEntries(t.entries())),c("\u30ed\u30b0\u30a4\u30f3\u30b3\u30fc\u30c9\u307e\u305f\u306f\u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093"),void setTimeout(()=>{e("/student-login/")},3e3);if(s&&a)return console.log("AutoLoginPage: \u65e2\u306b\u8a8d\u8a3c\u6e08\u307f\u3067\u3059"),void e("/student/dashboard");console.log("AutoLoginPage: \u4e00\u6642\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u3092\u958b\u59cb"),console.log("AutoLoginPage: \u8a8d\u8a3cAPI\u547c\u3073\u51fa\u3057\u958b\u59cb");const x=await it(u,m);if(console.log("AutoLoginPage: \u8a8d\u8a3cAPI\u5fdc\u7b54:",x),x.success){console.log("AutoLoginPage: \u8a8d\u8a3c\u6210\u529f:",x.data),x.data.access_token&&(localStorage.setItem("accessToken",x.data.access_token),console.log("AutoLoginPage: \u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u4fdd\u5b58")),x.data.refresh_token&&(localStorage.setItem("refreshToken",x.data.refresh_token),console.log("AutoLoginPage: \u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u30c8\u30fc\u30af\u30f3\u3092\u4fdd\u5b58")),localStorage.setItem("autoLoginCode",u),localStorage.setItem("tempPassword",m),localStorage.setItem("loginCode",u),localStorage.setItem("temp_password",m);const t={id:x.data.userId,name:x.data.userName,role:"student",login_code:u,instructorName:x.data.instructorName};console.log("AutoLoginPage: \u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58:",t),n(t,x.data.access_token,x.data.refresh_token),console.log("AutoLoginPage: \u4fdd\u5b58\u3055\u308c\u305f\u8a8d\u8a3c\u60c5\u5831\u78ba\u8a8d:",{autoLoginCode:localStorage.getItem("autoLoginCode"),tempPassword:localStorage.getItem("tempPassword")?"***":"\u306a\u3057",loginCode:localStorage.getItem("loginCode"),temp_password:localStorage.getItem("temp_password")?"***":"\u306a\u3057",accessToken:localStorage.getItem("accessToken")?"***":"\u306a\u3057",refreshToken:localStorage.getItem("refreshToken")?"***":"\u306a\u3057",currentUser:localStorage.getItem("currentUser")?"\u5b58\u5728":"\u306a\u3057"}),console.log("AutoLoginPage: \u81ea\u52d5\u30ed\u30b0\u30a4\u30f3\u6210\u529f"),e("/student/dashboard")}else{console.error("AutoLoginPage: \u8a8d\u8a3c\u5931\u6557:",x);const t=x.message||x.error||"\u8a8d\u8a3c\u306b\u5931\u6557\u3057\u307e\u3057\u305f";c(`\u8a8d\u8a3c\u30a8\u30e9\u30fc: ${t}`),setTimeout(()=>{e("/student-login/")},3e3)}}catch(i){console.error("AutoLoginPage: \u8a8d\u8a3c\u51e6\u7406\u30a8\u30e9\u30fc:",i),c("\u8a8d\u8a3c\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"),setTimeout(()=>{e("/student-login/")},3e3)}finally{o(!1)}})()},[t,n,s,a,e]),l?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),(0,pt.jsx)("div",{className:"text-blue-600 text-xl font-semibold mb-2",children:"\u81ea\u52d5\u30ed\u30b0\u30a4\u30f3\u4e2d..."}),(0,pt.jsx)("div",{className:"text-gray-600 text-sm",children:"\u8a8d\u8a3c\u60c5\u5831\u3092\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059"})]})}):i?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center max-w-md mx-auto p-6",children:[(0,pt.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 mb-4",children:[(0,pt.jsx)("div",{className:"text-red-600 text-xl font-semibold mb-2",children:"\u8a8d\u8a3c\u30a8\u30e9\u30fc"}),(0,pt.jsx)("div",{className:"text-red-700 mb-4",children:i}),(0,pt.jsx)("div",{className:"text-gray-600 text-sm",children:"\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306b\u79fb\u52d5\u3057\u307e\u3059..."})]}),(0,pt.jsx)("button",{className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",onClick:()=>e("/student-login/"),children:"\u4eca\u3059\u3050\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u3078"})]})}):(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsx)("div",{className:"text-center",children:(0,pt.jsx)("div",{className:"text-gray-600 text-lg",children:"\u51e6\u7406\u4e2d..."})})})},ko=e=>{let{lessonData:t,courseData:n,currentLesson:s,currentSection:r,sectionData:a,onSectionChange:l,onUploadModalOpen:o,onTestNavigate:i,isTestEnabled:c,hasAssignment:d,assignmentSubmitted:u}=e;const m=ne();return(0,pt.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-cyan-600 text-white shadow-lg",children:(0,pt.jsx)("div",{className:"px-4 sm:px-6 lg:px-8 py-6",children:(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,pt.jsx)("button",{onClick:()=>window.history.back(),className:"p-2 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg transition-all duration-200 hover:scale-105",title:"\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u623b\u308b",children:"\u2190"}),(0,pt.jsx)("h1",{className:"text-2xl lg:text-3xl font-bold",children:(null===t||void 0===t?void 0:t.title)||`\u7b2c${s}\u56de\u3000\u5b66\u7fd2\u5185\u5bb9`})]}),n&&(0,pt.jsxs)("p",{className:"text-blue-100 text-sm lg:text-base",children:[n.title," - ",n.description||"\u30b3\u30fc\u30b9\u306e\u8aac\u660e"]})]}),(0,pt.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("label",{className:"text-sm font-medium",children:"\u30bb\u30af\u30b7\u30e7\u30f3\u9078\u629e: "}),(0,pt.jsx)("select",{value:r,onChange:e=>l(parseInt(e.target.value)),className:"px-3 py-1 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50",children:a&&a.length>0?a.map((e,t)=>(0,pt.jsx)("option",{value:t,className:"text-gray-800",children:e.video_title||`\u30bb\u30af\u30b7\u30e7\u30f3 ${t+1}`},e.id||t)):(0,pt.jsxs)("option",{value:r,className:"text-gray-800",children:["\u30bb\u30af\u30b7\u30e7\u30f3",r+1]})})]}),d&&!u&&(0,pt.jsx)("button",{className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-all duration-200 hover:shadow-lg transform hover:-translate-y-0.5",onClick:o,children:"\ud83d\udcc1 \u6210\u679c\u7269\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"}),d&&u&&(0,pt.jsx)("span",{className:"px-4 py-2 bg-green-600 text-white rounded-lg font-medium",children:"\u2705 \u8ab2\u984c\u63d0\u51fa\u6e08\u307f"}),(0,pt.jsxs)("div",{className:"relative group",children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-all duration-200 hover:shadow-lg transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed",disabled:!c,children:"\ud83d\udcdd \u5b66\u7fd2\u52b9\u679c\u30c6\u30b9\u30c8 \u25bc"}),c&&(0,pt.jsx)("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50",children:(0,pt.jsxs)("div",{className:"py-2",children:[(0,pt.jsxs)("button",{onClick:()=>{const e=`test_data_${s}_${r}`;sessionStorage.removeItem(e),console.log("\u30bb\u30af\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2:",e),m(`/student/section-test?lesson=${s}&section=${r}`)},className:"w-full px-4 py-3 text-left text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors",children:[(0,pt.jsx)("div",{className:"font-medium",children:"\u30bb\u30af\u30b7\u30e7\u30f3\u307e\u3068\u3081\u30c6\u30b9\u30c8"}),(0,pt.jsx)("div",{className:"text-sm text-gray-500",children:"10\u554f"})]}),(0,pt.jsxs)("button",{onClick:()=>{const e=`test_data_lesson_${s}`;sessionStorage.removeItem(e),console.log("\u30ec\u30c3\u30b9\u30f3\u30c6\u30b9\u30c8\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2:",e),m(`/student/lesson-test?lesson=${s}`)},className:"w-full px-4 py-3 text-left text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors",children:[(0,pt.jsx)("div",{className:"font-medium",children:"\u30ec\u30c3\u30b9\u30f3\u307e\u3068\u3081\u30c6\u30b9\u30c8"}),(0,pt.jsx)("div",{className:"text-sm text-gray-500",children:"30\u554f"})]})]})})]})]})]})})})},So=e=>{let{videoUrl:t,title:n}=e;const s=(e=>{const t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/);return t&&11===t[2].length?t[2]:null})(t);return s?(0,pt.jsx)("div",{className:"aspect-video bg-gray-100 rounded-lg overflow-hidden flex items-center justify-center",children:(0,pt.jsx)("iframe",{src:`https://www.youtube.com/embed/${s}`,title:n,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"w-full h-full border-0"})}):(0,pt.jsx)("div",{className:"aspect-video bg-gray-100 rounded-lg flex items-center justify-center",children:(0,pt.jsx)("p",{className:"text-gray-500",children:"\u52d5\u753bURL\u304c\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093"})})},_o=e=>{let{lessonData:t}=e;return(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,pt.jsx)("span",{className:"text-2xl",children:"\ud83c\udfa5"}),(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u52d5\u753b\u5b66\u7fd2"})]}),t&&t.videos&&t.videos.length>0?(0,pt.jsx)(pt.Fragment,{children:t.videos.map((e,t)=>(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 rounded-lg",children:[(0,pt.jsx)("p",{className:"font-semibold text-blue-800 mb-1",children:e.title}),(0,pt.jsx)("p",{className:"text-sm text-blue-600",children:e.description})]}),(0,pt.jsx)(So,{videoUrl:e.youtube_url,title:e.title})]},e.id||t))}):(0,pt.jsx)("div",{className:"text-center py-8 text-gray-600",children:(0,pt.jsx)("p",{children:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u306b\u306f\u52d5\u753b\u304c\u3042\u308a\u307e\u305b\u3093\u3002"})})]})};function Co(e,t){const n=String(e);if("string"!==typeof t)throw new TypeError("Expected character");let s=0,r=n.indexOf(t);for(;-1!==r;)s++,r=n.indexOf(t,r+t.length);return s}function Io(e,t,n){const s=hl((n||{}).ignore||[]),r=function(e){const t=[];if(!Array.isArray(e))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!e[0]||Array.isArray(e[0])?e:[e];let s=-1;for(;++s<n.length;){const e=n[s];t.push([To(e[0]),Po(e[1])])}return t}(t);let a=-1;for(;++a<r.length;)Nl(e,"text",l);function l(e,t){let n,l=-1;for(;++l<t.length;){const e=t[l],r=n?n.children:void 0;if(s(e,r?r.indexOf(e):void 0,n))return;n=e}if(n)return function(e,t){const n=t[t.length-1],s=r[a][0],l=r[a][1];let o=0;const i=n.children.indexOf(e);let c=!1,d=[];s.lastIndex=0;let u=s.exec(e.value);for(;u;){const n=u.index,r={index:u.index,input:u.input,stack:[...t,e]};let a=l(...u,r);if("string"===typeof a&&(a=a.length>0?{type:"text",value:a}:void 0),!1===a?s.lastIndex=n+1:(o!==n&&d.push({type:"text",value:e.value.slice(o,n)}),Array.isArray(a)?d.push(...a):a&&d.push(a),o=n+u[0].length,c=!0),!s.global)break;u=s.exec(e.value)}c?(o<e.value.length&&d.push({type:"text",value:e.value.slice(o)}),n.children.splice(i,1,...d)):d=[e];return i+d.length}(e,t)}}function To(e){return"string"===typeof e?new RegExp(function(e){if("string"!==typeof e)throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}(e),"g"):e}function Po(e){return"function"===typeof e?e:function(){return e}}const Lo="phrasing",Eo=["autolink","link","image","label"];function Do(e){this.enter({type:"link",title:null,url:"",children:[]},e)}function Ao(e){this.config.enter.autolinkProtocol.call(this,e)}function $o(e){this.config.exit.autolinkProtocol.call(this,e)}function zo(e){this.config.exit.data.call(this,e);const t=this.stack[this.stack.length-1];t.type,t.url="http://"+this.sliceSerialize(e)}function Oo(e){this.config.exit.autolinkEmail.call(this,e)}function Ro(e){this.exit(e)}function Mo(e){Io(e,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,Fo],[/(?<=^|\s|\p{P}|\p{S})([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/gu,Uo]],{ignore:["link","linkReference"]})}function Fo(e,t,n,s,r){let a="";if(!Bo(r))return!1;if(/^w/i.test(t)&&(n=t+n,t="",a="http://"),!function(e){const t=e.split(".");if(t.length<2||t[t.length-1]&&(/_/.test(t[t.length-1])||!/[a-zA-Z\d]/.test(t[t.length-1]))||t[t.length-2]&&(/_/.test(t[t.length-2])||!/[a-zA-Z\d]/.test(t[t.length-2])))return!1;return!0}(n))return!1;const l=function(e){const t=/[!"&'),.:;<>?\]}]+$/.exec(e);if(!t)return[e,void 0];e=e.slice(0,t.index);let n=t[0],s=n.indexOf(")");const r=Co(e,"(");let a=Co(e,")");for(;-1!==s&&r>a;)e+=n.slice(0,s+1),n=n.slice(s+1),s=n.indexOf(")"),a++;return[e,n]}(n+s);if(!l[0])return!1;const o={type:"link",title:null,url:a+t+l[0],children:[{type:"text",value:t+l[0]}]};return l[1]?[o,{type:"text",value:l[1]}]:o}function Uo(e,t,n,s){return!(!Bo(s,!0)||/[-\d_]$/.test(n))&&{type:"link",title:null,url:"mailto:"+t+"@"+n,children:[{type:"text",value:t+"@"+n}]}}function Bo(e,t){const n=e.input.charCodeAt(e.index-1);return(0===e.index||Er(n)||Lr(n))&&(!t||47!==n)}function Jo(){this.buffer()}function qo(e){this.enter({type:"footnoteReference",identifier:"",label:""},e)}function Vo(){this.buffer()}function Ho(e){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},e)}function Wo(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=sa(this.sliceSerialize(e)).toLowerCase(),n.label=t}function Qo(e){this.exit(e)}function Ko(e){const t=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=sa(this.sliceSerialize(e)).toLowerCase(),n.label=t}function Yo(e){this.exit(e)}function Go(e,t,n,s){const r=n.createTracker(s);let a=r.move("[^");const l=n.enter("footnoteReference"),o=n.enter("reference");return a+=r.move(n.safe(n.associationId(e),{after:"]",before:a})),o(),l(),a+=r.move("]"),a}function Zo(e){let t=!1;return e&&e.firstLineBlank&&(t=!0),{handlers:{footnoteDefinition:function(e,n,s,r){const a=s.createTracker(r);let l=a.move("[^");const o=s.enter("footnoteDefinition"),i=s.enter("label");l+=a.move(s.safe(s.associationId(e),{before:l,after:"]"})),i(),l+=a.move("]:"),e.children&&e.children.length>0&&(a.shift(4),l+=a.move((t?"\n":" ")+s.indentLines(s.containerFlow(e,a.current()),t?ei:Xo)));return o(),l},footnoteReference:Go},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]}}function Xo(e,t,n){return 0===t?e:ei(e,t,n)}function ei(e,t,n){return(n?"":"    ")+e}Go.peek=function(){return"["};const ti=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];function ni(e){this.enter({type:"delete",children:[]},e)}function si(e){this.exit(e)}function ri(e,t,n,s){const r=n.createTracker(s),a=n.enter("strikethrough");let l=r.move("~~");return l+=n.containerPhrasing(e,{...r.current(),before:l,after:"~"}),l+=r.move("~~"),a(),l}function ai(e){return e.length}function li(e){return null===e||void 0===e?"":String(e)}function oi(e){const t="string"===typeof e?e.codePointAt(0):0;return 67===t||99===t?99:76===t||108===t?108:82===t||114===t?114:0}function ii(e,t,n){return">"+(n?"":" ")+e}function ci(e,t){return di(e,t.inConstruct,!0)&&!di(e,t.notInConstruct,!1)}function di(e,t,n){if("string"===typeof t&&(t=[t]),!t||0===t.length)return n;let s=-1;for(;++s<t.length;)if(e.includes(t[s]))return!0;return!1}function ui(e,t,n,s){let r=-1;for(;++r<n.unsafe.length;)if("\n"===n.unsafe[r].character&&ci(n.stack,n.unsafe[r]))return/[ \t]/.test(s.before)?"":" ";return"\\\n"}function mi(e,t,n){return(n?"":"    ")+e}function xi(e){const t=e.options.quote||'"';if('"'!==t&&"'"!==t)throw new Error("Cannot serialize title with `"+t+"` for `options.quote`, expected `\"`, or `'`");return t}function gi(e){return"&#x"+e.toString(16).toUpperCase()+";"}function hi(e,t,n){const s=Ia(e),r=Ia(t);return void 0===s?void 0===r?"_"===n?{inside:!0,outside:!0}:{inside:!1,outside:!1}:1===r?{inside:!0,outside:!0}:{inside:!1,outside:!0}:1===s?void 0===r?{inside:!1,outside:!1}:1===r?{inside:!0,outside:!0}:{inside:!1,outside:!1}:void 0===r?{inside:!1,outside:!1}:1===r?{inside:!0,outside:!1}:{inside:!1,outside:!1}}function pi(e,t,n,s){const r=function(e){const t=e.options.emphasis||"*";if("*"!==t&&"_"!==t)throw new Error("Cannot serialize emphasis with `"+t+"` for `options.emphasis`, expected `*`, or `_`");return t}(n),a=n.enter("emphasis"),l=n.createTracker(s),o=l.move(r);let i=l.move(n.containerPhrasing(e,{after:r,before:o,...l.current()}));const c=i.charCodeAt(0),d=hi(s.before.charCodeAt(s.before.length-1),c,r);d.inside&&(i=gi(c)+i.slice(1));const u=i.charCodeAt(i.length-1),m=hi(s.after.charCodeAt(0),u,r);m.inside&&(i=i.slice(0,-1)+gi(u));const x=l.move(r);return a(),n.attentionEncodeSurroundingInfo={after:m.outside,before:d.outside},o+i+x}function fi(e){return e.value||""}function bi(e,t,n,s){const r=xi(n),a='"'===r?"Quote":"Apostrophe",l=n.enter("image");let o=n.enter("label");const i=n.createTracker(s);let c=i.move("![");return c+=i.move(n.safe(e.alt,{before:c,after:"]",...i.current()})),c+=i.move("]("),o(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(o=n.enter("destinationLiteral"),c+=i.move("<"),c+=i.move(n.safe(e.url,{before:c,after:">",...i.current()})),c+=i.move(">")):(o=n.enter("destinationRaw"),c+=i.move(n.safe(e.url,{before:c,after:e.title?" ":")",...i.current()}))),o(),e.title&&(o=n.enter(`title${a}`),c+=i.move(" "+r),c+=i.move(n.safe(e.title,{before:c,after:r,...i.current()})),c+=i.move(r),o()),c+=i.move(")"),l(),c}function yi(e,t,n,s){const r=e.referenceType,a=n.enter("imageReference");let l=n.enter("label");const o=n.createTracker(s);let i=o.move("![");const c=n.safe(e.alt,{before:i,after:"]",...o.current()});i+=o.move(c+"]["),l();const d=n.stack;n.stack=[],l=n.enter("reference");const u=n.safe(n.associationId(e),{before:i,after:"]",...o.current()});return l(),n.stack=d,a(),"full"!==r&&c&&c===u?"shortcut"===r?i=i.slice(0,-1):i+=o.move("]"):i+=o.move(u+"]"),i}function vi(e,t,n){let s=e.value||"",r="`",a=-1;for(;new RegExp("(^|[^`])"+r+"([^`]|$)").test(s);)r+="`";for(/[^ \r\n]/.test(s)&&(/^[ \r\n]/.test(s)&&/[ \r\n]$/.test(s)||/^`|`$/.test(s))&&(s=" "+s+" ");++a<n.unsafe.length;){const e=n.unsafe[a],t=n.compilePattern(e);let r;if(e.atBreak)for(;r=t.exec(s);){let e=r.index;10===s.charCodeAt(e)&&13===s.charCodeAt(e-1)&&e--,s=s.slice(0,e)+" "+s.slice(r.index+1)}}return r+s+r}function ji(e,t){const n=ir(e);return Boolean(!t.options.resourceLink&&e.url&&!e.title&&e.children&&1===e.children.length&&"text"===e.children[0].type&&(n===e.url||"mailto:"+n===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}function Ni(e,t,n,s){const r=xi(n),a='"'===r?"Quote":"Apostrophe",l=n.createTracker(s);let o,i;if(ji(e,n)){const t=n.stack;n.stack=[],o=n.enter("autolink");let s=l.move("<");return s+=l.move(n.containerPhrasing(e,{before:s,after:">",...l.current()})),s+=l.move(">"),o(),n.stack=t,s}o=n.enter("link"),i=n.enter("label");let c=l.move("[");return c+=l.move(n.containerPhrasing(e,{before:c,after:"](",...l.current()})),c+=l.move("]("),i(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(i=n.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(n.safe(e.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(i=n.enter("destinationRaw"),c+=l.move(n.safe(e.url,{before:c,after:e.title?" ":")",...l.current()}))),i(),e.title&&(i=n.enter(`title${a}`),c+=l.move(" "+r),c+=l.move(n.safe(e.title,{before:c,after:r,...l.current()})),c+=l.move(r),i()),c+=l.move(")"),o(),c}function wi(e,t,n,s){const r=e.referenceType,a=n.enter("linkReference");let l=n.enter("label");const o=n.createTracker(s);let i=o.move("[");const c=n.containerPhrasing(e,{before:i,after:"]",...o.current()});i+=o.move(c+"]["),l();const d=n.stack;n.stack=[],l=n.enter("reference");const u=n.safe(n.associationId(e),{before:i,after:"]",...o.current()});return l(),n.stack=d,a(),"full"!==r&&c&&c===u?"shortcut"===r?i=i.slice(0,-1):i+=o.move("]"):i+=o.move(u+"]"),i}function ki(e){const t=e.options.bullet||"*";if("*"!==t&&"+"!==t&&"-"!==t)throw new Error("Cannot serialize items with `"+t+"` for `options.bullet`, expected `*`, `+`, or `-`");return t}function Si(e){const t=e.options.rule||"*";if("*"!==t&&"-"!==t&&"_"!==t)throw new Error("Cannot serialize rules with `"+t+"` for `options.rule`, expected `*`, `-`, or `_`");return t}ri.peek=function(){return"~"},pi.peek=function(e,t,n){return n.options.emphasis||"*"},fi.peek=function(){return"<"},bi.peek=function(){return"!"},yi.peek=function(){return"!"},vi.peek=function(){return"`"},Ni.peek=function(e,t,n){return ji(e,n)?"<":"["},wi.peek=function(){return"["};const _i=hl(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function Ci(e,t,n,s){const r=function(e){const t=e.options.strong||"*";if("*"!==t&&"_"!==t)throw new Error("Cannot serialize strong with `"+t+"` for `options.strong`, expected `*`, or `_`");return t}(n),a=n.enter("strong"),l=n.createTracker(s),o=l.move(r+r);let i=l.move(n.containerPhrasing(e,{after:r,before:o,...l.current()}));const c=i.charCodeAt(0),d=hi(s.before.charCodeAt(s.before.length-1),c,r);d.inside&&(i=gi(c)+i.slice(1));const u=i.charCodeAt(i.length-1),m=hi(s.after.charCodeAt(0),u,r);m.inside&&(i=i.slice(0,-1)+gi(u));const x=l.move(r+r);return a(),n.attentionEncodeSurroundingInfo={after:m.outside,before:d.outside},o+i+x}Ci.peek=function(e,t,n){return n.options.strong||"*"};const Ii={blockquote:function(e,t,n,s){const r=n.enter("blockquote"),a=n.createTracker(s);a.move("> "),a.shift(2);const l=n.indentLines(n.containerFlow(e,a.current()),ii);return r(),l},break:ui,code:function(e,t,n,s){const r=function(e){const t=e.options.fence||"`";if("`"!==t&&"~"!==t)throw new Error("Cannot serialize code with `"+t+"` for `options.fence`, expected `` ` `` or `~`");return t}(n),a=e.value||"",l="`"===r?"GraveAccent":"Tilde";if(function(e,t){return Boolean(!1===t.options.fences&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}(e,n)){const e=n.enter("codeIndented"),t=n.indentLines(a,mi);return e(),t}const o=n.createTracker(s),i=r.repeat(Math.max(function(e,t){const n=String(e);let s=n.indexOf(t),r=s,a=0,l=0;if("string"!==typeof t)throw new TypeError("Expected substring");for(;-1!==s;)s===r?++a>l&&(l=a):a=1,r=s+t.length,s=n.indexOf(t,r);return l}(a,r)+1,3)),c=n.enter("codeFenced");let d=o.move(i);if(e.lang){const t=n.enter(`codeFencedLang${l}`);d+=o.move(n.safe(e.lang,{before:d,after:" ",encode:["`"],...o.current()})),t()}if(e.lang&&e.meta){const t=n.enter(`codeFencedMeta${l}`);d+=o.move(" "),d+=o.move(n.safe(e.meta,{before:d,after:"\n",encode:["`"],...o.current()})),t()}return d+=o.move("\n"),a&&(d+=o.move(a+"\n")),d+=o.move(i),c(),d},definition:function(e,t,n,s){const r=xi(n),a='"'===r?"Quote":"Apostrophe",l=n.enter("definition");let o=n.enter("label");const i=n.createTracker(s);let c=i.move("[");return c+=i.move(n.safe(n.associationId(e),{before:c,after:"]",...i.current()})),c+=i.move("]: "),o(),!e.url||/[\0- \u007F]/.test(e.url)?(o=n.enter("destinationLiteral"),c+=i.move("<"),c+=i.move(n.safe(e.url,{before:c,after:">",...i.current()})),c+=i.move(">")):(o=n.enter("destinationRaw"),c+=i.move(n.safe(e.url,{before:c,after:e.title?" ":"\n",...i.current()}))),o(),e.title&&(o=n.enter(`title${a}`),c+=i.move(" "+r),c+=i.move(n.safe(e.title,{before:c,after:r,...i.current()})),c+=i.move(r),o()),l(),c},emphasis:pi,hardBreak:ui,heading:function(e,t,n,s){const r=Math.max(Math.min(6,e.depth||1),1),a=n.createTracker(s);if(function(e,t){let n=!1;return wl(e,function(e){if("value"in e&&/\r?\n|\r/.test(e.value)||"break"===e.type)return n=!0,jl}),Boolean((!e.depth||e.depth<3)&&ir(e)&&(t.options.setext||n))}(e,n)){const t=n.enter("headingSetext"),s=n.enter("phrasing"),l=n.containerPhrasing(e,{...a.current(),before:"\n",after:"\n"});return s(),t(),l+"\n"+(1===r?"=":"-").repeat(l.length-(Math.max(l.lastIndexOf("\r"),l.lastIndexOf("\n"))+1))}const l="#".repeat(r),o=n.enter("headingAtx"),i=n.enter("phrasing");a.move(l+" ");let c=n.containerPhrasing(e,{before:"# ",after:"\n",...a.current()});return/^[\t ]/.test(c)&&(c=gi(c.charCodeAt(0))+c.slice(1)),c=c?l+" "+c:l,n.options.closeAtx&&(c+=" "+l),i(),o(),c},html:fi,image:bi,imageReference:yi,inlineCode:vi,link:Ni,linkReference:wi,list:function(e,t,n,s){const r=n.enter("list"),a=n.bulletCurrent;let l=e.ordered?function(e){const t=e.options.bulletOrdered||".";if("."!==t&&")"!==t)throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOrdered`, expected `.` or `)`");return t}(n):ki(n);const o=e.ordered?"."===l?")":".":function(e){const t=ki(e),n=e.options.bulletOther;if(!n)return"*"===t?"-":"*";if("*"!==n&&"+"!==n&&"-"!==n)throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===t)throw new Error("Expected `bullet` (`"+t+"`) and `bulletOther` (`"+n+"`) to be different");return n}(n);let i=!(!t||!n.bulletLastUsed)&&l===n.bulletLastUsed;if(!e.ordered){const t=e.children?e.children[0]:void 0;if("*"!==l&&"-"!==l||!t||t.children&&t.children[0]||"list"!==n.stack[n.stack.length-1]||"listItem"!==n.stack[n.stack.length-2]||"list"!==n.stack[n.stack.length-3]||"listItem"!==n.stack[n.stack.length-4]||0!==n.indexStack[n.indexStack.length-1]||0!==n.indexStack[n.indexStack.length-2]||0!==n.indexStack[n.indexStack.length-3]||(i=!0),Si(n)===l&&t){let t=-1;for(;++t<e.children.length;){const n=e.children[t];if(n&&"listItem"===n.type&&n.children&&n.children[0]&&"thematicBreak"===n.children[0].type){i=!0;break}}}}i&&(l=o),n.bulletCurrent=l;const c=n.containerFlow(e,s);return n.bulletLastUsed=l,n.bulletCurrent=a,r(),c},listItem:function(e,t,n,s){const r=function(e){const t=e.options.listItemIndent||"one";if("tab"!==t&&"one"!==t&&"mixed"!==t)throw new Error("Cannot serialize items with `"+t+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return t}(n);let a=n.bulletCurrent||ki(n);t&&"list"===t.type&&t.ordered&&(a=("number"===typeof t.start&&t.start>-1?t.start:1)+(!1===n.options.incrementListMarker?0:t.children.indexOf(e))+a);let l=a.length+1;("tab"===r||"mixed"===r&&(t&&"list"===t.type&&t.spread||e.spread))&&(l=4*Math.ceil(l/4));const o=n.createTracker(s);o.move(a+" ".repeat(l-a.length)),o.shift(l);const i=n.enter("listItem"),c=n.indentLines(n.containerFlow(e,o.current()),function(e,t,n){if(t)return(n?"":" ".repeat(l))+e;return(n?a:a+" ".repeat(l-a.length))+e});return i(),c},paragraph:function(e,t,n,s){const r=n.enter("paragraph"),a=n.enter("phrasing"),l=n.containerPhrasing(e,s);return a(),r(),l},root:function(e,t,n,s){return(e.children.some(function(e){return _i(e)})?n.containerPhrasing:n.containerFlow).call(n,e,s)},strong:Ci,text:function(e,t,n,s){return n.safe(e.value,s)},thematicBreak:function(e,t,n){const s=(Si(n)+(n.options.ruleSpaces?" ":"")).repeat(function(e){const t=e.options.ruleRepetition||3;if(t<3)throw new Error("Cannot serialize rules with repetition `"+t+"` for `options.ruleRepetition`, expected `3` or more");return t}(n));return n.options.ruleSpaces?s.slice(0,-1):s}};function Ti(e){const t=e._align;this.enter({type:"table",align:t.map(function(e){return"none"===e?null:e}),children:[]},e),this.data.inTable=!0}function Pi(e){this.exit(e),this.data.inTable=void 0}function Li(e){this.enter({type:"tableRow",children:[]},e)}function Ei(e){this.exit(e)}function Di(e){this.enter({type:"tableCell",children:[]},e)}function Ai(e){let t=this.resume();this.data.inTable&&(t=t.replace(/\\([\\|])/g,$i));const n=this.stack[this.stack.length-1];n.type,n.value=t,this.exit(e)}function $i(e,t){return"|"===t?t:e}function zi(e){const t=e||{},n=t.tableCellPadding,s=t.tablePipeAlign,r=t.stringLength,a=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:"\n",inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[\t :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:function(e,t,n){let s=Ii.inlineCode(e,t,n);n.stack.includes("tableCell")&&(s=s.replace(/\|/g,"\\$&"));return s},table:function(e,t,n,s){return o(function(e,t,n){const s=e.children;let r=-1;const a=[],l=t.enter("table");for(;++r<s.length;)a[r]=i(s[r],t,n);return l(),a}(e,n,s),e.align)},tableCell:l,tableRow:function(e,t,n,s){const r=i(e,n,s),a=o([r]);return a.slice(0,a.indexOf("\n"))}}};function l(e,t,n,s){const r=n.enter("tableCell"),l=n.enter("phrasing"),o=n.containerPhrasing(e,{...s,before:a,after:a});return l(),r(),o}function o(e,t){return function(e,t){const n=t||{},s=(n.align||[]).concat(),r=n.stringLength||ai,a=[],l=[],o=[],i=[];let c=0,d=-1;for(;++d<e.length;){const t=[],s=[];let a=-1;for(e[d].length>c&&(c=e[d].length);++a<e[d].length;){const l=li(e[d][a]);if(!1!==n.alignDelimiters){const e=r(l);s[a]=e,(void 0===i[a]||e>i[a])&&(i[a]=e)}t.push(l)}l[d]=t,o[d]=s}let u=-1;if("object"===typeof s&&"length"in s)for(;++u<c;)a[u]=oi(s[u]);else{const e=oi(s);for(;++u<c;)a[u]=e}u=-1;const m=[],x=[];for(;++u<c;){const e=a[u];let t="",s="";99===e?(t=":",s=":"):108===e?t=":":114===e&&(s=":");let r=!1===n.alignDelimiters?1:Math.max(1,i[u]-t.length-s.length);const l=t+"-".repeat(r)+s;!1!==n.alignDelimiters&&(r=t.length+r+s.length,r>i[u]&&(i[u]=r),x[u]=r),m[u]=l}l.splice(1,0,m),o.splice(1,0,x),d=-1;const g=[];for(;++d<l.length;){const e=l[d],t=o[d];u=-1;const s=[];for(;++u<c;){const r=e[u]||"";let l="",o="";if(!1!==n.alignDelimiters){const e=i[u]-(t[u]||0),n=a[u];114===n?l=" ".repeat(e):99===n?e%2?(l=" ".repeat(e/2+.5),o=" ".repeat(e/2-.5)):(l=" ".repeat(e/2),o=l):o=" ".repeat(e)}!1===n.delimiterStart||u||s.push("|"),!1===n.padding||!1===n.alignDelimiters&&""===r||!1===n.delimiterStart&&!u||s.push(" "),!1!==n.alignDelimiters&&s.push(l),s.push(r),!1!==n.alignDelimiters&&s.push(o),!1!==n.padding&&s.push(" "),!1===n.delimiterEnd&&u===c-1||s.push("|")}g.push(!1===n.delimiterEnd?s.join("").replace(/ +$/,""):s.join(""))}return g.join("\n")}(e,{align:t,alignDelimiters:s,padding:n,stringLength:r})}function i(e,t,n){const s=e.children;let r=-1;const a=[],o=t.enter("tableRow");for(;++r<s.length;)a[r]=l(s[r],0,t,n);return o(),a}}function Oi(e){const t=this.stack[this.stack.length-2];t.type,t.checked="taskListCheckValueChecked"===e.type}function Ri(e){const t=this.stack[this.stack.length-2];if(t&&"listItem"===t.type&&"boolean"===typeof t.checked){const e=this.stack[this.stack.length-1];e.type;const n=e.children[0];if(n&&"text"===n.type){const s=t.children;let r,a=-1;for(;++a<s.length;){const e=s[a];if("paragraph"===e.type){r=e;break}}r===e&&(n.value=n.value.slice(1),0===n.value.length?e.children.shift():e.position&&n.position&&"number"===typeof n.position.start.offset&&(n.position.start.column++,n.position.start.offset++,e.position.start=Object.assign({},n.position.start)))}}this.exit(e)}function Mi(e,t,n,s){const r=e.children[0],a="boolean"===typeof e.checked&&r&&"paragraph"===r.type,l="["+(e.checked?"x":" ")+"] ",o=n.createTracker(s);a&&o.move(l);let i=Ii.listItem(e,t,n,{...s,...o.current()});return a&&(i=i.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,function(e){return e+l})),i}const Fi={tokenize:function(e,t,n){let s=0;return function t(a){if((87===a||119===a)&&s<3)return s++,e.consume(a),t;if(46===a&&3===s)return e.consume(a),r;return n(a)};function r(e){return null===e?n(e):t(e)}},partial:!0},Ui={tokenize:function(e,t,n){let s,r,a;return l;function l(t){return 46===t||95===t?e.check(Ji,i,o)(t):null===t||Tr(t)||Er(t)||45!==t&&Lr(t)?i(t):(a=!0,e.consume(t),l)}function o(t){return 95===t?s=!0:(r=s,s=void 0),e.consume(t),l}function i(e){return r||s||!a?n(e):t(e)}},partial:!0},Bi={tokenize:function(e,t){let n=0,s=0;return r;function r(l){return 40===l?(n++,e.consume(l),r):41===l&&s<n?a(l):33===l||34===l||38===l||39===l||41===l||42===l||44===l||46===l||58===l||59===l||60===l||63===l||93===l||95===l||126===l?e.check(Ji,t,a)(l):null===l||Tr(l)||Er(l)?t(l):(e.consume(l),r)}function a(t){return 41===t&&s++,e.consume(t),r}},partial:!0},Ji={tokenize:function(e,t,n){return s;function s(l){return 33===l||34===l||39===l||41===l||42===l||44===l||46===l||58===l||59===l||63===l||95===l||126===l?(e.consume(l),s):38===l?(e.consume(l),a):93===l?(e.consume(l),r):60===l||null===l||Tr(l)||Er(l)?t(l):n(l)}function r(e){return null===e||40===e||91===e||Tr(e)||Er(e)?t(e):s(e)}function a(e){return jr(e)?l(e):n(e)}function l(t){return 59===t?(e.consume(t),s):jr(t)?(e.consume(t),l):n(t)}},partial:!0},qi={tokenize:function(e,t,n){return function(t){return e.consume(t),s};function s(e){return Nr(e)?n(e):t(e)}},partial:!0},Vi={name:"wwwAutolink",tokenize:function(e,t,n){const s=this;return function(t){if(87!==t&&119!==t||!Yi.call(s,s.previous)||ec(s.events))return n(t);return e.enter("literalAutolink"),e.enter("literalAutolinkWww"),e.check(Fi,e.attempt(Ui,e.attempt(Bi,r),n),n)(t)};function r(n){return e.exit("literalAutolinkWww"),e.exit("literalAutolink"),t(n)}},previous:Yi},Hi={name:"protocolAutolink",tokenize:function(e,t,n){const s=this;let r="",a=!1;return function(t){if((72===t||104===t)&&Gi.call(s,s.previous)&&!ec(s.events))return e.enter("literalAutolink"),e.enter("literalAutolinkHttp"),r+=String.fromCodePoint(t),e.consume(t),l;return n(t)};function l(t){if(jr(t)&&r.length<5)return r+=String.fromCodePoint(t),e.consume(t),l;if(58===t){const n=r.toLowerCase();if("http"===n||"https"===n)return e.consume(t),o}return n(t)}function o(t){return 47===t?(e.consume(t),a?i:(a=!0,o)):n(t)}function i(t){return null===t||kr(t)||Tr(t)||Er(t)||Lr(t)?n(t):e.attempt(Ui,e.attempt(Bi,c),n)(t)}function c(n){return e.exit("literalAutolinkHttp"),e.exit("literalAutolink"),t(n)}},previous:Gi},Wi={name:"emailAutolink",tokenize:function(e,t,n){const s=this;let r,a;return function(t){if(!Xi(t)||!Zi.call(s,s.previous)||ec(s.events))return n(t);return e.enter("literalAutolink"),e.enter("literalAutolinkEmail"),l(t)};function l(t){return Xi(t)?(e.consume(t),l):64===t?(e.consume(t),o):n(t)}function o(t){return 46===t?e.check(qi,c,i)(t):45===t||95===t||Nr(t)?(a=!0,e.consume(t),o):c(t)}function i(t){return e.consume(t),r=!0,o}function c(l){return a&&r&&jr(s.previous)?(e.exit("literalAutolinkEmail"),e.exit("literalAutolink"),t(l)):n(l)}},previous:Zi},Qi={};let Ki=48;for(;Ki<123;)Qi[Ki]=Wi,Ki++,58===Ki?Ki=65:91===Ki&&(Ki=97);function Yi(e){return null===e||40===e||42===e||95===e||91===e||93===e||126===e||Tr(e)}function Gi(e){return!jr(e)}function Zi(e){return!(47===e||Xi(e))}function Xi(e){return 43===e||45===e||46===e||95===e||Nr(e)}function ec(e){let t=e.length,n=!1;for(;t--;){const s=e[t][1];if(("labelLink"===s.type||"labelImage"===s.type)&&!s._balanced){n=!0;break}if(s._gfmAutolinkLiteralWalkedInto){n=!1;break}}return e.length>0&&!n&&(e[e.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}Qi[43]=Wi,Qi[45]=Wi,Qi[46]=Wi,Qi[95]=Wi,Qi[72]=[Wi,Hi],Qi[104]=[Wi,Hi],Qi[87]=[Wi,Vi],Qi[119]=[Wi,Vi];const tc={tokenize:function(e,t,n){const s=this;return Ar(e,function(e){const r=s.events[s.events.length-1];return r&&"gfmFootnoteDefinitionIndent"===r[1].type&&4===r[2].sliceSerialize(r[1],!0).length?t(e):n(e)},"gfmFootnoteDefinitionIndent",5)},partial:!0};function nc(e,t,n){const s=this;let r=s.events.length;const a=s.parser.gfmFootnotes||(s.parser.gfmFootnotes=[]);let l;for(;r--;){const e=s.events[r][1];if("labelImage"===e.type){l=e;break}if("gfmFootnoteCall"===e.type||"labelLink"===e.type||"label"===e.type||"image"===e.type||"link"===e.type)break}return function(r){if(!l||!l._balanced)return n(r);const o=sa(s.sliceSerialize({start:l.end,end:s.now()}));if(94!==o.codePointAt(0)||!a.includes(o.slice(1)))return n(r);return e.enter("gfmFootnoteCallLabelMarker"),e.consume(r),e.exit("gfmFootnoteCallLabelMarker"),t(r)}}function sc(e,t){let n,s=e.length;for(;s--;)if("labelImage"===e[s][1].type&&"enter"===e[s][0]){n=e[s][1];break}e[s+1][1].type="data",e[s+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},e[s+3][1].start),end:Object.assign({},e[e.length-1][1].end)},a={type:"gfmFootnoteCallMarker",start:Object.assign({},e[s+3][1].end),end:Object.assign({},e[s+3][1].end)};a.end.column++,a.end.offset++,a.end._bufferIndex++;const l={type:"gfmFootnoteCallString",start:Object.assign({},a.end),end:Object.assign({},e[e.length-1][1].start)},o={type:"chunkString",contentType:"string",start:Object.assign({},l.start),end:Object.assign({},l.end)},i=[e[s+1],e[s+2],["enter",r,t],e[s+3],e[s+4],["enter",a,t],["exit",a,t],["enter",l,t],["enter",o,t],["exit",o,t],["exit",l,t],e[e.length-2],e[e.length-1],["exit",r,t]];return e.splice(s,e.length-s+1,...i),e}function rc(e,t,n){const s=this,r=s.parser.gfmFootnotes||(s.parser.gfmFootnotes=[]);let a,l=0;return function(t){return e.enter("gfmFootnoteCall"),e.enter("gfmFootnoteCallLabelMarker"),e.consume(t),e.exit("gfmFootnoteCallLabelMarker"),o};function o(t){return 94!==t?n(t):(e.enter("gfmFootnoteCallMarker"),e.consume(t),e.exit("gfmFootnoteCallMarker"),e.enter("gfmFootnoteCallString"),e.enter("chunkString").contentType="string",i)}function i(o){if(l>999||93===o&&!a||null===o||91===o||Tr(o))return n(o);if(93===o){e.exit("chunkString");const a=e.exit("gfmFootnoteCallString");return r.includes(sa(s.sliceSerialize(a)))?(e.enter("gfmFootnoteCallLabelMarker"),e.consume(o),e.exit("gfmFootnoteCallLabelMarker"),e.exit("gfmFootnoteCall"),t):n(o)}return Tr(o)||(a=!0),l++,e.consume(o),92===o?c:i}function c(t){return 91===t||92===t||93===t?(e.consume(t),l++,i):i(t)}}function ac(e,t,n){const s=this,r=s.parser.gfmFootnotes||(s.parser.gfmFootnotes=[]);let a,l,o=0;return function(t){return e.enter("gfmFootnoteDefinition")._container=!0,e.enter("gfmFootnoteDefinitionLabel"),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(t),e.exit("gfmFootnoteDefinitionLabelMarker"),i};function i(t){return 94===t?(e.enter("gfmFootnoteDefinitionMarker"),e.consume(t),e.exit("gfmFootnoteDefinitionMarker"),e.enter("gfmFootnoteDefinitionLabelString"),e.enter("chunkString").contentType="string",c):n(t)}function c(t){if(o>999||93===t&&!l||null===t||91===t||Tr(t))return n(t);if(93===t){e.exit("chunkString");const n=e.exit("gfmFootnoteDefinitionLabelString");return a=sa(s.sliceSerialize(n)),e.enter("gfmFootnoteDefinitionLabelMarker"),e.consume(t),e.exit("gfmFootnoteDefinitionLabelMarker"),e.exit("gfmFootnoteDefinitionLabel"),u}return Tr(t)||(l=!0),o++,e.consume(t),92===t?d:c}function d(t){return 91===t||92===t||93===t?(e.consume(t),o++,c):c(t)}function u(t){return 58===t?(e.enter("definitionMarker"),e.consume(t),e.exit("definitionMarker"),r.includes(a)||r.push(a),Ar(e,m,"gfmFootnoteDefinitionWhitespace")):n(t)}function m(e){return t(e)}}function lc(e,t,n){return e.check(Rr,t,e.attempt(tc,t,n))}function oc(e){e.exit("gfmFootnoteDefinition")}function ic(e){let t=(e||{}).singleTilde;const n={name:"strikethrough",tokenize:function(e,n,s){const r=this.previous,a=this.events;let l=0;return function(t){if(126===r&&"characterEscape"!==a[a.length-1][1].type)return s(t);return e.enter("strikethroughSequenceTemporary"),o(t)};function o(a){const i=Ia(r);if(126===a)return l>1?s(a):(e.consume(a),l++,o);if(l<2&&!t)return s(a);const c=e.exit("strikethroughSequenceTemporary"),d=Ia(a);return c._open=!d||2===d&&Boolean(i),c._close=!i||2===i&&Boolean(d),n(a)}},resolveAll:function(e,t){let n=-1;for(;++n<e.length;)if("enter"===e[n][0]&&"strikethroughSequenceTemporary"===e[n][1].type&&e[n][1]._close){let s=n;for(;s--;)if("exit"===e[s][0]&&"strikethroughSequenceTemporary"===e[s][1].type&&e[s][1]._open&&e[n][1].end.offset-e[n][1].start.offset===e[s][1].end.offset-e[s][1].start.offset){e[n][1].type="strikethroughSequence",e[s][1].type="strikethroughSequence";const r={type:"strikethrough",start:Object.assign({},e[s][1].start),end:Object.assign({},e[n][1].end)},a={type:"strikethroughText",start:Object.assign({},e[s][1].end),end:Object.assign({},e[n][1].start)},l=[["enter",r,t],["enter",e[s][1],t],["exit",e[s][1],t],["enter",a,t]],o=t.parser.constructs.insideSpan.null;o&&ur(l,l.length,0,Na(o,e.slice(s+1,n),t)),ur(l,l.length,0,[["exit",a,t],["enter",e[n][1],t],["exit",e[n][1],t],["exit",r,t]]),ur(e,s-1,n-s+3,l),n=s+l.length-2;break}}n=-1;for(;++n<e.length;)"strikethroughSequenceTemporary"===e[n][1].type&&(e[n][1].type="data");return e}};return null!==t&&void 0!==t||(t=!0),{text:{126:n},insideSpan:{null:[n]},attentionMarkers:{null:[126]}}}class cc{constructor(){this.map=[]}add(e,t,n){!function(e,t,n,s){let r=0;if(0===n&&0===s.length)return;for(;r<e.map.length;){if(e.map[r][0]===t)return e.map[r][1]+=n,void e.map[r][2].push(...s);r+=1}e.map.push([t,n,s])}(this,e,t,n)}consume(e){if(this.map.sort(function(e,t){return e[0]-t[0]}),0===this.map.length)return;let t=this.map.length;const n=[];for(;t>0;)t-=1,n.push(e.slice(this.map[t][0]+this.map[t][1]),this.map[t][2]),e.length=this.map[t][0];n.push(e.slice()),e.length=0;let s=n.pop();for(;s;){for(const t of s)e.push(t);s=n.pop()}this.map.length=0}}function dc(e,t){let n=!1;const s=[];for(;t<e.length;){const r=e[t];if(n){if("enter"===r[0])"tableContent"===r[1].type&&s.push("tableDelimiterMarker"===e[t+1][1].type?"left":"none");else if("tableContent"===r[1].type){if("tableDelimiterMarker"===e[t-1][1].type){const e=s.length-1;s[e]="left"===s[e]?"center":"right"}}else if("tableDelimiterRow"===r[1].type)break}else"enter"===r[0]&&"tableDelimiterRow"===r[1].type&&(n=!0);t+=1}return s}function uc(e,t,n){const s=this;let r,a=0,l=0;return function(e){let t=s.events.length-1;for(;t>-1;){const e=s.events[t][1].type;if("lineEnding"!==e&&"linePrefix"!==e)break;t--}const r=t>-1?s.events[t][1].type:null,a="tableHead"===r||"tableRow"===r?v:o;if(a===v&&s.parser.lazy[s.now().line])return n(e);return a(e)};function o(t){return e.enter("tableHead"),e.enter("tableRow"),function(e){if(124===e)return i(e);return r=!0,l+=1,i(e)}(t)}function i(t){return null===t?n(t):Ir(t)?l>1?(l=0,s.interrupt=!0,e.exit("tableRow"),e.enter("lineEnding"),e.consume(t),e.exit("lineEnding"),u):n(t):Pr(t)?Ar(e,i,"whitespace")(t):(l+=1,r&&(r=!1,a+=1),124===t?(e.enter("tableCellDivider"),e.consume(t),e.exit("tableCellDivider"),r=!0,i):(e.enter("data"),c(t)))}function c(t){return null===t||124===t||Tr(t)?(e.exit("data"),i(t)):(e.consume(t),92===t?d:c)}function d(t){return 92===t||124===t?(e.consume(t),c):c(t)}function u(t){return s.interrupt=!1,s.parser.lazy[s.now().line]?n(t):(e.enter("tableDelimiterRow"),r=!1,Pr(t)?Ar(e,m,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):m(t))}function m(t){return 45===t||58===t?g(t):124===t?(r=!0,e.enter("tableCellDivider"),e.consume(t),e.exit("tableCellDivider"),x):y(t)}function x(t){return Pr(t)?Ar(e,g,"whitespace")(t):g(t)}function g(t){return 58===t?(l+=1,r=!0,e.enter("tableDelimiterMarker"),e.consume(t),e.exit("tableDelimiterMarker"),h):45===t?(l+=1,h(t)):null===t||Ir(t)?b(t):y(t)}function h(t){return 45===t?(e.enter("tableDelimiterFiller"),p(t)):y(t)}function p(t){return 45===t?(e.consume(t),p):58===t?(r=!0,e.exit("tableDelimiterFiller"),e.enter("tableDelimiterMarker"),e.consume(t),e.exit("tableDelimiterMarker"),f):(e.exit("tableDelimiterFiller"),f(t))}function f(t){return Pr(t)?Ar(e,b,"whitespace")(t):b(t)}function b(n){return 124===n?m(n):(null===n||Ir(n))&&r&&a===l?(e.exit("tableDelimiterRow"),e.exit("tableHead"),t(n)):y(n)}function y(e){return n(e)}function v(t){return e.enter("tableRow"),j(t)}function j(n){return 124===n?(e.enter("tableCellDivider"),e.consume(n),e.exit("tableCellDivider"),j):null===n||Ir(n)?(e.exit("tableRow"),t(n)):Pr(n)?Ar(e,j,"whitespace")(n):(e.enter("data"),N(n))}function N(t){return null===t||124===t||Tr(t)?(e.exit("data"),j(t)):(e.consume(t),92===t?w:N)}function w(t){return 92===t||124===t?(e.consume(t),N):N(t)}}function mc(e,t){let n,s,r,a=-1,l=!0,o=0,i=[0,0,0,0],c=[0,0,0,0],d=!1,u=0;const m=new cc;for(;++a<e.length;){const x=e[a],g=x[1];"enter"===x[0]?"tableHead"===g.type?(d=!1,0!==u&&(gc(m,t,u,n,s),s=void 0,u=0),n={type:"table",start:Object.assign({},g.start),end:Object.assign({},g.end)},m.add(a,0,[["enter",n,t]])):"tableRow"===g.type||"tableDelimiterRow"===g.type?(l=!0,r=void 0,i=[0,0,0,0],c=[0,a+1,0,0],d&&(d=!1,s={type:"tableBody",start:Object.assign({},g.start),end:Object.assign({},g.end)},m.add(a,0,[["enter",s,t]])),o="tableDelimiterRow"===g.type?2:s?3:1):!o||"data"!==g.type&&"tableDelimiterMarker"!==g.type&&"tableDelimiterFiller"!==g.type?"tableCellDivider"===g.type&&(l?l=!1:(0!==i[1]&&(c[0]=c[1],r=xc(m,t,i,o,void 0,r)),i=c,c=[i[1],a,0,0])):(l=!1,0===c[2]&&(0!==i[1]&&(c[0]=c[1],r=xc(m,t,i,o,void 0,r),i=[0,0,0,0]),c[2]=a)):"tableHead"===g.type?(d=!0,u=a):"tableRow"===g.type||"tableDelimiterRow"===g.type?(u=a,0!==i[1]?(c[0]=c[1],r=xc(m,t,i,o,a,r)):0!==c[1]&&(r=xc(m,t,c,o,a,r)),o=0):!o||"data"!==g.type&&"tableDelimiterMarker"!==g.type&&"tableDelimiterFiller"!==g.type||(c[3]=a)}for(0!==u&&gc(m,t,u,n,s),m.consume(t.events),a=-1;++a<t.events.length;){const e=t.events[a];"enter"===e[0]&&"table"===e[1].type&&(e[1]._align=dc(t.events,a))}return e}function xc(e,t,n,s,r,a){const l=1===s?"tableHeader":2===s?"tableDelimiter":"tableData";0!==n[0]&&(a.end=Object.assign({},hc(t.events,n[0])),e.add(n[0],0,[["exit",a,t]]));const o=hc(t.events,n[1]);if(a={type:l,start:Object.assign({},o),end:Object.assign({},o)},e.add(n[1],0,[["enter",a,t]]),0!==n[2]){const r=hc(t.events,n[2]),a=hc(t.events,n[3]),l={type:"tableContent",start:Object.assign({},r),end:Object.assign({},a)};if(e.add(n[2],0,[["enter",l,t]]),2!==s){const s=t.events[n[2]],r=t.events[n[3]];if(s[1].end=Object.assign({},r[1].end),s[1].type="chunkText",s[1].contentType="text",n[3]>n[2]+1){const t=n[2]+1,s=n[3]-n[2]-1;e.add(t,s,[])}}e.add(n[3]+1,0,[["exit",l,t]])}return void 0!==r&&(a.end=Object.assign({},hc(t.events,r)),e.add(r,0,[["exit",a,t]]),a=void 0),a}function gc(e,t,n,s,r){const a=[],l=hc(t.events,n);r&&(r.end=Object.assign({},l),a.push(["exit",r,t])),s.end=Object.assign({},l),a.push(["exit",s,t]),e.add(n+1,0,a)}function hc(e,t){const n=e[t],s="enter"===n[0]?"start":"end";return n[1][s]}const pc={name:"tasklistCheck",tokenize:function(e,t,n){const s=this;return function(t){if(null!==s.previous||!s._gfmTasklistFirstContentOfListItem)return n(t);return e.enter("taskListCheck"),e.enter("taskListCheckMarker"),e.consume(t),e.exit("taskListCheckMarker"),r};function r(t){return Tr(t)?(e.enter("taskListCheckValueUnchecked"),e.consume(t),e.exit("taskListCheckValueUnchecked"),a):88===t||120===t?(e.enter("taskListCheckValueChecked"),e.consume(t),e.exit("taskListCheckValueChecked"),a):n(t)}function a(t){return 93===t?(e.enter("taskListCheckMarker"),e.consume(t),e.exit("taskListCheckMarker"),e.exit("taskListCheck"),l):n(t)}function l(s){return Ir(s)?t(s):Pr(s)?e.check({tokenize:fc},t,n)(s):n(s)}}};function fc(e,t,n){return Ar(e,function(e){return null===e?n(e):t(e)},"whitespace")}const bc={};function yc(e){const t=e||bc,n=this.data(),s=n.micromarkExtensions||(n.micromarkExtensions=[]),r=n.fromMarkdownExtensions||(n.fromMarkdownExtensions=[]),a=n.toMarkdownExtensions||(n.toMarkdownExtensions=[]);s.push(function(e){return br([{text:Qi},{document:{91:{name:"gfmFootnoteDefinition",tokenize:ac,continuation:{tokenize:lc},exit:oc}},text:{91:{name:"gfmFootnoteCall",tokenize:rc},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:nc,resolveTo:sc}}},ic(e),{flow:{null:{name:"table",tokenize:uc,resolveAll:mc}}},{text:{91:pc}}])}(t)),r.push([{transforms:[Mo],enter:{literalAutolink:Do,literalAutolinkEmail:Ao,literalAutolinkHttp:Ao,literalAutolinkWww:Ao},exit:{literalAutolink:Ro,literalAutolinkEmail:Oo,literalAutolinkHttp:$o,literalAutolinkWww:zo}},{enter:{gfmFootnoteCallString:Jo,gfmFootnoteCall:qo,gfmFootnoteDefinitionLabelString:Vo,gfmFootnoteDefinition:Ho},exit:{gfmFootnoteCallString:Wo,gfmFootnoteCall:Qo,gfmFootnoteDefinitionLabelString:Ko,gfmFootnoteDefinition:Yo}},{canContainEols:["delete"],enter:{strikethrough:ni},exit:{strikethrough:si}},{enter:{table:Ti,tableData:Di,tableHeader:Di,tableRow:Li},exit:{codeText:Ai,table:Pi,tableData:Ei,tableHeader:Ei,tableRow:Ei}},{exit:{taskListCheckValueChecked:Oi,taskListCheckValueUnchecked:Oi,paragraph:Ri}}]),a.push(function(e){return{extensions:[{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:Lo,notInConstruct:Eo},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:Lo,notInConstruct:Eo},{character:":",before:"[ps]",after:"\\/",inConstruct:Lo,notInConstruct:Eo}]},Zo(e),{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:ti}],handlers:{delete:ri}},zi(e),{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:Mi}}]}}(t))}const vc=e=>{let{content:t,showToc:n=!0}=e;const[s,a]=(0,r.useState)([]),[l,o]=(0,r.useState)("");(0,r.useEffect)(()=>{if(!n||0===s.length)return;const e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&o(e.target.id)})},{rootMargin:"-20% 0px -70% 0px",threshold:0});return s.forEach(t=>{const n=document.getElementById(t.id);n&&e.observe(n)}),()=>e.disconnect()},[s,n]),(0,r.useEffect)(()=>{if(t){const e=(e=>{const t=/^(#{1,6})\s+(.+?)(?:\s*\{#([^}]+)\})?\s*$/gm,n=[];let s;for(;null!==(s=t.exec(e));){const e=s[1].length,t=s[2].trim(),r=s[3],a=r||i(t);n.push({level:e,text:t,id:a,customId:!!r})}return n})(t);a(e)}},[t]);const i=e=>{if(!e)return"";const t=e.toString(),n=t.match(/\{#([^}]+)\}$/);if(n)return n[1];const s={"\u7b2c1\u7ae0":"chapter-1","\u7b2c2\u7ae0":"chapter-2","\u7b2c3\u7ae0":"chapter-3","\u7b2c4\u7ae0":"chapter-4","\u7b2c5\u7ae0":"chapter-5","\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u306e\u57fa\u672c\u69cb\u9020\u3068\u5f79\u5272":"computer-basics","Windows 11\u306e\u57fa\u672c\u64cd\u4f5c":"windows-11-basics","\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u57fa\u672c\u64cd\u4f5c":"software-basics","\u5916\u4ed8\u3051\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u30c7\u30d0\u30a4\u30b9\u306e\u4f7f\u7528\u65b9\u6cd5":"external-devices","Q&A\u30bb\u30c3\u30b7\u30e7\u30f3":"qa-session","\u306f\u3058\u3081\u306b":"introduction","\u307e\u3068\u3081":"summary","\u7dcf\u8ad6":"conclusion"};for(const[r,a]of Object.entries(s))if(t.includes(r))return a;return t.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"").replace(/[^\w-]/g,"")||"section-"+Math.random().toString(36).substr(2,9)},c=e=>{const t=document.getElementById(e);t&&t.scrollIntoView({behavior:"smooth",block:"start"})},d=()=>n&&0!==s.length?(0,pt.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6",children:[(0,pt.jsxs)("h3",{className:"text-lg font-semibold text-gray-800 mb-3 flex items-center",children:[(0,pt.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),"\u76ee\u6b21"]}),(0,pt.jsx)("nav",{className:"space-y-1",children:s.map((e,t)=>(0,pt.jsx)("button",{onClick:()=>c(e.id),className:"block w-full text-left px-3 py-2 rounded-md text-sm transition-colors duration-200 "+(l===e.id?"bg-blue-100 text-blue-800 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-800"),style:{paddingLeft:16*(e.level-1)+12+"px"},children:e.text},t))})]}):null;return(0,pt.jsxs)("div",{className:"markdown-content",children:[(0,pt.jsx)(d,{}),(0,pt.jsx)(go,{remarkPlugins:[yc],components:{h1:e=>{let{children:t,...n}=e;const s=i(t),r=Array.isArray(t)?t.map(e=>"string"===typeof e?e.replace(/\s*\{#[^}]+\}\s*$/,""):e):"string"===typeof t?t.replace(/\s*\{#[^}]+\}\s*$/,""):t;return(0,pt.jsxs)("h1",{id:s,className:"text-3xl font-bold text-gray-800 mt-8 mb-4 pb-2 border-b-2 border-blue-200 scroll-mt-20 group relative",...n,children:[r,(0,pt.jsx)("button",{onClick:()=>c(s),className:"opacity-0 group-hover:opacity-100 ml-2 text-blue-500 hover:text-blue-700 transition-opacity duration-200",title:"\u3053\u306e\u898b\u51fa\u3057\u3078\u306e\u30ea\u30f3\u30af\u3092\u30b3\u30d4\u30fc",children:(0,pt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})})]})},h2:e=>{let{children:t,...n}=e;const s=i(t),r=Array.isArray(t)?t.map(e=>"string"===typeof e?e.replace(/\s*\{#[^}]+\}\s*$/,""):e):"string"===typeof t?t.replace(/\s*\{#[^}]+\}\s*$/,""):t;return(0,pt.jsxs)("h2",{id:s,className:"text-2xl font-bold text-gray-700 mt-6 mb-3 pb-1 border-b border-blue-100 scroll-mt-16 group relative",...n,children:[r,(0,pt.jsx)("button",{onClick:()=>c(s),className:"opacity-0 group-hover:opacity-100 ml-2 text-blue-500 hover:text-blue-700 transition-opacity duration-200",title:"\u3053\u306e\u898b\u51fa\u3057\u3078\u306e\u30ea\u30f3\u30af\u3092\u30b3\u30d4\u30fc",children:(0,pt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})})]})},h3:e=>{let{children:t,...n}=e;const s=i(t),r=Array.isArray(t)?t.map(e=>"string"===typeof e?e.replace(/\s*\{#[^}]+\}\s*$/,""):e):"string"===typeof t?t.replace(/\s*\{#[^}]+\}\s*$/,""):t;return(0,pt.jsxs)("h3",{id:s,className:"text-xl font-semibold text-gray-700 mt-4 mb-2 scroll-mt-12 group relative",...n,children:[r,(0,pt.jsx)("button",{onClick:()=>c(s),className:"opacity-0 group-hover:opacity-100 ml-2 text-blue-500 hover:text-blue-700 transition-opacity duration-200",title:"\u3053\u306e\u898b\u51fa\u3057\u3078\u306e\u30ea\u30f3\u30af\u3092\u30b3\u30d4\u30fc",children:(0,pt.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,pt.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})})})]})},p:e=>{let{children:t,...n}=e;return(0,pt.jsx)("p",{className:"text-gray-700 leading-relaxed mb-4",...n,children:t})},ul:e=>{let{children:t,...n}=e;return(0,pt.jsx)("ul",{className:"list-disc list-inside text-gray-700 mb-4 space-y-1",...n,children:t})},ol:e=>{let{children:t,...n}=e;return(0,pt.jsx)("ol",{className:"list-decimal list-inside text-gray-700 mb-4 space-y-1",...n,children:t})},li:e=>{let{children:t,...n}=e;return(0,pt.jsx)("li",{className:"ml-4",...n,children:t})},blockquote:e=>{let{children:t,...n}=e;return(0,pt.jsx)("blockquote",{className:"border-l-4 border-blue-500 pl-4 py-2 bg-blue-50 text-gray-700 italic mb-4",...n,children:t})},code:e=>{let{children:t,className:n,...s}=e;return n&&n.startsWith("language-")?(0,pt.jsx)("pre",{className:"bg-gray-100 p-4 rounded-lg overflow-x-auto mb-4",children:(0,pt.jsx)("code",{className:`${n} text-sm`,...s,children:t})}):(0,pt.jsx)("code",{className:"bg-gray-200 px-2 py-1 rounded text-sm font-mono",...s,children:t})},table:e=>{let{children:t,...n}=e;return(0,pt.jsx)("div",{className:"overflow-x-auto mb-4",children:(0,pt.jsx)("table",{className:"min-w-full border border-gray-300",...n,children:t})})},th:e=>{let{children:t,...n}=e;return(0,pt.jsx)("th",{className:"border border-gray-300 px-4 py-2 bg-gray-100 font-semibold text-left",...n,children:t})},td:e=>{let{children:t,...n}=e;return(0,pt.jsx)("td",{className:"border border-gray-300 px-4 py-2",...n,children:t})},a:e=>{let{children:t,href:n,...s}=e;const r=n&&n.startsWith("#");return(0,pt.jsx)("a",{href:n,className:"text-blue-600 hover:text-blue-800 underline",target:r?void 0:"_blank",rel:r?void 0:"noopener noreferrer",onClick:r?e=>{e.preventDefault();const t=n.substring(1),s=document.getElementById(t);s&&s.scrollIntoView({behavior:"smooth",block:"start"})}:void 0,...s,children:t})},img:e=>{let{src:t,alt:n,...s}=e;return(0,pt.jsx)("img",{src:t,alt:n,className:"max-w-full h-auto rounded-lg shadow-md my-4",...s})}},children:t})]})},jc={_safeExecute:(e,t)=>{try{return e()}catch(n){return console.error("SessionStorageManager \u30a8\u30e9\u30fc:",n),t}},generateKey:(e,t)=>{try{if(!t)return`pdf_context_${e}_unknown`;return`pdf_context_${e}_${e}_${t.split("/").pop()}`}catch(n){console.error("\u30ad\u30fc\u751f\u6210\u30a8\u30e9\u30fc:",n);return`pdf_context_${e}_${Date.now()}`}},saveContext:function(e,t,n){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const r=jc.generateKey(e,t);console.log("SessionStorageManager.saveContext - \u30ad\u30fc\u751f\u6210:",{lessonId:e,s3Key:t,generatedKey:r,keyLength:r.length});const a={context:n,metadata:{...s,savedAt:(new Date).toISOString(),lessonId:e,s3Key:t,contextSize:n.length}};try{const e=JSON.stringify(a).length;return e>5242880&&(console.warn("\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u5927\u304d\u3059\u304e\u307e\u3059\uff085MB\u5236\u9650\uff09:",e),a.context=a.context.substring(0,2097152),a.metadata.truncated=!0),sessionStorage.setItem(r,JSON.stringify(a)),console.log("\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u4fdd\u5b58:",{key:r,contextLength:a.context.length,dataSize:JSON.stringify(a).length}),!0}catch(l){return console.error("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u4fdd\u5b58\u30a8\u30e9\u30fc:",l),!1}},getContext:(e,t)=>{const n=jc.generateKey(e,t);console.log("SessionStorageManager.getContext - \u30ad\u30fc\u751f\u6210:",{lessonId:e,s3Key:t,generatedKey:n});try{const e=sessionStorage.getItem(n);if(e){const t=JSON.parse(e);return console.log("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u53d6\u5f97:",{key:n,contextLength:t.context.length}),t}return null}catch(s){return console.error("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u53d6\u5f97\u30a8\u30e9\u30fc:",s),null}},hasContext:(e,t)=>{const n=jc.generateKey(e,t);return console.log("SessionStorageManager.hasContext - \u30ad\u30fc\u751f\u6210:",{lessonId:e,s3Key:t,generatedKey:n,exists:null!==sessionStorage.getItem(n)}),null!==sessionStorage.getItem(n)},clearLessonContext:e=>{Object.keys(sessionStorage).forEach(t=>{t.startsWith(`pdf_context_${e}_`)&&(sessionStorage.removeItem(t),console.log("\u30ec\u30c3\u30b9\u30f3\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u30af\u30ea\u30a2:",t))})},clearAllContexts:()=>{Object.keys(sessionStorage).forEach(e=>{e.startsWith("pdf_context_")&&sessionStorage.removeItem(e)}),console.log("\u5168\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u30af\u30ea\u30a2")},getStoredContexts:()=>{const e=[];return Object.keys(sessionStorage).forEach(t=>{if(t.startsWith("pdf_context_"))try{const n=JSON.parse(sessionStorage.getItem(t));e.push({key:t,...n.metadata,contextLength:n.context.length})}catch(n){console.error("\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u89e3\u6790\u30a8\u30e9\u30fc:",n)}}),e}},Nc=e=>{var t;let{lessonData:n,textContent:s,textLoading:a,textContainerRef:l,onTextContentUpdate:o}=e;const[i,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)(null),g=(0,r.useRef)(null),h=(0,r.useRef)(null),p=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(console.log("TextSection useEffect - \u5b9f\u884c\u958b\u59cb"),console.log("TextSection - \u53d7\u3051\u53d6\u3063\u305flessonData:",n),console.log("TextSection - lessonData.file_type:",null===n||void 0===n?void 0:n.file_type),console.log("TextSection - lessonData.s3_key:",null===n||void 0===n?void 0:n.s3_key),console.log("TextSection - pdfTextContent:",i),!n||!n.s3_key)return void console.log("\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u307e\u305f\u306fS3\u30ad\u30fc\u304c\u5b58\u5728\u3057\u307e\u305b\u3093");console.log("S3\u30ad\u30fc\u306e\u8a73\u7d30:",{s3_key:n.s3_key,keyType:typeof n.s3_key,keyLength:n.s3_key.length,isEmpty:""===n.s3_key.trim(),containsSpaces:n.s3_key.includes(" "),containsSpecialChars:/[<>:"|?*]/.test(n.s3_key)});const e=jc.hasContext(n.id,n.s3_key);if(console.log("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u72b6\u614b:",{hasStoredContext:e,lessonId:n.id,s3Key:n.s3_key}),e){const e=jc.getContext(n.id,n.s3_key);return console.log("\u4fdd\u5b58\u6e08\u307f\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u60c5\u5831:",e.metadata),o&&(console.log("\u65e2\u5b58\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u89aa\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306b\u901a\u77e5:",{contextLength:e.context.length}),o(e.context)),void(p.current=n.s3_key)}if(console.log("TextSection useEffect - \u6761\u4ef6\u30c1\u30a7\u30c3\u30af:",{fileType:null===n||void 0===n?void 0:n.file_type,s3Key:null===n||void 0===n?void 0:n.s3_key,pdfTextContent:i,textContent:s,hasS3Key:!(null===n||void 0===n||!n.s3_key),shouldExtractPdf:"pdf"===(null===n||void 0===n?void 0:n.file_type)&&(null===n||void 0===n?void 0:n.s3_key)&&!i,shouldSaveText:("txt"===(null===n||void 0===n?void 0:n.file_type)||"md"===(null===n||void 0===n?void 0:n.file_type)||"application/rtf"===(null===n||void 0===n?void 0:n.file_type))&&s}),"pdf"===(null===n||void 0===n?void 0:n.file_type)&&null!==n&&void 0!==n&&n.s3_key&&!i)console.log("PDF\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u3092\u958b\u59cb\u3057\u307e\u3059:",n.s3_key),f(n.s3_key);else if("txt"!==(null===n||void 0===n?void 0:n.file_type)&&"md"!==(null===n||void 0===n?void 0:n.file_type)&&"application/rtf"!==(null===n||void 0===n?void 0:n.file_type)||!s)console.log("\u30c6\u30ad\u30b9\u30c8\u51e6\u7406\u306e\u6761\u4ef6\u304c\u6e80\u305f\u3055\u308c\u3066\u3044\u307e\u305b\u3093");else{console.log("\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u4fdd\u5b58:",{fileType:n.file_type,textLength:s.length,s3Key:n.s3_key});jc.saveContext(n.id,n.s3_key,s,{fileType:n.file_type,lessonTitle:n.title,processingTime:0})?(console.log("\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u4fdd\u5b58\u5b8c\u4e86"),o&&o(s),p.current=n.s3_key):console.error("\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u4fdd\u5b58\u306b\u5931\u6557")}},[n,s]),(0,r.useEffect)(()=>()=>{h.current&&clearTimeout(h.current),g.current&&g.current.abort()},[]);const f=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!e)return console.error("extractPdfText: s3Key\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u305b\u3093"),void x("S3\u30ad\u30fc\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u305b\u3093");const s=jc.getContext(null===n||void 0===n?void 0:n.id,e);if(s)return console.log("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u65e2\u5b58\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u4f7f\u7528:",{contextLength:s.context.length,savedAt:s.metadata.savedAt}),c(s.context),p.current=e,void(o&&o(s.context));if(console.log("extractPdfText: \u958b\u59cb",{s3Key:e,lessonId:null===n||void 0===n?void 0:n.id,lessonTitle:null===n||void 0===n?void 0:n.title,retryCount:t}),d)console.log("\u65e2\u306bPDF\u51e6\u7406\u304c\u9032\u884c\u4e2d\u3067\u3059\u3002\u65b0\u3057\u3044\u51e6\u7406\u3092\u958b\u59cb\u3057\u307e\u305b\u3093\u3002");else{u(!0),x(null),g.current=new AbortController;try{console.log(`PDF\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u958b\u59cb (\u8a66\u884c\u56de\u6570: ${t+1})`,{s3Key:e,lessonId:null===n||void 0===n?void 0:n.id,lessonTitle:null===n||void 0===n?void 0:n.title}),h.current=setTimeout(()=>{console.warn("PDF\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u307e\u3057\u305f"),g.current&&g.current.abort();const e="PDF\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u307e\u3057\u305f\u3002\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u5927\u304d\u3059\u304e\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002";x(e),u(!1),o&&o(`\u30a8\u30e9\u30fc: ${e}`)},3e5);const s=await fetch(`${ze.JR}/api/learning/extract-pdf-text`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({s3Key:e,lessonId:null===n||void 0===n?void 0:n.id}),signal:g.current.signal});if(h.current&&(clearTimeout(h.current),h.current=null),s.ok){const t=await s.json();if(console.log("PDF\u30c6\u30ad\u30b9\u30c8\u62bd\u51faAPI\u5fdc\u7b54:",t),t.success&&t.textContent){c(t.textContent),p.current=e;jc.saveContext(null===n||void 0===n?void 0:n.id,e,t.textContent,{fileType:null===n||void 0===n?void 0:n.file_type,lessonTitle:null===n||void 0===n?void 0:n.title,processingTime:t.processingTime||0})&&console.log("\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u4fdd\u5b58\u5b8c\u4e86"),o&&o(t.textContent),console.log("PDF\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u6210\u529f:",{textLength:t.textContent.length})}else{console.warn("PDF\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u5931\u6557:",t.message);const e=`\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${t.message}`;x(e),c(e),o&&o(e)}}else{const n=`PDF\u30c6\u30ad\u30b9\u30c8\u62bd\u51faAPI\u547c\u3073\u51fa\u3057\u5931\u6557: ${s.status}`;console.error(n);try{const t=await s.json();if(console.error("\u30a8\u30e9\u30fc\u8a73\u7d30:",t),"The specified key does not exist."===t.error){const t=`PDF\u30d5\u30a1\u30a4\u30eb\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002S3\u30ad\u30fc: ${e}`;console.error(t),x(t),c(t),o&&o(t)}else{const e=`\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${t.message||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc"}`;x(e),c(e),o&&o(e)}}catch(r){console.error("\u30a8\u30e9\u30fc\u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u89e3\u6790\u306b\u5931\u6557:",r);const e=`\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u306b\u5931\u6557\u3057\u307e\u3057\u305f (HTTP ${s.status})`;x(e),c(e),o&&o(e)}if(t<2&&s.status>=500)return console.log(`${t+1}\u56de\u76ee\u306e\u30ea\u30c8\u30e9\u30a4\u3092\u5b9f\u884c\u3057\u307e\u3059...`),void setTimeout(()=>{f(e,t+1)},2e3*(t+1))}}catch(a){if(h.current&&(clearTimeout(h.current),h.current=null),"AbortError"===a.name)return console.log("PDF\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u304c\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u307e\u3057\u305f"),void x("PDF\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u304c\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u307e\u3057\u305f");if(console.error("PDF\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u30a8\u30e9\u30fc:",a),t<2&&("TypeError"===a.name||a.message.includes("Failed to fetch")))return console.log(`${t+1}\u56de\u76ee\u306e\u30ea\u30c8\u30e9\u30a4\u3092\u5b9f\u884c\u3057\u307e\u3059...`),void setTimeout(()=>{f(e,t+1)},2e3*(t+1));const n=`\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: ${a.message}`;x(n),c(n),o&&o(n)}finally{u(!1),g.current=null}}},b=()=>{var e,t;return"pdf"===(null===n||void 0===n?void 0:n.file_type)?m?`\u30a8\u30e9\u30fc: ${m}`:d?"PDF\u30d5\u30a1\u30a4\u30eb\u306e\u51e6\u7406\u4e2d...":i||"PDF\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u4e2d...":"application/rtf"===(null===n||void 0===n?void 0:n.file_type)||null!==n&&void 0!==n&&null!==(e=n.s3_key)&&void 0!==e&&e.toLowerCase().endsWith(".rtf")?((t=s)?t.replace(/\\[a-z]+\d*\s?/g,"").replace(/[{}]/g,"").replace(/\\\s/g," ").replace(/\s+/g," ").trim():"")||"\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9\u304c\u3042\u308a\u307e\u305b\u3093":s||"\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9\u304c\u3042\u308a\u307e\u305b\u3093"};return a?(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,pt.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc4"}),(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9"})]}),(0,pt.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,pt.jsx)("p",{className:"text-blue-600 font-medium",children:"\u30c6\u30ad\u30b9\u30c8\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]})})]}):(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,pt.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc4"}),(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9"}),"pdf"===(null===n||void 0===n?void 0:n.file_type)&&(0,pt.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"PDF"}),"pdf"===(null===n||void 0===n?void 0:n.file_type)&&d&&(0,pt.jsx)("button",{onClick:()=>{g.current&&(g.current.abort(),console.log("PDF\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u3092\u30ad\u30e3\u30f3\u30bb\u30eb\u3057\u307e\u3057\u305f")),h.current&&(clearTimeout(h.current),h.current=null),u(!1),x(null)},className:"px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600 transition-colors",title:"\u51e6\u7406\u3092\u30ad\u30e3\u30f3\u30bb\u30eb",children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]}),m&&(0,pt.jsxs)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("span",{className:"text-red-500",children:"\u26a0\ufe0f"}),(0,pt.jsx)("p",{className:"text-red-700 text-sm",children:m})]}),(0,pt.jsx)("button",{onClick:()=>{x(null),null!==n&&void 0!==n&&n.s3_key&&f(n.s3_key)},className:"mt-2 px-3 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600 transition-colors",children:"\u518d\u8a66\u884c"})]}),(0,pt.jsx)("div",{ref:l,className:"h-[85vh] overflow-y-auto custom-scrollbar border border-gray-200 rounded-lg p-2 bg-gray-50",children:"pdf"===(null===n||void 0===n?void 0:n.file_type)?(0,pt.jsx)("div",{className:"h-full",children:(0,pt.jsxs)("div",{className:"w-full h-full border border-gray-300 rounded-lg overflow-hidden relative",children:[(0,pt.jsx)("iframe",{src:n.pdfUrl||`${ze.JR}/api/learning/pdf-viewer?key=${encodeURIComponent(n.s3_key)}`,title:"PDF Viewer",className:"w-full h-full",frameBorder:"0",allow:"fullscreen",onError:e=>{console.error("PDF iframe \u8aad\u307f\u8fbc\u307f\u30a8\u30e9\u30fc:",e),document.getElementById("pdf-error-fallback").classList.remove("hidden")},onLoad:()=>{console.log("PDF iframe \u8aad\u307f\u8fbc\u307f\u5b8c\u4e86"),document.getElementById("pdf-error-fallback").classList.add("hidden")}}),(0,pt.jsx)("div",{className:"absolute inset-0 bg-gray-100 flex items-center justify-center",id:"pdf-error-fallback",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("p",{className:"text-gray-600 mb-3",children:"PDF\u306e\u8868\u793a\u306b\u5931\u6557\u3057\u307e\u3057\u305f"}),(0,pt.jsxs)("div",{className:"space-y-2",children:[(0,pt.jsx)("button",{onClick:()=>window.open(n.pdfUrl||`${ze.JR}/api/learning/pdf-viewer?key=${encodeURIComponent(n.s3_key)}`,"_blank"),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 mr-2",children:"\u65b0\u3057\u3044\u30bf\u30d6\u3067\u958b\u304f"}),(0,pt.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"\u518d\u8aad\u307f\u8fbc\u307f"})]}),(0,pt.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["S3\u30ad\u30fc: ",n.s3_key]})]})})]})}):(0,pt.jsx)("div",{className:"prose prose-sm max-w-none",children:"md"===(null===n||void 0===n?void 0:n.file_type)||null!==n&&void 0!==n&&null!==(t=n.s3_key)&&void 0!==t&&t.toLowerCase().endsWith(".md")?(0,pt.jsx)(vc,{content:b(),showToc:!1}):(0,pt.jsx)("div",{className:"whitespace-pre-wrap text-gray-700 leading-relaxed",children:b()})})}),"pdf"===(null===n||void 0===n?void 0:n.file_type)&&i||"txt"===(null===n||void 0===n?void 0:n.file_type)&&s||"md"===(null===n||void 0===n?void 0:n.file_type)&&s||"application/rtf"===(null===n||void 0===n?void 0:n.file_type)&&s||"text/plain"===(null===n||void 0===n?void 0:n.file_type)&&s?(0,pt.jsxs)("div",{className:"mt-3 text-xs text-gray-500",children:[(0,pt.jsx)("span",{className:"text-blue-600",children:"\u2713 AI\u30a2\u30b7\u30b9\u30bf\u30f3\u30c8\u3067\u5229\u7528\u53ef\u80fd"}),"txt"===(null===n||void 0===n?void 0:n.file_type)&&(0,pt.jsx)("span",{className:"ml-2 text-blue-600",children:"\ud83d\udcc4 \u30c6\u30ad\u30b9\u30c8\u5f62\u5f0f"}),"md"===(null===n||void 0===n?void 0:n.file_type)&&(0,pt.jsx)("span",{className:"ml-2 text-green-600",children:"\ud83d\udcdd Markdown\u5f62\u5f0f"}),"application/rtf"===(null===n||void 0===n?void 0:n.file_type)&&(0,pt.jsx)("span",{className:"ml-2 text-orange-600",children:"\ud83d\udcc4 RTF\u5f62\u5f0f"}),"text/plain"===(null===n||void 0===n?void 0:n.file_type)&&(0,pt.jsx)("span",{className:"ml-2 text-gray-600",children:"\ud83d\udcc4 \u30d7\u30ec\u30fc\u30f3\u30c6\u30ad\u30b9\u30c8\u5f62\u5f0f"})]}):null]})},wc=e=>{if(!e||"string"!==typeof e)return"";let t=e;return t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/^\u2022\s+(.+)$/gm,"<li>$1</li>"),t=t.replace(/(<li>.*<\/li>)/gs,'<ul class="list-disc ml-4 space-y-1">$1</ul>'),t=t.replace(/\n/g,"<br>"),t=t.replace(/(<br>){2,}/g,"</p><p>"),t=t.replace(/^(.*)$/gm,"<p>$1</p>"),t=t.replace(/<p><\/p>/g,""),t=t.replace(/<p><br><\/p>/g,""),t=t.replace(/<ul[^>]*>.*?<\/ul>/gs,e=>e.replace(/<p>/g,"").replace(/<\/p>/g,"")),t},kc=e=>{let{chatMessages:t,chatInput:n,onChatInputChange:s,onSendMessage:a,currentLessonData:l,currentSectionText:o,isAILoading:i,isAIEnabled:c=!0}=e;const[d,u]=(0,r.useState)(!1),m=(0,r.useRef)(null);return(0,r.useEffect)(()=>{m.current&&t.length>0&&(m.current.scrollTop=0)},[t]),(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,pt.jsx)("span",{className:"text-2xl",children:"\ud83e\udd16"}),(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"AI\u30a2\u30b7\u30b9\u30bf\u30f3\u30c8"}),!c&&(0,pt.jsx)("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs rounded-full border border-yellow-200",children:"\u6e96\u5099\u4e2d"})]}),!c&&(0,pt.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,pt.jsxs)("div",{className:"flex items-center gap-2 text-yellow-700 text-sm",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-yellow-500"}),(0,pt.jsx)("span",{children:"PDF\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u5316\u3092\u51e6\u7406\u4e2d\u3067\u3059\u3002AI\u30b5\u30dd\u30fc\u30c8\u6a5f\u80fd\u306f\u6e96\u5099\u5b8c\u4e86\u307e\u3067\u304a\u5f85\u3061\u304f\u3060\u3055\u3044\u3002"})]})}),!c&&(0,pt.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:(0,pt.jsxs)("div",{className:"flex items-center gap-2 text-red-700 text-sm",children:[(0,pt.jsx)("span",{className:"text-red-500",children:"\u26a0\ufe0f"}),(0,pt.jsx)("span",{children:"AI\u30b5\u30dd\u30fc\u30c8\u6a5f\u80fd\u306e\u6e96\u5099\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\u30da\u30fc\u30b8\u3092\u518d\u8aad\u307f\u8fbc\u307f\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})]})}),(0,pt.jsxs)("div",{ref:m,className:"h-64 overflow-y-auto mb-4 space-y-3 custom-scrollbar flex flex-col-reverse",children:[i&&(0,pt.jsx)("div",{className:"flex justify-start",children:(0,pt.jsx)("div",{className:"bg-green-100 text-gray-800 border border-green-200 px-4 py-2 rounded-lg",children:(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsxs)("div",{className:"flex space-x-1",children:[(0,pt.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-bounce"}),(0,pt.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,pt.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,pt.jsx)("span",{className:"text-sm",children:"AI\u304c\u56de\u7b54\u3092\u751f\u6210\u4e2d..."})]})})}),t.slice().reverse().map(e=>(0,pt.jsx)("div",{className:"flex "+("user"===e.sender?"justify-end":"justify-start"),children:(0,pt.jsxs)("div",{className:("user"===e.sender?"max-w-xs bg-blue-500 text-white":"ai"===e.sender?"max-w-md bg-green-100 text-gray-800 border border-green-200":"max-w-xs bg-gray-100 text-gray-800")+" px-4 py-2 rounded-lg",children:["ai"===e.sender?(0,pt.jsx)("div",{className:"text-sm",dangerouslySetInnerHTML:{__html:wc(e.text)}}):(0,pt.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:e.text}),(0,pt.jsx)("p",{className:"text-xs opacity-70 mt-1",children:e.timestamp})]})},e.id))]}),(0,pt.jsxs)("div",{className:"space-y-3",children:[(0,pt.jsx)(Ct,{type:"text",value:n,onChange:s,onKeyPress:e=>"Enter"===e.key&&a(),placeholder:c?"\u5b66\u7fd2\u5185\u5bb9\u306b\u3064\u3044\u3066\u8cea\u554f\u3057\u3066\u304f\u3060\u3055\u3044...":"AI\u6a5f\u80fd\u306e\u6e96\u5099\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067\u304a\u5f85\u3061\u304f\u3060\u3055\u3044...",sanitizeMode:_t.FULL,debounceMs:300,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:border-transparent text-base "+(c?"border-gray-300 focus:ring-green-500":"border-gray-200 bg-gray-50 text-gray-500"),disabled:i||!c}),(0,pt.jsx)("div",{className:"flex justify-center",children:(0,pt.jsx)("button",{onClick:a,disabled:i||!n.trim()||!c,className:"px-8 py-3 rounded-lg font-medium transition-all duration-200 "+(c?"bg-green-500 hover:bg-green-600 disabled:bg-gray-400 disabled:cursor-not-allowed text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),children:i?"\u9001\u4fe1\u4e2d...":c?"\u9001\u4fe1":"\u6e96\u5099\u4e2d..."})})]}),c&&(0,pt.jsx)("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:(0,pt.jsx)("p",{className:"text-green-700 text-xs",children:"\ud83d\udca1 AI\u30a2\u30b7\u30b9\u30bf\u30f3\u30c8\u304c\u5229\u7528\u53ef\u80fd\u3067\u3059\u3002\u5b66\u7fd2\u5185\u5bb9\u306b\u3064\u3044\u3066\u8cea\u554f\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})})]})},Sc=e=>{let{uploadedFiles:t,onFileDelete:n}=e;return(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 mt-6",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,pt.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc1"}),(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u63d0\u51fa\u7269\u78ba\u8a8d"}),(0,pt.jsxs)("span",{className:"text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:[t.length,"\u4ef6"]})]}),(0,pt.jsxs)("div",{className:"space-y-3",children:[t.map(e=>(0,pt.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,pt.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,pt.jsx)("span",{className:"text-blue-600",children:"\ud83d\udce6"}),(0,pt.jsx)("p",{className:"text-sm font-medium text-gray-800 truncate",children:e.name})]}),(0,pt.jsxs)("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[(0,pt.jsxs)("span",{children:["\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9: ",e.uploadDate]}),e.instructorApproved?(0,pt.jsx)("span",{className:"text-green-600 font-mono text-xs bg-green-50 px-2 py-1 rounded",children:"\u627f\u8a8d\u6e08"}):e.s3Key?(0,pt.jsx)("span",{className:"text-blue-600 font-mono text-xs bg-blue-50 px-2 py-1 rounded",children:"\u30b9\u30c8\u30ec\u30fc\u30b8\u4fdd\u5b58\u6e08"}):null]})]}),!e.instructorApproved&&(0,pt.jsx)("button",{onClick:()=>n(e.id),className:"ml-3 px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg text-sm font-medium transition-colors hover:bg-red-100",title:"\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664",children:"\u524a\u9664"})]},e.id)),0===t.length&&(0,pt.jsxs)("div",{className:"text-center py-8",children:[(0,pt.jsx)("div",{className:"text-gray-400 text-4xl mb-2",children:"\ud83d\udcc1"}),(0,pt.jsx)("p",{className:"text-gray-500 text-sm",children:"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u306f\u3042\u308a\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-gray-400 text-xs mt-1",children:"ZIP\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044"})]})]})]})},_c=e=>{let{isOpen:t,onClose:n,onFileUpload:s}=e;const[a,l]=(0,r.useState)(null),[o,i]=(0,r.useState)(!1);if(!t)return null;const c=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?i(!0):"dragleave"===e.type&&i(!1)},d=()=>{l(null),n()};return(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"\u6210\u679c\u7269\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all duration-200",onClick:d,children:"\xd7"})]})}),(0,pt.jsxs)("div",{className:"p-6",children:[(0,pt.jsxs)("div",{className:"mb-4",children:[(0,pt.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"\u30d5\u30a1\u30a4\u30eb\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),(0,pt.jsx)("p",{className:"text-xs text-gray-500 mb-3",children:"\u203b ZIP\u30d5\u30a1\u30a4\u30eb\u306e\u307f\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u53ef\u80fd\u3067\u3059"}),(0,pt.jsx)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center transition-colors "+(o?"border-blue-400 bg-blue-50":"border-gray-300 hover:border-gray-400"),onDragEnter:c,onDragLeave:c,onDragOver:c,onDrop:e=>{if(e.preventDefault(),e.stopPropagation(),i(!1),e.dataTransfer.files&&e.dataTransfer.files[0]){const t=e.dataTransfer.files[0];t.type.includes("zip")||t.name.toLowerCase().endsWith(".zip")?l(t):alert("ZIP\u30d5\u30a1\u30a4\u30eb\u306e\u307f\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u53ef\u80fd\u3067\u3059")}},children:a?(0,pt.jsxs)("div",{className:"space-y-2",children:[(0,pt.jsx)("div",{className:"text-green-600",children:(0,pt.jsx)("span",{className:"text-2xl",children:"\ud83d\udcc1"})}),(0,pt.jsx)("p",{className:"text-sm font-medium text-gray-700",children:a.name}),(0,pt.jsxs)("p",{className:"text-xs text-gray-500",children:[(a.size/1024/1024).toFixed(2)," MB"]})]}):(0,pt.jsxs)("div",{className:"space-y-2",children:[(0,pt.jsx)("div",{className:"text-gray-400",children:(0,pt.jsx)("span",{className:"text-3xl",children:"\ud83d\udcc1"})}),(0,pt.jsxs)("p",{className:"text-sm text-gray-600",children:["\u30d5\u30a1\u30a4\u30eb\u3092\u30c9\u30e9\u30c3\u30b0&\u30c9\u30ed\u30c3\u30d7\u3059\u308b\u304b\u3001",(0,pt.jsx)("br",{}),"\u4e0b\u306e\u30dc\u30bf\u30f3\u304b\u3089\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"]})]})}),(0,pt.jsx)("div",{className:"mt-3",children:(0,pt.jsx)(Ct,{type:"file",accept:".zip,application/zip",onChange:e=>{const t=e.target.files[0];t&&(t.type.includes("zip")||t.name.toLowerCase().endsWith(".zip")?l(t):(alert("ZIP\u30d5\u30a1\u30a4\u30eb\u306e\u307f\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u53ef\u80fd\u3067\u3059"),e.target.value="",l(null)))},sanitizeMode:_t.NONE,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"})})]}),(0,pt.jsxs)("div",{className:"flex gap-4 pt-6 border-t border-gray-200",children:[(0,pt.jsx)("button",{className:"flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-all duration-200",onClick:d,children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{className:"flex-1 px-6 py-3 rounded-xl font-medium transition-all duration-200 "+(a?"bg-blue-500 hover:bg-blue-600 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),onClick:()=>{if(a){s({target:{files:[a]}})}},disabled:!a,children:"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"})]})]})]})})},Cc=()=>{const e=(0,r.useRef)(!1),t=(0,r.useRef)(0),n=(0,r.useRef)(null),s=e=>{if(e&&e.id)return console.log("\u8a8d\u8a3c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u30e6\u30fc\u30b6\u30fcID\u53d6\u5f97:",e.id),e.id;const t=localStorage.getItem("currentUser");if(t)try{const e=JSON.parse(t);if(e&&e.id)return console.log("localStorage\u306ecurrentUser\u304b\u3089\u30e6\u30fc\u30b6\u30fcID\u53d6\u5f97:",e.id),e.id}catch(s){console.error("localStorage\u306ecurrentUser\u30d1\u30fc\u30b9\u30a8\u30e9\u30fc:",s)}const n=localStorage.getItem("userId");return n?(console.log("localStorage\u306euserId\u304b\u3089\u30e6\u30fc\u30b6\u30fcID\u53d6\u5f97:",n),n):(console.warn("\u30e6\u30fc\u30b6\u30fcID\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u50241\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002"),"1")},a=(0,r.useCallback)((s,r,a)=>{Date.now()-t.current<5e3?console.log("\u5b66\u7fd2\u9032\u6357\u66f4\u65b0\u3092\u30b9\u30ad\u30c3\u30d7\uff08\u524d\u56de\u306e\u66f4\u65b0\u304b\u30895\u79d2\u4ee5\u5185\uff09"):e.current?console.log("\u5b66\u7fd2\u9032\u6357\u66f4\u65b0\u3092\u30b9\u30ad\u30c3\u30d7\uff08\u65e2\u306b\u66f4\u65b0\u4e2d\uff09"):(n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{l(s,r,a)},1e3))},[]),l=async(n,r,a)=>{if(n&&r)try{e.current=!0,t.current=Date.now();const l=s(a),o=r.id||1;console.log("\u5b66\u7fd2\u9032\u6357\u66f4\u65b0\u51e6\u7406\u958b\u59cb:",{userId:l,courseId:o,currentLesson:n});const i=await fetch(`${ze.JR}/api/learning/assign-course`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify({userId:parseInt(l),courseId:parseInt(o)})});i.ok?console.log("\u30b3\u30fc\u30b9\u5272\u308a\u5f53\u3066\u5b8c\u4e86"):console.error("\u30b3\u30fc\u30b9\u5272\u308a\u5f53\u3066\u5931\u6557:",i.status);const c=await fetch(`${ze.JR}/api/learning/progress/lesson`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify({userId:parseInt(l),lessonId:parseInt(n),status:"in_progress"})});if(c.ok)console.log("\u5b66\u7fd2\u9032\u6357\u304c\u6b63\u5e38\u306b\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f");else{console.error("\u5b66\u7fd2\u9032\u6357\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f:",c.status);const e=await c.json().catch(()=>({}));console.error("\u30a8\u30e9\u30fc\u8a73\u7d30:",e)}}catch(l){console.error("\u5b66\u7fd2\u9032\u6357\u66f4\u65b0\u30a8\u30e9\u30fc:",l)}finally{e.current=!1}};return{updateLearningProgress:a,handleStartLearning:async(e,t,n)=>{try{const r=s(n),a=(null===t||void 0===t?void 0:t.id)||1;console.log("=== \u5b66\u7fd2\u958b\u59cb\u51e6\u7406 ==="),console.log("\u8a8d\u8a3c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30e6\u30fc\u30b6\u30fc:",n),console.log("\u53d6\u5f97\u3057\u305f\u30e6\u30fc\u30b6\u30fcID:",r),console.log("\u30b3\u30fc\u30b9ID:",a),console.log("\u30ec\u30c3\u30b9\u30f3ID:",e),console.log("localStorage\u306euserId:",localStorage.getItem("userId")),console.log("1. \u30b3\u30fc\u30b9\u5272\u308a\u5f53\u3066\u51e6\u7406\u958b\u59cb...");const l=await fetch(`${ze.JR}/api/learning/assign-course`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify({userId:parseInt(r),courseId:parseInt(a)})});if(console.log("\u30b3\u30fc\u30b9\u5272\u308a\u5f53\u3066\u30ec\u30b9\u30dd\u30f3\u30b9:",l.status,l.statusText),l.ok){const e=await l.json();console.log("\u5229\u7528\u8005\u3068\u30b3\u30fc\u30b9\u306e\u95a2\u9023\u4ed8\u3051\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f:",e)}else{console.error("\u5229\u7528\u8005\u3068\u30b3\u30fc\u30b9\u306e\u95a2\u9023\u4ed8\u3051\u306b\u5931\u6557\u3057\u307e\u3057\u305f");const e=await l.json().catch(()=>({}));console.error("\u30a8\u30e9\u30fc\u8a73\u7d30:",e)}console.log("2. \u30ec\u30c3\u30b9\u30f3\u9032\u6357\u66f4\u65b0\u51e6\u7406\u958b\u59cb...");const o=await fetch(`${ze.JR}/api/learning/progress/lesson`,{method:"PUT",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify({userId:parseInt(r),lessonId:parseInt(e),status:"in_progress"})});if(console.log("\u30ec\u30c3\u30b9\u30f3\u9032\u6357\u66f4\u65b0\u30ec\u30b9\u30dd\u30f3\u30b9:",o.status,o.statusText),o.ok){const e=await o.json();console.log("\u30ec\u30c3\u30b9\u30f3\u9032\u6357\u306e\u66f4\u65b0\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f:",e)}else{console.error("\u30ec\u30c3\u30b9\u30f3\u9032\u6357\u306e\u66f4\u65b0\u306b\u5931\u6557\u3057\u307e\u3057\u305f");const e=await o.json().catch(()=>({}));console.error("\u30a8\u30e9\u30fc\u8a73\u7d30:",e)}console.log("=== \u5b66\u7fd2\u958b\u59cb\u51e6\u7406\u5b8c\u4e86 ===")}catch(r){console.error("\u5b66\u7fd2\u958b\u59cb\u51e6\u7406\u30a8\u30e9\u30fc:",r)}}}};const Ic=new class{constructor(){this.baseURL=ze.JR,this.apiKey={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"https://backend.studysphere.ayatori-inc.co.jp"}.REACT_APP_OPENAI_API_KEY}async askQuestion(e,t,n){try{const s=8e3,r=t.length>s?t.substring(0,s)+"...":t,a=(this.buildPrompt(e,r,n),await fetch(`${this.baseURL}/api/ai/assist`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:JSON.stringify({question:e,context:r,lessonTitle:n,model:"gpt-4o",maxTokens:1e3,temperature:.6,systemPrompt:this.getSystemPrompt()})}));if(!a.ok)throw new Error(`AI API\u547c\u3073\u51fa\u3057\u30a8\u30e9\u30fc: ${a.status}`);const l=await a.json();if(l.success)return{success:!0,answer:l.answer,usage:l.usage};throw new Error(l.message||"AI\u304b\u3089\u306e\u56de\u7b54\u3092\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f")}catch(s){return console.error("AI\u30a2\u30b7\u30b9\u30bf\u30f3\u30c8\u30a8\u30e9\u30fc:",s),{success:!1,error:s.message,fallbackAnswer:this.getFallbackAnswer(e)}}}getSystemPrompt(){return"\u3042\u306a\u305f\u306f\u5b66\u7fd2\u652f\u63f4AI\u30a2\u30b7\u30b9\u30bf\u30f3\u30c8\u3067\u3059\u3002\u4ee5\u4e0b\u306e\u6307\u793a\u306b\u5f93\u3063\u3066\u304f\u3060\u3055\u3044\uff1a\n\n1. **\u30de\u30fc\u30af\u30c0\u30a6\u30f3\u5f62\u5f0f\u3067\u306e\u56de\u7b54**: \u3059\u3079\u3066\u306e\u56de\u7b54\u306f\u30de\u30fc\u30af\u30c0\u30a6\u30f3\u5f62\u5f0f\u3067\u63d0\u4f9b\u3057\u3066\u304f\u3060\u3055\u3044\n   - \u898b\u51fa\u3057\u306b\u306f **\u592a\u5b57** \u3092\u4f7f\u7528\n   - \u91cd\u8981\u306a\u30dd\u30a4\u30f3\u30c8\u306f **\u592a\u5b57** \u3067\u5f37\u8abf\n   - \u30ea\u30b9\u30c8\u306f\u9069\u5207\u306a\u30a4\u30f3\u30c7\u30f3\u30c8\u3068\u8a18\u53f7\u3092\u4f7f\u7528\n   - \u69cb\u9020\u5316\u3055\u308c\u305f\u60c5\u5831\u306f\u8868\u3084\u30bb\u30af\u30b7\u30e7\u30f3\u306b\u6574\u7406\n\n2. **\u67d4\u8edf\u306a\u7406\u89e3**: \u8cea\u554f\u306e\u610f\u56f3\u3092\u7406\u89e3\u3057\u3001\u30c6\u30ad\u30b9\u30c8\u5185\u306e\u540c\u7fa9\u8a9e\u30fb\u985e\u4f3c\u8868\u73fe\u30fb\u8868\u8a18\u306e\u9055\u3044\u3092\u9069\u5207\u306b\u8a8d\u8b58\u3057\u3066\u304f\u3060\u3055\u3044\n   - \u4f8b\uff1a\u300cMacOS\u300d\u3068\u300cmacOS\u300d\u3001\u300cWindows\u300d\u3068\u300cWindows OS\u300d\u306a\u3069\n   - \u5927\u6587\u5b57\u5c0f\u6587\u5b57\u306e\u9055\u3044\u3001\u30cf\u30a4\u30d5\u30f3\u306e\u6709\u7121\u3001\u7565\u8a9e\u306a\u3069\u3082\u8003\u616e\u3057\u3066\u304f\u3060\u3055\u3044\n\n3. **\u56de\u7b54\u306e\u7bc4\u56f2**: \u63d0\u4f9b\u3055\u308c\u305f\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9\u306e\u7bc4\u56f2\u5185\u3067\u56de\u7b54\u3057\u3066\u304f\u3060\u3055\u3044\n4. **\u63a8\u8ad6\u306e\u5236\u9650**: \u30c6\u30ad\u30b9\u30c8\u306b\u660e\u8a18\u3055\u308c\u3066\u3044\u306a\u3044\u5185\u5bb9\u306b\u3064\u3044\u3066\u63a8\u8ad6\u3084\u61b6\u6e2c\u3092\u884c\u308f\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\n5. **\u660e\u78ba\u6027**: \u5206\u304b\u308a\u3084\u3059\u304f\u3001\u69cb\u9020\u5316\u3055\u308c\u305f\u56de\u7b54\u3092\u5fc3\u304c\u3051\u3066\u304f\u3060\u3055\u3044\n6. **\u5f15\u7528**: \u53ef\u80fd\u3067\u3042\u308c\u3070\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u8a72\u5f53\u90e8\u5206\u3092\u5f15\u7528\u3057\u3066\u56de\u7b54\u3057\u3066\u304f\u3060\u3055\u3044\n7. **\u4e01\u5be7\u3055**: \u5e38\u306b\u4e01\u5be7\u3067\u89aa\u5207\u306a\u53e3\u8abf\u3067\u56de\u7b54\u3057\u3066\u304f\u3060\u3055\u3044\n8. **\u6559\u80b2\u7684\u914d\u616e**: \u5b66\u7fd2\u8005\u306e\u7406\u89e3\u3092\u4fc3\u9032\u3059\u308b\u3088\u3046\u3001\u5206\u304b\u308a\u3084\u3059\u3044\u8aac\u660e\u3092\u5fc3\u304c\u3051\u3066\u304f\u3060\u3055\u3044\n\n\u30c6\u30ad\u30b9\u30c8\u306b\u542b\u307e\u308c\u3066\u3044\u306a\u3044\u8cea\u554f\u306b\u3064\u3044\u3066\u306f\u3001\u300c\u3053\u306e\u5185\u5bb9\u306b\u3064\u3044\u3066\u306f\u62c5\u5f53\u6307\u5c0e\u54e1\u306b\u304a\u554f\u3044\u5408\u308f\u305b\u304f\u3060\u3055\u3044\u3002\u300d\u3068\u56de\u7b54\u3057\u3066\u304f\u3060\u3055\u3044\u3002"}buildPrompt(e,t,n){return`\u30ec\u30c3\u30b9\u30f3: ${n}\n\n\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9:\n${t}\n\n\u8cea\u554f: ${e}\n\n\u4e0a\u8a18\u306e\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9\u306b\u57fa\u3065\u3044\u3066\u3001\u8cea\u554f\u306b\u56de\u7b54\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n**\u91cd\u8981\u306a\u6307\u793a:**\n- **\u56de\u7b54\u306f\u5fc5\u305a\u30de\u30fc\u30af\u30c0\u30a6\u30f3\u5f62\u5f0f\u3067\u63d0\u4f9b\u3057\u3066\u304f\u3060\u3055\u3044**\n- \u898b\u51fa\u3057\u3001\u592a\u5b57\u3001\u30ea\u30b9\u30c8\u3001\u30a4\u30f3\u30c7\u30f3\u30c8\u3092\u9069\u5207\u306b\u4f7f\u7528\u3057\u3066\u69cb\u9020\u5316\u3057\u3066\u304f\u3060\u3055\u3044\n- \u8cea\u554f\u306e\u610f\u56f3\u3092\u7406\u89e3\u3057\u3001\u540c\u7fa9\u8a9e\u30fb\u985e\u4f3c\u8868\u73fe\u30fb\u8868\u8a18\u306e\u9055\u3044\u3092\u9069\u5207\u306b\u8a8d\u8b58\u3057\u3066\u304f\u3060\u3055\u3044\n- \u5927\u6587\u5b57\u5c0f\u6587\u5b57\u306e\u9055\u3044\u3001\u30cf\u30a4\u30d5\u30f3\u306e\u6709\u7121\u3001\u7565\u8a9e\u306a\u3069\u3082\u8003\u616e\u3057\u3066\u304f\u3060\u3055\u3044\n- \u30c6\u30ad\u30b9\u30c8\u306b\u542b\u307e\u308c\u3066\u3044\u306a\u3044\u5185\u5bb9\u306b\u3064\u3044\u3066\u306f\u63a8\u8ad6\u305b\u305a\u3001\u660e\u78ba\u306b\u300c\u3053\u306e\u5185\u5bb9\u306b\u3064\u3044\u3066\u306f\u62c5\u5f53\u6307\u5c0e\u54e1\u306b\u3054\u76f8\u8ac7\u304f\u3060\u3055\u3044\u3002\u300d\u3068\u56de\u7b54\u3057\u3066\u304f\u3060\u3055\u3044\n- \u5e38\u306b\u4e01\u5be7\u3067\u89aa\u5207\u306a\u53e3\u8abf\u3067\u56de\u7b54\u3057\u3066\u304f\u3060\u3055\u3044\n- \u5b66\u7fd2\u8005\u306e\u7406\u89e3\u3092\u4fc3\u9032\u3059\u308b\u3088\u3046\u3001\u5206\u304b\u308a\u3084\u3059\u3044\u8aac\u660e\u3092\u5fc3\u304c\u3051\u3066\u304f\u3060\u3055\u3044\n- \u53ef\u80fd\u3067\u3042\u308c\u3070\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u8a72\u5f53\u90e8\u5206\u3092\u5f15\u7528\u3057\u3066\u56de\u7b54\u3057\u3066\u304f\u3060\u3055\u3044\n- **\u56de\u7b54\u306f\u7c21\u6f54\u3067\u5b9f\u7528\u7684\u306a\u5185\u5bb9\u306b\u7559\u3081\u3066\u304f\u3060\u3055\u3044\u3002\u56de\u7b54\u304c\u51fa\u3066\u3044\u308b\u306e\u306b\u3055\u3089\u306b\u300c\u3053\u308c\u4ee5\u4e0a\u306e\u5185\u5bb9\u306f\u62c5\u5f53\u6307\u5c0e\u54e1\u306b\u3054\u76f8\u8ac7\u304f\u3060\u3055\u3044\u3002\u300d\u3068\u3044\u3063\u305f\u6587\u8a00\u306f\u4e0d\u8981\u3067\u3059**\n\n**\u30de\u30fc\u30af\u30c0\u30a6\u30f3\u5f62\u5f0f\u306e\u4f8b:**\n- \u898b\u51fa\u3057: **\u898b\u51fa\u3057\u30c6\u30ad\u30b9\u30c8**\n- \u91cd\u8981\u30dd\u30a4\u30f3\u30c8: **\u91cd\u8981\u306a\u60c5\u5831**\n- \u30ea\u30b9\u30c8: \u2022 \u9805\u76ee1\n         \u2022 \u9805\u76ee2\n- \u69cb\u9020\u5316: \u30bb\u30af\u30b7\u30e7\u30f3\u3054\u3068\u306b\u9069\u5207\u306b\u6574\u7406\n\n\u4f8b\uff1a\n- \u300cMacOS\u300d\u2192\u300cmacOS\u300d\u3068\u3057\u3066\u8a8d\u8b58\n- \u300cWindows OS\u300d\u2192\u300cWindows\u300d\u3068\u3057\u3066\u8a8d\u8b58\n- \u300cAI\u300d\u2192\u300c\u4eba\u5de5\u77e5\u80fd\u300d\u300cartificial intelligence\u300d\u3068\u3057\u3066\u8a8d\u8b58`}getFallbackAnswer(e){return`\u7533\u3057\u8a33\u3054\u3056\u3044\u307e\u305b\u3093\u3002\u73fe\u5728\u3001AI\u30a2\u30b7\u30b9\u30bf\u30f3\u30c8\u306e\u5fdc\u7b54\u3092\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u8cea\u554f: "${e}"\n\n\u4ee5\u4e0b\u306e\u5bfe\u51e6\u6cd5\u3092\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\uff1a\n1. \u30da\u30fc\u30b8\u3092\u518d\u8aad\u307f\u8fbc\u307f\u3059\u308b\n2. \u3057\u3070\u3089\u304f\u6642\u9593\u3092\u304a\u3044\u3066\u518d\u5ea6\u8cea\u554f\u3059\u308b\n3. \u8cea\u554f\u3092\u7c21\u6f54\u306b\u3057\u76f4\u3059\n\n\u6280\u8853\u7684\u306a\u554f\u984c\u304c\u7d9a\u304f\u5834\u5408\u306f\u3001\u7ba1\u7406\u8005\u306b\u304a\u554f\u3044\u5408\u308f\u305b\u304f\u3060\u3055\u3044\u3002`}validateContext(e){return e&&0!==e.trim().length?e.length<50?{isValid:!1,error:"\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9\u304c\u77ed\u3059\u304e\u307e\u3059"}:{isValid:!0}:{isValid:!1,error:"\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9\u304c\u5229\u7528\u3067\u304d\u307e\u305b\u3093"}}validateQuestion(e){return e&&0!==e.trim().length?e.length<3?{isValid:!1,error:"\u8cea\u554f\u304c\u77ed\u3059\u304e\u307e\u3059"}:e.length>500?{isValid:!1,error:"\u8cea\u554f\u304c\u9577\u3059\u304e\u307e\u3059\uff08500\u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\uff09"}:{isValid:!0}:{isValid:!1,error:"\u8cea\u554f\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044"}}},Tc=()=>{const e=ne(),{currentUser:t}=(0,r.useContext)(ft),[n]=De(),[s,a]=(0,r.useState)(1),[l,o]=(0,r.useState)([]),[i,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(""),[m,x]=(0,r.useState)(""),[g,h]=(0,r.useState)(!0),[p,f]=(0,r.useState)(0),[b,y]=(0,r.useState)([]),[v,j]=(0,r.useState)(!1),[N,w]=(0,r.useState)(null),[k,S]=(0,r.useState)(null),[_,C]=(0,r.useState)(null),[I,T]=(0,r.useState)(0),[P,L]=(0,r.useState)(!0),[E,D]=(0,r.useState)(null),[A,$]=(0,r.useState)(!1),[z,O]=(0,r.useState)(!1),[R,M]=(0,r.useState)("idle"),[F,U]=(0,r.useState)({hasAssignment:!1,assignmentSubmitted:!1}),B=(0,r.useRef)(null),J=(0,r.useRef)(0),q=(0,r.useRef)(null),{updateLearningProgress:V,handleStartLearning:H,handleTestCompleted:W}=Cc();(0,r.useEffect)(()=>{console.log(`\ud83d\udd04 currentLesson\u72b6\u614b\u5909\u5316: ${s}`)},[s]),(0,r.useEffect)(()=>{const e=n.get("course"),t=n.get("lesson");if(console.log("\ud83d\udd0d URL\u30d1\u30e9\u30e1\u30fc\u30bf\u89e3\u6790:",{courseParam:e,lessonParam:t}),e&&X(e,0,n),t){const e=parseInt(t);console.log("\ud83d\udcda \u30ec\u30c3\u30b9\u30f3ID\u89e3\u6790:",{lessonParam:t,lessonId:e,isValid:e>=1}),e>=1&&(console.log(`\ud83d\udd04 setCurrentLesson\u547c\u3073\u51fa\u3057\u524d: currentLesson = ${s}, \u65b0\u3057\u3044\u5024 = ${e}`),a(e),h(!0),console.log("\u2705 \u30ec\u30c3\u30b9\u30f3ID\u8a2d\u5b9a\u5b8c\u4e86:",e))}},[n]);const Q=async function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||s;try{console.log(`\ud83d\udcc1 \u63d0\u51fa\u7269\u78ba\u8a8d\u30d5\u30a1\u30a4\u30eb\u53d6\u5f97\u958b\u59cb: \u30ec\u30c3\u30b9\u30f3ID ${e}`);const t=await fetch(`${ze.JR}/api/learning/lesson/${e}/uploaded-files`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(t.ok){const e=await t.json();console.log("\ud83d\udcc1 \u63d0\u51fa\u7269\u78ba\u8a8d\u30d5\u30a1\u30a4\u30eb\u30c7\u30fc\u30bf:",e),e.success?(y(e.data),console.log(`\u2705 \u63d0\u51fa\u7269\u78ba\u8a8d\u30d5\u30a1\u30a4\u30eb\u8a2d\u5b9a\u5b8c\u4e86: ${e.data.length}\u4ef6`)):console.error("\u63d0\u51fa\u7269\u78ba\u8a8d\u30d5\u30a1\u30a4\u30eb\u53d6\u5f97\u5931\u6557:",e.message)}else{const e=await t.json().catch(()=>({}));console.error("\u63d0\u51fa\u7269\u78ba\u8a8d\u30d5\u30a1\u30a4\u30ebAPI\u30a8\u30e9\u30fc:",{status:t.status,error:e.message})}}catch(E){console.error("\u63d0\u51fa\u7269\u78ba\u8a8d\u30d5\u30a1\u30a4\u30eb\u53d6\u5f97\u30a8\u30e9\u30fc:",E)}},K=async function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)||s,t=++J.current;try{console.log(`\ud83d\udd0d \u8ab2\u984c\u63d0\u51fa\u72b6\u6cc1\u78ba\u8a8d\u958b\u59cb: \u30ec\u30c3\u30b9\u30f3ID ${e} (currentLesson: ${s}), requestId: ${t}`);const n=await fetch(`${ze.JR}/api/learning/lesson/${e}/assignment-status`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(console.log("\ud83d\udce1 \u8ab2\u984c\u63d0\u51fa\u72b6\u6cc1API\u30ec\u30b9\u30dd\u30f3\u30b9:",{status:n.status,ok:n.ok,targetLessonId:e,currentLesson:s,requestId:t}),n.ok){const e=await n.json();console.log("\ud83d\udcca \u8ab2\u984c\u63d0\u51fa\u72b6\u6cc1\u30c7\u30fc\u30bf:",e),e.success?(U(e.data),console.log("\u2705 \u8ab2\u984c\u63d0\u51fa\u72b6\u6cc1\u8a2d\u5b9a\u5b8c\u4e86:",{hasAssignment:e.data.hasAssignment,assignmentSubmitted:e.data.assignmentSubmitted})):console.error("\u8ab2\u984c\u63d0\u51fa\u72b6\u6cc1\u53d6\u5f97\u5931\u6557:",e.message)}else{const t=await n.json().catch(()=>({}));console.error("\u8ab2\u984c\u63d0\u51fa\u72b6\u6cc1API\u30a8\u30e9\u30fc:",{status:n.status,error:t.message,targetLessonId:e,currentLesson:s})}}catch(E){console.error("\u8ab2\u984c\u63d0\u51fa\u72b6\u6cc1\u78ba\u8a8d\u30a8\u30e9\u30fc:",E)}},Y=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||s,n=++J.current;q.current&&q.current.abort();const r=new AbortController;q.current=r;try{var a,l,o;L(!0),D(null);const i=localStorage.getItem("userId")||"1";console.log("\ud83d\ude80 \u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u53d6\u5f97\u958b\u59cb:",{currentLesson:s,targetLessonId:t,userId:i,retryCount:e+1,requestId:n,url:`${ze.JR}/api/learning/lesson/${t}/content`});const c=await fetch(`${ze.JR}/api/learning/lesson/${t}/content`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},signal:r.signal});if(console.log("\ud83d\udce1 API\u30ec\u30b9\u30dd\u30f3\u30b9:",{status:c.status,ok:c.ok,targetLessonId:t}),!c.ok){const n=await c.json().catch(()=>({})),s=`\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${c.status} ${n.message||""}`;return console.error("\u274c API\u30a8\u30e9\u30fc:",{status:c.status,errorData:n,targetLessonId:t}),c.status>=500&&e<2?(console.log(`${e+1}\u56de\u76ee\u306e\u30ea\u30c8\u30e9\u30a4\u3092\u5b9f\u884c\u3057\u307e\u3059...`),void setTimeout(()=>{Y(e+1,t)},2e3*(e+1))):(D(s),void L(!1))}const d=await c.json();if(console.log("\ud83d\udcca \u30ec\u30b9\u30dd\u30f3\u30b9\u30c7\u30fc\u30bf:",{success:d.success,lessonId:null===(a=d.data)||void 0===a?void 0:a.id,lessonTitle:null===(l=d.data)||void 0===l?void 0:l.title,courseId:null===(o=d.data)||void 0===o?void 0:o.course_id,requestId:n}),d.success){if(d.data&&d.data.id!==t)return console.error(`\u274c \u30c7\u30fc\u30bf\u6574\u5408\u6027\u30a8\u30e9\u30fc: \u8981\u6c42\u3057\u305f\u30ec\u30c3\u30b9\u30f3ID ${t} \u3068\u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u30ec\u30c3\u30b9\u30f3ID ${d.data.id} \u304c\u4e00\u81f4\u3057\u307e\u305b\u3093`),D(`\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u306e\u6574\u5408\u6027\u30a8\u30e9\u30fc: \u8981\u6c42\u3057\u305f\u30ec\u30c3\u30b9\u30f3ID ${t} \u3068\u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u30ec\u30c3\u30b9\u30f3ID ${d.data.id} \u304c\u4e00\u81f4\u3057\u307e\u305b\u3093`),void L(!1);w(d.data),h(!1),d.data.textContent?(console.log("\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u304b\u3089textContent\u3092\u8a2d\u5b9a:",{textContentLength:d.data.textContent.length,fileType:d.data.file_type,s3Key:d.data.s3_key}),u(d.data.textContent)):console.log("\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u306btextContent\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u305b\u3093:",{hasTextContent:!!d.data.textContent,fileType:d.data.file_type,s3Key:d.data.s3_key}),console.log(`\ud83d\udd0d \u8ab2\u984c\u63d0\u51fa\u72b6\u6cc1\u78ba\u8a8d\u958b\u59cb: \u30ec\u30c3\u30b9\u30f3ID ${t}`),await K(t),await Q(t),await G(t),console.log("\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u53d6\u5f97\u6210\u529f:",d.data)}else D(d.message||"\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(E){if("AbortError"===E.name)return void console.log(`\u23f9\ufe0f \u30ea\u30af\u30a8\u30b9\u30c8\u304c\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u307e\u3057\u305f: \u30ec\u30c3\u30b9\u30f3ID ${t}`);if(console.error("\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u53d6\u5f97\u30a8\u30e9\u30fc:",E),e<2&&("TypeError"===E.name||E.message.includes("Failed to fetch")))return console.log(`${e+1}\u56de\u76ee\u306e\u30ea\u30c8\u30e9\u30a4\u3092\u5b9f\u884c\u3057\u307e\u3059...`),void setTimeout(()=>{Y(e+1,t)},2e3*(e+1));D("\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+E.message)}finally{L(!1)}};(0,r.useEffect)(()=>{if(s){console.log(`\ud83d\udd04 useEffect: currentLesson\u5909\u66f4\u691c\u77e5 - \u30ec\u30c3\u30b9\u30f3ID ${s}`),N&&N.id!==s&&(console.log(`\ud83d\uddd1\ufe0f \u524d\u306e\u30ec\u30c3\u30b9\u30f3${N.id}\u306e\u72b6\u614b\u3092\u30af\u30ea\u30a2\u4e2d...`),w(null),u(""),x(""),o([]),T(0),O(!1),M("idle"),U({hasAssignment:!1,assignmentSubmitted:!1}));const e=s;console.log(`\ud83d\ude80 \u5373\u5ea7\u306b\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u53d6\u5f97\u958b\u59cb: \u30ec\u30c3\u30b9\u30f3ID ${e}`),Y(0,e),K(e)}},[s]),(0,r.useEffect)(()=>()=>{},[]);const G=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{console.log(`\u30bb\u30af\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u4e2d: \u30ec\u30c3\u30b9\u30f3ID ${e} (\u8a66\u884c\u56de\u6570: ${t+1})`);const i=await fetch(`${ze.JR}/api/lesson-text-video-links/lesson/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(i.ok){const e=await i.json();var n,s,r,a,l,o;if(e.success){if(console.log("\u30bb\u30af\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\u53d6\u5f97\u6210\u529f:",e.data),console.log("\u30bb\u30af\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf - text_file_key\u8a73\u7d30:",{text_file_key:null===(n=e.data[0])||void 0===n?void 0:n.text_file_key,text_file_key_type:typeof(null===(s=e.data[0])||void 0===s?void 0:s.text_file_key),text_file_key_length:null===(r=e.data[0])||void 0===r||null===(a=r.text_file_key)||void 0===a?void 0:a.length,text_file_key_starts_with_lessons:null===(l=e.data[0])||void 0===l||null===(o=l.text_file_key)||void 0===o?void 0:o.startsWith("lessons/"),first_section:e.data[0]}),C(e.data),e.data.length>0){T(0);const t=e.data[0];if(t.text_file_key&&t.text_file_key!==(null===N||void 0===N?void 0:N.s3_key)){console.log("\u30bb\u30af\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\u53d6\u5f97: \u6700\u521d\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u306e\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u5b9a:",t.text_file_key);const e=t.text_file_key.split(".").pop().toLowerCase(),n="md"===e?"md":"txt"===e?"text/plain":"rtf"===e?"application/rtf":"pdf"===e?"pdf":(null===N||void 0===N?void 0:N.file_type)||"pdf";console.log("\u30d5\u30a1\u30a4\u30eb\u30bf\u30a4\u30d7\u5224\u5b9a:",{text_file_key:t.text_file_key,fileExtension:e,detectedFileType:n,originalFileType:null===N||void 0===N?void 0:N.file_type}),w(e=>({...e,s3_key:t.text_file_key,file_type:n})),"pdf"===n?(M("processing"),O(!1),u(""),x("")):console.log("\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u305f\u3081\u3001\u65e2\u5b58\u306etextContent\u3092\u4fdd\u6301\u3057\u307e\u3059")}Z(t)}}else console.error("\u30bb\u30af\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\u53d6\u5f97\u5931\u6557:",e.message)}else{const n=`\u30bb\u30af\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\u53d6\u5f97\u5931\u6557: ${i.status}`;if(console.error(n),i.status>=500&&t<2)return console.log(`${t+1}\u56de\u76ee\u306e\u30ea\u30c8\u30e9\u30a4\u3092\u5b9f\u884c\u3057\u307e\u3059...`),void setTimeout(()=>{G(e,t+1)},2e3*(t+1))}}catch(E){if(console.error("\u30bb\u30af\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\u53d6\u5f97\u30a8\u30e9\u30fc:",E),t<2&&("TypeError"===E.name||E.message.includes("Failed to fetch")))return console.log(`${t+1}\u56de\u76ee\u306e\u30ea\u30c8\u30e9\u30a4\u3092\u5b9f\u884c\u3057\u307e\u3059...`),void setTimeout(()=>{G(e,t+1)},2e3*(t+1))}},Z=e=>{if(e&&(console.log("\u30bb\u30af\u30b7\u30e7\u30f3\u5185\u5bb9\u3092\u8868\u793a:",e),e.video_id&&e.youtube_url)){const t={id:e.video_id,title:e.video_title||"\u30bb\u30af\u30b7\u30e7\u30f3\u52d5\u753b",description:e.video_description||"",youtube_url:e.youtube_url,duration:e.video_duration||""};w(e=>({...e,videos:[t]}))}},X=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{const r=localStorage.getItem("userId")||"1";console.log(`\u30b3\u30fc\u30b9\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u4e2d: \u30b3\u30fc\u30b9ID ${e}, \u5229\u7528\u8005ID ${r} (\u8a66\u884c\u56de\u6570: ${t+1})`);const l=await fetch(`${ze.JR}/api/learning/progress/${r}/course/${e}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(l.ok){const e=await l.json();if(e.success){S(e.data),console.log("\u30b3\u30fc\u30b9\u30c7\u30fc\u30bf\u53d6\u5f97\u6210\u529f:",e.data);if(!(n?n.get("lesson"):null)&&!s&&e.data.lessons&&e.data.lessons.length>0){const t=e.data.lessons[0];a(t.id),console.log(`\u6700\u521d\u306e\u30ec\u30c3\u30b9\u30f3\u3092\u8a2d\u5b9a: ${t.id}`)}}else console.error("\u30b3\u30fc\u30b9\u30c7\u30fc\u30bf\u53d6\u5f97\u5931\u6557:",e.message)}else{const n=`\u30b3\u30fc\u30b9\u30c7\u30fc\u30bf\u53d6\u5f97\u5931\u6557: ${l.status}`;console.error(n);const s=await l.json().catch(()=>({}));if(console.error("\u30a8\u30e9\u30fc\u8a73\u7d30:",s),l.status>=500&&t<2)return console.log(`${t+1}\u56de\u76ee\u306e\u30ea\u30c8\u30e9\u30a4\u3092\u5b9f\u884c\u3057\u307e\u3059...`),void setTimeout(()=>{X(e,t+1)},2e3*(t+1))}}catch(E){if(console.error("\u30b3\u30fc\u30b9\u30c7\u30fc\u30bf\u53d6\u5f97\u30a8\u30e9\u30fc:",E),t<2&&("TypeError"===E.name||E.message.includes("Failed to fetch")))return console.log(`${t+1}\u56de\u76ee\u306e\u30ea\u30c8\u30e9\u30a4\u3092\u5b9f\u884c\u3057\u307e\u3059...`),void setTimeout(()=>{X(e,t+1)},2e3*(t+1))}},ee=()=>{if(null!==N&&void 0!==N&&N.s3_key&&null!==N&&void 0!==N&&N.id){const e=jc.getContext(N.id,N.s3_key);if(e)return console.log("AI\u30b5\u30dd\u30fc\u30c8\u7528\u306b\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u53d6\u5f97:",{contextLength:e.context.length}),e.context}return I>=0&&_&&_[I],d||m||(null===N||void 0===N?void 0:N.description)||"\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9\u304c\u5229\u7528\u3067\u304d\u307e\u305b\u3093"},te=N||{title:`\u7b2c${s}\u56de\u3000\u5b66\u7fd2\u5185\u5bb9`,description:"\u30ec\u30c3\u30b9\u30f3\u306e\u8aac\u660e\u304c\u8aad\u307f\u8fbc\u3081\u307e\u305b\u3093\u3067\u3057\u305f\u3002",videos:[]};return console.log("\ud83c\udfa8 \u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u6642\u306e\u72b6\u614b:",{currentLesson:s,lessonDataId:null===N||void 0===N?void 0:N.id,lessonDataTitle:null===N||void 0===N?void 0:N.title,lessonDataS3Key:null===N||void 0===N?void 0:N.s3_key,isDataConsistent:s===(null===N||void 0===N?void 0:N.id)}),P?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),(0,pt.jsx)("p",{className:"text-blue-600 text-xl font-semibold",children:"\u5b66\u7fd2\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]})}):E?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"text-red-600 text-xl font-semibold mb-4",children:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}),(0,pt.jsx)("p",{className:"text-gray-600 mb-4",children:E}),(0,pt.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"\u518d\u8aad\u307f\u8fbc\u307f"})]})}):(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50",children:[(0,pt.jsx)(ko,{lessonData:N,courseData:k,currentLesson:s,currentSection:I,sectionData:_,onSectionChange:e=>{if(!_||!Array.isArray(_))return;const t=_[e];if(t){if(T(e),t.video_id&&t.youtube_url){const e={id:t.video_id,title:t.video_title||"\u30bb\u30af\u30b7\u30e7\u30f3\u52d5\u753b",description:t.video_description||"",youtube_url:t.youtube_url,duration:t.video_duration||""};w(t=>({...t,videos:[e]}))}if(t.text_file_key&&t.text_file_key!==(null===N||void 0===N?void 0:N.s3_key)){console.log("\u30bb\u30af\u30b7\u30e7\u30f3\u5909\u66f4: \u65b0\u3057\u3044\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u691c\u51fa:",t.text_file_key);const e=t.text_file_key.split(".").pop().toLowerCase(),n="md"===e?"md":"txt"===e?"text/plain":"rtf"===e?"application/rtf":"pdf";w(e=>({...e,s3_key:t.text_file_key,file_type:n})),"pdf"===n?(M("processing"),O(!1),u(""),x("")):console.log("\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u305f\u3081\u3001\u65e2\u5b58\u306etextContent\u3092\u4fdd\u6301\u3057\u307e\u3059"),"pdf"===n&&null!==N&&void 0!==N&&N.id&&jc.clearLessonContext(N.id)}}},onUploadModalOpen:()=>j(!0),onTestNavigate:t=>e(`/student/test?lesson=${t}`),isTestEnabled:"completed"===R,hasAssignment:F.hasAssignment,assignmentSubmitted:F.assignmentSubmitted}),"processing"===R&&(0,pt.jsx)("div",{className:"w-full bg-blue-50 border-b border-blue-200 px-4 py-2",children:(0,pt.jsxs)("div",{className:"flex items-center justify-center text-blue-600 text-sm",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"PDF\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u5316\u3092\u51e6\u7406\u4e2d... AI\u30b5\u30dd\u30fc\u30c8\u6a5f\u80fd\u306f\u6e96\u5099\u5b8c\u4e86\u307e\u3067\u304a\u5f85\u3061\u304f\u3060\u3055\u3044"]})}),"error"===R&&(0,pt.jsx)("div",{className:"w-full bg-red-50 border-b border-red-200 px-4 py-2",children:(0,pt.jsxs)("div",{className:"flex items-center justify-center text-red-600 text-sm",children:[(0,pt.jsx)("span",{className:"mr-2",children:"\u26a0\ufe0f"}),"PDF\u30d5\u30a1\u30a4\u30eb\u306e\u51e6\u7406\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002AI\u30b5\u30dd\u30fc\u30c8\u6a5f\u80fd\u306f\u5229\u7528\u3067\u304d\u307e\u305b\u3093",(0,pt.jsx)("button",{onClick:()=>{M("idle"),"pdf"===(null===N||void 0===N?void 0:N.file_type)&&null!==N&&void 0!==N&&N.s3_key&&setTimeout(()=>{M("processing")},100)},className:"ml-3 px-2 py-1 bg-red-100 text-red-700 text-xs rounded hover:bg-red-200 transition-colors",children:"\u518d\u8a66\u884c"})]})}),"completed"===R&&(0,pt.jsx)("div",{className:"w-full bg-green-50 border-b border-green-200 px-4 py-2",children:(0,pt.jsxs)("div",{className:"flex items-center justify-center text-green-600 text-sm",children:[(0,pt.jsx)("span",{className:"mr-2",children:"\u2713"}),"PDF\u30d5\u30a1\u30a4\u30eb\u306e\u51e6\u7406\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002AI\u30b5\u30dd\u30fc\u30c8\u6a5f\u80fd\u304c\u5229\u7528\u53ef\u80fd\u3067\u3059"]})}),(0,pt.jsx)("div",{className:"w-full px-4 sm:px-6 lg:px-8 py-8",children:(0,pt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,pt.jsx)("div",{className:"lg:col-span-1",children:(0,pt.jsx)(_o,{lessonData:N})}),(0,pt.jsxs)("div",{className:"lg:col-span-1",children:[console.log("TextSection\u547c\u3073\u51fa\u3057\u524d - lessonData:",N),console.log("TextSection\u547c\u3073\u51fa\u3057\u524d - lessonData.file_type:",null===N||void 0===N?void 0:N.file_type),console.log("TextSection\u547c\u3073\u51fa\u3057\u524d - lessonData.s3_key:",null===N||void 0===N?void 0:N.s3_key),console.log("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u72b6\u614b:",jc.getStoredContexts()),(0,pt.jsx)(Nc,{lessonData:N,textContent:d,textLoading:g,textContainerRef:B,onTextContentUpdate:e=>{console.log("handlePdfTextUpdate \u547c\u3073\u51fa\u3057:",{textLength:null===e||void 0===e?void 0:e.length,isError:null===e||void 0===e?void 0:e.startsWith("\u30a8\u30e9\u30fc:"),isCancel:null===e||void 0===e?void 0:e.includes("\u30ad\u30e3\u30f3\u30bb\u30eb")}),e&&e.length>0?e.startsWith("\u30a8\u30e9\u30fc:")||e.includes("\u5931\u6557")||e.includes("\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8")?(M("error"),console.log("PDF\u51e6\u7406\u3067\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f:",e)):e.includes("\u30ad\u30e3\u30f3\u30bb\u30eb")?(M("idle"),console.log("PDF\u51e6\u7406\u304c\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u307e\u3057\u305f")):(O(!0),M("completed"),console.log("PDF\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u5b8c\u4e86:",{textLength:e.length})):(M("error"),console.log("PDF\u51e6\u7406\u3067\u7a7a\u306e\u30c6\u30ad\u30b9\u30c8\u304c\u8fd4\u3055\u308c\u307e\u3057\u305f"))}})]}),(0,pt.jsxs)("div",{className:"lg:col-span-1",children:[(0,pt.jsx)(kc,{chatMessages:l,chatInput:i,onChatInputChange:e=>c(e.target.value),onSendMessage:async()=>{if(i.trim()){var e;const t=i.trim(),n=Ic.validateQuestion(t);if(!n.isValid)return void alert(n.error);if("pdf"===(null===N||void 0===N?void 0:N.file_type)&&!m){if(!jc.hasContext(N.id,N.s3_key))return void alert("PDF\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u304c\u5b8c\u4e86\u3057\u3066\u3044\u307e\u305b\u3093\u3002\u3057\u3070\u3089\u304f\u304a\u5f85\u3061\u304f\u3060\u3055\u3044\u3002")}const r=ee();console.log("handleSendMessage - \u30c6\u30ad\u30b9\u30c8\u5185\u5bb9\u691c\u8a3c:",{question:t,currentSectionTextLength:r.length,currentSectionTextPreview:r.substring(0,100)+"...",textContentLength:(null===d||void 0===d?void 0:d.length)||0,pdfTextContentLength:(null===m||void 0===m?void 0:m.length)||0,lessonDescriptionLength:(null===N||void 0===N||null===(e=N.description)||void 0===e?void 0:e.length)||0});const a=Ic.validateContext(r);if(!a.isValid)return console.error("\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u691c\u8a3c\u30a8\u30e9\u30fc:",a),void("pdf"===(null===N||void 0===N?void 0:N.file_type)?alert("PDF\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u304c\u5b8c\u4e86\u3057\u3066\u3044\u306a\u3044\u304b\u3001\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9\u304c\u77ed\u3059\u304e\u307e\u3059\u3002\u3057\u3070\u3089\u304f\u304a\u5f85\u3061\u304f\u3060\u3055\u3044\u3002"):alert(`AI\u30a2\u30b7\u30b9\u30bf\u30f3\u30c8\u304c\u5229\u7528\u3067\u304d\u307e\u305b\u3093: ${a.error}`));const l={id:Date.now(),text:t,sender:"user",timestamp:(new Date).toLocaleTimeString()};o(e=>[...e,l]),c(""),$(!0);try{const e=await Ic.askQuestion(t,r,(null===N||void 0===N?void 0:N.title)||`\u30ec\u30c3\u30b9\u30f3${s}`);if(e.success){const t={id:Date.now()+1,text:e.answer,sender:"ai",timestamp:(new Date).toLocaleTimeString()};o(e=>[...e,t])}else{const t={id:Date.now()+1,text:e.fallbackAnswer,sender:"ai",timestamp:(new Date).toLocaleTimeString()};o(e=>[...e,t])}}catch(E){console.error("AI\u30a2\u30b7\u30b9\u30bf\u30f3\u30c8\u30a8\u30e9\u30fc:",E);const t={id:Date.now()+1,text:"AI\u30a2\u30b7\u30b9\u30bf\u30f3\u30c8\u306e\u5fdc\u7b54\u3092\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u3057\u3070\u3089\u304f\u6642\u9593\u3092\u304a\u3044\u3066\u518d\u5ea6\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002",sender:"ai",timestamp:(new Date).toLocaleTimeString()};o(e=>[...e,t])}finally{$(!1)}}},currentLessonData:te,currentSectionText:ee(),isAILoading:A,isAIEnabled:"completed"===R||"pdf"===(null===N||void 0===N?void 0:N.file_type)&&jc.hasContext(N.id,N.s3_key)||"txt"===(null===N||void 0===N?void 0:N.file_type)&&jc.hasContext(N.id,N.s3_key)||"md"===(null===N||void 0===N?void 0:N.file_type)&&jc.hasContext(N.id,N.s3_key)||"application/rtf"===(null===N||void 0===N?void 0:N.file_type)&&jc.hasContext(N.id,N.s3_key)||"pdf"!==(null===N||void 0===N?void 0:N.file_type)&&(null===N||void 0===N?void 0:N.textContent)}),F.hasAssignment&&(0,pt.jsx)(Sc,{uploadedFiles:b,onFileDelete:async e=>{try{console.log(`\ud83d\uddd1\ufe0f \u30d5\u30a1\u30a4\u30eb\u524a\u9664\u958b\u59cb: \u30d5\u30a1\u30a4\u30ebID ${e}, \u30ec\u30c3\u30b9\u30f3ID ${s}`);const t=await fetch(`${ze.JR}/api/learning/lesson/${s}/uploaded-files/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(t.ok){const n=await t.json();console.log("\u30d5\u30a1\u30a4\u30eb\u524a\u9664\u6210\u529f:",n),y(t=>t.filter(t=>t.id!==e)),n.data&&n.data.assignmentStatusReset&&(console.log("\u8ab2\u984c\u63d0\u51fa\u72b6\u6cc1\u304c\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u307e\u3057\u305f\u3002\u518d\u53d6\u5f97\u3057\u307e\u3059\u3002"),await K(s)),console.log("\u2705 \u30d5\u30a1\u30a4\u30eb\u524a\u9664\u5b8c\u4e86")}else{const e=await t.json().catch(()=>({}));console.error("\u30d5\u30a1\u30a4\u30eb\u524a\u9664API\u30a8\u30e9\u30fc:",{status:t.status,error:e.message}),alert("\u30d5\u30a1\u30a4\u30eb\u306e\u524a\u9664\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(e.message||"\u4e0d\u660e\u306a\u30a8\u30e9\u30fc"))}}catch(E){console.error("\u30d5\u30a1\u30a4\u30eb\u524a\u9664\u30a8\u30e9\u30fc:",E),alert("\u30d5\u30a1\u30a4\u30eb\u306e\u524a\u9664\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}}})]})]})}),F.hasAssignment&&(0,pt.jsx)(_c,{isOpen:v,onClose:()=>j(!1),onFileUpload:async e=>{const t=Array.from(e.target.files).filter(e=>e.type.includes("zip")||e.name.toLowerCase().endsWith(".zip"));if(0!==t.length)try{const e=new FormData;e.append("file",t[0]),e.append("lessonId",s);const n=await fetch(`${ze.JR}/api/learning/upload-assignment`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`},body:e});if(n.ok){const e=await n.json();if(e.success){const t={id:Date.now()+Math.random(),name:e.data.fileName,type:"application/zip",uploadDate:(new Date).toLocaleString(),status:"uploaded",s3Key:e.data.s3Key};y(e=>[...e,t]),j(!1),U(e=>({...e,assignmentSubmitted:!0})),alert("\u6210\u679c\u7269\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\uff01"),setTimeout(()=>{K(),Q()},500)}else alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+e.message)}else{const e=await n.json().catch(()=>({}));alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+(e.message||"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"))}}catch(E){console.error("\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30a8\u30e9\u30fc:",E),alert("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f: "+E.message)}else alert("ZIP\u30d5\u30a1\u30a4\u30eb\u306e\u307f\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u53ef\u80fd\u3067\u3059")}})]})},Pc=()=>{const e=ne(),[t]=De(),[n,s]=(0,r.useState)(1),[a,l]=(0,r.useState)(null),[o,i]=(0,r.useState)({}),[c,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(null),[x,g]=(0,r.useState)(!0),[h,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{const e=t.get("lesson");if(e){const t=parseInt(e);t>=1&&s(t)}},[t]),(0,r.useEffect)(()=>{n&&(async()=>{try{g(!0),p(null);const e=n,t=await fetch(`${ze.JR}/api/learning/lesson/${e}/content`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!t.ok)throw new Error("\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f");const s=await t.json();if(!s.success)throw new Error(s.message||"\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f");m(s.data),f(s.data)}catch(h){console.error("\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u53d6\u5f97\u30a8\u30e9\u30fc:",h),p(h.message),m({title:`\u7b2c${n}\u56de\u3000\u5b66\u7fd2\u5185\u5bb9`,description:"\u30ec\u30c3\u30b9\u30f3\u306e\u8aac\u660e\u304c\u8aad\u307f\u8fbc\u3081\u307e\u305b\u3093\u3067\u3057\u305f\u3002"}),b()}finally{g(!1)}})()},[n]);const f=e=>{const t={title:`${e.title} - \u7406\u89e3\u5ea6\u30c6\u30b9\u30c8`,description:`${e.description}\u306b\u3064\u3044\u3066\u306e\u7406\u89e3\u5ea6\u3092\u78ba\u8a8d\u3059\u308b\u30c6\u30b9\u30c8\u3067\u3059\u3002`,questions:[{id:1,question:`${e.title}\u306e\u4e3b\u8981\u306a\u30dd\u30a4\u30f3\u30c8\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3044\u3002`,placeholder:"\u5b66\u7fd2\u3057\u305f\u5185\u5bb9\u306e\u8981\u70b9\u3092\u307e\u3068\u3081\u3066\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3044..."},{id:2,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u3067\u5b66\u3093\u3060\u5185\u5bb9\u3092\u5b9f\u969b\u306e\u696d\u52d9\u306b\u3069\u306e\u3088\u3046\u306b\u6d3b\u304b\u305b\u307e\u3059\u304b\uff1f",placeholder:"\u5177\u4f53\u7684\u306a\u6d3b\u7528\u65b9\u6cd5\u3084\u5fdc\u7528\u4f8b\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3044..."},{id:3,question:"\u5b66\u7fd2\u4e2d\u306b\u7591\u554f\u306b\u601d\u3063\u305f\u70b9\u3084\u3001\u3055\u3089\u306b\u6df1\u304f\u5b66\u3073\u305f\u3044\u5185\u5bb9\u306f\u3042\u308a\u307e\u3059\u304b\uff1f",placeholder:"\u7591\u554f\u70b9\u3084\u8208\u5473\u306e\u3042\u308b\u5185\u5bb9\u306b\u3064\u3044\u3066\u8ff0\u3079\u3066\u304f\u3060\u3055\u3044..."}]};l(t)},b=()=>{l({title:`\u7b2c${n}\u56de\u3000\u7406\u89e3\u5ea6\u30c6\u30b9\u30c8`,description:"\u5b66\u7fd2\u5185\u5bb9\u306b\u3064\u3044\u3066\u306e\u7406\u89e3\u5ea6\u3092\u78ba\u8a8d\u3059\u308b\u30c6\u30b9\u30c8\u3067\u3059\u3002",questions:[{id:1,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u3067\u5b66\u3093\u3060\u5185\u5bb9\u306e\u8981\u70b9\u3092\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3044\u3002",placeholder:"\u5b66\u7fd2\u3057\u305f\u5185\u5bb9\u306e\u8981\u70b9\u3092\u307e\u3068\u3081\u3066\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3044..."},{id:2,question:"\u5b66\u7fd2\u3057\u305f\u5185\u5bb9\u3092\u5b9f\u969b\u306b\u3069\u306e\u3088\u3046\u306b\u6d3b\u7528\u3067\u304d\u307e\u3059\u304b\uff1f",placeholder:"\u5177\u4f53\u7684\u306a\u6d3b\u7528\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3044..."}]})},y=Object.keys(o).filter(e=>o[e]&&""!==o[e].trim()).length;return x?(0,pt.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600 mx-auto"}),(0,pt.jsx)("p",{className:"mt-4 text-gray-600",children:"\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]})}):h?(0,pt.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"text-red-600 text-6xl mb-4",children:"\u26a0\ufe0f"}),(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}),(0,pt.jsx)("p",{className:"text-gray-600 mb-4",children:h}),(0,pt.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700",children:"\u518d\u8aad\u307f\u8fbc\u307f"})]})}):a?(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50",children:[(0,pt.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-600 text-white shadow-lg",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg hover:bg-opacity-20 transition-all duration-200 font-medium",onClick:()=>e(-1),children:"\u2190 \u5b66\u7fd2\u753b\u9762\u306b\u623b\u308b"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h1",{className:"text-2xl font-bold",children:"\u5b66\u7fd2\u52b9\u679c\u30c6\u30b9\u30c8"}),(0,pt.jsxs)("span",{className:"text-blue-100 text-sm",children:[null===u||void 0===u?void 0:u.title," - ",null===u||void 0===u?void 0:u.description]})]})]}),(0,pt.jsxs)("div",{className:"text-right",children:[(0,pt.jsxs)("span",{className:"text-sm font-medium mb-2 block",children:["\u56de\u7b54\u6e08\u307f: ",y," / ",a.questions.length," \u554f"]}),(0,pt.jsx)("div",{className:"w-48 bg-white bg-opacity-20 rounded-full h-2",children:(0,pt.jsx)("div",{className:"bg-white h-2 rounded-full transition-all duration-300",style:{width:y/a.questions.length*100+"%"}})})]})]})})}),(0,pt.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 mb-8",children:[(0,pt.jsxs)("div",{className:"text-center mb-8",children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-4 whitespace-pre-line",children:a.title}),(0,pt.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-blue-800 mb-3",children:"\ud83d\udccb \u30c6\u30b9\u30c8\u306e\u6ce8\u610f\u4e8b\u9805"}),(0,pt.jsxs)("ul",{className:"text-left space-y-2 text-blue-700",children:[(0,pt.jsxs)("li",{className:"flex items-start gap-2",children:[(0,pt.jsx)("span",{className:"text-blue-500 mt-1",children:"\u2022"}),(0,pt.jsx)("span",{children:"\u5404\u554f\u984c\u306b\u3064\u3044\u3066\u3001\u3067\u304d\u308b\u3060\u3051\u8a73\u3057\u304f\u56de\u7b54\u3057\u3066\u304f\u3060\u3055\u3044"})]}),(0,pt.jsxs)("li",{className:"flex items-start gap-2",children:[(0,pt.jsx)("span",{className:"text-blue-500 mt-1",children:"\u2022"}),(0,pt.jsx)("span",{children:"\u5206\u304b\u3089\u306a\u3044\u5834\u5408\u306f\u300c\u5206\u304b\u308a\u307e\u305b\u3093\u300d\u3068\u8a18\u5165\u3057\u3066\u304f\u3060\u3055\u3044"})]}),(0,pt.jsxs)("li",{className:"flex items-start gap-2",children:[(0,pt.jsx)("span",{className:"text-blue-500 mt-1",children:"\u2022"}),(0,pt.jsx)("span",{children:"\u56de\u7b54\u306f\u81ea\u52d5\u4fdd\u5b58\u3055\u308c\u307e\u3059"})]}),(0,pt.jsxs)("li",{className:"flex items-start gap-2",children:[(0,pt.jsx)("span",{className:"text-blue-500 mt-1",children:"\u2022"}),(0,pt.jsx)("span",{children:"\u3059\u3079\u3066\u306e\u554f\u984c\u306b\u56de\u7b54\u3057\u3066\u304b\u3089\u300c\u56de\u7b54\u3092\u63d0\u51fa\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044"})]})]})]})]}),(0,pt.jsx)("div",{className:"space-y-8",children:a.questions.map((e,t)=>(0,pt.jsxs)("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-md transition-all duration-200",children:[(0,pt.jsxs)("div",{className:"flex items-start gap-4 mb-4",children:[(0,pt.jsx)("span",{className:"flex-shrink-0 w-8 h-8 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-full flex items-center justify-center font-bold text-sm",children:e.id}),(0,pt.jsx)("span",{className:"text-lg font-medium text-gray-800 leading-relaxed",children:e.question})]}),(0,pt.jsxs)("div",{className:"ml-12",children:[(0,pt.jsx)("textarea",{value:o[e.id]||"",onChange:t=>{return n=e.id,s=t.target.value,void i(e=>({...e,[n]:s}));var n,s},placeholder:e.placeholder,className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 resize-none",rows:"6"}),(0,pt.jsx)("div",{className:"mt-3 flex items-center gap-2",children:o[e.id]&&""!==o[e.id].trim()?(0,pt.jsxs)("span",{className:"flex items-center gap-2 text-green-600 font-medium",children:[(0,pt.jsx)("span",{className:"w-5 h-5 bg-green-100 rounded-full flex items-center justify-center text-sm",children:"\u2713"}),"\u56de\u7b54\u6e08\u307f"]}):(0,pt.jsxs)("span",{className:"flex items-center gap-2 text-gray-500",children:[(0,pt.jsx)("span",{className:"w-5 h-5 bg-gray-100 rounded-full flex items-center justify-center text-sm",children:"\u25cb"}),"\u672a\u56de\u7b54"]})})]})]},e.id))}),(0,pt.jsx)("div",{className:"mt-12 pt-8 border-t border-gray-200",children:(0,pt.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,pt.jsxs)("div",{className:"text-center sm:text-left",children:[(0,pt.jsxs)("p",{className:"text-lg font-medium text-gray-700",children:["\u56de\u7b54\u6e08\u307f: ",(0,pt.jsx)("span",{className:"text-blue-600 font-bold",children:y})," / ",a.questions.length," \u554f"]}),y<a.questions.length&&(0,pt.jsx)("p",{className:"text-orange-600 text-sm mt-1",children:"\u26a0\ufe0f \u3059\u3079\u3066\u306e\u554f\u984c\u306b\u56de\u7b54\u3057\u3066\u304b\u3089\u63d0\u51fa\u3057\u3066\u304f\u3060\u3055\u3044"})]}),(0,pt.jsx)("button",{className:"px-8 py-4 rounded-xl font-semibold text-lg transition-all duration-200 "+(y!==a.questions.length||c?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-blue-500 to-cyan-600 text-white hover:shadow-lg transform hover:-translate-y-0.5"),onClick:async()=>{d(!0);try{var t;const c=JSON.parse(localStorage.getItem("currentUser")||"{}"),d=c.user_id||c.id;if(!d)throw new Error("\u30e6\u30fc\u30b6\u30fcID\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002");console.log("TestPage \u30c6\u30b9\u30c8\u63d0\u51fa\u30c7\u30fc\u30bf:",{userId:d,currentLesson:n,hasAnswers:!!o,answersCount:Object.keys(o||{}).length,testDataQuestions:null===a||void 0===a||null===(t=a.questions)||void 0===t?void 0:t.length});const m=await fetch(`${ze.JR}/api/learning/test/submit`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify({userId:parseInt(d),lessonId:parseInt(n),testType:"essay",answers:o,testData:a,shuffledQuestions:[]})});if(!m.ok){let e=`\u30c6\u30b9\u30c8\u7d50\u679c\u306e\u63d0\u51fa\u306b\u5931\u6557\u3057\u307e\u3057\u305f (HTTP ${m.status})`;try{const t=await m.json();e+=`: ${t.message||t.error||"\u30b5\u30fc\u30d0\u30fc\u30a8\u30e9\u30fc"}`}catch(i){e+=": \u30b5\u30fc\u30d0\u30fc\u304b\u3089\u306e\u5fdc\u7b54\u3092\u89e3\u6790\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f"}throw new Error(e)}{const t=await m.json();if(!t.success)throw new Error(t.message||"\u30c6\u30b9\u30c8\u7d50\u679c\u306e\u63d0\u51fa\u306b\u5931\u6557\u3057\u307e\u3057\u305f");var s,r,l;e("/student/test-result",{state:{testType:"essay",lessonId:n,lessonNumber:n,lessonTitle:(null===u||void 0===u?void 0:u.title)||`\u7b2c${n}\u56de`,answers:o,testData:a,score:(null===(s=t.data)||void 0===s?void 0:s.score)||0,totalQuestions:a.questions.length,examResultId:null===(r=t.data)||void 0===r?void 0:r.examResultId,s3Key:null===(l=t.data)||void 0===l?void 0:l.s3Key}})}}catch(h){console.error("TestPage \u30c6\u30b9\u30c8\u63d0\u51fa\u30a8\u30e9\u30fc:",h),alert("\u30c6\u30b9\u30c8\u306e\u63d0\u51fa\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+h.message),d(!1)}},disabled:y<a.questions.length||c,children:c?(0,pt.jsxs)("div",{className:"flex items-center gap-3",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"\u63a1\u70b9\u4e2d..."]}):"\ud83d\udcdd \u56de\u7b54\u3092\u63d0\u51fa"})]})})]})})]}):(0,pt.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,pt.jsx)("div",{className:"text-center",children:(0,pt.jsx)("p",{className:"text-gray-600",children:"\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093"})})})},Lc=e=>{let{testData:t,onAnswerChange:n,onComplete:s,isSubmitting:a=!1}=e;const[l,o]=(0,r.useState)({}),[i,c]=(0,r.useState)(0),[d,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(t&&t.questions&&!d&&0===m.length){const e=t.questions.map(e=>{const t=[...e.options],n=e.correctAnswer,s=t[n];for(let a=t.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1));[t[a],t[e]]=[t[e],t[a]]}const r=t.findIndex(e=>e===s);return{...e,options:t,correctAnswer:r,originalCorrectAnswer:n}});x(e)}},[t,d,m.length]);const g=()=>{u(!0)},h=Object.keys(l).length,p=m[i];return t?d?(0,pt.jsxs)("div",{className:"max-w-6xl mx-auto p-6",children:[(0,pt.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-4 mb-6",children:(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:t.title}),(0,pt.jsxs)("p",{className:"text-sm text-gray-600",children:["\u554f\u984c ",i+1," / ",m.length]})]}),(0,pt.jsxs)("div",{className:"flex items-center gap-6",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"\u9032\u6357:"}),(0,pt.jsx)("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:(0,pt.jsx)("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:(i+1)/m.length*100+"%"}})}),(0,pt.jsxs)("span",{className:"text-sm text-gray-600",children:[Math.round((i+1)/m.length*100),"%"]})]}),(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("span",{className:"text-sm font-medium text-gray-600",children:"\u56de\u7b54\u6e08\u307f:"}),(0,pt.jsxs)("span",{className:"text-sm font-bold text-blue-600",children:[h,"/",m.length]})]})]})]})}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,pt.jsx)("div",{className:"lg:col-span-1",children:(0,pt.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-4 sticky top-4",children:[(0,pt.jsx)("h3",{className:"font-semibold text-gray-800 mb-4",children:"\u554f\u984c\u4e00\u89a7"}),(0,pt.jsx)("div",{className:"grid grid-cols-5 lg:grid-cols-2 gap-2",children:m.map((e,t)=>(0,pt.jsx)("button",{onClick:()=>(e=>{c(e)})(t),className:"w-10 h-10 rounded-lg text-sm font-medium transition-all duration-200 "+(t===i?"bg-blue-500 text-white":void 0!==l[m[t].id]?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:t+1},t))}),(0,pt.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,pt.jsx)("div",{className:"w-3 h-3 bg-blue-500 rounded"}),(0,pt.jsx)("span",{className:"text-gray-600",children:"\u73fe\u5728\u306e\u554f\u984c"})]}),(0,pt.jsxs)("div",{className:"flex items-center gap-2 text-sm mt-1",children:[(0,pt.jsx)("div",{className:"w-3 h-3 bg-green-100 rounded"}),(0,pt.jsx)("span",{className:"text-gray-600",children:"\u56de\u7b54\u6e08\u307f"})]}),(0,pt.jsxs)("div",{className:"flex items-center gap-2 text-sm mt-1",children:[(0,pt.jsx)("div",{className:"w-3 h-3 bg-gray-100 rounded"}),(0,pt.jsx)("span",{className:"text-gray-600",children:"\u672a\u56de\u7b54"})]})]})]})}),(0,pt.jsx)("div",{className:"lg:col-span-3",children:(0,pt.jsx)("div",{className:"bg-white rounded-xl shadow-lg p-8",children:p&&(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsxs)("div",{className:"mb-8",children:[(0,pt.jsxs)("div",{className:"flex items-start gap-4 mb-6",children:[(0,pt.jsx)("span",{className:"flex-shrink-0 w-10 h-10 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-full flex items-center justify-center font-bold",children:i+1}),(0,pt.jsx)("div",{className:"flex-1",children:(0,pt.jsx)("h3",{className:"text-lg font-semibold text-gray-800 leading-relaxed",children:p.question})})]}),(0,pt.jsx)("div",{className:"space-y-3 mb-6",children:p.options.map((e,t)=>{const s=l[p.id]===t;return(0,pt.jsxs)("button",{onClick:()=>((e,t)=>{const s={...l,[e]:t};o(s),n(s)})(p.id,t),className:"w-full flex items-center p-4 border-2 rounded-xl transition-all duration-200 hover:shadow-md "+(s?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-blue-300 hover:bg-blue-50"),children:[(0,pt.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center mr-4 font-bold transition-all duration-200 "+(s?"bg-blue-500 text-white":"bg-gray-100 text-gray-600"),children:t+1}),(0,pt.jsx)("span",{className:"flex-1 text-left font-medium transition-colors duration-200 "+(s?"text-blue-800":"text-gray-800"),children:e}),s&&(0,pt.jsx)("div",{className:"text-blue-500 text-xl",children:"\u2713"})]},t)})}),(0,pt.jsxs)("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-6",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsx)("label",{className:"text-lg font-semibold text-gray-700",children:"\u9078\u629e\u3055\u308c\u305f\u56de\u7b54:"}),(0,pt.jsx)("div",{className:"flex items-center gap-3",children:void 0!==l[p.id]?(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsx)("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center text-lg font-bold",children:l[p.id]+1}),(0,pt.jsx)("span",{className:"text-lg font-medium text-gray-800",children:p.options[l[p.id]]})]}):(0,pt.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[(0,pt.jsx)("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center text-lg font-bold",children:"?"}),(0,pt.jsx)("span",{className:"text-lg",children:"\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"})]})})]}),(0,pt.jsx)("div",{className:"mt-3 text-sm text-gray-600",children:"\ud83d\udca1 \u4e0a\u8a18\u306e\u9078\u629e\u80a2\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u56de\u7b54\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"})]})]}),(0,pt.jsxs)("div",{className:"flex items-center justify-between pt-6 border-t border-gray-200",children:[(0,pt.jsx)("button",{onClick:()=>{i>0&&c(i-1)},disabled:0===i,className:"px-6 py-3 rounded-lg font-medium transition-all duration-200 "+(0===i?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:"\u2190 \u524d\u306e\u554f\u984c"}),(0,pt.jsx)("div",{className:"flex items-center gap-4",children:i===m.length-1?(0,pt.jsx)("button",{onClick:()=>{const e=Object.keys(l).length;if(e<m.length){if(!window.confirm(`\u307e\u3060${m.length-e}\u554f\u304c\u672a\u56de\u7b54\u3067\u3059\u3002\n\u3053\u306e\u307e\u307e\u63d0\u51fa\u3057\u307e\u3059\u304b\uff1f`))return}s({answers:l,shuffledQuestions:m})},disabled:a,className:"px-8 py-3 rounded-lg font-semibold transition-all duration-200 "+(a?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-gradient-to-r from-green-500 to-green-600 text-white hover:shadow-lg transform hover:-translate-y-0.5"),children:a?(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"\u63d0\u51fa\u4e2d..."]}):"\ud83d\udcdd \u30c6\u30b9\u30c8\u3092\u63d0\u51fa"}):(0,pt.jsx)("button",{onClick:()=>{i<m.length-1&&c(i+1)},className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-lg font-medium hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200",children:"\u6b21\u306e\u554f\u984c \u2192"})})]})]})})})]})]}):(0,pt.jsx)("div",{className:"max-w-4xl mx-auto p-6",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[(0,pt.jsxs)("div",{className:"text-center mb-8",children:[(0,pt.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-4",children:t.title}),(0,pt.jsx)("p",{className:"text-lg text-gray-600 mb-6",children:t.description})]}),(0,pt.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-6 mb-8",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:"\ud83d\udccb \u30c6\u30b9\u30c8\u306e\u8a73\u7d30"}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-blue-700",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u554f\u984c\u6570:"}),(0,pt.jsxs)("span",{children:[t.questions.length,"\u554f"]})]}),(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("span",{className:"font-medium",children:"\u5f62\u5f0f:"}),(0,pt.jsx)("span",{children:"4\u629e\u554f\u984c\uff08\u30af\u30ea\u30c3\u30af\u9078\u629e\uff09"})]})]})]}),(0,pt.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-6 mb-8",children:[(0,pt.jsx)("h3",{className:"text-lg font-semibold text-yellow-800 mb-3",children:"\u26a0\ufe0f \u6ce8\u610f\u4e8b\u9805"}),(0,pt.jsxs)("ul",{className:"text-left space-y-2 text-yellow-700",children:[(0,pt.jsxs)("li",{className:"flex items-start gap-2",children:[(0,pt.jsx)("span",{className:"text-yellow-500 mt-1",children:"\u2022"}),(0,pt.jsx)("span",{children:"\u5404\u554f\u984c\u306e\u9078\u629e\u80a2\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u56de\u7b54\u3057\u3066\u304f\u3060\u3055\u3044"})]}),(0,pt.jsxs)("li",{className:"flex items-start gap-2",children:[(0,pt.jsx)("span",{className:"text-yellow-500 mt-1",children:"\u2022"}),(0,pt.jsx)("span",{children:"\u56de\u7b54\u306f\u81ea\u52d5\u4fdd\u5b58\u3055\u308c\u307e\u3059"})]}),(0,pt.jsxs)("li",{className:"flex items-start gap-2",children:[(0,pt.jsx)("span",{className:"text-yellow-500 mt-1",children:"\u2022"}),(0,pt.jsx)("span",{children:"\u4e0d\u5408\u683c\u306e\u5834\u5408\u306f\u518d\u53d7\u9a13\u53ef\u80fd\u3067\u3059"})]})]})]}),(0,pt.jsx)("div",{className:"text-center",children:(0,pt.jsx)("button",{onClick:g,className:"px-8 py-4 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-xl font-semibold text-lg hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200",children:"\ud83d\ude80 \u30c6\u30b9\u30c8\u3092\u958b\u59cb\u3059\u308b"})})]})}):(0,pt.jsx)("div",{className:"flex items-center justify-center min-h-64",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]})})},Ec=()=>{var e;const t=ne(),[n]=De(),[s,a]=(0,r.useState)(1),[l,o]=(0,r.useState)(0);console.log("SectionTestPage\u521d\u671f\u5316:",{url:window.location.href,search:window.location.search,lessonParam:n.get("lesson"),sectionParam:n.get("section"),allParams:Object.fromEntries(n.entries())});const[i,c]=(0,r.useState)(null),[d,u]=(0,r.useState)(!0),[m,x]=(0,r.useState)(null),[g,h]=(0,r.useState)(!1),[p,f]=(0,r.useState)(null),[b,y]=(0,r.useState)(null),[v,j]=(0,r.useState)(!1);(0,r.useEffect)(()=>{const e=n.get("lesson"),t=n.get("section");if(console.log("URL\u30d1\u30e9\u30e1\u30fc\u30bf\u53d6\u5f97:",{lessonParam:e,sectionParam:t,allParams:Object.fromEntries(n.entries())}),e){const t=parseInt(e);t>=1&&(console.log("\u30ec\u30c3\u30b9\u30f3\u756a\u53f7\u8a2d\u5b9a:",t),a(t))}else console.warn("\u30ec\u30c3\u30b9\u30f3\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u5024(1)\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002");if(t){const e=parseInt(t);e>=0&&(console.log("\u30bb\u30af\u30b7\u30e7\u30f3\u756a\u53f7\u8a2d\u5b9a:",e),o(e))}else console.warn("\u30bb\u30af\u30b7\u30e7\u30f3\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u5024(0)\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002")},[n]),(0,r.useEffect)(()=>{if(!s)return void console.log("\u30ec\u30c3\u30b9\u30f3\u756a\u53f7\u304c\u672a\u8a2d\u5b9a\u306e\u305f\u3081\u3001\u30c7\u30fc\u30bf\u53d6\u5f97\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");if(v)return void console.log("\u65e2\u306b\u30c7\u30fc\u30bf\u53d6\u5f97\u4e2d\u3067\u3059\u3002\u91cd\u8907\u5b9f\u884c\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059");if(i)return console.log("\u65e2\u306b\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3059\u308b\u305f\u3081\u3001\u518d\u751f\u6210\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059"),void u(!1);(async()=>{try{j(!0),u(!0),x(null),console.log("\u30c7\u30fc\u30bf\u53d6\u5f97\u958b\u59cb:",{currentLesson:s,currentSection:l,lessonData:p,sectionData:b});const e=await fetch(`${ze.JR}/api/learning/lesson/${s}/content`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!e.ok)throw new Error("\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f");const t=await e.json();t.success&&f(t.data);const n=await fetch(`${ze.JR}/api/lesson-text-video-links/lesson/${s}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(n.ok){const e=await n.json();e.success&&(y(e.data),e.data.length>0&&l>=e.data.length&&o(0))}await N()}catch(m){console.error("\u30c7\u30fc\u30bf\u53d6\u5f97\u30a8\u30e9\u30fc:",m),x(m.message),k()}finally{u(!1),j(!1)}})()},[s,l]);const N=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var t;console.log("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u76f4\u63a5\u30c6\u30b9\u30c8\u751f\u6210\u958b\u59cb:",{currentLesson:s,currentSection:l,forceRefresh:e});const g=`test_data_${s}_${l}`;if(e)console.log("\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\u3057\u3066\u65b0\u3057\u3044\u554f\u984c\u3092\u751f\u6210:",{key:g}),sessionStorage.removeItem(g);else{const e=sessionStorage.getItem(g);if(e){console.log("\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u30c6\u30b9\u30c8\u554f\u984c\u3092\u4f7f\u7528:",{key:g,dataLength:e.length});const t=JSON.parse(e);return c(t),void u(!1)}}const h=Object.keys(sessionStorage).filter(e=>e.startsWith("pdf_context_"));console.log("\u5229\u7528\u53ef\u80fd\u306a\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30ad\u30fc:",h);let f=null;if(f=h.find(e=>e.includes(`_${s}_${s}_`)),f&&console.log(`\u5b8c\u5168\u4e00\u81f4\u3067\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u767a\u898b: ${f}`),f||(f=h.find(e=>e.includes(`_${s}_`)),f&&console.log(`\u90e8\u5206\u4e00\u81f4\u3067\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u767a\u898b: ${f}`)),!f){console.log("\u30e1\u30bf\u30c7\u30fc\u30bf\u304b\u3089\u30ec\u30c3\u30b9\u30f3ID\u3092\u78ba\u8a8d\u4e2d...");for(const e of h)try{const t=sessionStorage.getItem(e);if(t){var n,r,a;const l=JSON.parse(t);if(console.log(`\u30ad\u30fc ${e} \u306e\u30e1\u30bf\u30c7\u30fc\u30bf:`,{lessonId:null===(n=l.metadata)||void 0===n?void 0:n.lessonId,lessonTitle:null===(r=l.metadata)||void 0===r?void 0:r.lessonTitle,fileType:null===(a=l.metadata)||void 0===a?void 0:a.fileType}),l.metadata&&l.metadata.lessonId===s){f=e,console.log(`\u30e1\u30bf\u30c7\u30fc\u30bf\u304b\u3089\u6b63\u78ba\u306a\u30ec\u30c3\u30b9\u30f3ID\u3067\u30de\u30c3\u30c1: ${e} (lessonId: ${l.metadata.lessonId})`);break}}}catch(m){console.warn(`\u30ad\u30fc ${e} \u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u89e3\u6790\u306b\u5931\u6557:`,m)}}if(f||(console.log("\u30ad\u30fc\u306e\u90e8\u5206\u6587\u5b57\u5217\u304b\u3089\u30ec\u30c3\u30b9\u30f3\u756a\u53f7\u3092\u62bd\u51fa\u4e2d..."),f=h.find(e=>{const t=e.split("_");if(t.length>=3){const n=parseInt(t[2]);return console.log(`\u30ad\u30fc ${e} \u304b\u3089\u62bd\u51fa\u3057\u305f\u30ec\u30c3\u30b9\u30f3ID: ${n}, \u691c\u7d22\u5bfe\u8c61: ${s}`),n===s}return!1}),f&&console.log(`\u90e8\u5206\u6587\u5b57\u5217\u30de\u30c3\u30c1\u3067\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u767a\u898b: ${f}`)),!f&&h.length>0&&(console.warn(`\u30ec\u30c3\u30b9\u30f3${s}\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u305f\u3081\u3001\u5229\u7528\u53ef\u80fd\u306a\u6700\u521d\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u4f7f\u7528\u3057\u307e\u3059`),f=h[0],console.log(`\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8: ${f}`)),!f){const e=[];for(const t of h)try{const n=sessionStorage.getItem(t);if(n){var o,i,d;const s=JSON.parse(n);e.push({key:t,lessonId:null===(o=s.metadata)||void 0===o?void 0:o.lessonId,lessonTitle:null===(i=s.metadata)||void 0===i?void 0:i.lessonTitle,fileType:null===(d=s.metadata)||void 0===d?void 0:d.fileType})}}catch(m){console.warn(`\u30ad\u30fc ${t} \u306e\u89e3\u6790\u306b\u5931\u6557:`,m)}if(console.warn(`\u30ec\u30c3\u30b9\u30f3${s}\u306b\u5bfe\u5fdc\u3059\u308b\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002\u5229\u7528\u53ef\u80fd\u306a\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8:`,e),1===s&&e.length>0)return console.log("\u30ec\u30c3\u30b9\u30f31\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u52d5\u7684\u306b\u751f\u6210\u3057\u307e\u3059..."),void await w(e);if(4===s&&e.length>0){console.log("\u30ec\u30c3\u30b9\u30f34\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u898b\u3064\u304b\u3089\u306a\u3044\u305f\u3081\u3001\u5229\u7528\u53ef\u80fd\u306a\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u4f7f\u7528\u3057\u307e\u3059...");const t=e[0];console.log("\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u4f7f\u7528:",t);const n=sessionStorage.getItem(t.key);if(n){var x;const e=JSON.parse(n),t=e.context,r=`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}`,a={type:"section",lessonId:s,sectionIndex:l,sectionTitle:r,sectionDescription:"\u30bb\u30af\u30b7\u30e7\u30f3\u306e\u8aac\u660e",textContent:t,fileType:(null===(x=e.metadata)||void 0===x?void 0:x.fileType)||"text/plain",fileName:`lesson_${s}_section_${l}_fallback`,questionCount:10};console.log("\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067API\u30ea\u30af\u30a8\u30b9\u30c8\u9001\u4fe1:",a);const o=await fetch(`${ze.JR}/api/test/learning/generate-test`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(o.ok){const e=await o.json();if(e.success){const t=`test_data_${s}_${l}`;return sessionStorage.setItem(t,JSON.stringify(e.data)),console.log("\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u30c6\u30b9\u30c8\u554f\u984c\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u4fdd\u5b58:",{key:t,dataLength:JSON.stringify(e.data).length}),void c(e.data)}}}}return console.warn("\u30e2\u30c3\u30af\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u3066\u30c6\u30b9\u30c8\u3092\u751f\u6210\u3057\u307e\u3059"),void k()}const b=sessionStorage.getItem(f);if(!b)return console.warn("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093"),void k();const y=JSON.parse(b),v=y.context;console.log("\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u53d6\u5f97:",{key:f,contextLength:(null===v||void 0===v?void 0:v.length)||0,metadata:y.metadata,searchLesson:s,foundLesson:null===(t=y.metadata)||void 0===t?void 0:t.lessonId});const j=`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}`,N="\u30bb\u30af\u30b7\u30e7\u30f3\u306e\u8aac\u660e";if(console.log("\u30c6\u30b9\u30c8\u751f\u6210\u7528\u30c7\u30fc\u30bf:",{sectionTitle:j,sectionDescription:N,textContentLength:(null===v||void 0===v?void 0:v.length)||0,textContentPreview:(null===v||void 0===v?void 0:v.substring(0,200))+"...",currentLesson:s,currentSection:l,sessionStorageKey:f}),!v||0===v.trim().length)return console.warn("\u26a0\ufe0f \u30c6\u30ad\u30b9\u30c8\u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u7a7a\u3067\u3059\u3002\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u7528\u306e\u30e2\u30c3\u30af\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002"),void k();const S={type:"section",lessonId:s,sectionIndex:l,sectionTitle:j,sectionDescription:N,textContent:v,fileType:(null===p||void 0===p?void 0:p.file_type)||"text/plain",fileName:(null===p||void 0===p?void 0:p.s3_key)||`lesson_${s}_section_${l}`,questionCount:10};console.log("API\u30ea\u30af\u30a8\u30b9\u30c8\u9001\u4fe1:",{url:`${ze.JR}/api/test/learning/generate-test`,body:S});const _=await fetch(`${ze.JR}/api/test/learning/generate-test`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify(S)});if(!_.ok)throw new Error("\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f");{const e=await _.json();if(!e.success)throw new Error(e.message||"\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f");sessionStorage.setItem(g,JSON.stringify(e.data)),console.log("\u30c6\u30b9\u30c8\u554f\u984c\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u4fdd\u5b58:",{key:g,dataLength:JSON.stringify(e.data).length}),c(e.data)}}catch(m){console.error("\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u751f\u6210\u30a8\u30e9\u30fc:",m),k()}},w=async e=>{try{console.log("\u30ec\u30c3\u30b9\u30f31\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u52d5\u7684\u306b\u751f\u6210\u958b\u59cb:",e);let t=e.find(e=>4===e.lessonId)||e[0];if(!t)return console.warn("\u5229\u7528\u53ef\u80fd\u306a\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u3042\u308a\u307e\u305b\u3093"),void k();console.log("\u9078\u629e\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8:",t);const n=sessionStorage.getItem(t.key);if(!n)return console.warn("\u9078\u629e\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093"),void k();const r=JSON.parse(n),a=`\u30ec\u30c3\u30b9\u30f31\u306e\u5b66\u7fd2\u5185\u5bb9:\n\n${r.context}`,o="pdf_context_1_1_lesson1_generated",i={context:a,metadata:{...r.metadata,lessonId:1,lessonTitle:"\u30ec\u30c3\u30b9\u30f31",fileType:"generated",generatedFrom:t.key,generatedAt:(new Date).toISOString()}};sessionStorage.setItem(o,JSON.stringify(i)),console.log("\u30ec\u30c3\u30b9\u30f31\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u751f\u6210\u3057\u3066\u4fdd\u5b58:",{key:o,contextLength:a.length,generatedFrom:t.key});const d=`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}`,u={type:"section",lessonId:s,sectionIndex:l,sectionTitle:d,sectionDescription:"\u30bb\u30af\u30b7\u30e7\u30f3\u306e\u8aac\u660e",textContent:a,fileType:"generated",fileName:`lesson_${s}_section_${l}_generated`,questionCount:10};console.log("\u751f\u6210\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067API\u30ea\u30af\u30a8\u30b9\u30c8\u9001\u4fe1:",{url:`${ze.JR}/api/test/learning/generate-test`,body:u});const m=await fetch(`${ze.JR}/api/test/learning/generate-test`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify(u)});if(!m.ok)throw new Error("\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f");{const e=await m.json();if(!e.success)throw new Error(e.message||"\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f");{const t=`test_data_${s}_${l}`;sessionStorage.setItem(t,JSON.stringify(e.data)),console.log("\u751f\u6210\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u30c6\u30b9\u30c8\u554f\u984c\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u4fdd\u5b58:",{key:t,dataLength:JSON.stringify(e.data).length}),c(e.data)}}}catch(m){console.error("\u30ec\u30c3\u30b9\u30f31\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u751f\u6210\u30a8\u30e9\u30fc:",m),k()}},k=()=>{const e=null===b||void 0===b?void 0:b[l],t=(null===e||void 0===e?void 0:e.section_title)||`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}`;c({title:`${t} - \u30bb\u30af\u30b7\u30e7\u30f3\u307e\u3068\u3081\u30c6\u30b9\u30c8`,description:`${t}\u306e\u5b66\u7fd2\u5185\u5bb9\u306b\u3064\u3044\u3066\u7406\u89e3\u5ea6\u3092\u78ba\u8a8d\u3059\u308b\u30c6\u30b9\u30c8\u3067\u3059\u3002`,type:"section",lessonId:s,sectionIndex:l,questionCount:10,passingScore:90,questions:[{id:1,question:`${t}\u306e\u4e3b\u8981\u306a\u30dd\u30a4\u30f3\u30c8\u306f\u4f55\u3067\u3059\u304b\uff1f`,options:["\u57fa\u672c\u7684\u306a\u6982\u5ff5\u306e\u7406\u89e3","\u5b9f\u8df5\u7684\u306a\u5fdc\u7528\u65b9\u6cd5","\u7406\u8ad6\u7684\u306a\u80cc\u666f","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:2,question:"\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u5b66\u3093\u3060\u5185\u5bb9\u3092\u5b9f\u969b\u306b\u6d3b\u7528\u3059\u308b\u969b\u306e\u6ce8\u610f\u70b9\u306f\uff1f",options:["\u7279\u306b\u6ce8\u610f\u70b9\u306f\u306a\u3044","\u57fa\u672c\u7684\u306a\u30eb\u30fc\u30eb\u3092\u5b88\u308b","\u5c02\u9580\u5bb6\u306e\u6307\u5c0e\u3092\u53d7\u3051\u308b","\u81ea\u5df1\u5224\u65ad\u3067\u9032\u3081\u308b"],correctAnswer:2},{id:3,question:"\u5b66\u7fd2\u5185\u5bb9\u306e\u7406\u89e3\u5ea6\u3092\u6df1\u3081\u308b\u305f\u3081\u306b\u91cd\u8981\u306a\u3053\u3068\u306f\uff1f",options:["\u6697\u8a18\u3059\u308b\u3053\u3068","\u5b9f\u8df5\u3059\u308b\u3053\u3068","\u7406\u8ad6\u3092\u5b66\u3076\u3053\u3068","\u4ed6\u4eba\u306b\u6559\u3048\u308b\u3053\u3068"],correctAnswer:1},{id:4,question:"\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u306e\u5185\u5bb9\u3092\u5fa9\u7fd2\u3059\u308b\u969b\u306e\u52b9\u679c\u7684\u306a\u65b9\u6cd5\u306f\uff1f",options:["\u4e00\u5ea6\u3060\u3051\u8aad\u3080","\u5b9a\u671f\u7684\u306b\u5fa9\u7fd2\u3059\u308b","\u6697\u8a18\u3059\u308b","\u4ed6\u4eba\u306b\u8aac\u660e\u3059\u308b"],correctAnswer:1},{id:5,question:"\u5b66\u7fd2\u3057\u305f\u5185\u5bb9\u3092\u5fdc\u7528\u3059\u308b\u969b\u306b\u8003\u616e\u3059\u3079\u304d\u70b9\u306f\uff1f",options:["\u7406\u8ad6\u7684\u306a\u6b63\u78ba\u6027","\u5b9f\u8df5\u7684\u306a\u52b9\u679c","\u6642\u9593\u7684\u306a\u52b9\u7387","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:6,question:"\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u6700\u3082\u91cd\u8981\u306a\u5b66\u7fd2\u76ee\u6a19\u306f\uff1f",options:["\u77e5\u8b58\u306e\u7fd2\u5f97","\u30b9\u30ad\u30eb\u306e\u5411\u4e0a","\u7406\u89e3\u306e\u6df1\u5316","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:7,question:"\u5b66\u7fd2\u5185\u5bb9\u3092\u4ed6\u8005\u306b\u8aac\u660e\u3059\u308b\u969b\u306e\u30dd\u30a4\u30f3\u30c8\u306f\uff1f",options:["\u5c02\u9580\u7528\u8a9e\u3092\u591a\u7528\u3059\u308b","\u5206\u304b\u308a\u3084\u3059\u3044\u8a00\u8449\u3067\u8aac\u660e\u3059\u308b","\u8a73\u7d30\u306b\u8aac\u660e\u3059\u308b","\u7c21\u6f54\u306b\u8aac\u660e\u3059\u308b"],correctAnswer:1},{id:8,question:"\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u306e\u5185\u5bb9\u3092\u5b9f\u8df5\u3059\u308b\u969b\u306e\u6e96\u5099\u3068\u3057\u3066\u5fc5\u8981\u306a\u3053\u3068\u306f\uff1f",options:["\u7406\u8ad6\u306e\u5b8c\u5168\u306a\u7406\u89e3","\u5b9f\u8df5\u7684\u306a\u6e96\u5099","\u5c02\u9580\u5bb6\u306e\u6307\u5c0e","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:9,question:"\u5b66\u7fd2\u3057\u305f\u5185\u5bb9\u306e\u52b9\u679c\u3092\u6e2c\u5b9a\u3059\u308b\u65b9\u6cd5\u306f\uff1f",options:["\u30c6\u30b9\u30c8\u306e\u70b9\u6570","\u5b9f\u8df5\u7684\u306a\u6210\u679c","\u7406\u89e3\u5ea6\u306e\u78ba\u8a8d","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:10,question:"\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u306e\u5b66\u7fd2\u3092\u5b8c\u4e86\u3057\u305f\u5f8c\u306e\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u306f\uff1f",options:["\u6b21\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u306b\u9032\u3080","\u5fa9\u7fd2\u3092\u7e70\u308a\u8fd4\u3059","\u5b9f\u8df5\u3092\u958b\u59cb\u3059\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3}]})};return d?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),(0,pt.jsx)("p",{className:"text-blue-600 text-xl font-semibold",children:"\u30bb\u30af\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u3092\u6e96\u5099\u4e2d..."})]})}):m?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"text-red-600 text-xl font-semibold mb-4",children:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}),(0,pt.jsx)("p",{className:"text-gray-600 mb-4",children:m}),(0,pt.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"\u518d\u8aad\u307f\u8fbc\u307f"})]})}):(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50",children:[(0,pt.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-600 text-white shadow-lg",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,pt.jsx)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg hover:bg-opacity-20 transition-all duration-200 font-medium",onClick:()=>t(-1),children:"\u2190 \u5b66\u7fd2\u753b\u9762\u306b\u623b\u308b"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h1",{className:"text-2xl font-bold",children:"\u30bb\u30af\u30b7\u30e7\u30f3\u307e\u3068\u3081\u30c6\u30b9\u30c8"}),(0,pt.jsxs)("span",{className:"text-blue-100 text-sm",children:[null===p||void 0===p?void 0:p.title," - ",(null===b||void 0===b||null===(e=b[l])||void 0===e?void 0:e.section_title)||`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}`]})]})]})})})}),(0,pt.jsx)("div",{className:"py-8",children:(0,pt.jsx)(Lc,{testData:i,onAnswerChange:e=>{console.log("\u56de\u7b54\u304c\u5909\u66f4\u3055\u308c\u307e\u3057\u305f:",e)},onComplete:async e=>{h(!0);try{var n,r;const m=JSON.parse(localStorage.getItem("currentUser")||"{}"),x=m.user_id||m.id;if(!x)throw new Error("\u30e6\u30fc\u30b6\u30fcID\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002");const g={userId:parseInt(x),lessonId:parseInt(s),testType:"section",sectionIndex:l,answers:e.answers,testData:i,shuffledQuestions:e.shuffledQuestions};console.log("=== SectionTestPage \u30c6\u30b9\u30c8\u63d0\u51fa\u30c7\u30fc\u30bf\uff08\u8a73\u7d30\uff09 ==="),console.log("\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3:",g),console.log("\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u30b5\u30a4\u30ba:",JSON.stringify(g).length,"bytes"),console.log("answers:",e.answers),console.log("testData.questions\u6570:",null===i||void 0===i||null===(n=i.questions)||void 0===n?void 0:n.length),console.log("shuffledQuestions\u6570:",null===(r=e.shuffledQuestions)||void 0===r?void 0:r.length),console.log("============================================");const h=await fetch(`${ze.JR}/api/learning/test/submit`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify(g)});if(!h.ok){let e=`\u30c6\u30b9\u30c8\u7d50\u679c\u306e\u63d0\u51fa\u306b\u5931\u6557\u3057\u307e\u3057\u305f (HTTP ${h.status})`,t=null;try{const n=await h.json();t=n,e+=`: ${n.message||n.error||"\u30b5\u30fc\u30d0\u30fc\u30a8\u30e9\u30fc"}`,console.error("=== \u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30a8\u30e9\u30fc\u8a73\u7d30 ==="),console.error("HTTP\u30b9\u30c6\u30fc\u30bf\u30b9:",h.status),console.error("\u30a8\u30e9\u30fc\u30ec\u30b9\u30dd\u30f3\u30b9:",n),console.error("===========================")}catch(u){const t=await h.text();e+=": \u30b5\u30fc\u30d0\u30fc\u304b\u3089\u306e\u5fdc\u7b54\u3092\u89e3\u6790\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f",console.error("=== \u30ec\u30b9\u30dd\u30f3\u30b9\u30c6\u30ad\u30b9\u30c8 ==="),console.error(t),console.error("========================")}throw new Error(e)}{const n=await h.json();if(!n.success)throw new Error(n.message||"\u30c6\u30b9\u30c8\u7d50\u679c\u306e\u63d0\u51fa\u306b\u5931\u6557\u3057\u307e\u3057\u305f");var a,o,c,d;t("/student/test-result",{state:{testType:"section",lessonId:s,sectionIndex:l,lessonTitle:(null===p||void 0===p?void 0:p.title)||`\u7b2c${s}\u56de`,sectionTitle:(null===b||void 0===b||null===(a=b[l])||void 0===a?void 0:a.section_title)||`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}`,answers:e.answers,testData:i,shuffledQuestions:e.shuffledQuestions,score:(null===(o=n.data)||void 0===o?void 0:o.score)||0,totalQuestions:i.questions.length,examResultId:null===(c=n.data)||void 0===c?void 0:c.examResultId,s3Key:null===(d=n.data)||void 0===d?void 0:d.s3Key}})}}catch(m){console.error("=== SectionTestPage \u30c6\u30b9\u30c8\u63d0\u51fa\u30a8\u30e9\u30fc ==="),console.error("\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8:",m.message),console.error("\u30a8\u30e9\u30fc\u30b9\u30bf\u30c3\u30af:",m.stack),console.error("====================================="),alert("\u30c6\u30b9\u30c8\u306e\u63d0\u51fa\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+m.message),h(!1)}},isSubmitting:g})})]})},Dc=()=>{const e=ne(),[t]=De(),[n,s]=(0,r.useState)(1),[a,l]=(0,r.useState)(null),[o,i]=(0,r.useState)(!0),[c,d]=(0,r.useState)(null),[u,m]=(0,r.useState)(!1),[x,g]=(0,r.useState)(null),[h,p]=(0,r.useState)(null);(0,r.useEffect)(()=>{const e=t.get("lesson");if(e){const t=parseInt(e);t>=1&&s(t)}},[t]),(0,r.useEffect)(()=>{n&&(async()=>{try{i(!0),d(null);const e=await fetch(`${ze.JR}/api/learning/lesson/${n}/content`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(!e.ok)throw new Error("\u30ec\u30c3\u30b9\u30f3\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f");const t=await e.json();t.success&&g(t.data);const s=await fetch(`${ze.JR}/api/lesson-text-video-links/lesson/${n}`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(s.ok){const e=await s.json();e.success&&p(e.data)}}catch(c){console.error("\u30c7\u30fc\u30bf\u53d6\u5f97\u30a8\u30e9\u30fc:",c),d(c.message),y(),i(!1)}})()},[n]),(0,r.useEffect)(()=>{h&&h.length>0&&x&&(console.log("\u30bb\u30af\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\u53d6\u5f97\u5b8c\u4e86\u3001\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u751f\u6210\u958b\u59cb:",{sectionCount:h.length,lessonTitle:x.title}),f())},[h,x,n]);const f=async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{const c=`test_data_lesson_${n}`;if(e)console.log("\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2\u3057\u3066\u65b0\u3057\u3044\u554f\u984c\u3092\u751f\u6210:",{key:c}),sessionStorage.removeItem(c);else{const e=sessionStorage.getItem(c);if(e){console.log("\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u30c6\u30b9\u30c8\u554f\u984c\u3092\u4f7f\u7528:",{key:c,dataLength:e.length});const t=JSON.parse(e);return l(t),void i(!1)}}console.log("\u30ec\u30c3\u30b9\u30f3\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9\u306e\u53d6\u5f97\u3092\u958b\u59cb...");const h=await b();if(!h||h.trim().length<50)throw new Error(`\u30c6\u30ad\u30b9\u30c8\u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059: \u9577\u3055=${(null===h||void 0===h?void 0:h.length)||0}`);const p=h.includes("AI")||h.includes("Google")||h.includes("\u691c\u7d22")||h.includes("\u97f3\u58f0")||h.includes("\u7ffb\u8a33")||h.includes("\u753b\u50cf")||h.includes("DALL")||h.includes("Perplexity")||h.includes("\u502b\u7406")||h.includes("\u30d0\u30a4\u30a2\u30b9")||h.includes("Windows")||h.includes("\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2")||h.includes("\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf")||h.includes("\u57fa\u672c\u64cd\u4f5c")||h.length>200;p||console.warn("\u30c6\u30ad\u30b9\u30c8\u30b3\u30f3\u30c6\u30f3\u30c4\u306b\u6709\u52b9\u306a\u5b66\u7fd2\u5185\u5bb9\u304c\u542b\u307e\u308c\u3066\u3044\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059:",{textContentPreview:h.substring(0,1e3),textContentLength:h.length}),console.log("\u30c6\u30ad\u30b9\u30c8\u30b3\u30f3\u30c6\u30f3\u30c4\u306e\u691c\u8a3c\u5b8c\u4e86:",{textContentLength:h.length,hasValidContent:p,textContentPreview:h.substring(0,500),textContentEnd:h.substring(h.length-500)});const f={type:"lesson",lessonId:n,lessonTitle:(null===x||void 0===x?void 0:x.title)||`\u7b2c${n}\u56de`,lessonDescription:(null===x||void 0===x?void 0:x.description)||"",textContent:h,fileType:(null===x||void 0===x?void 0:x.file_type)||"text/plain",fileName:(null===x||void 0===x?void 0:x.s3_key)||`lesson_${n}`,questionCount:30};console.log("\u30c6\u30b9\u30c8\u751f\u6210API\u30ea\u30af\u30a8\u30b9\u30c8\u9001\u4fe1:",{url:`${ze.JR}/api/test/learning/generate-test`,requestBody:{...f,textContentLength:(null===h||void 0===h?void 0:h.length)||0,textContentPreview:(null===h||void 0===h?void 0:h.substring(0,200))+"...",textContentEnd:h?h.substring(h.length-200):"null",textContentFull:h}});const y=await fetch(`${ze.JR}/api/test/learning/generate-test`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify(f)});if(!y.ok){const e=await y.text();throw console.error("API\u547c\u3073\u51fa\u3057\u5931\u6557:",{status:y.status,statusText:y.statusText,errorText:e}),new Error(`\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f: ${y.status} ${y.statusText}`)}{var t,s,r;const e=await y.json();var a,o,d,u,m,g;if(console.log("\u30c6\u30b9\u30c8\u751f\u6210API\u30ec\u30b9\u30dd\u30f3\u30b9:",{success:e.success,dataLength:e.data?JSON.stringify(e.data).length:0,dataPreview:e.data?JSON.stringify(e.data).substring(0,500)+"...":"null",firstQuestion:(null===(t=e.data)||void 0===t||null===(s=t.questions)||void 0===s||null===(r=s[0])||void 0===r?void 0:r.question)||"null"}),!(e.success&&e.data&&e.data.questions&&e.data.questions.length>0))throw console.warn("API\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u7121\u52b9\u3067\u3059:",{success:e.success,hasData:!!e.data,hasQuestions:!(null===(a=e.data)||void 0===a||!a.questions),questionCount:(null===(o=e.data)||void 0===o||null===(d=o.questions)||void 0===d?void 0:d.length)||0}),new Error(e.message||"\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f");sessionStorage.setItem(c,JSON.stringify(e.data)),console.log("\u30c6\u30b9\u30c8\u554f\u984c\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u4fdd\u5b58:",{key:c,dataLength:JSON.stringify(e.data).length,questionCount:(null===(u=e.data)||void 0===u||null===(m=u.questions)||void 0===m?void 0:m.length)||0,firstQuestion:(null===(g=e.data.questions[0])||void 0===g?void 0:g.question)||"null"}),l(e.data)}}catch(c){console.error("\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u751f\u6210\u30a8\u30e9\u30fc:",{error:c.message,stack:c.stack,currentLesson:n}),console.warn("\u30e2\u30c3\u30af\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u307e\u3059"),y()}finally{i(!1)}},b=async()=>{try{let s="";console.log("\u30ec\u30c3\u30b9\u30f3\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9\u53d6\u5f97\u958b\u59cb:",{lessonId:n,sectionCount:(null===h||void 0===h?void 0:h.length)||0,lessonTitle:null===x||void 0===x?void 0:x.title});const r=Object.keys(sessionStorage).filter(e=>e.startsWith("pdf_context_"));if(console.log("\u73fe\u5728\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30ad\u30fc:",r),r.forEach(e=>{try{var t,n,s,r;const a=JSON.parse(sessionStorage.getItem(e));console.log(`\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30ad\u30fc ${e}:`,{lessonId:null===(t=a.metadata)||void 0===t?void 0:t.lessonId,lessonTitle:null===(n=a.metadata)||void 0===n?void 0:n.lessonTitle,contextLength:(null===(s=a.context)||void 0===s?void 0:s.length)||0,contextPreview:(null===(r=a.context)||void 0===r?void 0:r.substring(0,100))+"..."})}catch(c){console.warn(`\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30ad\u30fc ${e} \u306e\u89e3\u6790\u306b\u5931\u6557:`,c)}}),null!==x&&void 0!==x&&x.description&&(s+=`# ${x.title||`\u7b2c${n}\u56de`}\n\n`,s+=x.description+"\n\n"),h&&h.length>0)for(let l=0;l<h.length;l++){const r=h[l];if(console.log(`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}\u306e\u30c6\u30ad\u30b9\u30c8\u53d6\u5f97\u958b\u59cb:`,{sectionTitle:r.section_title,textFileKey:r.text_file_key,hasTextFileKey:!!r.text_file_key}),r.text_file_key)try{let a=jc.getContext(n,r.text_file_key);if(a&&a.metadata&&a.metadata.lessonId!==n&&(console.warn(`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30ec\u30c3\u30b9\u30f3ID\u304c\u4e00\u81f4\u3057\u307e\u305b\u3093:`,{expectedLessonId:n,actualLessonId:a.metadata.lessonId,sectionTitle:r.section_title,textFileKey:r.text_file_key}),a=null),a&&a.context){const t=a.context.length,o=a.context.includes("AI")||a.context.includes("Google")||a.context.includes("\u691c\u7d22")||a.context.includes("\u97f3\u58f0")||a.context.includes("\u7ffb\u8a33")||a.context.includes("\u753b\u50cf")||a.context.includes("DALL")||a.context.includes("Perplexity")||a.context.includes("\u502b\u7406")||a.context.includes("\u30d0\u30a4\u30a2\u30b9")||a.context.includes("Windows")||a.context.includes("\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2")||a.context.includes("\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf")||a.context.includes("\u57fa\u672c\u64cd\u4f5c")||a.context.length>200;if(t>50&&o){var e;s+=`\n\n## \u30bb\u30af\u30b7\u30e7\u30f3${l+1}: ${r.section_title||"\u30bb\u30af\u30b7\u30e7\u30f3"}\n\n`,s+=a.context,console.log(`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u53d6\u5f97\u5b8c\u4e86:`,{contextLength:a.context.length,sectionTitle:r.section_title,lessonId:null===(e=a.metadata)||void 0===e?void 0:e.lessonId,expectedLessonId:n,hasValidContent:o});continue}console.warn(`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u7121\u52b9\u3067\u3059:`,{contextLength:t,hasValidContent:o,contextPreview:a.context.substring(0,200)}),a=null}console.log(`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u53d6\u5f97:`,{currentLesson:n,sectionTitle:r.section_title,note:"\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u306a\u3044\u305f\u3081\u3001\u30ec\u30c3\u30b9\u30f3\u30b3\u30f3\u30c6\u30f3\u30c4API\u3092\u4f7f\u7528"});const o=await fetch(`${ze.JR}/api/learning/lesson/${n}/content`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(o.ok){var t;const e=await o.json();if(e.success&&null!==(t=e.data)&&void 0!==t&&t.textContent){const t=e.data.textContent,a=t.length,o=t.includes("AI")||t.includes("Google")||t.includes("\u691c\u7d22")||t.includes("\u97f3\u58f0")||t.includes("\u7ffb\u8a33")||t.includes("\u753b\u50cf")||t.includes("DALL")||t.includes("Perplexity")||t.includes("\u502b\u7406")||t.includes("\u30d0\u30a4\u30a2\u30b9")||t.includes("Windows")||t.includes("\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2")||t.includes("\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf")||t.includes("\u57fa\u672c\u64cd\u4f5c")||t.length>200;if(a>50&&o){s+=`\n\n## \u30bb\u30af\u30b7\u30e7\u30f3${l+1}: ${r.section_title||"\u30bb\u30af\u30b7\u30e7\u30f3"}\n\n`,s+=t;const e=jc.saveContext(n,`lesson_${n}_content`,t,{fileType:"lesson_content",lessonTitle:null===x||void 0===x?void 0:x.title,sectionTitle:r.section_title,source:"lesson_content_api"});e&&console.log(`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30c8\u30ec\u30fc\u30b8\u306b\u4fdd\u5b58\u5b8c\u4e86`),console.log(`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}\u306e\u30ec\u30c3\u30b9\u30f3\u30b3\u30f3\u30c6\u30f3\u30c4\u53d6\u5f97\u5b8c\u4e86:`,{textLength:t.length,sectionTitle:r.section_title,savedToSessionStorage:e,hasValidContent:o})}else console.warn(`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}\u306e\u30ec\u30c3\u30b9\u30f3\u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u7121\u52b9\u3067\u3059:`,{textLength:a,hasValidContent:o,textPreview:t.substring(0,200)})}else console.warn(`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}\u306e\u30ec\u30c3\u30b9\u30f3\u30b3\u30f3\u30c6\u30f3\u30c4\u53d6\u5f97\u7d50\u679c\u304c\u7a7a:`,e)}else console.warn(`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}\u306e\u30ec\u30c3\u30b9\u30f3\u30b3\u30f3\u30c6\u30f3\u30c4API\u5931\u6557:`,{status:o.status,statusText:o.statusText,sectionTitle:r.section_title})}catch(c){console.error(`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}\u306e\u30ec\u30c3\u30b9\u30f3\u30b3\u30f3\u30c6\u30f3\u30c4\u53d6\u5f97\u30a8\u30e9\u30fc:`,{error:c.message,sectionTitle:r.section_title,currentLesson:n})}else console.warn(`\u30bb\u30af\u30b7\u30e7\u30f3${l+1}\u306btext_file_key\u304c\u3042\u308a\u307e\u305b\u3093:`,{sectionTitle:r.section_title,section:r})}else console.warn("\u30bb\u30af\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093:",{sectionData:h,currentLesson:n});s.length;const a=s.includes("AI")||s.includes("Google")||s.includes("\u691c\u7d22")||s.includes("\u97f3\u58f0")||s.includes("\u7ffb\u8a33")||s.includes("\u753b\u50cf")||s.includes("DALL")||s.includes("Perplexity")||s.includes("\u502b\u7406")||s.includes("\u30d0\u30a4\u30a2\u30b9")||s.includes("Windows")||s.includes("\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2")||s.includes("\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf")||s.includes("\u57fa\u672c\u64cd\u4f5c")||s.length>200;return console.log("\u30ec\u30c3\u30b9\u30f3\u5168\u4f53\u306e\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9\u53d6\u5f97\u5b8c\u4e86:",{totalLength:s.length,sectionCount:(null===h||void 0===h?void 0:h.length)||0,hasValidFinalContent:a,textPreview:s.substring(0,500),textEnd:s.substring(s.length-500),hasContent:s.length>0,contentPreview:s.substring(0,200)+"...",currentLesson:n,lessonTitle:null===x||void 0===x?void 0:x.title}),s}catch(c){return console.error("\u30ec\u30c3\u30b9\u30f3\u30c6\u30ad\u30b9\u30c8\u5185\u5bb9\u53d6\u5f97\u30a8\u30e9\u30fc:",c),""}},y=()=>{const e=(null===x||void 0===x?void 0:x.title)||`\u7b2c${n}\u56de`;l({title:`${e} - \u30ec\u30c3\u30b9\u30f3\u307e\u3068\u3081\u30c6\u30b9\u30c8`,description:`${e}\u306e\u5168\u30bb\u30af\u30b7\u30e7\u30f3\u306e\u5b66\u7fd2\u5185\u5bb9\u306b\u3064\u3044\u3066\u7406\u89e3\u5ea6\u3092\u78ba\u8a8d\u3059\u308b\u30c6\u30b9\u30c8\u3067\u3059\u3002`,type:"lesson",lessonId:n,questionCount:30,passingScore:90,questions:[{id:1,question:`${e}\u306e\u5b66\u7fd2\u76ee\u6a19\u306f\u4f55\u3067\u3059\u304b\uff1f`,options:["\u57fa\u672c\u7684\u306a\u77e5\u8b58\u306e\u7fd2\u5f97","\u5b9f\u8df5\u7684\u306a\u30b9\u30ad\u30eb\u306e\u5411\u4e0a","\u7406\u8ad6\u7684\u306a\u7406\u89e3\u306e\u6df1\u5316","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:2,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u3067\u6700\u3082\u91cd\u8981\u306a\u5b66\u7fd2\u30dd\u30a4\u30f3\u30c8\u306f\uff1f",options:["\u7406\u8ad6\u306e\u7406\u89e3","\u5b9f\u8df5\u306e\u7fd2\u5f97","\u5fdc\u7528\u529b\u306e\u5411\u4e0a","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:3,question:"\u5b66\u7fd2\u5185\u5bb9\u3092\u5b9f\u969b\u306e\u696d\u52d9\u306b\u6d3b\u7528\u3059\u308b\u969b\u306e\u6ce8\u610f\u70b9\u306f\uff1f",options:["\u57fa\u672c\u7684\u306a\u30eb\u30fc\u30eb\u3092\u5b88\u308b","\u5c02\u9580\u5bb6\u306e\u6307\u5c0e\u3092\u53d7\u3051\u308b","\u6bb5\u968e\u7684\u306b\u5b9f\u8df5\u3059\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:4,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u306e\u5185\u5bb9\u3092\u5fa9\u7fd2\u3059\u308b\u52b9\u679c\u7684\u306a\u65b9\u6cd5\u306f\uff1f",options:["\u4e00\u5ea6\u3060\u3051\u8aad\u3080","\u5b9a\u671f\u7684\u306b\u5fa9\u7fd2\u3059\u308b","\u5b9f\u8df5\u3068\u7d44\u307f\u5408\u308f\u305b\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:5,question:"\u5b66\u7fd2\u3057\u305f\u5185\u5bb9\u306e\u7406\u89e3\u5ea6\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\u306f\uff1f",options:["\u30c6\u30b9\u30c8\u3092\u53d7\u3051\u308b","\u5b9f\u8df5\u3067\u78ba\u8a8d\u3059\u308b","\u4ed6\u4eba\u306b\u8aac\u660e\u3059\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:6,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u3067\u5b66\u3093\u3060\u5185\u5bb9\u3092\u4ed6\u8005\u306b\u6559\u3048\u308b\u969b\u306e\u30dd\u30a4\u30f3\u30c8\u306f\uff1f",options:["\u5c02\u9580\u7528\u8a9e\u3092\u591a\u7528\u3059\u308b","\u5206\u304b\u308a\u3084\u3059\u3044\u8a00\u8449\u3067\u8aac\u660e\u3059\u308b","\u5b9f\u4f8b\u3092\u4ea4\u3048\u3066\u8aac\u660e\u3059\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:7,question:"\u5b66\u7fd2\u5185\u5bb9\u3092\u5fdc\u7528\u3059\u308b\u969b\u306b\u8003\u616e\u3059\u3079\u304d\u70b9\u306f\uff1f",options:["\u7406\u8ad6\u7684\u306a\u6b63\u78ba\u6027","\u5b9f\u8df5\u7684\u306a\u52b9\u679c","\u6642\u9593\u7684\u306a\u52b9\u7387","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:8,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u306e\u5185\u5bb9\u3092\u5b9f\u8df5\u3059\u308b\u969b\u306e\u6e96\u5099\u3068\u3057\u3066\u5fc5\u8981\u306a\u3053\u3068\u306f\uff1f",options:["\u7406\u8ad6\u306e\u5b8c\u5168\u306a\u7406\u89e3","\u5b9f\u8df5\u7684\u306a\u6e96\u5099","\u5c02\u9580\u5bb6\u306e\u6307\u5c0e","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:9,question:"\u5b66\u7fd2\u3057\u305f\u5185\u5bb9\u306e\u52b9\u679c\u3092\u6e2c\u5b9a\u3059\u308b\u65b9\u6cd5\u306f\uff1f",options:["\u30c6\u30b9\u30c8\u306e\u70b9\u6570","\u5b9f\u8df5\u7684\u306a\u6210\u679c","\u7406\u89e3\u5ea6\u306e\u78ba\u8a8d","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:10,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u306e\u5b66\u7fd2\u3092\u5b8c\u4e86\u3057\u305f\u5f8c\u306e\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u306f\uff1f",options:["\u6b21\u306e\u30ec\u30c3\u30b9\u30f3\u306b\u9032\u3080","\u5fa9\u7fd2\u3092\u7e70\u308a\u8fd4\u3059","\u5b9f\u8df5\u3092\u958b\u59cb\u3059\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:11,question:"\u5b66\u7fd2\u5185\u5bb9\u306e\u7406\u89e3\u3092\u6df1\u3081\u308b\u305f\u3081\u306b\u91cd\u8981\u306a\u3053\u3068\u306f\uff1f",options:["\u6697\u8a18\u3059\u308b\u3053\u3068","\u5b9f\u8df5\u3059\u308b\u3053\u3068","\u7406\u8ad6\u3092\u5b66\u3076\u3053\u3068","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:12,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u3067\u5b66\u3093\u3060\u5185\u5bb9\u3092\u5b9f\u969b\u306b\u6d3b\u7528\u3059\u308b\u969b\u306e\u6ce8\u610f\u70b9\u306f\uff1f",options:["\u7279\u306b\u6ce8\u610f\u70b9\u306f\u306a\u3044","\u57fa\u672c\u7684\u306a\u30eb\u30fc\u30eb\u3092\u5b88\u308b","\u5c02\u9580\u5bb6\u306e\u6307\u5c0e\u3092\u53d7\u3051\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:13,question:"\u5b66\u7fd2\u3057\u305f\u5185\u5bb9\u306e\u52b9\u679c\u3092\u6700\u5927\u5316\u3059\u308b\u65b9\u6cd5\u306f\uff1f",options:["\u7406\u8ad6\u3092\u5b8c\u74a7\u306b\u7406\u89e3\u3059\u308b","\u5b9f\u8df5\u3092\u7e70\u308a\u8fd4\u3059","\u7d99\u7d9a\u7684\u306b\u5b66\u7fd2\u3059\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:14,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u306e\u5185\u5bb9\u3092\u5fa9\u7fd2\u3059\u308b\u969b\u306e\u52b9\u679c\u7684\u306a\u65b9\u6cd5\u306f\uff1f",options:["\u4e00\u5ea6\u3060\u3051\u8aad\u3080","\u5b9a\u671f\u7684\u306b\u5fa9\u7fd2\u3059\u308b","\u5b9f\u8df5\u3068\u7d44\u307f\u5408\u308f\u305b\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:15,question:"\u5b66\u7fd2\u3057\u305f\u5185\u5bb9\u306e\u7406\u89e3\u5ea6\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\u306f\uff1f",options:["\u30c6\u30b9\u30c8\u3092\u53d7\u3051\u308b","\u5b9f\u8df5\u3067\u78ba\u8a8d\u3059\u308b","\u4ed6\u4eba\u306b\u8aac\u660e\u3059\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:16,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u3067\u5b66\u3093\u3060\u5185\u5bb9\u3092\u4ed6\u8005\u306b\u6559\u3048\u308b\u969b\u306e\u30dd\u30a4\u30f3\u30c8\u306f\uff1f",options:["\u5c02\u9580\u7528\u8a9e\u3092\u591a\u7528\u3059\u308b","\u5206\u304b\u308a\u3084\u3059\u3044\u8a00\u8449\u3067\u8aac\u660e\u3059\u308b","\u5b9f\u4f8b\u3092\u4ea4\u3048\u3066\u8aac\u660e\u3059\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:17,question:"\u5b66\u7fd2\u5185\u5bb9\u3092\u5fdc\u7528\u3059\u308b\u969b\u306b\u8003\u616e\u3059\u3079\u304d\u70b9\u306f\uff1f",options:["\u7406\u8ad6\u7684\u306a\u6b63\u78ba\u6027","\u5b9f\u8df5\u7684\u306a\u52b9\u679c","\u6642\u9593\u7684\u306a\u52b9\u7387","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:18,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u306e\u5185\u5bb9\u3092\u5b9f\u8df5\u3059\u308b\u969b\u306e\u6e96\u5099\u3068\u3057\u3066\u5fc5\u8981\u306a\u3053\u3068\u306f\uff1f",options:["\u7406\u8ad6\u306e\u5b8c\u5168\u306a\u7406\u89e3","\u5b9f\u8df5\u7684\u306a\u6e96\u5099","\u5c02\u9580\u5bb6\u306e\u6307\u5c0e","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:19,question:"\u5b66\u7fd2\u3057\u305f\u5185\u5bb9\u306e\u52b9\u679c\u3092\u6e2c\u5b9a\u3059\u308b\u65b9\u6cd5\u306f\uff1f",options:["\u30c6\u30b9\u30c8\u306e\u70b9\u6570","\u5b9f\u8df5\u7684\u306a\u6210\u679c","\u7406\u89e3\u5ea6\u306e\u78ba\u8a8d","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:20,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u306e\u5b66\u7fd2\u3092\u5b8c\u4e86\u3057\u305f\u5f8c\u306e\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u306f\uff1f",options:["\u6b21\u306e\u30ec\u30c3\u30b9\u30f3\u306b\u9032\u3080","\u5fa9\u7fd2\u3092\u7e70\u308a\u8fd4\u3059","\u5b9f\u8df5\u3092\u958b\u59cb\u3059\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:21,question:"\u5b66\u7fd2\u5185\u5bb9\u306e\u7406\u89e3\u3092\u6df1\u3081\u308b\u305f\u3081\u306b\u91cd\u8981\u306a\u3053\u3068\u306f\uff1f",options:["\u6697\u8a18\u3059\u308b\u3053\u3068","\u5b9f\u8df5\u3059\u308b\u3053\u3068","\u7406\u8ad6\u3092\u5b66\u3076\u3053\u3068","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:22,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u3067\u5b66\u3093\u3060\u5185\u5bb9\u3092\u5b9f\u969b\u306b\u6d3b\u7528\u3059\u308b\u969b\u306e\u6ce8\u610f\u70b9\u306f\uff1f",options:["\u7279\u306b\u6ce8\u610f\u70b9\u306f\u306a\u3044","\u57fa\u672c\u7684\u306a\u30eb\u30fc\u30eb\u3092\u5b88\u308b","\u5c02\u9580\u5bb6\u306e\u6307\u5c0e\u3092\u53d7\u3051\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:23,question:"\u5b66\u7fd2\u3057\u305f\u5185\u5bb9\u306e\u52b9\u679c\u3092\u6700\u5927\u5316\u3059\u308b\u65b9\u6cd5\u306f\uff1f",options:["\u7406\u8ad6\u3092\u5b8c\u74a7\u306b\u7406\u89e3\u3059\u308b","\u5b9f\u8df5\u3092\u7e70\u308a\u8fd4\u3059","\u7d99\u7d9a\u7684\u306b\u5b66\u7fd2\u3059\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:24,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u306e\u5185\u5bb9\u3092\u5fa9\u7fd2\u3059\u308b\u969b\u306e\u52b9\u679c\u7684\u306a\u65b9\u6cd5\u306f\uff1f",options:["\u4e00\u5ea6\u3060\u3051\u8aad\u3080","\u5b9a\u671f\u7684\u306b\u5fa9\u7fd2\u3059\u308b","\u5b9f\u8df5\u3068\u7d44\u307f\u5408\u308f\u305b\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:25,question:"\u5b66\u7fd2\u3057\u305f\u5185\u5bb9\u306e\u7406\u89e3\u5ea6\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\u306f\uff1f",options:["\u30c6\u30b9\u30c8\u3092\u53d7\u3051\u308b","\u5b9f\u8df5\u3067\u78ba\u8a8d\u3059\u308b","\u4ed6\u4eba\u306b\u8aac\u660e\u3059\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:26,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u3067\u5b66\u3093\u3060\u5185\u5bb9\u3092\u4ed6\u8005\u306b\u6559\u3048\u308b\u969b\u306e\u30dd\u30a4\u30f3\u30c8\u306f\uff1f",options:["\u5c02\u9580\u7528\u8a9e\u3092\u591a\u7528\u3059\u308b","\u5206\u304b\u308a\u3084\u3059\u3044\u8a00\u8449\u3067\u8aac\u660e\u3059\u308b","\u5b9f\u4f8b\u3092\u4ea4\u3048\u3066\u8aac\u660e\u3059\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:27,question:"\u5b66\u7fd2\u5185\u5bb9\u3092\u5fdc\u7528\u3059\u308b\u969b\u306b\u8003\u616e\u3059\u3079\u304d\u70b9\u306f\uff1f",options:["\u7406\u8ad6\u7684\u306a\u6b63\u78ba\u6027","\u5b9f\u8df5\u7684\u306a\u52b9\u679c","\u6642\u9593\u7684\u306a\u52b9\u7387","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:28,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u306e\u5185\u5bb9\u3092\u5b9f\u8df5\u3059\u308b\u969b\u306e\u6e96\u5099\u3068\u3057\u3066\u5fc5\u8981\u306a\u3053\u3068\u306f\uff1f",options:["\u7406\u8ad6\u306e\u5b8c\u5168\u306a\u7406\u89e3","\u5b9f\u8df5\u7684\u306a\u6e96\u5099","\u5c02\u9580\u5bb6\u306e\u6307\u5c0e","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:29,question:"\u5b66\u7fd2\u3057\u305f\u5185\u5bb9\u306e\u52b9\u679c\u3092\u6e2c\u5b9a\u3059\u308b\u65b9\u6cd5\u306f\uff1f",options:["\u30c6\u30b9\u30c8\u306e\u70b9\u6570","\u5b9f\u8df5\u7684\u306a\u6210\u679c","\u7406\u89e3\u5ea6\u306e\u78ba\u8a8d","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3},{id:30,question:"\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u306e\u5b66\u7fd2\u3092\u5b8c\u4e86\u3057\u305f\u5f8c\u306e\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u306f\uff1f",options:["\u6b21\u306e\u30ec\u30c3\u30b9\u30f3\u306b\u9032\u3080","\u5fa9\u7fd2\u3092\u7e70\u308a\u8fd4\u3059","\u5b9f\u8df5\u3092\u958b\u59cb\u3059\u308b","\u3059\u3079\u3066\u306e\u9078\u629e\u80a2\u304c\u6b63\u3057\u3044"],correctAnswer:3}]})};return o?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),(0,pt.jsx)("p",{className:"text-blue-600 text-xl font-semibold",children:"\u30ec\u30c3\u30b9\u30f3\u30c6\u30b9\u30c8\u3092\u6e96\u5099\u4e2d..."})]})}):c?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"text-red-600 text-xl font-semibold mb-4",children:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}),(0,pt.jsx)("p",{className:"text-gray-600 mb-4",children:c}),(0,pt.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"\u518d\u8aad\u307f\u8fbc\u307f"})]})}):(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50",children:[(0,pt.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-600 text-white shadow-lg",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,pt.jsx)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg hover:bg-opacity-20 transition-all duration-200 font-medium",onClick:()=>e(-1),children:"\u2190 \u5b66\u7fd2\u753b\u9762\u306b\u623b\u308b"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h1",{className:"text-2xl font-bold",children:"\u30ec\u30c3\u30b9\u30f3\u307e\u3068\u3081\u30c6\u30b9\u30c8"}),(0,pt.jsxs)("span",{className:"text-blue-100 text-sm",children:[null===x||void 0===x?void 0:x.title," - \u5168\u30bb\u30af\u30b7\u30e7\u30f3"]})]})]})})})}),(0,pt.jsx)("div",{className:"py-8",children:(0,pt.jsx)(Lc,{testData:a,onAnswerChange:e=>{console.log("\u56de\u7b54\u304c\u5909\u66f4\u3055\u308c\u307e\u3057\u305f:",e)},onComplete:async t=>{m(!0);try{const i=JSON.parse(localStorage.getItem("currentUser")||"{}"),c=i.user_id||i.id;if(!c)throw new Error("\u30e6\u30fc\u30b6\u30fcID\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002");const d=await fetch(`${ze.JR}/api/learning/test/submit`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify({userId:parseInt(c),lessonId:parseInt(n),testType:"lesson",answers:t.answers,testData:a,shuffledQuestions:t.shuffledQuestions})});if(!d.ok){let e=`\u30c6\u30b9\u30c8\u7d50\u679c\u306e\u63d0\u51fa\u306b\u5931\u6557\u3057\u307e\u3057\u305f (HTTP ${d.status})`;try{const t=await d.json();e+=`: ${t.message||t.error||"\u30b5\u30fc\u30d0\u30fc\u30a8\u30e9\u30fc"}`}catch(o){e+=": \u30b5\u30fc\u30d0\u30fc\u304b\u3089\u306e\u5fdc\u7b54\u3092\u89e3\u6790\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f"}throw new Error(e)}{const o=await d.json();if(!o.success)throw new Error(o.message||"\u30c6\u30b9\u30c8\u7d50\u679c\u306e\u63d0\u51fa\u306b\u5931\u6557\u3057\u307e\u3057\u305f");var s,r,l;e("/student/test-result",{state:{testType:"lesson",lessonId:n,lessonTitle:(null===x||void 0===x?void 0:x.title)||`\u7b2c${n}\u56de`,answers:t.answers,testData:a,score:(null===(s=o.data)||void 0===s?void 0:s.score)||0,totalQuestions:a.questions.length,examResultId:null===(r=o.data)||void 0===r?void 0:r.examResultId,s3Key:null===(l=o.data)||void 0===l?void 0:l.s3Key}})}}catch(c){console.error("\u30c6\u30b9\u30c8\u63d0\u51fa\u30a8\u30e9\u30fc:",c),alert("\u30c6\u30b9\u30c8\u306e\u63d0\u51fa\u306b\u5931\u6557\u3057\u307e\u3057\u305f: "+c.message),m(!1)}},isSubmitting:u})})]})},Ac=()=>{const e=ne(),t=ee(),[n,s]=(0,r.useState)(null),[a,l]=(0,r.useState)(0),[o,i]=(0,r.useState)(!0),[c,d]=(0,r.useState)(null),u=async(e,t,n)=>{try{const s=e.options[t],r=e.options[n],a=await fetch("http://localhost:5050/api/learning/generate-feedback",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify({question:e.question,userAnswer:s,correctAnswer:r,allOptions:e.options})});if(a.ok){const e=await a.json();if(e.success)return e.feedback}}catch(c){console.error("\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u751f\u6210\u30a8\u30e9\u30fc:",c)}const s=e.options[t],r=e.options[n],a=[`\u6b8b\u5ff5\u306a\u304c\u3089\u4e0d\u6b63\u89e3\u3067\u3057\u305f\u3002\u9078\u629e\u80a2\u300c${s}\u300d\u306f\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093\u3002\u6b63\u89e3\u306f\u300c${r}\u300d\u3067\u3059\u3002\n\n\u3053\u306e\u554f\u984c\u3067\u306f\u3001\u5b66\u7fd2\u5185\u5bb9\u306e\u91cd\u8981\u306a\u30dd\u30a4\u30f3\u30c8\u3092\u7406\u89e3\u3059\u308b\u3053\u3068\u304c\u6c42\u3081\u3089\u308c\u3066\u3044\u307e\u3059\u3002\u6b63\u3057\u3044\u7b54\u3048\u306e\u7406\u7531\u3092\u8003\u3048\u3066\u307f\u3066\u3001\u306a\u305c\u4ed6\u306e\u9078\u629e\u80a2\u304c\u9593\u9055\u3063\u3066\u3044\u308b\u306e\u304b\u3082\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u6b21\u56de\u306f\u5fc5\u305a\u6b63\u89e3\u3067\u304d\u308b\u3088\u3046\u3001\u5b66\u7fd2\u5185\u5bb9\u3092\u5fa9\u7fd2\u3057\u3066\u7406\u89e3\u3092\u6df1\u3081\u3066\u304f\u3060\u3055\u3044\u3002\u9811\u5f35\u308a\u307e\u3057\u3087\u3046\uff01`,`\u9593\u9055\u3048\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u306d\u3002\u3042\u306a\u305f\u306e\u56de\u7b54\u300c${s}\u300d\u306f\u6b63\u89e3\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u6b63\u3057\u3044\u7b54\u3048\u306f\u300c${r}\u300d\u3067\u3059\u3002\n\n\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u3001\u5b66\u7fd2\u3057\u305f\u5185\u5bb9\u306e\u7406\u89e3\u5ea6\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\u9593\u9055\u3044\u306f\u5b66\u7fd2\u306e\u6a5f\u4f1a\u3067\u3059\u3002\u6b63\u89e3\u306e\u7406\u7531\u3092\u3057\u3063\u304b\u308a\u3068\u7406\u89e3\u3057\u3001\u95a2\u9023\u3059\u308b\u77e5\u8b58\u3082\u4e00\u7dd2\u306b\u5fa9\u7fd2\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u7d99\u7d9a\u7684\u306a\u5b66\u7fd2\u3067\u5fc5\u305a\u30b9\u30ad\u30eb\u30a2\u30c3\u30d7\u3067\u304d\u307e\u3059\u3002\u5fdc\u63f4\u3057\u3066\u3044\u307e\u3059\uff01`,`\u6b63\u89e3\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u9078\u629e\u80a2\u300c${s}\u300d\u3067\u306f\u306a\u304f\u3001\u300c${r}\u300d\u304c\u6b63\u89e3\u3067\u3059\u3002\n\n\u3053\u306e\u554f\u984c\u306e\u30dd\u30a4\u30f3\u30c8\u3092\u518d\u5ea6\u78ba\u8a8d\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\u5b66\u7fd2\u5185\u5bb9\u306e\u3069\u306e\u90e8\u5206\u304c\u95a2\u9023\u3057\u3066\u3044\u308b\u304b\u3001\u306a\u305c\u305d\u306e\u7b54\u3048\u304c\u6b63\u3057\u3044\u306e\u304b\u3092\u8003\u3048\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u9593\u9055\u3044\u304b\u3089\u5b66\u3076\u3053\u3068\u3067\u3001\u3088\u308a\u6df1\u3044\u7406\u89e3\u304c\u5f97\u3089\u308c\u307e\u3059\u3002\u6b21\u56de\u306f\u6b63\u89e3\u3067\u304d\u308b\u3088\u3046\u3001\u9811\u5f35\u3063\u3066\u304f\u3060\u3055\u3044\uff01`,`\u4e0d\u6b63\u89e3\u3067\u3057\u305f\u3002\u3042\u306a\u305f\u306e\u9078\u629e\u300c${s}\u300d\u306f\u6b63\u3057\u304f\u3042\u308a\u307e\u305b\u3093\u3002\u6b63\u89e3\u306f\u300c${r}\u300d\u3067\u3059\u3002\n\n\u3053\u306e\u554f\u984c\u306f\u5b66\u7fd2\u5185\u5bb9\u306e\u91cd\u8981\u306a\u6982\u5ff5\u3092\u554f\u3046\u3066\u3044\u307e\u3059\u3002\u6b63\u3057\u3044\u7b54\u3048\u306e\u7406\u7531\u3092\u7406\u89e3\u3057\u3001\u306a\u305c\u4ed6\u306e\u9078\u629e\u80a2\u304c\u9069\u5207\u3067\u306a\u3044\u306e\u304b\u3082\u8003\u3048\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u5b66\u7fd2\u306f\u7d99\u7d9a\u304c\u5927\u5207\u3067\u3059\u3002\u3053\u306e\u7d4c\u9a13\u3092\u6d3b\u304b\u3057\u3066\u3001\u3088\u308a\u78ba\u5b9f\u306a\u77e5\u8b58\u3092\u8eab\u306b\u3064\u3051\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002`];return a[Math.floor(Math.random()*a.length)]};(0,r.useEffect)(()=>{(async()=>{if(t.state){if(t.state.testResult){const{testResult:e,lessonTitle:n,courseTitle:r}=t.state;console.log("TestResultPage: LessonList\u304b\u3089\u306e\u30c6\u30b9\u30c8\u7d50\u679c\u30c7\u30fc\u30bf:",e);const a={testType:e.testType||"lesson",lessonId:e.lessonId||0,sectionIndex:e.sectionIndex||null,lessonTitle:n||"\u30ec\u30c3\u30b9\u30f3\u540d\u4e0d\u660e",sectionTitle:e.sectionTitle||"",score:e.score||0,totalQuestions:e.totalQuestions||0,passed:e.passed||!1,percentage:e.totalQuestions>0?Math.round(e.score/e.totalQuestions*100):0,grade:e.passed?"\u5408\u683c":"\u4e0d\u5408\u683c",gradeEmoji:e.passed?"\ud83c\udf89":"\ud83d\udcd8",submittedAt:e.submittedAt||(new Date).toISOString(),testData:{questions:[]},answers:{},results:[]};return s(a),void i(!1)}const{testType:e,lessonId:n,sectionIndex:r,lessonTitle:a,sectionTitle:l,answers:o,testData:c,shuffledQuestions:m,score:x,totalQuestions:g,examResultId:h,s3Key:p}=t.state;if(!c||!c.questions)return console.error("TestResultPage: testData\u307e\u305f\u306ftestData.questions\u304c\u5b58\u5728\u3057\u307e\u305b\u3093:",{testData:c,location:t.state}),d("\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002"),void i(!1);const f=m&&m.length>0?m:c.questions,b=x||0,y=g||f.length,v=Math.round(b/y*100),j="lesson"===e?b>=29:b>=y-1,N={testType:e,lessonId:n,sectionIndex:r,lessonTitle:a,sectionTitle:l,testData:{...c,questions:f},answers:o,correctAnswers:b,totalQuestions:y,score:b,percentage:v,passed:j,grade:j?"\u5408\u683c":"\u4e0d\u5408\u683c",gradeEmoji:j?"\ud83c\udf89":"\ud83d\udcd8",examResultId:h,s3Key:p,results:[]};for(const t of f){const e=o[t.id],n=void 0!==e?`${e+1}. ${t.options[e]}`:"\u672a\u56de\u7b54",s=`${t.correctAnswer+1}. ${t.options[t.correctAnswer]}`,r=e===t.correctAnswer;let a="";a=r?"\u6b63\u89e3\u3067\u3059\uff01\u3088\u304f\u7406\u89e3\u3067\u304d\u3066\u3044\u307e\u3059\u3002":void 0!==e?await u(t,e,t.correctAnswer):"\u672a\u56de\u7b54\u3067\u3059\u3002\u5b66\u7fd2\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u518d\u53d7\u9a13\u3057\u3066\u304f\u3060\u3055\u3044\u3002",N.results.push({questionId:N.results.length+1,question:t.question,userAnswer:n,correctAnswer:s,feedback:a,isCorrect:r,score:r?1:0})}s(N),i(!1)}else e("/student/dashboard")})()},[t.state,e]),(0,r.useEffect)(()=>{if(n){const e=async()=>{try{var e,t,s;const r=n.lessonId||n.lessonNumber;if(n.examResultId)return void console.log("\u65e2\u306b\u30c6\u30b9\u30c8\u7d50\u679c\u304c\u4fdd\u5b58\u6e08\u307f\u306e\u305f\u3081\u3001\u518d\u63d0\u51fa\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059:",n.examResultId);console.log("TestResultPage\u518d\u63d0\u51fa\u30c7\u30fc\u30bf:",{lessonId:r,sectionIndex:n.sectionIndex,hasAnswers:!!n.answers,hasTestData:!!n.testData,hasShuffledQuestions:!!n.shuffledQuestions,answersCount:Object.keys(n.answers||{}).length,testDataQuestions:null===(e=n.testData)||void 0===e||null===(t=e.questions)||void 0===t?void 0:t.length,shuffledQuestionsLength:null===(s=n.shuffledQuestions)||void 0===s?void 0:s.length,examResultId:n.examResultId});(await fetch("/api/learning/test/submit",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"},body:JSON.stringify({lessonId:parseInt(r),sectionIndex:n.sectionIndex||0,testType:"section",answers:n.answers,testData:n.testData,shuffledQuestions:n.shuffledQuestions,score:n.score,totalQuestions:n.totalQuestions})})).ok&&console.log("\u30c6\u30b9\u30c8\u7d50\u679c\u304c\u4fdd\u5b58\u3055\u308c\u307e\u3057\u305f")}catch(c){console.error("\u30c6\u30b9\u30c8\u7d50\u679c\u4fdd\u5b58\u30a8\u30e9\u30fc:",c)}};e()}},[n]);const m=()=>{e("/student/dashboard")};return o?(0,pt.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-indigo-600 mx-auto"}),(0,pt.jsx)("p",{className:"mt-4 text-gray-600",children:"\u30c6\u30b9\u30c8\u7d50\u679c\u3092\u51e6\u7406\u4e2d..."})]})}):c?(0,pt.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"text-red-600 text-6xl mb-4",children:"\u26a0\ufe0f"}),(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}),(0,pt.jsx)("p",{className:"text-gray-600 mb-4",children:c}),(0,pt.jsx)("button",{onClick:()=>e("/student/dashboard"),className:"bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700",children:"\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u623b\u308b"})]})}):n?(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50",children:[(0,pt.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-600 text-white shadow-lg",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg hover:bg-opacity-20 transition-all duration-200 font-medium",onClick:m,children:"\u2190 \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u623b\u308b"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h1",{className:"text-2xl font-bold",children:"\u30c6\u30b9\u30c8\u7d50\u679c"}),(0,pt.jsxs)("span",{className:"text-blue-100 text-sm",children:[n.lessonTitle,n.sectionTitle&&` - ${n.sectionTitle}`]})]})]}),(0,pt.jsxs)("div",{className:"text-right",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,pt.jsx)("span",{className:"text-3xl",children:n.gradeEmoji}),(0,pt.jsx)("span",{className:"text-lg font-semibold",children:n.grade})]}),(0,pt.jsxs)("div",{className:"text-sm",children:["\u6b63\u7b54\u6570\uff1a",n.correctAnswers," / ",n.totalQuestions]})]})]})})}),(0,pt.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 mb-8",children:[(0,pt.jsxs)("div",{className:"text-center mb-8",children:[(0,pt.jsxs)("h2",{className:"text-2xl font-bold text-gray-800 mb-6",children:["\u51fa\u984c\u7bc4\u56f2\uff1a",n.lessonTitle,n.sectionTitle&&` - ${n.sectionTitle}`]}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,pt.jsxs)("div",{className:"bg-blue-50 rounded-xl p-6",children:[(0,pt.jsx)("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:n.correctAnswers}),(0,pt.jsx)("div",{className:"text-blue-800 font-medium",children:"\u6b63\u7b54\u6570"})]}),(0,pt.jsxs)("div",{className:"bg-gray-50 rounded-xl p-6",children:[(0,pt.jsx)("div",{className:"text-3xl font-bold text-gray-600 mb-2",children:n.totalQuestions}),(0,pt.jsx)("div",{className:"text-gray-800 font-medium",children:"\u7dcf\u554f\u984c\u6570"})]}),(0,pt.jsxs)("div",{className:"bg-cyan-50 rounded-xl p-6",children:[(0,pt.jsxs)("div",{className:"text-3xl font-bold text-cyan-600 mb-2",children:[Math.round(n.correctAnswers/n.totalQuestions*100),"%"]}),(0,pt.jsx)("div",{className:"text-cyan-800 font-medium",children:"\u6b63\u7b54\u7387"})]})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:"\u554f\u984c\u5225\u7d50\u679c"}),(0,pt.jsx)("div",{className:"flex flex-wrap gap-2 mb-8",children:n.results.map((e,t)=>(0,pt.jsxs)("button",{className:"px-4 py-2 rounded-lg font-medium transition-all duration-200 "+(a===t?"bg-gradient-to-r from-blue-500 to-cyan-600 text-white shadow-lg":e.isCorrect?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"),onClick:()=>l(t),children:["Q",t+1]},e.questionId))}),(0,pt.jsx)("div",{className:"border border-gray-200 rounded-xl p-6",children:n.results[a]&&(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("div",{className:"flex items-start gap-4 mb-6",children:[(0,pt.jsx)("span",{className:"flex-shrink-0 w-8 h-8 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-full flex items-center justify-center font-bold text-sm",children:a+1}),(0,pt.jsx)("span",{className:"text-lg font-medium text-gray-800 leading-relaxed",children:n.results[a].question})]}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[(0,pt.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:[(0,pt.jsx)("h4",{className:"font-semibold text-red-800 mb-3",children:"\u3042\u306a\u305f\u306e\u89e3\u7b54"}),(0,pt.jsx)("div",{className:"text-red-700 bg-white rounded-lg p-3 min-h-[100px]",children:n.results[a].userAnswer||"\u56de\u7b54\u304c\u3042\u308a\u307e\u305b\u3093"})]}),(0,pt.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4",children:[(0,pt.jsx)("h4",{className:"font-semibold text-green-800 mb-3",children:"\u6a21\u7bc4\u89e3\u7b54"}),(0,pt.jsx)("div",{className:"text-green-700 bg-white rounded-lg p-3 min-h-[100px]",children:n.results[a].correctAnswer})]})]}),(0,pt.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,pt.jsx)("span",{className:"text-yellow-600",children:"\ud83d\udca1"}),(0,pt.jsx)("h4",{className:"font-semibold text-yellow-800",children:"\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af"})]}),(0,pt.jsx)("p",{className:"text-yellow-700",children:n.results[a].feedback})]})]})})]})]}),(0,pt.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[!n.passed&&(0,pt.jsx)("button",{className:"px-8 py-4 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-xl font-semibold hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200",onClick:()=>{if("section"===n.testType){const t=`test_data_${n.lessonId}_${n.sectionIndex}`;sessionStorage.removeItem(t),console.log("\u518d\u8a66\u9a13: \u30bb\u30af\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2:",t),e(`/student/section-test?lesson=${n.lessonId}&section=${n.sectionIndex}`)}else{const t=`test_data_lesson_${n.lessonId}`;sessionStorage.removeItem(t),console.log("\u518d\u8a66\u9a13: \u30ec\u30c3\u30b9\u30f3\u30c6\u30b9\u30c8\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u30af\u30ea\u30a2:",t),e(`/student/lesson-test?lesson=${n.lessonId}`)}},children:"\ud83d\udd04 \u518d\u53d7\u9a13\u3059\u308b"}),n.passed&&"lesson"===n.testType&&(0,pt.jsx)("button",{className:"px-8 py-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200",onClick:()=>{if(n.passed){const t=JSON.parse(localStorage.getItem("currentUser")||"{}"),s=t.user_id||t.id;if(!s)return void alert("\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u304c\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002\u518d\u5ea6\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u304f\u3060\u3055\u3044\u3002");e("/student/certificate",{state:{userId:s,lessonId:n.lessonId,lessonTitle:n.lessonTitle,sectionTitle:n.sectionTitle,testType:n.testType,score:n.score,totalQuestions:n.totalQuestions,examResultId:n.examResultId}})}else alert("\u5408\u683c\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u4fee\u4e86\u8a3c\u306f\u767a\u884c\u3067\u304d\u307e\u305b\u3093\u3002\u518d\u53d7\u9a13\u3057\u3066\u304f\u3060\u3055\u3044\u3002")},children:"\ud83c\udfc6 \u4fee\u4e86\u8a3c\u3092\u78ba\u8a8d"}),(0,pt.jsx)("button",{className:"px-8 py-4 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-xl font-semibold hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200",onClick:m,children:"\ud83d\udcca \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u623b\u308b"})]})]})]}):(0,pt.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("p",{className:"text-gray-600",children:"\u30c6\u30b9\u30c8\u7d50\u679c\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093"}),(0,pt.jsx)("button",{onClick:()=>e("/student/dashboard"),className:"bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 mt-4",children:"\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u623b\u308b"})]})})},$c=()=>{const e=ne(),t=ee(),[n,s]=(0,r.useState)(null),[a,l]=(0,r.useState)(!1),[o,i]=(0,r.useState)(!0),[c,d]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{if(i(!0),d(null),t.state){const{userId:e,lessonId:n,examResultId:r}=t.state;if(!e||!n)throw new Error("\u5fc5\u8981\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059");const a=await async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return He(n?`/api/learning/certificate/${e}/${t}/${n}`:`/api/learning/certificate/${e}/${t}`)}(e,n,r);if(!a.success)throw new Error(a.message||"\u5408\u683c\u8a3c\u660e\u66f8\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f");s(a.data)}else e("/student/dashboard")}catch(c){console.error("\u5408\u683c\u8a3c\u660e\u66f8\u30c7\u30fc\u30bf\u53d6\u5f97\u30a8\u30e9\u30fc:",c),d(c.message||"\u5408\u683c\u8a3c\u660e\u66f8\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}finally{i(!1)}})()},[t.state,e]);const u=()=>{l(!0),setTimeout(()=>{Fn(n),l(!1)},100)},m=()=>{e("/student/dashboard")};return o?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,pt.jsx)("p",{className:"text-gray-700 text-lg",children:"\u8a3c\u660e\u66f8\u3092\u6e96\u5099\u4e2d..."})]})}):c?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center max-w-md",children:[(0,pt.jsx)("div",{className:"text-red-500 text-6xl mb-4",children:"\u26a0\ufe0f"}),(0,pt.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}),(0,pt.jsx)("p",{className:"text-gray-600 mb-6",children:c}),(0,pt.jsxs)("div",{className:"flex gap-3 justify-center",children:[(0,pt.jsx)("button",{className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",onClick:()=>e("/student/dashboard"),children:"\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u623b\u308b"}),(0,pt.jsx)("button",{className:"px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",onClick:()=>window.location.reload(),children:"\u518d\u8aad\u307f\u8fbc\u307f"})]})]})}):n?(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50",children:[(0,pt.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-600 text-white shadow-lg",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg hover:bg-opacity-20 transition-all duration-200 font-medium",onClick:()=>{e(-1)},children:"\u2190 \u7d50\u679c\u306b\u623b\u308b"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h1",{className:"text-2xl font-bold",children:"\u5408\u683c\u8a3c\u660e\u66f8"}),(0,pt.jsx)("span",{className:"text-blue-100 text-sm",children:n.lessonTitle})]})]}),(0,pt.jsxs)("div",{className:"flex gap-3",children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg hover:bg-opacity-20 transition-all duration-200 font-medium",onClick:u,disabled:a,children:a?"\u5370\u5237\u4e2d...":"\ud83d\udda8\ufe0f \u5370\u5237"}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg hover:bg-opacity-20 transition-all duration-200 font-medium",onClick:m,children:"\ud83c\udfe0 \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9"})]})]})})}),(0,pt.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl p-8 border-8 border-gradient-to-r from-blue-500 to-cyan-600 relative overflow-hidden",children:[(0,pt.jsxs)("div",{className:"absolute inset-0 pointer-events-none",children:[(0,pt.jsx)("div",{className:"absolute top-4 left-4 w-16 h-16 border-4 border-blue-200 rounded-full"}),(0,pt.jsx)("div",{className:"absolute top-4 right-4 w-16 h-16 border-4 border-cyan-200 rounded-full"}),(0,pt.jsx)("div",{className:"absolute bottom-4 left-4 w-16 h-16 border-4 border-blue-200 rounded-full"}),(0,pt.jsx)("div",{className:"absolute bottom-4 right-4 w-16 h-16 border-4 border-cyan-200 rounded-full"})]}),(0,pt.jsxs)("div",{className:"relative z-10",children:[(0,pt.jsx)("div",{className:"text-center mb-8",children:(0,pt.jsxs)("div",{className:"flex items-center justify-center gap-6 mb-6",children:[(0,pt.jsx)("div",{className:"w-20 h-20 bg-gradient-to-r from-blue-500 to-cyan-600 rounded-full flex items-center justify-center text-white text-2xl font-bold",children:n.officeName?n.officeName.charAt(0):"S"}),(0,pt.jsxs)("div",{className:"text-left",children:[(0,pt.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:n.officeName}),(0,pt.jsx)("p",{className:"text-gray-600",children:n.companyName}),(0,pt.jsxs)("p",{className:"text-sm text-gray-500",children:[n.officeAddress||"",n.officePhone&&(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsx)("br",{}),"TEL: ",n.officePhone]})]})]})]})}),(0,pt.jsxs)("div",{className:"text-center mb-12",children:[(0,pt.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent mb-2",children:"\u4fee\u4e86\u8a3c\u660e\u66f8"}),(0,pt.jsx)("p",{className:"text-gray-600 text-lg",children:"Certificate of Completion"})]}),(0,pt.jsxs)("div",{className:"mb-12",children:[(0,pt.jsxs)("p",{className:"text-lg text-gray-700 text-center mb-8 leading-relaxed",children:["\u3053\u306e\u8a3c\u660e\u66f8\u306f\u3001\u4e0b\u8a18\u306e\u65b9\u304c",(0,pt.jsx)("span",{className:"font-bold text-blue-600 mx-2",children:n.lessonTitle}),"\u306e\u5b66\u7fd2\u3092\u4fee\u4e86\u3057\u305f\u3053\u3068\u3092\u8a3c\u660e\u3057\u307e\u3059\u3002"]}),(0,pt.jsx)("div",{className:"bg-gray-50 rounded-xl p-6 mb-8",children:(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("span",{className:"font-semibold text-gray-700",children:"\u6c0f\u540d"}),(0,pt.jsx)("span",{className:"text-gray-800",children:n.studentName})]}),(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("span",{className:"font-semibold text-gray-700",children:"\u5229\u7528\u8005ID"}),(0,pt.jsx)("span",{className:"text-gray-800",children:n.studentId})]}),(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("span",{className:"font-semibold text-gray-700",children:"\u4fee\u4e86\u65e5"}),(0,pt.jsx)("span",{className:"text-gray-800",children:n.completionDate})]}),(0,pt.jsxs)("div",{className:"flex justify-between items-center",children:[(0,pt.jsx)("span",{className:"font-semibold text-gray-700",children:"\u30c6\u30b9\u30c8\u7d50\u679c"}),(0,pt.jsxs)("span",{className:"text-blue-600 font-bold",children:[n.score,"\u70b9"]})]})]})}),(0,pt.jsx)("p",{className:"text-lg text-gray-700 text-center leading-relaxed",children:"\u4e0a\u8a18\u306e\u5b66\u7fd2\u5185\u5bb9\u3092\u7406\u89e3\u3057\u3001\u52b9\u679c\u30c6\u30b9\u30c8\u306b\u5408\u683c\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3044\u305f\u3057\u307e\u3059\u3002 \u4eca\u5f8c\u306e\u5b66\u7fd2\u6d3b\u52d5\u306b\u304a\u3044\u3066\u3082\u3001\u3053\u306e\u77e5\u8b58\u3092\u6d3b\u7528\u3057\u3066\u3044\u305f\u3060\u304f\u3053\u3068\u3092\u671f\u5f85\u3044\u305f\u3057\u307e\u3059\u3002"})]}),(0,pt.jsxs)("div",{className:"flex justify-between items-end mb-8",children:[n.instructorName&&(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"w-32 h-0.5 bg-gray-400 mb-2"}),(0,pt.jsx)("p",{className:"font-semibold text-gray-800",children:n.instructorName}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u6307\u5c0e\u54e1"})]}),n.managerNames&&n.managerNames.length>0&&(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"w-32 h-0.5 bg-gray-400 mb-2"}),(0,pt.jsx)("div",{className:"font-semibold text-gray-800",children:n.managerNames.map((e,t)=>(0,pt.jsx)("div",{children:e},t))}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u62e0\u70b9\u7ba1\u7406\u8005"})]})]}),(0,pt.jsx)("div",{className:"text-center mb-8",children:(0,pt.jsxs)("p",{className:"text-sm text-gray-500",children:["\u8a3c\u660e\u66f8ID: ",n.certificateId]})}),(0,pt.jsx)("div",{className:"absolute top-8 right-8",children:(0,pt.jsx)("div",{className:"w-24 h-24 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center text-white font-bold text-lg shadow-lg",children:"\u5408\u683c"})})]})]}),(0,pt.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 justify-center mt-8",children:[(0,pt.jsx)("button",{className:"px-8 py-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200",onClick:u,disabled:a,children:a?"\u5370\u5237\u4e2d...":"\ud83d\udda8\ufe0f \u8a3c\u660e\u66f8\u3092\u5370\u5237"}),(0,pt.jsx)("button",{className:"px-8 py-4 bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-xl font-semibold hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200",onClick:m,children:"\ud83d\udcca \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u623b\u308b"})]})]})]}):(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8 text-center",children:[(0,pt.jsx)("div",{className:"text-gray-500 text-6xl mb-4",children:"\ud83d\udcc4"}),(0,pt.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"\u8a3c\u660e\u66f8\u30c7\u30fc\u30bf\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093"}),(0,pt.jsx)("p",{className:"text-gray-600 mb-6",children:"\u5408\u683c\u8a3c\u660e\u66f8\u306e\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002"}),(0,pt.jsx)("button",{className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",onClick:()=>e("/student/dashboard"),children:"\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u623b\u308b"})]})})},zc=(e,t)=>{const n={title:`${t.name} \u65e5\u6b21\u5831\u544a\u66f8`,date:e.date,studentInfo:{name:t.name,course:t.class,instructor:t.instructorName},reportData:{workHours:e.workHours,tasks:e.tasks,achievements:e.achievements,challenges:e.challenges,nextDayPlan:e.nextDayPlan,mood:e.mood,notes:e.notes}};console.log("\u65e5\u6b21\u5831\u544a\u66f8PDF\u751f\u6210:",n);const s=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`${t.name}_\u65e5\u6b21\u5831\u544a\u66f8_${e.date}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)},Oc=(e,t)=>{const n={title:`${t.name} \u9031\u6b21\u5831\u544a\u66f8`,period:e.period,evaluationDate:e.evaluationDate,studentInfo:{name:t.name,course:t.class,instructor:t.instructorName},reportData:{overallProgress:e.overallProgress,achievements:e.achievements,challenges:e.challenges,nextWeekPlan:e.nextWeekPlan,instructorNotes:e.instructorNotes}};console.log("\u9031\u6b21\u5831\u544a\u66f8PDF\u751f\u6210:",n);const s=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`${t.name}_\u9031\u6b21\u5831\u544a\u66f8_${e.period}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)},Rc=(e,t)=>{const n={title:`${t.name} \u6708\u6b21\u5831\u544a\u66f8`,period:e.period,evaluationDate:e.evaluationDate,studentInfo:{name:t.name,course:t.class,instructor:t.instructorName},reportData:{overallProgress:e.overallProgress,skillImprovements:e.skillImprovements,workHabits:e.workHabits,goals:e.goals,instructorEvaluation:e.instructorEvaluation}};console.log("\u6708\u6b21\u5831\u544a\u66f8PDF\u751f\u6210:",n);const s=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=`${t.name}_\u6708\u6b21\u5831\u544a\u66f8_${e.period}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r)},Mc=["\u4f50\u85e4\u6307\u5c0e\u54e1","\u7530\u4e2d\u6307\u5c0e\u54e1","\u5c71\u7530\u6307\u5c0e\u54e1","\u9234\u6728\u6307\u5c0e\u54e1"],Fc=e=>{var t,n;let{student:s,report:a,onSave:l,onEdit:o,onDelete:i,onDownloadPDF:c}=e;const[d,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)({evalDate:(null===a||void 0===a?void 0:a.evalDate)||(new Date).toISOString().split("T")[0],prevEvalDate:(null===a||void 0===a?void 0:a.prevEvalDate)||"",method:(null===a||void 0===a?void 0:a.method)||"\u901a\u6240",otherMethod:(null===a||void 0===a?void 0:a.otherMethod)||"",period:(null===a||void 0===a?void 0:a.period)||{start:"",end:""},content:(null===a||void 0===a?void 0:a.content)||"",instructor:(null===a||void 0===a?void 0:a.instructor)||(null===s||void 0===s?void 0:s.instructorName)||Mc[0]});return(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 p-6",children:(0,pt.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\ud83d\udcc5 \u9031\u6b21\u8a55\u4fa1\uff08\u5728\u5b85\u306b\u304a\u3051\u308b\u5c31\u52b4\u652f\u63f4\u8a18\u9332\u30fb\u8a55\u4fa1\uff09"}),(0,pt.jsx)("div",{className:"flex gap-2",children:d?(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>{if(!m.content.trim())return void alert("\u8a55\u4fa1\u5185\u5bb9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002");const e={...m,method:"\u305d\u306e\u4ed6"===m.method?m.otherMethod:m.method};l(e),u(!1)},children:"\ud83d\udcbe \u4fdd\u5b58"}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-all duration-200",onClick:()=>{u(!1),x({evalDate:(null===a||void 0===a?void 0:a.evalDate)||(new Date).toISOString().split("T")[0],prevEvalDate:(null===a||void 0===a?void 0:a.prevEvalDate)||"",method:(null===a||void 0===a?void 0:a.method)||"\u901a\u6240",otherMethod:(null===a||void 0===a?void 0:a.otherMethod)||"",period:(null===a||void 0===a?void 0:a.period)||{start:"",end:""},content:(null===a||void 0===a?void 0:a.content)||"",instructor:(null===a||void 0===a?void 0:a.instructor)||(null===s||void 0===s?void 0:s.instructorName)||Mc[0]})},children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]}):(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>u(!0),children:"\u270f\ufe0f \u7de8\u96c6"}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>{window.confirm("\u3053\u306e\u9031\u6b21\u8a55\u4fa1\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f")&&i(null===a||void 0===a?void 0:a.id)},children:"\ud83d\uddd1\ufe0f \u524a\u9664"}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>c&&c(a),title:"PDF\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9",children:"\ud83d\udcc4 PDF"})]})})]}),(0,pt.jsx)("div",{className:"space-y-6",children:d?(0,pt.jsxs)("div",{className:"space-y-6",children:[(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8a55\u4fa1\u5b9f\u65bd\u65e5"}),(0,pt.jsx)("input",{type:"date",value:m.evalDate,onChange:e=>x(t=>({...t,evalDate:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u524d\u56de\u8a55\u4fa1\u65e5"}),(0,pt.jsx)("input",{type:"date",value:m.prevEvalDate,onChange:e=>x(t=>({...t,prevEvalDate:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8a55\u4fa1\u65b9\u6cd5"}),(0,pt.jsxs)("div",{className:"flex gap-4",children:[(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"radio",name:"method",value:"\u901a\u6240",checked:"\u901a\u6240"===m.method,onChange:()=>x(e=>({...e,method:"\u901a\u6240"})),className:"mr-2 text-green-600 focus:ring-green-500"}),"\u901a\u6240"]}),(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"radio",name:"method",value:"\u8a2a\u554f",checked:"\u8a2a\u554f"===m.method,onChange:()=>x(e=>({...e,method:"\u8a2a\u554f"})),className:"mr-2 text-green-600 focus:ring-green-500"}),"\u8a2a\u554f"]}),(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"radio",name:"method",value:"\u305d\u306e\u4ed6",checked:"\u305d\u306e\u4ed6"===m.method,onChange:()=>x(e=>({...e,method:"\u305d\u306e\u4ed6"})),className:"mr-2 text-green-600 focus:ring-green-500"}),"\u305d\u306e\u4ed6"]})]}),"\u305d\u306e\u4ed6"===m.method&&(0,pt.jsx)("input",{type:"text",value:m.otherMethod,onChange:e=>x(t=>({...t,otherMethod:e.target.value})),placeholder:"\u65b9\u6cd5\u3092\u5165\u529b",className:"mt-2 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u5bfe\u8c61\u671f\u9593"}),(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsx)("input",{type:"date",value:m.period.start,onChange:e=>x(t=>({...t,period:{...t.period,start:e.target.value}})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"}),(0,pt.jsx)("span",{className:"text-gray-500",children:"\uff5e"}),(0,pt.jsx)("input",{type:"date",value:m.period.end,onChange:e=>x(t=>({...t,period:{...t.period,end:e.target.value}})),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u8a55\u4fa1\u5185\u5bb9",(0,pt.jsx)("button",{type:"button",className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-all duration-200",onClick:async()=>{const e=`\u30fb${null===s||void 0===s?void 0:s.name}\u306e\u9031\u6b21\u8a55\u4fa1\u306b\u3064\u3044\u3066\n\u30fb\u671f\u9593\uff1a${m.period.start} \uff5e ${m.period.end}\n\u30fb\u5b66\u7fd2\u9032\u6357\uff1a${null===s||void 0===s?void 0:s.class}\u306e\u5185\u5bb9\u3092\u7740\u5b9f\u306b\u7fd2\u5f97\n\u30fb\u4f53\u8abf\u7ba1\u7406\uff1a\u826f\u597d\u306a\u72b6\u614b\u3092\u7dad\u6301\n\u30fb\u6b21\u56de\u76ee\u6a19\uff1a\u3088\u308a\u9ad8\u5ea6\u306a\u5185\u5bb9\u3078\u306e\u6311\u6226`;x(t=>({...t,content:e}))},children:"\ud83e\udd16 AI\u30a2\u30b7\u30b9\u30c8"})]}),(0,pt.jsx)("textarea",{value:m.content,onChange:e=>x(t=>({...t,content:e.target.value})),rows:6,placeholder:"\u8a55\u4fa1\u5185\u5bb9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8a18\u9332\u8005"}),(0,pt.jsx)("select",{value:m.instructor,onChange:e=>x(t=>({...t,instructor:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:Mc.map(e=>(0,pt.jsx)("option",{value:e,children:e},e))})]})]}):(0,pt.jsxs)("div",{className:"space-y-6",children:[(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u8a55\u4fa1\u5b9f\u65bd\u65e5:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:(null===a||void 0===a?void 0:a.evalDate)||"\u672a\u8a2d\u5b9a"})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u524d\u56de\u8a55\u4fa1\u65e5:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:(null===a||void 0===a?void 0:a.prevEvalDate)||"\u306a\u3057"})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u8a55\u4fa1\u65b9\u6cd5:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:(null===a||void 0===a?void 0:a.method)||"\u672a\u8a2d\u5b9a"})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u5bfe\u8c61\u671f\u9593:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:null!==a&&void 0!==a&&null!==(t=a.period)&&void 0!==t&&t.start&&null!==a&&void 0!==a&&null!==(n=a.period)&&void 0!==n&&n.end?`${a.period.start} \uff5e ${a.period.end}`:"\u672a\u8a2d\u5b9a"})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u8a18\u9332\u8005:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:(null===a||void 0===a?void 0:a.instructor)||"\u672a\u8a2d\u5b9a"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block font-medium text-gray-700 mb-2",children:"\u8a55\u4fa1\u5185\u5bb9:"}),(0,pt.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(null===a||void 0===a?void 0:a.content)||"\u8a55\u4fa1\u5185\u5bb9\u304c\u5165\u529b\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002"})]})]})})]})})})},Uc=["\u4f50\u85e4\u6307\u5c0e\u54e1","\u7530\u4e2d\u6307\u5c0e\u54e1","\u5c71\u7530\u6307\u5c0e\u54e1","\u9234\u6728\u6307\u5c0e\u54e1"],Bc=e=>{let{student:t,report:n,onSave:s,onEdit:a,onDelete:l,onDownloadPDF:o}=e;const[i,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)({evalDate:(null===n||void 0===n?void 0:n.evalDate)||(new Date).toISOString().split("T")[0],prevEvalDate:(null===n||void 0===n?void 0:n.prevEvalDate)||"",method:(null===n||void 0===n?void 0:n.method)||"\u901a\u6240",otherMethod:(null===n||void 0===n?void 0:n.otherMethod)||"",goal:(null===n||void 0===n?void 0:n.goal)||"",work:(null===n||void 0===n?void 0:n.work)||"",achievement:(null===n||void 0===n?void 0:n.achievement)||"",issue:(null===n||void 0===n?void 0:n.issue)||"",improve:(null===n||void 0===n?void 0:n.improve)||"",health:(null===n||void 0===n?void 0:n.health)||"",note:(null===n||void 0===n?void 0:n.note)||"",validity:(null===n||void 0===n?void 0:n.validity)||"",instructor:(null===n||void 0===n?void 0:n.instructor)||(null===t||void 0===t?void 0:t.instructorName)||Uc[0]}),m=async e=>{const n={goal:`${null===t||void 0===t?void 0:t.class}\u306e\u7fd2\u5f97\u3068\u5b9f\u8df5\u7684\u306a\u30b9\u30ad\u30eb\u30a2\u30c3\u30d7`,work:`${null===t||void 0===t?void 0:t.class}\u306e\u5b66\u7fd2\u3068\u5b9f\u7fd2\u3001\u8ab2\u984c\u3078\u306e\u53d6\u308a\u7d44\u307f`,achievement:"\u57fa\u790e\u77e5\u8b58\u306e\u7fd2\u5f97\u304c\u3067\u304d\u3001\u5b9f\u8df5\u7684\u306a\u4f5c\u696d\u3082\u53ef\u80fd\u306b\u306a\u3063\u305f",issue:"\u3088\u308a\u9ad8\u5ea6\u306a\u5185\u5bb9\u3078\u306e\u7406\u89e3\u3092\u6df1\u3081\u308b\u5fc5\u8981\u304c\u3042\u308b",improve:"\u6bb5\u968e\u7684\u306a\u5b66\u7fd2\u3068\u5b9f\u8df5\u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u6307\u5c0e\u3092\u7d99\u7d9a",health:"\u4f53\u8abf\u7ba1\u7406\u3092\u9069\u5207\u306b\u884c\u3044\u3001\u7121\u7406\u306e\u306a\u3044\u5b66\u7fd2\u3092\u7d99\u7d9a",note:"\u5b66\u7fd2\u610f\u6b32\u304c\u9ad8\u304f\u3001\u7740\u5b9f\u306b\u30b9\u30ad\u30eb\u30a2\u30c3\u30d7\u3057\u3066\u3044\u308b",validity:"\u5728\u5b85\u5c31\u52b4\u306e\u7d99\u7d9a\u306f\u59a5\u5f53\u3002\u9069\u5207\u306a\u30b5\u30dd\u30fc\u30c8\u4f53\u5236\u3092\u7dad\u6301"};u(t=>({...t,[e]:n[e]||""}))};return(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 p-6",children:(0,pt.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\ud83d\udcc8 \u6708\u6b21\u8a55\u4fa1\uff08\u5728\u5b85\u306b\u304a\u3051\u308b\u5c31\u52b4\u9054\u6210\u5ea6\u8a55\u4fa1\u30b7\u30fc\u30c8\uff09"}),(0,pt.jsx)("div",{className:"flex gap-2",children:i?(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>{if(!d.goal.trim()||!d.work.trim())return void alert("\u8a13\u7df4\u76ee\u6a19\u3068\u53d6\u7d44\u5185\u5bb9\u306f\u5fc5\u9808\u9805\u76ee\u3067\u3059\u3002");const e={...d,method:"\u305d\u306e\u4ed6"===d.method?d.otherMethod:d.method};s(e),c(!1)},children:"\ud83d\udcbe \u4fdd\u5b58"}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg font-medium transition-all duration-200",onClick:()=>{c(!1),u({evalDate:(null===n||void 0===n?void 0:n.evalDate)||(new Date).toISOString().split("T")[0],prevEvalDate:(null===n||void 0===n?void 0:n.prevEvalDate)||"",method:(null===n||void 0===n?void 0:n.method)||"\u901a\u6240",otherMethod:(null===n||void 0===n?void 0:n.otherMethod)||"",goal:(null===n||void 0===n?void 0:n.goal)||"",work:(null===n||void 0===n?void 0:n.work)||"",achievement:(null===n||void 0===n?void 0:n.achievement)||"",issue:(null===n||void 0===n?void 0:n.issue)||"",improve:(null===n||void 0===n?void 0:n.improve)||"",health:(null===n||void 0===n?void 0:n.health)||"",note:(null===n||void 0===n?void 0:n.note)||"",validity:(null===n||void 0===n?void 0:n.validity)||"",instructor:(null===n||void 0===n?void 0:n.instructor)||(null===t||void 0===t?void 0:t.instructorName)||Uc[0]})},children:"\u30ad\u30e3\u30f3\u30bb\u30eb"})]}):(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>c(!0),children:"\u270f\ufe0f \u7de8\u96c6"}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>{window.confirm("\u3053\u306e\u6708\u6b21\u8a55\u4fa1\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f")&&l(null===n||void 0===n?void 0:n.id)},children:"\ud83d\uddd1\ufe0f \u524a\u9664"}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>o&&o(n),title:"PDF\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9",children:"\ud83d\udcc4 PDF"})]})})]}),(0,pt.jsx)("div",{className:"space-y-6",children:i?(0,pt.jsxs)("div",{className:"space-y-6",children:[(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8a55\u4fa1\u5b9f\u65bd\u65e5"}),(0,pt.jsx)("input",{type:"date",value:d.evalDate,onChange:e=>u(t=>({...t,evalDate:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u524d\u56de\u306e\u9054\u6210\u5ea6\u8a55\u4fa1\u65e5"}),(0,pt.jsx)("input",{type:"date",value:d.prevEvalDate,onChange:e=>u(t=>({...t,prevEvalDate:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u5b9f\u65bd\u65b9\u6cd5"}),(0,pt.jsxs)("div",{className:"flex gap-4",children:[(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"radio",name:"method",value:"\u901a\u6240",checked:"\u901a\u6240"===d.method,onChange:()=>u(e=>({...e,method:"\u901a\u6240"})),className:"mr-2 text-green-600 focus:ring-green-500"}),"\u901a\u6240"]}),(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"radio",name:"method",value:"\u8a2a\u554f",checked:"\u8a2a\u554f"===d.method,onChange:()=>u(e=>({...e,method:"\u8a2a\u554f"})),className:"mr-2 text-green-600 focus:ring-green-500"}),"\u8a2a\u554f"]}),(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"radio",name:"method",value:"\u305d\u306e\u4ed6",checked:"\u305d\u306e\u4ed6"===d.method,onChange:()=>u(e=>({...e,method:"\u305d\u306e\u4ed6"})),className:"mr-2 text-green-600 focus:ring-green-500"}),"\u305d\u306e\u4ed6"]})]}),"\u305d\u306e\u4ed6"===d.method&&(0,pt.jsx)("input",{type:"text",value:d.otherMethod,onChange:e=>u(t=>({...t,otherMethod:e.target.value})),placeholder:"\u65b9\u6cd5\u3092\u5165\u529b",className:"mt-2 w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u8a13\u7df4\u76ee\u6a19 *",(0,pt.jsx)("button",{type:"button",className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-all duration-200",onClick:()=>m("goal"),children:"\ud83e\udd16 AI"})]}),(0,pt.jsx)("textarea",{value:d.goal,onChange:e=>u(t=>({...t,goal:e.target.value})),rows:3,placeholder:"\u8a13\u7df4\u76ee\u6a19\u3092\u5165\u529b",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u53d6\u7d44\u5185\u5bb9 *",(0,pt.jsx)("button",{type:"button",className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-all duration-200",onClick:()=>m("work"),children:"\ud83e\udd16 AI"})]}),(0,pt.jsx)("textarea",{value:d.work,onChange:e=>u(t=>({...t,work:e.target.value})),rows:3,placeholder:"\u53d6\u7d44\u5185\u5bb9\u3092\u5165\u529b",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u8a13\u7df4\u76ee\u6a19\u306b\u5bfe\u3059\u308b\u9054\u6210\u5ea6",(0,pt.jsx)("button",{type:"button",className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-all duration-200",onClick:()=>m("achievement"),children:"\ud83e\udd16 AI"})]}),(0,pt.jsx)("textarea",{value:d.achievement,onChange:e=>u(t=>({...t,achievement:e.target.value})),rows:3,placeholder:"\u9054\u6210\u5ea6\u3092\u5165\u529b",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u8ab2\u984c",(0,pt.jsx)("button",{type:"button",className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-all duration-200",onClick:()=>m("issue"),children:"\ud83e\udd16 AI"})]}),(0,pt.jsx)("textarea",{value:d.issue,onChange:e=>u(t=>({...t,issue:e.target.value})),rows:3,placeholder:"\u8ab2\u984c\u3092\u5165\u529b",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u4eca\u5f8c\u306e\u8ab2\u984c\u6539\u5584\u65b9\u91dd",(0,pt.jsx)("button",{type:"button",className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-all duration-200",onClick:()=>m("improve"),children:"\ud83e\udd16 AI"})]}),(0,pt.jsx)("textarea",{value:d.improve,onChange:e=>u(t=>({...t,improve:e.target.value})),rows:3,placeholder:"\u6539\u5584\u65b9\u91dd\u3092\u5165\u529b",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u5065\u5eb7\u30fb\u4f53\u8abf\u9762\u3067\u306e\u7559\u610f\u4e8b\u9805",(0,pt.jsx)("button",{type:"button",className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-all duration-200",onClick:()=>m("health"),children:"\ud83e\udd16 AI"})]}),(0,pt.jsx)("textarea",{value:d.health,onChange:e=>u(t=>({...t,health:e.target.value})),rows:3,placeholder:"\u5065\u5eb7\u30fb\u4f53\u8abf\u9762\u3067\u306e\u7559\u610f\u4e8b\u9805\u3092\u5165\u529b",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u305d\u306e\u4ed6\u7279\u8a18\u4e8b\u9805",(0,pt.jsx)("button",{type:"button",className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-all duration-200",onClick:()=>m("note"),children:"\ud83e\udd16 AI"})]}),(0,pt.jsx)("textarea",{value:d.note,onChange:e=>u(t=>({...t,note:e.target.value})),rows:3,placeholder:"\u7279\u8a18\u4e8b\u9805\u3092\u5165\u529b",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["\u5728\u5b85\u5c31\u52b4\u7d99\u7d9a\u306e\u59a5\u5f53\u6027",(0,pt.jsx)("button",{type:"button",className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-all duration-200",onClick:()=>m("validity"),children:"\ud83e\udd16 AI"})]}),(0,pt.jsx)("textarea",{value:d.validity,onChange:e=>u(t=>({...t,validity:e.target.value})),rows:3,placeholder:"\u59a5\u5f53\u6027\u3092\u5165\u529b",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u8a55\u4fa1\u5b9f\u65bd\u8005"}),(0,pt.jsx)("select",{value:d.instructor,onChange:e=>u(t=>({...t,instructor:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:Uc.map(e=>(0,pt.jsx)("option",{value:e,children:e},e))})]})]}):(0,pt.jsxs)("div",{className:"space-y-6",children:[(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u8a55\u4fa1\u5b9f\u65bd\u65e5:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:(null===n||void 0===n?void 0:n.evalDate)||"\u672a\u8a2d\u5b9a"})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u524d\u56de\u306e\u9054\u6210\u5ea6\u8a55\u4fa1\u65e5:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:(null===n||void 0===n?void 0:n.prevEvalDate)||"\u306a\u3057"})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u5b9f\u65bd\u65b9\u6cd5:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:(null===n||void 0===n?void 0:n.method)||"\u672a\u8a2d\u5b9a"})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u8a55\u4fa1\u5b9f\u65bd\u8005:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:(null===n||void 0===n?void 0:n.instructor)||"\u672a\u8a2d\u5b9a"})]})]}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block font-medium text-gray-700 mb-2",children:"\u8a13\u7df4\u76ee\u6a19:"}),(0,pt.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(null===n||void 0===n?void 0:n.goal)||"\u672a\u5165\u529b"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block font-medium text-gray-700 mb-2",children:"\u53d6\u7d44\u5185\u5bb9:"}),(0,pt.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(null===n||void 0===n?void 0:n.work)||"\u672a\u5165\u529b"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block font-medium text-gray-700 mb-2",children:"\u8a13\u7df4\u76ee\u6a19\u306b\u5bfe\u3059\u308b\u9054\u6210\u5ea6:"}),(0,pt.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(null===n||void 0===n?void 0:n.achievement)||"\u672a\u5165\u529b"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block font-medium text-gray-700 mb-2",children:"\u8ab2\u984c:"}),(0,pt.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(null===n||void 0===n?void 0:n.issue)||"\u672a\u5165\u529b"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block font-medium text-gray-700 mb-2",children:"\u4eca\u5f8c\u306e\u8ab2\u984c\u6539\u5584\u65b9\u91dd:"}),(0,pt.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(null===n||void 0===n?void 0:n.improve)||"\u672a\u5165\u529b"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block font-medium text-gray-700 mb-2",children:"\u5065\u5eb7\u30fb\u4f53\u8abf\u9762\u3067\u306e\u7559\u610f\u4e8b\u9805:"}),(0,pt.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(null===n||void 0===n?void 0:n.health)||"\u672a\u5165\u529b"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block font-medium text-gray-700 mb-2",children:"\u305d\u306e\u4ed6\u7279\u8a18\u4e8b\u9805:"}),(0,pt.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(null===n||void 0===n?void 0:n.note)||"\u672a\u5165\u529b"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block font-medium text-gray-700 mb-2",children:"\u5728\u5b85\u5c31\u52b4\u7d99\u7d9a\u306e\u59a5\u5f53\u6027:"}),(0,pt.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(null===n||void 0===n?void 0:n.validity)||"\u672a\u5165\u529b"})]})]})]})})]})})})},Jc=e=>{let{student:t,reports:n,onNavigateToReport:s,onDownloadPDF:a}=e;const[l,o]=(0,r.useState)("all"),[i,c]=(0,r.useState)("date"),[d,u]=(0,r.useState)(""),[m,x]=(0,r.useState)([]),[g,h]=(0,r.useState)(null),[p,f]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=(()=>{const e=[];return n.daily&&n.daily.forEach(t=>{e.push({...t,type:"daily",typeLabel:"\u65e5\u6b21\u5831\u544a\u66f8",typeIcon:"\ud83d\udcdd",status:t.id?"completed":"pending"})}),n.weekly&&n.weekly.forEach(t=>{e.push({...t,type:"weekly",typeLabel:"\u9031\u6b21\u5831\u544a\u66f8",typeIcon:"\ud83d\udcc5",status:t.id?"completed":"pending"})}),n.monthly&&n.monthly.forEach(t=>{e.push({...t,type:"monthly",typeLabel:"\u6708\u6b21\u5831\u544a\u66f8",typeIcon:"\ud83d\udcc8",status:t.id?"completed":"pending"})}),e})();"all"!==l&&(e=e.filter(e=>e.type===l)),d&&(e=e.filter(e=>e.date.includes(d)||e.typeLabel.toLowerCase().includes(d.toLowerCase())||e.actualWork&&e.actualWork.toLowerCase().includes(d.toLowerCase())||e.thoughts&&e.thoughts.toLowerCase().includes(d.toLowerCase()))),e.sort((e,t)=>{switch(i){case"date":return new Date(t.date)-new Date(e.date);case"type":return e.typeLabel.localeCompare(t.typeLabel);case"status":return e.status.localeCompare(t.status);default:return 0}}),x(e)},[n,l,i,d]);const b=e=>{"weekly"===e.type||"monthly"===e.type?(h(e),f(!0)):s(e.type,e.date,e)},y=()=>{f(!1),h(null)},v=e=>{console.log("\u8a55\u4fa1\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58:",e),y()},j=e=>{console.log("\u8a55\u4fa1\u3092\u524a\u9664:",e),y()},N=e=>{const t=(0,Pt.pu)().toISOString().split("T")[0];s(e,t,null)};return(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 p-6",children:[(0,pt.jsx)("div",{className:"max-w-7xl mx-auto",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\ud83d\udccb \u5831\u544a\u66f8\u4e00\u89a7"}),(0,pt.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsxs)("select",{value:l,onChange:e=>o(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[(0,pt.jsx)("option",{value:"all",children:"\u3059\u3079\u3066"}),(0,pt.jsx)("option",{value:"daily",children:"\u65e5\u6b21\u5831\u544a\u66f8"}),(0,pt.jsx)("option",{value:"weekly",children:"\u9031\u6b21\u5831\u544a\u66f8"}),(0,pt.jsx)("option",{value:"monthly",children:"\u6708\u6b21\u5831\u544a\u66f8"})]}),(0,pt.jsxs)("select",{value:i,onChange:e=>c(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[(0,pt.jsx)("option",{value:"date",children:"\u65e5\u4ed8\u9806"}),(0,pt.jsx)("option",{value:"type",children:"\u7a2e\u985e\u9806"}),(0,pt.jsx)("option",{value:"status",children:"\u30b9\u30c6\u30fc\u30bf\u30b9\u9806"})]})]}),(0,pt.jsx)("input",{type:"text",placeholder:"\u65e5\u4ed8\u307e\u305f\u306f\u5185\u5bb9\u3067\u691c\u7d22...",value:d,onChange:e=>u(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]}),(0,pt.jsxs)("div",{className:"flex flex-wrap gap-3 mb-6",children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>N("daily"),children:"\u2795 \u65e5\u6b21\u5831\u544a\u66f8\u4f5c\u6210"}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>N("weekly"),children:"\u2795 \u9031\u6b21\u5831\u544a\u66f8\u4f5c\u6210"}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>N("monthly"),children:"\u2795 \u6708\u6b21\u5831\u544a\u66f8\u4f5c\u6210"})]}),(0,pt.jsx)("div",{className:"min-h-[400px]",children:0===m.length?(0,pt.jsxs)("div",{className:"text-center py-12",children:[(0,pt.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udcc4"}),(0,pt.jsx)("p",{className:"text-gray-600 mb-4",children:"\u8a72\u5f53\u3059\u308b\u5831\u544a\u66f8\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002"}),(0,pt.jsx)("div",{children:(0,pt.jsx)("button",{className:"px-6 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>N("daily"),children:"\u6700\u521d\u306e\u5831\u544a\u66f8\u3092\u4f5c\u6210"})})]}):(0,pt.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:m.map((e,t)=>{const n=(e=>{if("completed"===e.status)return{label:"\u4f5c\u6210\u6e08\u307f",class:"completed"};const t=((0,Pt.pu)()-new Date(e.date))/864e5;return t>7?{label:"\u671f\u9650\u5207\u308c",class:"expired"}:t>3?{label:"\u8981\u4f5c\u6210",class:"urgent"}:{label:"\u672a\u4f5c\u6210",class:"pending"}})(e);return(0,pt.jsxs)("div",{className:"border border-gray-200 rounded-xl p-4 hover:shadow-lg transition-all duration-200 cursor-pointer "+("expired"===n.class?"border-red-200 bg-red-50":"urgent"===n.class?"border-yellow-200 bg-yellow-50":"completed"===n.class?"border-green-200 bg-green-50":"border-gray-200 bg-white"),onClick:()=>b(e),children:[(0,pt.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-2",children:[(0,pt.jsx)("span",{className:"text-xl",children:e.typeIcon}),(0,pt.jsx)("span",{className:"font-semibold text-gray-800",children:e.typeLabel})]}),(0,pt.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("completed"===n.class?"bg-green-100 text-green-800":"expired"===n.class?"bg-red-100 text-red-800":"urgent"===n.class?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:n.label})]}),(0,pt.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-3",children:e.date}),(0,pt.jsxs)("div",{className:"space-y-2 mb-4",children:["daily"===e.type&&(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u4f53\u6e29:"}),(0,pt.jsxs)("span",{className:"text-gray-800",children:[e.temperature||"--","\u2103"]})]}),(0,pt.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u4f53\u8abf:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:"good"===e.healthCondition?"\u826f\u597d":"normal"===e.healthCondition?"\u666e\u901a":"\u60aa\u3044"})]}),(0,pt.jsxs)("div",{className:"text-sm",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u4f5c\u696d\u5b9f\u7e3e:"}),(0,pt.jsx)("p",{className:"text-gray-800 truncate",children:e.actualWork?e.actualWork.length>30?e.actualWork.substring(0,30)+"...":e.actualWork:"\u672a\u5165\u529b"})]})]}),"weekly"===e.type&&(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u671f\u9593:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:e.period})]}),(0,pt.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u9032\u6357:"}),(0,pt.jsxs)("span",{className:"text-gray-800",children:[e.overallProgress||"--","%"]})]}),(0,pt.jsxs)("div",{className:"text-sm",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u6210\u679c:"}),(0,pt.jsx)("p",{className:"text-gray-800 truncate",children:e.achievements&&e.achievements.length>0?e.achievements[0]:"\u672a\u5165\u529b"})]})]}),"monthly"===e.type&&(0,pt.jsxs)(pt.Fragment,{children:[(0,pt.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u671f\u9593:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:e.period})]}),(0,pt.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u9032\u6357:"}),(0,pt.jsxs)("span",{className:"text-gray-800",children:[e.overallProgress||"--","%"]})]}),(0,pt.jsxs)("div",{className:"text-sm",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u30b9\u30ad\u30eb\u5411\u4e0a:"}),(0,pt.jsx)("p",{className:"text-gray-800 truncate",children:e.skillImprovements&&e.skillImprovements.length>0?e.skillImprovements[0]:"\u672a\u5165\u529b"})]})]})]}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("button",{className:"flex-1 px-3 py-1 bg-blue-100 hover:bg-blue-200 text-blue-700 rounded text-sm font-medium transition-all duration-200",onClick:t=>{t.stopPropagation(),b(e)},children:"\ud83d\udc41\ufe0f \u8868\u793a"}),"completed"===e.status&&(0,pt.jsx)("button",{className:"flex-1 px-3 py-1 bg-green-100 hover:bg-green-200 text-green-700 rounded text-sm font-medium transition-all duration-200",onClick:t=>{t.stopPropagation(),b(e)},children:"\u270f\ufe0f \u7de8\u96c6"}),(0,pt.jsx)("button",{className:"px-3 py-1 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded text-sm font-medium transition-all duration-200",onClick:t=>{t.stopPropagation(),a&&a(e)},title:`${e.typeLabel}\u3092PDF\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9`,children:"\ud83d\udcc4 PDF"})]})]},`${e.type}-${e.date}-${t}`)})})})]})}),p&&g&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsxs)("h3",{className:"text-xl font-bold text-gray-800",children:[g.typeLabel," - ",g.date]}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all duration-200",onClick:y,children:"\xd7"})]})}),(0,pt.jsxs)("div",{className:"p-6",children:["weekly"===g.type&&(0,pt.jsx)(Fc,{student:t,report:g,onSave:v,onDelete:j,onDownloadPDF:a}),"monthly"===g.type&&(0,pt.jsx)(Bc,{student:t,report:g,onSave:v,onDelete:j,onDownloadPDF:a})]})]})})]})},qc=()=>{const{studentId:e}=se(),t=ne(),[n,s]=(0,r.useState)(null),[a,l]=(0,r.useState)(null),[o,i]=(0,r.useState)({daily:[],weekly:[],monthly:[]});if((0,r.useEffect)(()=>{const t=[{id:"student001",name:"\u672b\u5409\u3000\u5143\u6c17",email:"sueyoshi@example.com",instructorId:"instructor001",instructorName:"\u4f50\u85e4\u6307\u5c0e\u54e1",locationId:"location001",locationName:"\u6771\u4eac\u672c\u6821",recipientNumber:"123456789012",lastLogin:"2024-01-15",status:"active",loginToken:"f9Ul-7OlL-OPZE",joinDate:"2024-01-01",canStudyAtHome:!0,tags:["\u4f50\u85e4\u6307\u5c0e\u54e1","IT\u30ea\u30c6\u30e9\u30b7\u30fc\u30fbAI\u306e\u57fa\u672c","\u6771\u4eac\u672c\u6821","\u4e2d\u7d1a\u8005","\u5fc5\u4fee\u79d1\u76ee","\u521d\u7d1a\u30b3\u30fc\u30b9"]}].find(t=>t.id===e);s(t);i({daily:[{id:"daily001",date:"2024-01-15",temperature:"36.2",healthCondition:"good",healthNotes:"\u4f53\u8abf\u306f\u826f\u597d\u3067\u3059\u3002",plannedWork:"IT\u30ea\u30c6\u30e9\u30b7\u30fc\u30fbAI\u306e\u57fa\u672c\u306e\u5b66\u7fd2\u3092\u9032\u3081\u307e\u3059\u3002",actualWork:"HTML/CSS\u57fa\u790e\u5b66\u7fd2\u3068\u30ec\u30b9\u30dd\u30f3\u30b7\u30d6\u30c7\u30b6\u30a4\u30f3\u5b9f\u7fd2\u3092\u884c\u3044\u3001\u57fa\u672c\u6982\u5ff5\u3092\u7406\u89e3\u3057\u307e\u3057\u305f\u3002",thoughts:"\u5b66\u7fd2\u304c\u9806\u8abf\u306b\u9032\u3093\u3067\u3044\u307e\u3059\u3002",nextGoal:"\u6b21\u56de\u306f\u3088\u308a\u9ad8\u5ea6\u306a\u5185\u5bb9\u306b\u6311\u6226\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002"},{id:"daily002",date:"2024-01-14",temperature:"36.5",healthCondition:"normal",healthNotes:"\u5c11\u3057\u75b2\u308c\u6c17\u5473\u3067\u3059\u304c\u3001\u4f5c\u696d\u306f\u53ef\u80fd\u3067\u3059\u3002",plannedWork:"AI\u306e\u57fa\u672c\u6982\u5ff5\u306b\u3064\u3044\u3066\u5b66\u7fd2\u3057\u307e\u3059\u3002",actualWork:"AI\u306e\u57fa\u672c\u6982\u5ff5\u3068ChatGPT\u306e\u4f7f\u3044\u65b9\u306b\u3064\u3044\u3066\u5b66\u7fd2\u3057\u307e\u3057\u305f\u3002",thoughts:"AI\u306e\u53ef\u80fd\u6027\u3092\u5b9f\u611f\u3067\u304d\u307e\u3057\u305f\u3002",nextGoal:"\u5b9f\u969b\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067AI\u3092\u6d3b\u7528\u3057\u3066\u307f\u305f\u3044\u3002"}],weekly:[{id:"weekly001",period:"2024-01-08 - 2024-01-14",evaluationDate:"2024-01-14",overallProgress:85,achievements:["HTML\u57fa\u790e\u5b8c\u4e86","CSS\u57fa\u672c\u6982\u5ff5\u7406\u89e3"],challenges:["CSS Grid\u306e\u5fdc\u7528"],nextWeekPlan:"JavaScript\u57fa\u790e\u5b66\u7fd2\u958b\u59cb",instructorNotes:"\u9806\u8abf\u306b\u9032\u6357\u3057\u3066\u3044\u308b"}],monthly:[{id:"monthly001",period:"2024-01-01 - 2024-01-31",evaluationDate:"2024-01-31",overallProgress:75,skillImprovements:["HTML/CSS\u57fa\u790e\u30b9\u30ad\u30eb\u7fd2\u5f97","Web\u30c7\u30b6\u30a4\u30f3\u57fa\u790e\u7406\u89e3"],workHabits:"\u898f\u5247\u6b63\u3057\u3044\u5b66\u7fd2\u7fd2\u6163\u304c\u8eab\u306b\u3064\u3044\u305f",goals:"JavaScript\u7fd2\u5f97\u3068\u30dd\u30fc\u30c8\u30d5\u30a9\u30ea\u30aa\u4f5c\u6210",instructorEvaluation:"\u7740\u5b9f\u306b\u30b9\u30ad\u30eb\u30a2\u30c3\u30d7\u3057\u3066\u3044\u308b"}]})},[e]),!n)return(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 flex items-center justify-center",children:(0,pt.jsx)("div",{className:"text-indigo-600 text-xl font-semibold",children:"\u5229\u7528\u8005\u60c5\u5831\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})});const c=(e,t)=>{i(n=>({...n,[t]:n[t].filter(t=>t.id!==e)})),console.log(`${t}\u5831\u544a\u66f8\u3092\u524a\u9664:`,e)},d=e=>{console.log(`${e}\u5831\u544a\u66f8\u3092\u4f5c\u6210\u3057\u307e\u3059`)};return(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50",children:[(0,pt.jsx)("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-700 text-white shadow-lg",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg hover:bg-opacity-20 transition-all duration-200 font-medium",onClick:()=>{t("/instructor/dashboard?tab=home-support")},children:"\u2190 \u5728\u5b85\u652f\u63f4\u7ba1\u7406\u306b\u623b\u308b"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h1",{className:"text-2xl font-bold",children:"\u5728\u5b85\u652f\u63f4\u5229\u7528\u8005\u8a73\u7d30"}),(0,pt.jsxs)("span",{className:"text-indigo-100 text-sm",children:[n.name,"\u3055\u3093\u306e\u8a73\u7d30\u60c5\u5831"]})]})]}),(0,pt.jsx)("div",{className:"flex items-center gap-3",children:(0,pt.jsx)("span",{className:"px-3 py-1 bg-white bg-opacity-20 rounded-full text-sm font-semibold",children:"active"===n.status?"\u30a2\u30af\u30c6\u30a3\u30d6":"\u975e\u30a2\u30af\u30c6\u30a3\u30d6"})})]})})}),(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,pt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,pt.jsx)("div",{className:"lg:col-span-1",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsxs)("div",{className:"text-center mb-6",children:[(0,pt.jsx)("div",{className:"w-24 h-24 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white text-2xl font-bold mx-auto mb-4",children:n.name.charAt(0)}),(0,pt.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:n.name}),(0,pt.jsx)("p",{className:"text-gray-600",children:n.email})]}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{className:"border-b border-gray-200 pb-4",children:[(0,pt.jsx)("h3",{className:"font-semibold text-gray-800 mb-3",children:"\u57fa\u672c\u60c5\u5831"}),(0,pt.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u6307\u5c0e\u54e1:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:n.instructorName})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u62e0\u70b9:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:n.locationName})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u52a0\u5165\u65e5:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:n.joinDate})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u6700\u7d42\u30ed\u30b0\u30a4\u30f3:"}),(0,pt.jsx)("span",{className:"text-gray-800",children:n.lastLogin})]})]})]}),(0,pt.jsxs)("div",{className:"border-b border-gray-200 pb-4",children:[(0,pt.jsx)("h3",{className:"font-semibold text-gray-800 mb-3",children:"\u5728\u5b85\u5b66\u7fd2"}),(0,pt.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u5728\u5b85\u5b66\u7fd2:"}),(0,pt.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+(n.canStudyAtHome?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:n.canStudyAtHome?"\u53ef\u80fd":"\u4e0d\u53ef"})]}),(0,pt.jsxs)("div",{className:"flex justify-between",children:[(0,pt.jsx)("span",{className:"text-gray-600",children:"\u30ed\u30b0\u30a4\u30f3\u30c8\u30fc\u30af\u30f3:"}),(0,pt.jsx)("span",{className:"text-gray-800 font-mono text-xs",children:n.loginToken})]})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h3",{className:"font-semibold text-gray-800 mb-3",children:"\u30bf\u30b0"}),(0,pt.jsx)("div",{className:"flex flex-wrap gap-2",children:n.tags.map((e,t)=>(0,pt.jsx)("span",{className:"px-2 py-1 bg-indigo-100 text-indigo-800 rounded-full text-xs font-medium",children:e},t))})]})]})]})}),(0,pt.jsx)("div",{className:"lg:col-span-2",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,pt.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"\u5831\u544a\u66f8\u4e00\u89a7"}),(0,pt.jsxs)("div",{className:"flex gap-2",children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>d("daily"),children:"\ud83d\udcdd \u65e5\u6b21\u5831\u544a\u66f8\u4f5c\u6210"}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>d("weekly"),children:"\ud83d\udcca \u9031\u6b21\u5831\u544a\u66f8\u4f5c\u6210"}),(0,pt.jsx)("button",{className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>d("monthly"),children:"\ud83d\udcc8 \u6708\u6b21\u5831\u544a\u66f8\u4f5c\u6210"})]})]}),(0,pt.jsx)(Jc,{reports:o,onNavigateToReport:(e,t,n)=>{l({type:e,date:t,report:n})},onEditReport:(e,t)=>{console.log(`${e}\u5831\u544a\u66f8\u3092\u7de8\u96c6\u3057\u307e\u3059: ${t}`)},onDeleteReport:c,onDownloadPDF:e=>{try{switch(e.type){case"daily":zc(e,n);break;case"weekly":Oc(e,n);break;case"monthly":Rc(e,n);break;default:console.log("\u672a\u77e5\u306e\u5831\u544a\u66f8\u30bf\u30a4\u30d7:",e.type)}}catch(t){console.error("PDF\u751f\u6210\u30a8\u30e9\u30fc:",t),alert("PDF\u306e\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002")}},student:n})]})})]})})]})},Vc=()=>{const{studentId:e}=se(),t=ne(),[n,s]=(0,r.useState)(null),[a,l]=(0,r.useState)([]),[o,i]=(0,r.useState)(!1),[c,d]=(0,r.useState)({date:"",startTime:"",endTime:"",supportMethod:"",workContent:"",supportContent:"",healthStatus:""});(0,r.useEffect)(()=>{(()=>{const n=[{id:"student001",name:"\u672b\u5409\u3000\u5143\u6c17",email:"sueyoshi@example.com",class:"IT\u30ea\u30c6\u30e9\u30b7\u30fc\u30fbAI\u306e\u57fa\u672c",instructorId:"instructor001",instructorName:"\u4f50\u85e4\u6307\u5c0e\u54e1",locationId:"location001",locationName:"\u6771\u4eac\u672c\u6821",progress:75,lastLogin:"2024-01-15",status:"active",loginToken:"f9Ul-7OlL-OPZE",joinDate:"2024-01-01",canStudyAtHome:!0}].find(t=>t.id===e);n?s(n):(alert("\u5229\u7528\u8005\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002"),t("/instructor/dashboard"))})()},[e,t]),(0,r.useEffect)(()=>{l([{id:"record001",date:"2024-01-15",startTime:"10:00",endTime:"16:00",supportMethod:"\u8a2a\u554f",workContent:"\u30fb\u30d3\u30fc\u30ba\u7b49\u3092\u4f7f\u3063\u305f\u30a2\u30af\u30bb\u30b5\u30ea\u30fc\u4f5c\u308a\uff08\u524d\u56de\u7d42\u3048\u3089\u308c\u306a\u304b\u3063\u305f\u5206\u3082\u542b\u3080\uff09\n\u30fb\u4e0a\u8a18\u7d42\u4e86\u5f8c\u3001\u7d30\u304b\u3044\u4f5c\u696d\u306e\u8a13\u7df4\u306e\u305f\u3081\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\uff08\u7c21\u5358\u306a\u624b\u82b8\u4f5c\u54c1\u306e\u4f5c\u6210\uff09\u3092\u5b9f\u65bd",supportContent:"\u30fb9:00\u3000\u5229\u7528\u8005\u304b\u3089\u4f5c\u696d\u958b\u59cb\u306e\u96fb\u8a71\u3042\u308a\u3002\u524d\u56de\u4f5c\u6210\u4e88\u5b9a\u306e\u500b\u6570\u304c\u7d42\u308f\u3089\u306a\u304b\u3063\u305f\u306e\u306f\u3001\u96c6\u4e2d\u529b\u304c\u7d9a\u304b\u306a\u304b\u3063\u305f\u3053\u3068\u304c\u539f\u56e0\u306e\u3088\u3046\u3067\u3042\u308a\u300130\u5206\u3054\u3068\u306b\u5c11\u3057\u4f11\u61a9\u3092\u306f\u3055\u3080\u306a\u3069\u3057\u3066\u30ea\u30d5\u30ec\u30c3\u30b7\u30e5\u306e\u6642\u9593\u3092\u8a2d\u3051\u308b\u3053\u3068\u3092\u63d0\u6848\u3002\u4eca\u65e5\u306f\u3001\u524d\u56de\u306e\u6b8b\u308a\u5206\u3092\u542b\u3081\u300130\u500b\u306e\u4f5c\u6210\u3092\u76ee\u6a19\u3068\u3059\u308b\u3002\uff08\u6bcd\u89aa\u3078\u3082\u5831\u544a\uff09\n\u30fb12:00\u3000\u5229\u7528\u8005\u3078\u96fb\u8a71\u3002\u5348\u524d\u4e2d\u306e\u4f5c\u696d\u9032\u6357\u3092\u78ba\u8a8d\u3002\u76ee\u6a19\u306e\u534a\u5206\uff0815\u500b\uff09\u3092\u4f5c\u6210\u6e08\u307f\u300213:00\u307e\u3067\u663c\u4f11\u307f\u3092\u53d6\u308a\u300113:00\u304b\u3089\u518d\u958b\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002",healthStatus:"\u30fb9:00\u3000\u4f53\u6e2936.2\u2103\u3001\u7761\u7720\u6642\u95936\u6642\u9593\u3068\u78ba\u8a8d\u3002\u4f53\u8abf\u3082\u826f\u597d\u306a\u69d8\u5b50\u3002\u3044\u3064\u3082\u3069\u304a\u308a\u30b9\u30c8\u30ec\u30c3\u30c1\u3092\u884c\u3046\u3053\u3068\u3092\u52a9\u8a00\u3002\n\u30fb16:00\u3000\u3044\u3064\u3082\u4ee5\u4e0a\u306b\u4f5c\u696d\u3092\u9811\u5f35\u3063\u305f\u305b\u3044\u304b\u3001\u8efd\u3044\u982d\u75db\u3092\u611f\u3058\u308b\u3068\u306e\u3053\u3068\u3002\u30da\u30fc\u30b9\u3092\u8003\u3048\u3001\u9069\u5b9c\u4f11\u61a9\u3092\u3068\u308a\u306a\u304c\u3089\u3001\u30e1\u30ea\u30cf\u30ea\u3092\u3064\u3051\u3066\u4f5c\u696d\u3059\u308b\u3053\u3068\u3092\u52a9\u8a00\u3002",recorder:"\u5c71\u7530 \u6307\u5c0e\u54e1"},{id:"record002",date:"2024-01-14",startTime:"09:30",endTime:"15:30",supportMethod:"\u96fb\u8a71",workContent:"\u30fbIT\u30ea\u30c6\u30e9\u30b7\u30fc\u30fbAI\u306e\u57fa\u672c\u30b3\u30fc\u30b9\u306e\u5b66\u7fd2\n\u30fbWindows 11\u306e\u57fa\u672c\u64cd\u4f5c\u306e\u5fa9\u7fd2",supportContent:"\u30fb9:30\u3000\u5229\u7528\u8005\u304b\u3089\u5b66\u7fd2\u958b\u59cb\u306e\u9023\u7d61\u3002\u4eca\u65e5\u306fWindows 11\u306e\u57fa\u672c\u64cd\u4f5c\u3092\u5fa9\u7fd2\u3057\u305f\u3044\u3068\u306e\u3053\u3068\u3002\n\u30fb12:00\u3000\u5348\u524d\u4e2d\u306e\u5b66\u7fd2\u9032\u6357\u3092\u78ba\u8a8d\u3002\u57fa\u672c\u64cd\u4f5c\u306f\u9806\u8abf\u306b\u9032\u3093\u3067\u3044\u308b\u3002\n\u30fb15:00\u3000\u5b66\u7fd2\u7d42\u4e86\u306e\u78ba\u8a8d\u3002\u660e\u65e5\u306f\u65b0\u3057\u3044\u5185\u5bb9\u306b\u9032\u3080\u3053\u3068\u3092\u63d0\u6848\u3002",healthStatus:"\u30fb\u4f53\u8abf\u306f\u826f\u597d\u3002\u96c6\u4e2d\u529b\u3082\u4fdd\u305f\u308c\u3066\u3044\u308b\u3002\u9069\u5ea6\u306a\u4f11\u61a9\u3092\u53d6\u308b\u3088\u3046\u52a9\u8a00\u3002",recorder:"\u5c71\u7530 \u6307\u5c0e\u54e1"}])},[]);return n?(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 p-6",children:[(0,pt.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6 border border-gray-100",children:(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-indigo-500 hover:bg-indigo-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>t("/instructor/dashboard"),children:"\u2190 \u623b\u308b"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent",children:"\ud83d\udcdd \u65e5\u3005\u306e\u5c31\u52b4\u652f\u63f4\u8a18\u9332"}),(0,pt.jsxs)("div",{className:"mt-2",children:[(0,pt.jsx)("h2",{className:"text-xl font-semibold text-gray-800",children:n.name}),(0,pt.jsxs)("p",{className:"text-gray-600",children:[n.class," | ",n.instructorName," | ",n.locationName]})]})]})]}),(0,pt.jsx)("button",{className:"px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200",onClick:()=>i(!0),children:"\uff0b \u65b0\u898f\u8a18\u9332"})]})}),(0,pt.jsx)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:0===a.length?(0,pt.jsxs)("div",{className:"text-center py-12",children:[(0,pt.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udcdd"}),(0,pt.jsx)("p",{className:"text-gray-600 mb-4",children:"\u307e\u3060\u8a18\u9332\u304c\u3042\u308a\u307e\u305b\u3093\u3002"}),(0,pt.jsx)("button",{className:"px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-medium transition-all duration-200",onClick:()=>i(!0),children:"\u6700\u521d\u306e\u8a18\u9332\u3092\u4f5c\u6210"})]}):(0,pt.jsx)("div",{className:"space-y-6",children:a.map(e=>(0,pt.jsxs)("div",{className:"border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-all duration-200",children:[(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4",children:[(0,pt.jsx)("div",{className:"flex items-center gap-4",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"text-2xl font-bold text-indigo-600",children:e.date}),(0,pt.jsxs)("div",{className:"text-sm text-gray-600",children:[e.startTime," \uff5e ",e.endTime]})]})}),(0,pt.jsx)("div",{className:"flex items-center gap-2",children:(0,pt.jsx)("span",{className:"px-3 py-1 bg-indigo-100 text-indigo-800 rounded-full text-sm font-medium",children:e.supportMethod})})]}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h4",{className:"font-semibold text-gray-800 mb-2",children:"\u4f5c\u696d\u30fb\u8a13\u7df4\u5185\u5bb9"}),(0,pt.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(0,pt.jsx)("p",{className:"text-gray-700 whitespace-pre-line",children:e.workContent})})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h4",{className:"font-semibold text-gray-800 mb-2",children:"\u652f\u63f4\u5185\u5bb9\uff081\u65e52\u56de\u4ee5\u4e0a\uff09"}),(0,pt.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(0,pt.jsx)("p",{className:"text-gray-700 whitespace-pre-line",children:e.supportContent})})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h4",{className:"font-semibold text-gray-800 mb-2",children:"\u5bfe\u8c61\u8005\u306e\u5fc3\u8eab\u306e\u72b6\u6cc1\u53ca\u3073\u305d\u308c\u306b\u5bfe\u3059\u308b\u52a9\u8a00\u306e\u5185\u5bb9"}),(0,pt.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(0,pt.jsx)("p",{className:"text-gray-700 whitespace-pre-line",children:e.healthStatus})})]}),(0,pt.jsx)("div",{className:"border-t border-gray-200 pt-4",children:(0,pt.jsxs)("span",{className:"text-sm text-gray-600",children:["\u5bfe\u5fdc\u30fb\u8a18\u9332\u8005: ",(0,pt.jsx)("span",{className:"font-medium text-gray-800",children:e.recorder})]})})]})]},e.id))})})]}),o&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\u65e5\u3005\u306e\u5c31\u52b4\u652f\u63f4\u8a18\u9332\u4f5c\u6210"}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all duration-200",onClick:()=>i(!1),children:"\xd7"})]})}),(0,pt.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t={id:`record${Date.now()}`,...c,recorder:"\u5c71\u7530 \u6307\u5c0e\u54e1"};l([t,...a]),d({date:"",startTime:"",endTime:"",supportMethod:"",workContent:"",supportContent:"",healthStatus:""}),i(!1)},className:"p-6 space-y-6",children:[(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u5b9f\u65bd\u65e5 *"}),(0,pt.jsx)(Ct,{type:"date",value:c.date,onChange:e=>d({...c,date:e.target.value}),required:!0,sanitizeMode:_t.NONE,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u958b\u59cb\u6642\u9593 *"}),(0,pt.jsx)(Ct,{type:"time",value:c.startTime,onChange:e=>d({...c,startTime:e.target.value}),required:!0,sanitizeMode:_t.NONE,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u7d42\u4e86\u6642\u9593 *"}),(0,pt.jsx)(Ct,{type:"time",value:c.endTime,onChange:e=>d({...c,endTime:e.target.value}),required:!0,sanitizeMode:_t.NONE,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u652f\u63f4\u65b9\u6cd5 *"}),(0,pt.jsxs)("select",{value:c.supportMethod,onChange:e=>d({...c,supportMethod:e.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,pt.jsx)("option",{value:"",children:"\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),(0,pt.jsx)("option",{value:"\u8a2a\u554f",children:"\u8a2a\u554f"}),(0,pt.jsx)("option",{value:"\u96fb\u8a71",children:"\u96fb\u8a71"}),(0,pt.jsx)("option",{value:"\u305d\u306e\u4ed6",children:"\u305d\u306e\u4ed6"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u4f5c\u696d\u30fb\u8a13\u7df4\u5185\u5bb9 *"}),(0,pt.jsx)(Dt,{value:c.workContent,onChange:e=>d({...c,workContent:e.target.value}),placeholder:"\u5b9f\u65bd\u3057\u305f\u4f5c\u696d\u3084\u8a13\u7df4\u306e\u5185\u5bb9\u3092\u8a18\u8f09\u3057\u3066\u304f\u3060\u3055\u3044",required:!0,rows:"4",sanitizeMode:_t.FULL,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u652f\u63f4\u5185\u5bb9\uff081\u65e52\u56de\u4ee5\u4e0a\uff09 *"}),(0,pt.jsx)(Dt,{value:c.supportContent,onChange:e=>d({...c,supportContent:e.target.value}),placeholder:"\u5177\u4f53\u7684\u306a\u652f\u63f4\u5185\u5bb9\u3092\u6642\u9593\u9806\u306b\u8a18\u8f09\u3057\u3066\u304f\u3060\u3055\u3044",required:!0,rows:"6",sanitizeMode:_t.FULL,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"\u5bfe\u8c61\u8005\u306e\u5fc3\u8eab\u306e\u72b6\u6cc1\u53ca\u3073\u305d\u308c\u306b\u5bfe\u3059\u308b\u52a9\u8a00\u306e\u5185\u5bb9 *"}),(0,pt.jsx)(Dt,{value:c.healthStatus,onChange:e=>d({...c,healthStatus:e.target.value}),placeholder:"\u4f53\u8abf\u3084\u7cbe\u795e\u72b6\u614b\u3001\u305d\u308c\u306b\u5bfe\u3059\u308b\u52a9\u8a00\u3092\u8a18\u8f09\u3057\u3066\u304f\u3060\u3055\u3044",required:!0,rows:"4",sanitizeMode:_t.FULL,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"})]}),(0,pt.jsxs)("div",{className:"flex gap-4 pt-6 border-t border-gray-200",children:[(0,pt.jsx)("button",{type:"button",className:"flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl font-medium hover:bg-gray-200 transition-all duration-200",onClick:()=>i(!1),children:"\u30ad\u30e3\u30f3\u30bb\u30eb"}),(0,pt.jsx)("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200",children:"\u8a18\u9332"})]})]})]})})]}):(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 flex items-center justify-center",children:(0,pt.jsx)("div",{className:"text-indigo-600 text-xl font-semibold",children:"\u8aad\u307f\u8fbc\u307f\u4e2d..."})})},Hc=()=>{const e=ne(),[t,n]=(0,r.useState)([]),[s,a]=(0,r.useState)((new Date).toISOString().split("T")[0]),[l,o]=(0,r.useState)([]),[i,c]=(0,r.useState)({}),[d,u]=(0,r.useState)({}),[m,x]=(0,r.useState)(""),[g,h]=(0,r.useState)([]),[p,f]=(0,r.useState)([]),[b,y]=(0,r.useState)({}),[v,j]=(0,r.useState)({});(0,r.useEffect)(()=>{n([]),o([]),f([])},[]),(0,r.useEffect)(()=>{const e={},n={};t.forEach(t=>{e[t.id]={date:s,temperature:"36.2",healthCondition:"good",healthNotes:"\u4f53\u8abf\u306f\u826f\u597d\u3067\u3059\u3002",plannedWork:`${t.class}\u306e\u5b66\u7fd2\u3092\u9032\u3081\u307e\u3059\u3002`,actualWork:"\u5b66\u7fd2\u3092\u7d99\u7d9a\u3057\u3001\u65b0\u3057\u3044\u5185\u5bb9\u306b\u3064\u3044\u3066\u7406\u89e3\u3092\u6df1\u3081\u307e\u3057\u305f\u3002",thoughts:"\u5b66\u7fd2\u304c\u9806\u8abf\u306b\u9032\u3093\u3067\u3044\u307e\u3059\u3002",nextGoal:"\u6b21\u56de\u306f\u3088\u308a\u9ad8\u5ea6\u306a\u5185\u5bb9\u306b\u6311\u6226\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002"},n[t.id]={date:s,startTime:"10:00",endTime:"16:00",supportMethod:"\u96fb\u8a71",workContent:"",supportContent:"",healthStatus:""}}),c(e),u(n)},[t,s]);const N=(e,n)=>{const s=t.find(e=>e.id===n),r=i[n]||{};if(!s||!r.healthCondition)return"\u30c7\u30fc\u30bf\u304c\u6e96\u5099\u3067\u304d\u3066\u3044\u307e\u305b\u3093\u3002";let a="";switch(e){case"workContent":a=`\u30fb${r.actualWork||"\u4f5c\u696d\u5185\u5bb9\u3092\u78ba\u8a8d"}\n\u30fb${s.class}\u306e\u5b66\u7fd2\u3092\u7d99\u7d9a\n\u30fb\u4f5c\u696d\u52b9\u7387\u306e\u5411\u4e0a\u3092\u56f3\u308b`;break;case"supportContent":a=`\u30fb9:00\u3000\u5229\u7528\u8005\u304b\u3089\u4f5c\u696d\u958b\u59cb\u306e\u9023\u7d61\u3002\u4f53\u8abf\u78ba\u8a8d\uff08\u4f53\u6e29${r.temperature||"--"}\u2103\uff09\n\u30fb12:00\u3000\u5348\u524d\u4e2d\u306e\u4f5c\u696d\u9032\u6357\u3092\u78ba\u8a8d\u3002${r.actualWork||"\u4f5c\u696d\u5185\u5bb9\u3092\u78ba\u8a8d"}\n\u30fb15:00\u3000\u4f5c\u696d\u7d42\u4e86\u306e\u78ba\u8a8d\u3002\u6b21\u56de\u76ee\u6a19\uff1a${r.nextGoal||"\u76ee\u6a19\u3092\u8a2d\u5b9a"}`;break;case"healthStatus":const e="good"===r.healthCondition?"\u826f\u597d":"normal"===r.healthCondition?"\u666e\u901a":"\u60aa\u3044";a=`\u30fb\u4f53\u6e29${r.temperature||"--"}\u2103\u3001\u4f53\u8abf\u306f${e}\n\u30fb${r.healthNotes||"\u4f53\u8abf\u5099\u8003\u306a\u3057"}\n\u30fb\u9069\u5ea6\u306a\u4f11\u61a9\u3092\u53d6\u308b\u3088\u3046\u52a9\u8a00`;break;default:a="AI\u30a2\u30b7\u30b9\u30c8\u306e\u63d0\u6848\u3092\u751f\u6210\u4e2d..."}return a},w=(e,t,n)=>{u(s=>({...s,[e]:{...s[e],[t]:n}}))},k=(e,n)=>{let s=t;e&&(s=s.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())||t.email.toLowerCase().includes(e.toLowerCase())||t.class.toLowerCase().includes(e.toLowerCase()))),n.length>0&&(s=s.filter(e=>n.some(t=>e.tags.includes(t)))),o(s)};return(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-50",children:[(0,pt.jsx)("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 text-white shadow-lg",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,pt.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg hover:bg-opacity-20 transition-all duration-200 font-medium",onClick:()=>e("/instructor/dashboard?tab=home-support"),children:"\u2190 \u5728\u5b85\u652f\u63f4\u7ba1\u7406\u306b\u623b\u308b"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h1",{className:"text-2xl font-bold",children:"\ud83d\udcdd \u5728\u5b85\u652f\u63f4\u65e5\u6b21\u8a18\u9332"}),(0,pt.jsx)("p",{className:"text-green-100 text-sm",children:"\u5728\u5b85\u5b66\u7fd2\u8005\u306e\u65e5\u6b21\u8a18\u9332\u3068\u652f\u63f4\u5185\u5bb9\u306e\u7ba1\u7406"})]})]}),(0,pt.jsx)("div",{className:"flex items-center gap-3",children:(0,pt.jsxs)("span",{className:"px-4 py-2 bg-white bg-opacity-20 rounded-full text-sm font-semibold",children:[l.length,"\u540d\u306e\u5728\u5b85\u5b66\u7fd2\u8005"]})})]})})}),(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,pt.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[(0,pt.jsxs)("div",{className:"lg:col-span-1 space-y-6",children:[(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsx)("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"\ud83d\udcc5 \u65e5\u4ed8\u9078\u629e"}),(0,pt.jsx)("input",{type:"date",value:s,onChange:e=>{return t=e.target.value,void a(t);var t},className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsx)("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"\ud83d\udd0d \u691c\u7d22"}),(0,pt.jsx)("input",{type:"text",placeholder:"\u5229\u7528\u8005\u540d\u3001\u30e1\u30fc\u30eb\u3001\u30b3\u30fc\u30b9\u3067\u691c\u7d22...",value:m,onChange:e=>(e=>{x(e),k(e,g)})(e.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsx)("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"\ud83c\udff7\ufe0f \u30bf\u30b0\u30d5\u30a3\u30eb\u30bf\u30fc"}),(0,pt.jsx)("div",{className:"space-y-2",children:p.map(e=>(0,pt.jsxs)("label",{className:"flex items-center",children:[(0,pt.jsx)("input",{type:"checkbox",checked:g.includes(e),onChange:()=>(e=>{const t=g.includes(e)?g.filter(t=>t!==e):[...g,e];h(t),k(m,t)})(e),className:"w-4 h-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),(0,pt.jsx)("span",{className:"ml-2 text-sm text-gray-700",children:e})]},e))}),g.length>0&&(0,pt.jsx)("button",{onClick:()=>{h([]),k(m,[])},className:"mt-4 w-full px-3 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-medium transition-all duration-200",children:"\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u30af\u30ea\u30a2"})]}),(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsx)("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"\ud83d\udcc8 \u7d71\u8a08"}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsxs)("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[(0,pt.jsx)("span",{className:"text-green-800 font-medium",children:"\u7dcf\u5728\u5b85\u5b66\u7fd2\u8005"}),(0,pt.jsx)("span",{className:"text-2xl font-bold text-green-600",children:t.length})]}),(0,pt.jsxs)("div",{className:"flex items-center justify-between p-3 bg-blue-50 rounded-lg",children:[(0,pt.jsx)("span",{className:"text-blue-800 font-medium",children:"\u8868\u793a\u4e2d"}),(0,pt.jsx)("span",{className:"text-2xl font-bold text-blue-600",children:l.length})]}),(0,pt.jsxs)("div",{className:"flex items-center justify-between p-3 bg-orange-50 rounded-lg",children:[(0,pt.jsx)("span",{className:"text-orange-800 font-medium",children:"\u8a18\u9332\u672a\u5b8c\u4e86"}),(0,pt.jsx)("span",{className:"text-2xl font-bold text-orange-600",children:l.filter(e=>{var t;return!(null!==(t=d[e.id])&&void 0!==t&&t.workContent)}).length})]})]})]})]}),(0,pt.jsx)("div",{className:"lg:col-span-3",children:(0,pt.jsx)("div",{className:"space-y-6",children:l.map(e=>{const t=i[e.id]||{},n=d[e.id]||{};return(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,pt.jsxs)("div",{className:"flex items-start gap-4",children:[(0,pt.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full flex items-center justify-center text-white font-bold text-xl",children:e.name.charAt(0)}),(0,pt.jsxs)("div",{className:"flex-1",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-1",children:e.name}),(0,pt.jsx)("p",{className:"text-gray-600 mb-2",children:e.email}),(0,pt.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[(0,pt.jsxs)("span",{children:["\ud83d\udcda ",e.class]}),(0,pt.jsxs)("span",{children:["\ud83d\udc68\u200d\ud83c\udfeb ",e.instructorName]}),(0,pt.jsxs)("span",{children:["\ud83d\udccd ",e.locationName]})]})]})]}),(0,pt.jsxs)("div",{className:"text-right",children:[(0,pt.jsxs)("div",{className:"text-lg font-bold text-green-600 mb-1",children:[e.progress,"% \u5b8c\u4e86"]}),(0,pt.jsx)("div",{className:"text-sm text-gray-500",children:"\u5b66\u7fd2\u9032\u6357"})]})]}),(0,pt.jsx)("div",{className:"flex flex-wrap gap-2 mb-6",children:e.tags.map((e,t)=>(0,pt.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium",children:e},t))}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,pt.jsxs)("div",{className:"bg-gray-50 rounded-xl p-4",children:[(0,pt.jsx)("h4",{className:"font-semibold text-gray-800 mb-3",children:"\ud83d\udc64 \u5229\u7528\u8005\u4e8b\u524d\u5165\u529b"}),(0,pt.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u4f53\u6e29:"}),(0,pt.jsxs)("span",{className:"ml-2 text-gray-600",children:[t.temperature,"\u2103"]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u4f53\u8abf:"}),(0,pt.jsx)("span",{className:"ml-2 px-2 py-1 rounded text-xs font-medium "+("good"===t.healthCondition?"bg-green-100 text-green-800":"normal"===t.healthCondition?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:"good"===t.healthCondition?"\u826f\u597d":"normal"===t.healthCondition?"\u666e\u901a":"\u60aa\u3044"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u4e88\u5b9a\u4f5c\u696d:"}),(0,pt.jsx)("p",{className:"mt-1 text-gray-600",children:t.plannedWork})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("span",{className:"font-medium text-gray-700",children:"\u5b9f\u969b\u306e\u4f5c\u696d:"}),(0,pt.jsx)("p",{className:"mt-1 text-gray-600",children:t.actualWork})]})]})]}),(0,pt.jsxs)("div",{className:"space-y-4",children:[(0,pt.jsx)("h4",{className:"font-semibold text-gray-800",children:"\ud83d\udcdd \u6307\u5c0e\u54e1\u8a18\u9332"}),(0,pt.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u958b\u59cb\u6642\u9593"}),(0,pt.jsx)("input",{type:"time",value:n.startTime||"",onChange:t=>w(e.id,"startTime",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u7d42\u4e86\u6642\u9593"}),(0,pt.jsx)("input",{type:"time",value:n.endTime||"",onChange:t=>w(e.id,"endTime",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"\u652f\u63f4\u65b9\u6cd5"}),(0,pt.jsxs)("select",{value:n.supportMethod||"",onChange:t=>w(e.id,"supportMethod",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[(0,pt.jsx)("option",{value:"",children:"\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044"}),(0,pt.jsx)("option",{value:"\u96fb\u8a71",children:"\u96fb\u8a71"}),(0,pt.jsx)("option",{value:"\u30aa\u30f3\u30e9\u30a4\u30f3",children:"\u30aa\u30f3\u30e9\u30a4\u30f3"}),(0,pt.jsx)("option",{value:"\u8a2a\u554f",children:"\u8a2a\u554f"}),(0,pt.jsx)("option",{value:"\u30e1\u30fc\u30eb",children:"\u30e1\u30fc\u30eb"})]})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u4f5c\u696d\u5185\u5bb9",(0,pt.jsx)("button",{onClick:()=>w(e.id,"workContent",N("workContent",e.id)),className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-all duration-200",children:"\ud83e\udd16 AI\u63d0\u6848"})]}),(0,pt.jsx)("textarea",{value:n.workContent||"",onChange:t=>w(e.id,"workContent",t.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",placeholder:"\u4f5c\u696d\u5185\u5bb9\u3092\u8a18\u9332\u3057\u3066\u304f\u3060\u3055\u3044..."})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u652f\u63f4\u5185\u5bb9",(0,pt.jsx)("button",{onClick:()=>w(e.id,"supportContent",N("supportContent",e.id)),className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-all duration-200",children:"\ud83e\udd16 AI\u63d0\u6848"})]}),(0,pt.jsx)("textarea",{value:n.supportContent||"",onChange:t=>w(e.id,"supportContent",t.target.value),rows:"4",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",placeholder:"\u652f\u63f4\u5185\u5bb9\u3092\u8a18\u9332\u3057\u3066\u304f\u3060\u3055\u3044..."})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["\u5065\u5eb7\u72b6\u614b",(0,pt.jsx)("button",{onClick:()=>w(e.id,"healthStatus",N("healthStatus",e.id)),className:"ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-all duration-200",children:"\ud83e\udd16 AI\u63d0\u6848"})]}),(0,pt.jsx)("textarea",{value:n.healthStatus||"",onChange:t=>w(e.id,"healthStatus",t.target.value),rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none",placeholder:"\u5065\u5eb7\u72b6\u614b\u3092\u8a18\u9332\u3057\u3066\u304f\u3060\u3055\u3044..."})]}),(0,pt.jsxs)("div",{className:"flex gap-3",children:[(0,pt.jsx)("button",{onClick:()=>(e=>{const t=d[e]||{};console.log(`${e}\u306e\u8a18\u9332\u3092\u4fdd\u5b58:`,t),alert("\u8a18\u9332\u3092\u4fdd\u5b58\u3057\u307e\u3057\u305f\u3002")})(e.id),className:"flex-1 px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-all duration-200",children:"\ud83d\udcbe \u4fdd\u5b58"}),(0,pt.jsx)("button",{onClick:()=>(async e=>{j(t=>({...t,[e]:!0})),setTimeout(()=>{y(t=>({...t,[e]:{morning:"https://via.placeholder.com/150x150/4ade80/ffffff?text=\u671d",afternoon:"https://via.placeholder.com/150x150/fbbf24/ffffff?text=\u5348\u5f8c",evening:"https://via.placeholder.com/150x150/8b5cf6/ffffff?text=\u5915\u65b9"}})),j(t=>({...t,[e]:!1}))},1e3)})(e.id),className:"px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-medium transition-all duration-200",children:"\ud83d\udcf8 \u5199\u771f\u78ba\u8a8d"})]})]})]}),b[e.id]&&(0,pt.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 rounded-xl",children:[(0,pt.jsx)("h4",{className:"font-semibold text-gray-800 mb-3",children:"\ud83d\udcf8 \u5f53\u65e5\u306e\u5199\u771f"}),(0,pt.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("img",{src:b[e.id].morning,alt:"\u671d\u306e\u5199\u771f",className:"w-full h-32 object-cover rounded-lg mb-2"}),(0,pt.jsx)("p",{className:"text-sm text-gray-600",children:"\u671d"})]}),(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("img",{src:b[e.id].afternoon,alt:"\u5348\u5f8c\u306e\u5199\u771f",className:"w-full h-32 object-cover rounded-lg mb-2"}),(0,pt.jsx)("p",{className:"text-sm text-gray-600",children:"\u5348\u5f8c"})]}),(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("img",{src:b[e.id].evening,alt:"\u5915\u65b9\u306e\u5199\u771f",className:"w-full h-32 object-cover rounded-lg mb-2"}),(0,pt.jsx)("p",{className:"text-sm text-gray-600",children:"\u5915\u65b9"})]})]})]}),v[e.id]&&(0,pt.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 rounded-xl text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto mb-2"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u5199\u771f\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]})]},e.id)})})})]})})]})},Wc=()=>{const{studentId:e}=se(),t=ne(),{currentUser:n}=bt(),[s,a]=(0,r.useState)(null),[l,o]=(0,r.useState)([]),[i,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[g,h]=(0,r.useState)(!1),[p,f]=(0,r.useState)(!1);(0,r.useEffect)(()=>{b()},[e]);const b=async()=>{try{c(!0);const t=await fetch(`${ze.JR}/api/learning/instructor/student/${e}/lesson-progress`,{headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(t.ok){const e=await t.json();e.success?(a(e.data.student),o(e.data.progress)):u(e.message||"\u5b66\u751f\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}else u("\u5b66\u751f\u60c5\u5831\u306e\u53d6\u5f97\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(d){console.error("\u5b66\u751f\u9032\u6357\u53d6\u5f97\u30a8\u30e9\u30fc:",d),u("\u5b66\u751f\u60c5\u5831\u306e\u53d6\u5f97\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}finally{c(!1)}},y=async t=>{try{f(!0);const n=await fetch(`${ze.JR}/api/learning/instructor/student/${e}/lesson/${t}/approve`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("accessToken")}`,"Content-Type":"application/json"}});if(n.ok){const e=await n.json();e.success?(alert("\u30ec\u30c3\u30b9\u30f3\u5b8c\u4e86\u3092\u627f\u8a8d\u3057\u307e\u3057\u305f"),b()):alert(e.message||"\u627f\u8a8d\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}else alert("\u627f\u8a8d\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}catch(d){console.error("\u30ec\u30c3\u30b9\u30f3\u627f\u8a8d\u30a8\u30e9\u30fc:",d),alert("\u627f\u8a8d\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f")}finally{f(!1)}},v=e=>{switch(e){case"completed":return(0,pt.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"\u5b8c\u4e86"});case"in_progress":return(0,pt.jsx)("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"\u9032\u884c\u4e2d"});default:return(0,pt.jsx)("span",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded-full",children:"\u672a\u958b\u59cb"})}},j=e=>{if(null===e||void 0===e)return(0,pt.jsx)("span",{className:"text-gray-400",children:"-"});const t=e>=80?"green":e>=60?"yellow":"red";return(0,pt.jsxs)("span",{className:`px-2 py-1 bg-${t}-100 text-${t}-800 text-xs rounded-full`,children:[e,"\u70b9"]})};return i?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),(0,pt.jsx)("p",{className:"text-blue-600 text-xl font-semibold",children:"\u5b66\u751f\u60c5\u5831\u3092\u8aad\u307f\u8fbc\u307f\u4e2d..."})]})}):d?(0,pt.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 flex items-center justify-center",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("div",{className:"text-red-600 text-xl font-semibold mb-4",children:"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f"}),(0,pt.jsx)("p",{className:"text-gray-600 mb-4",children:d}),(0,pt.jsx)("button",{onClick:()=>t("/instructor/dashboard"),className:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u623b\u308b"})]})}):(0,pt.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50",children:[(0,pt.jsx)("div",{className:"bg-gradient-to-r from-blue-500 to-cyan-600 text-white shadow-lg",children:(0,pt.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:(0,pt.jsx)("div",{className:"flex items-center justify-between",children:(0,pt.jsxs)("div",{className:"flex items-center gap-4",children:[(0,pt.jsx)("button",{className:"px-4 py-2 bg-white bg-opacity-10 border border-white border-opacity-30 rounded-lg hover:bg-opacity-20 transition-all duration-200 font-medium",onClick:()=>t("/instructor/dashboard"),children:"\u2190 \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u623b\u308b"}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("h1",{className:"text-2xl font-bold",children:"\u5b66\u751f\u8a73\u7d30"}),(0,pt.jsxs)("span",{className:"text-blue-100 text-sm",children:[null===s||void 0===s?void 0:s.name," (",null===s||void 0===s?void 0:s.login_code,")"]})]})]})})})}),(0,pt.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-8 border border-gray-100",children:[(0,pt.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"\u5b66\u751f\u60c5\u5831"}),(0,pt.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"\u540d\u524d"}),(0,pt.jsx)("p",{className:"text-lg font-semibold text-gray-800",children:null===s||void 0===s?void 0:s.name})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"\u30ed\u30b0\u30a4\u30f3\u30b3\u30fc\u30c9"}),(0,pt.jsx)("p",{className:"text-lg font-mono text-gray-800",children:null===s||void 0===s?void 0:s.login_code})]}),(0,pt.jsxs)("div",{children:[(0,pt.jsx)("label",{className:"block text-sm font-medium text-gray-600",children:"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9"}),(0,pt.jsx)("p",{className:"text-lg text-gray-800",children:(null===s||void 0===s?void 0:s.email)||"\u672a\u8a2d\u5b9a"})]})]})]}),(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 border border-gray-100",children:[(0,pt.jsx)("h2",{className:"text-xl font-bold text-gray-800 mb-6",children:"\u30ec\u30c3\u30b9\u30f3\u9032\u6357"}),0===l.length?(0,pt.jsx)("div",{className:"text-center py-8",children:(0,pt.jsx)("p",{className:"text-gray-500",children:"\u30ec\u30c3\u30b9\u30f3\u9032\u6357\u304c\u3042\u308a\u307e\u305b\u3093"})}):(0,pt.jsx)("div",{className:"overflow-x-auto",children:(0,pt.jsxs)("table",{className:"w-full",children:[(0,pt.jsx)("thead",{children:(0,pt.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,pt.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"\u30ec\u30c3\u30b9\u30f3"}),(0,pt.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-gray-700",children:"\u30b3\u30fc\u30b9"}),(0,pt.jsx)("th",{className:"text-center py-3 px-4 font-semibold text-gray-700",children:"\u9032\u6357"}),(0,pt.jsx)("th",{className:"text-center py-3 px-4 font-semibold text-gray-700",children:"\u30c6\u30b9\u30c8\u30b9\u30b3\u30a2"}),(0,pt.jsx)("th",{className:"text-center py-3 px-4 font-semibold text-gray-700",children:"\u8ab2\u984c\u63d0\u51fa"}),(0,pt.jsx)("th",{className:"text-center py-3 px-4 font-semibold text-gray-700",children:"\u5b8c\u4e86\u65e5\u6642"}),(0,pt.jsx)("th",{className:"text-center py-3 px-4 font-semibold text-gray-700",children:"\u64cd\u4f5c"})]})}),(0,pt.jsx)("tbody",{children:l.map(e=>(0,pt.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,pt.jsx)("td",{className:"py-3 px-4",children:(0,pt.jsx)("div",{className:"font-semibold text-gray-800",children:e.lesson_title})}),(0,pt.jsx)("td",{className:"py-3 px-4 text-gray-600",children:e.course_title}),(0,pt.jsx)("td",{className:"py-3 px-4 text-center",children:v(e.status)}),(0,pt.jsx)("td",{className:"py-3 px-4 text-center",children:j(e.test_score)}),(0,pt.jsx)("td",{className:"py-3 px-4 text-center",children:e.assignment_submitted?(0,pt.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"\u63d0\u51fa\u6e08\u307f"}):(0,pt.jsx)("span",{className:"text-gray-400",children:"-"})}),(0,pt.jsx)("td",{className:"py-3 px-4 text-center text-sm text-gray-600",children:e.completed_at?new Date(e.completed_at).toLocaleDateString("ja-JP"):"-"}),(0,pt.jsx)("td",{className:"py-3 px-4 text-center",children:(0,pt.jsxs)("div",{className:"flex gap-2 justify-center",children:["completed"===e.status&&e.test_score>=29&&(0,pt.jsx)("button",{className:"px-3 py-1 bg-gradient-to-r from-green-500 to-green-600 text-white text-xs rounded-lg font-medium hover:shadow-lg transition-all duration-200",onClick:()=>(e=>{x(e),h(!0)})(e),children:"\ud83c\udfc6 \u7d42\u4e86\u8a3c"}),e.assignment_submitted&&(0,pt.jsx)("button",{className:"px-3 py-1 bg-gradient-to-r from-purple-500 to-purple-600 text-white text-xs rounded-lg font-medium hover:shadow-lg transition-all duration-200",onClick:()=>(e=>{alert(`\u63d0\u51fa\u7269\u78ba\u8a8d\u6a5f\u80fd\u306f\u4eca\u5f8c\u5b9f\u88c5\u4e88\u5b9a\u3067\u3059\u3002\n\u30ec\u30c3\u30b9\u30f3: ${e.lesson_title}`)})(e),children:"\ud83d\udcc4 \u63d0\u51fa\u7269"}),"completed"===e.status&&e.test_score>=29&&!e.completed_at&&(0,pt.jsx)("button",{className:"px-3 py-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-xs rounded-lg font-medium hover:shadow-lg transition-all duration-200 disabled:opacity-50",onClick:()=>y(e.lesson_id),disabled:p,children:p?"\u627f\u8a8d\u4e2d...":"\u2705 \u627f\u8a8d"})]})})]},e.lesson_id))})]})})]})]}),g&&m&&(0,pt.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,pt.jsxs)("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,pt.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,pt.jsxs)("div",{className:"flex items-center justify-between",children:[(0,pt.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:"\u4fee\u4e86\u8a3c"}),(0,pt.jsx)("button",{className:"text-gray-400 hover:text-gray-600 text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-all duration-200",onClick:()=>h(!1),children:"\xd7"})]})}),(0,pt.jsxs)("div",{className:"p-6",children:[(0,pt.jsxs)("div",{className:"text-center mb-6",children:[(0,pt.jsx)("div",{className:"text-6xl mb-4",children:"\ud83c\udfc6"}),(0,pt.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"\u4fee\u4e86\u8a3c"}),(0,pt.jsx)("p",{className:"text-gray-600",children:"\u3053\u306e\u8a3c\u66f8\u306f\u3001\u4ee5\u4e0b\u306e\u5b66\u7fd2\u3092\u5b8c\u4e86\u3057\u305f\u3053\u3068\u3092\u8a3c\u660e\u3057\u307e\u3059"})]}),(0,pt.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-cyan-50 rounded-xl p-6 mb-6",children:(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:m.lesson_title}),(0,pt.jsx)("p",{className:"text-gray-600 mb-4",children:m.course_title}),(0,pt.jsxs)("div",{className:"flex justify-center items-center gap-4 text-sm text-gray-600",children:[(0,pt.jsxs)("span",{children:["\u53d7\u8b1b\u8005: ",null===s||void 0===s?void 0:s.name]}),(0,pt.jsx)("span",{children:"|"}),(0,pt.jsxs)("span",{children:["\u30b9\u30b3\u30a2: ",m.test_score,"\u70b9"]}),(0,pt.jsx)("span",{children:"|"}),(0,pt.jsxs)("span",{children:["\u5b8c\u4e86\u65e5: ",(new Date).toLocaleDateString("ja-JP")]})]})]})}),(0,pt.jsxs)("div",{className:"text-center",children:[(0,pt.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"\u6307\u5c0e\u54e1\u306b\u3088\u308b\u627f\u8a8d\u5f8c\u3001\u3053\u306e\u30ec\u30c3\u30b9\u30f3\u304c\u6b63\u5f0f\u306b\u5b8c\u4e86\u3068\u306a\u308a\u307e\u3059"}),m.assignment_submitted&&(0,pt.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:(0,pt.jsx)("p",{className:"text-sm text-yellow-800",children:"\u26a0\ufe0f \u3053\u306e\u30ec\u30c3\u30b9\u30f3\u306b\u306f\u63d0\u51fa\u7269\u304c\u3042\u308a\u307e\u3059\u3002\u63d0\u51fa\u7269\u306e\u78ba\u8a8d\u3082\u5b8c\u4e86\u3057\u3066\u304b\u3089\u627f\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})}),(0,pt.jsxs)("div",{className:"flex gap-4 justify-center",children:[(0,pt.jsx)("button",{className:"px-6 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200",onClick:()=>h(!1),children:"\u9589\u3058\u308b"}),(0,pt.jsx)("button",{className:"px-6 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-medium hover:shadow-lg transition-all duration-200",onClick:()=>{y(m.lesson_id),h(!1)},disabled:p,children:p?"\u627f\u8a8d\u4e2d...":"\u2705 \u4fee\u4e86\u78ba\u8a8d"})]})]})]})]})})]})},Qc=()=>(0,pt.jsxs)("div",{style:{padding:"20px",backgroundColor:"#f0f0f0",minHeight:"100vh"},children:[(0,pt.jsx)("h1",{children:"Test Component - App is working!"}),(0,pt.jsx)("p",{children:"If you can see this, the React app is loading correctly."}),(0,pt.jsxs)("p",{children:["Current URL: ",window.location.href]}),(0,pt.jsxs)("p",{children:["PUBLIC_URL: ",""]}),(0,pt.jsxs)("p",{children:["NODE_ENV: ","production"]})]});const Kc=function(){return(0,pt.jsx)(Ce,{basename:"",future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:(0,pt.jsx)(yt,{children:(0,pt.jsxs)("div",{className:"App",children:[(0,pt.jsxs)(ve,{children:[(0,pt.jsx)(be,{path:"/test",element:(0,pt.jsx)(Qc,{})}),(0,pt.jsx)(be,{path:"/",element:(0,pt.jsx)(jt,{})}),(0,pt.jsx)(be,{path:"/homepage",element:(0,pt.jsx)(jt,{})}),(0,pt.jsx)(be,{path:"/admin-instructor-login",element:(0,pt.jsx)(It,{})}),(0,pt.jsx)(be,{path:"/admin/dashboard",element:(0,pt.jsx)(Jt,{})}),(0,pt.jsx)(be,{path:"/instructor/dashboard",element:(0,pt.jsx)(On,{})}),(0,pt.jsx)(be,{path:"/teacher/dashboard",element:(0,pt.jsx)(On,{})}),(0,pt.jsx)(be,{path:"/student/login/:token",element:(0,pt.jsx)(Rn,{})}),(0,pt.jsx)(be,{path:"/student-login/",element:(0,pt.jsx)(Rn,{})}),(0,pt.jsx)(be,{path:"/student/login",element:(0,pt.jsx)(Rn,{})}),(0,pt.jsx)(be,{path:"/auto-login/",element:(0,pt.jsx)(wo,{})}),(0,pt.jsx)(be,{path:"/student/dashboard",element:(0,pt.jsx)(No,{})}),(0,pt.jsx)(be,{path:"/student/enhanced-learning",element:(0,pt.jsx)(Tc,{})}),(0,pt.jsx)(be,{path:"/student/test",element:(0,pt.jsx)(Pc,{})}),(0,pt.jsx)(be,{path:"/student/section-test",element:(0,pt.jsx)(Ec,{})}),(0,pt.jsx)(be,{path:"/student/lesson-test",element:(0,pt.jsx)(Dc,{})}),(0,pt.jsx)(be,{path:"/student/test-result",element:(0,pt.jsx)(Ac,{})}),(0,pt.jsx)(be,{path:"/student/certificate",element:(0,pt.jsx)($c,{})}),(0,pt.jsx)(be,{path:"/instructor/student/:studentId",element:(0,pt.jsx)(qc,{})}),(0,pt.jsx)(be,{path:"/instructor/student-detail/:studentId",element:(0,pt.jsx)(Wc,{})}),(0,pt.jsx)(be,{path:"/instructor/student/:studentId/daily-records",element:(0,pt.jsx)(Vc,{})}),(0,pt.jsx)(be,{path:"/instructor/daily-records",element:(0,pt.jsx)(Hc,{})}),(0,pt.jsx)(be,{path:"/instructor/evaluations",element:(0,pt.jsx)(Pn,{})}),(0,pt.jsx)(be,{path:"/instructor/home-support-evaluations",element:(0,pt.jsx)(Pn,{})}),(0,pt.jsx)(be,{path:"/instructor/student-detail/:studentId",element:(0,pt.jsx)(qc,{})})]}),(0,pt.jsx)(vt,{})]})})})};l.createRoot(document.getElementById("root")).render((0,pt.jsx)(r.StrictMode,{children:(0,pt.jsx)(Kc,{})}))})()})();
//# sourceMappingURL=main.c616c44f.js.map